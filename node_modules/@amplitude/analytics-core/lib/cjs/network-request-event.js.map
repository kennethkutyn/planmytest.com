{"version":3,"file":"network-request-event.js","sourceRoot":"","sources":["../../src/network-request-event.ts"],"names":[],"mappings":"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","sourcesContent":["import { getGlobalScope } from './global-scope';\nimport { pruneJson } from './utils/json-query';\nimport { SAFE_HEADERS, FORBIDDEN_HEADERS } from './';\n\n/* SAFE TYPE DEFINITIONS\n  These type definitions expose limited properties of the original types\n  to prevent the consumer from mutating them or consuming them.\n*/\ntype BlobSafe = {\n  size: number;\n};\n\ntype ArrayBufferSafe = {\n  byteLength: number;\n};\n\ntype ArrayBufferViewSafe = {\n  byteLength: number;\n};\n\ntype URLSearchParamsSafe = {\n  toString(): string;\n};\n\n// no method on readablestream is safe to call\ntype ReadableStreamSafe = Record<string, never>;\n\ntype FormDataEntryValueSafe = string | BlobSafe | null;\n\ntype BodyInitSafe =\n  | string\n  | Blob\n  | ArrayBufferSafe\n  | FormDataSafe\n  | URLSearchParamsSafe\n  | ArrayBufferViewSafe\n  | null\n  | undefined;\n\ntype HeadersRequestSafe = {\n  entries(): IterableIterator<[string, string]>;\n  forEach(callbackfn: (value: string, key: string) => void): void;\n};\n\ntype HeadersResponseSafe = {\n  get(name: string): string | null;\n  forEach(callbackfn: (value: string, key: string) => void): void;\n};\n\ntype HeadersInitSafe = HeadersRequestSafe | Record<string, string> | string[][];\n\ntype ResponseSafe = {\n  status: number;\n  headers: HeadersResponseSafe | undefined;\n  clone(): ResponseCloneSafe;\n};\n\ntype ResponseCloneSafe = {\n  text(): Promise<string>;\n};\n\nconst TEXT_READ_TIMEOUT = 500;\n\nexport type RequestInitSafe = {\n  method?: string;\n  headers?: HeadersInitSafe;\n  body?: BodyInitSafe;\n};\nexport interface FormDataSafe {\n  entries(): IterableIterator<[string, FormDataEntryValueSafe]>;\n}\nexport type XMLHttpRequestBodyInitSafe = BlobSafe | FormDataSafe | URLSearchParamsSafe | string;\n\nexport type FetchRequestBody =\n  | string\n  | BlobSafe\n  | ArrayBufferSafe\n  | FormDataSafe\n  | URLSearchParamsSafe\n  | ArrayBufferViewSafe\n  | null\n  | undefined;\n\nexport interface IRequestWrapper {\n  /**\n   * Get the headers of the request.\n   * @param allow - The headers to allow.\n   * @returns The pruned headers\n   */\n  headers(allow?: string[]): Record<string, string> | undefined;\n  bodySize?: number;\n  method?: string;\n  body?: FetchRequestBody | XMLHttpRequestBodyInitSafe | null;\n  json: (allow?: string[], exclude?: string[]) => Promise<JsonObject | null>;\n}\n\nexport const MAXIMUM_ENTRIES = 100;\n\n/**\n * This class encapsulates the RequestInit (https://developer.mozilla.org/en-US/docs/Web/API/RequestInit)\n * object so that the consumer can only get access to the headers, method and body size.\n *\n * This is to prevent consumers from directly accessing the Request object\n * and mutating it or running costly operations on it.\n *\n * IMPORTANT:\n *    * Do not make changes to this class without careful consideration\n *      of performance implications, memory usage and potential to mutate the customer's\n *      request.\n *   * NEVER .clone() the RequestInit object. This will 2x's the memory overhead of the request\n *   * NEVER: call .arrayBuffer(), text(), json() or any other method on the body that\n *     consumes the body's stream. This will cause the response to be consumed\n *     meaning the body will be empty when the customer tries to access it.\n *     (ie: if the body is an instanceof https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n *      never call any of the methods on it)\n */\nexport class RequestWrapperFetch implements IRequestWrapper {\n  private _bodySize: number | undefined;\n  constructor(private request: RequestInitSafe) {}\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    const headersUnsafe = this.request.headers;\n\n    // copy the headers into a new object\n    const headersSafeCopy: Record<string, string> = {};\n    if (Array.isArray(headersUnsafe)) {\n      headersUnsafe.forEach(([headerName, headerValue]) => {\n        headersSafeCopy[headerName] = headerValue;\n      });\n    } else if (headersUnsafe instanceof Headers) {\n      headersUnsafe.forEach((value: string, key: string) => {\n        headersSafeCopy[key] = value;\n      });\n    } else if (typeof headersUnsafe === 'object' && headersUnsafe !== null) {\n      for (const [key, value] of Object.entries(headersUnsafe as Record<string, string>)) {\n        headersSafeCopy[key] = value;\n      }\n    }\n\n    return pruneHeaders(headersSafeCopy, { allow });\n  }\n\n  get bodySize(): number | undefined {\n    if (typeof this._bodySize === 'number') return this._bodySize;\n    const global = getGlobalScope();\n\n    /* istanbul ignore if */\n    if (!global?.TextEncoder) {\n      return;\n    }\n    const body = this.request.body as FetchRequestBody;\n    this._bodySize = getBodySize(body, MAXIMUM_ENTRIES);\n    return this._bodySize;\n  }\n\n  get method(): string | undefined {\n    return this.request.method;\n  }\n\n  get body(): string | null {\n    if (typeof this.request.body === 'string') {\n      return this.request.body;\n    }\n    return null;\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const text = this.body;\n    return safeParseAndPruneBody(text, allow, exclude);\n  }\n}\n\nexport class RequestWrapperXhr implements IRequestWrapper {\n  constructor(readonly bodyRaw: XMLHttpRequestBodyInitSafe | null, readonly requestHeaders: Record<string, string>) {}\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    return pruneHeaders(this.requestHeaders, { allow });\n  }\n\n  get bodySize(): number | undefined {\n    return getBodySize(this.bodyRaw as FetchRequestBody, MAXIMUM_ENTRIES);\n  }\n\n  get body(): string | null {\n    if (typeof this.bodyRaw === 'string') {\n      return this.bodyRaw;\n    }\n    return null;\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const text = this.body;\n    return safeParseAndPruneBody(text, allow, exclude);\n  }\n}\n\nfunction getBodySize(bodyUnsafe: FetchRequestBody, maxEntries: number): number | undefined {\n  let bodySize: number | undefined;\n  const global = getGlobalScope();\n  /* istanbul ignore next */\n  const TextEncoder = global?.TextEncoder;\n  /* istanbul ignore next */\n  if (!TextEncoder) {\n    return;\n  }\n  let bodySafe;\n  if (typeof bodyUnsafe === 'string') {\n    bodySafe = bodyUnsafe;\n    bodySize = new TextEncoder().encode(bodySafe).length;\n  } else if (bodyUnsafe instanceof Blob) {\n    bodySafe = bodyUnsafe as BlobSafe;\n    bodySize = bodySafe.size;\n  } else if (bodyUnsafe instanceof URLSearchParams) {\n    bodySafe = bodyUnsafe as URLSearchParamsSafe;\n    bodySize = new TextEncoder().encode(bodySafe.toString()).length;\n  } else if (ArrayBuffer.isView(bodyUnsafe)) {\n    bodySafe = bodyUnsafe as ArrayBufferViewSafe;\n    bodySize = bodySafe.byteLength;\n  } else if (bodyUnsafe instanceof ArrayBuffer) {\n    bodySafe = bodyUnsafe as ArrayBufferSafe;\n    bodySize = bodySafe.byteLength;\n  } else if (bodyUnsafe instanceof FormData) {\n    // Estimating only for text parts; not accurate for files\n    const formData = bodyUnsafe as unknown as FormDataSafe;\n\n    let total = 0;\n    let count = 0;\n    for (const [key, value] of formData.entries()) {\n      total += key.length;\n      if (typeof value === 'string') {\n        total += new TextEncoder().encode(value).length;\n      } else if (value instanceof Blob) {\n        total += value.size;\n      } else {\n        // encountered an unknown type\n        // we can't estimate the size of this entry\n        return;\n      }\n      // terminate if we reach the maximum number of entries\n      // to avoid performance issues in case of very large FormData\n      if (++count >= maxEntries) {\n        return;\n      }\n    }\n    bodySize = total;\n  } else if (bodyUnsafe instanceof ReadableStream) {\n    // If bodyUnsafe is an instanceof ReadableStream, we can't determine the size,\n    // without consuming it, so we return undefined.\n    // Never ever consume ReadableStream! DO NOT DO IT!!!\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    bodySafe = bodyUnsafe as unknown as ReadableStreamSafe;\n    return;\n  }\n  return bodySize;\n}\n\nexport type JsonObject = {\n  [key: string]: JsonValue;\n};\n\nexport type JsonValue = string | number | boolean | null | JsonObject | JsonArray;\n\nexport type JsonArray = Array<JsonValue>;\n\nexport interface IResponseWrapper {\n  /**\n   * Get the headers of the response.\n   * @param allow - The headers to allow.\n   * @returns The pruned headers\n   */\n  headers(allow?: string[]): Record<string, string> | undefined;\n  bodySize?: number;\n  status?: number;\n  body?: string | Blob | ReadableStream | ArrayBuffer | FormDataSafe | URLSearchParams | ArrayBufferView | null;\n  json: (allow?: string[], exclude?: string[]) => Promise<JsonObject | null>;\n}\n\n/**\n * This class encapsulates the Fetch API Response object\n * (https://developer.mozilla.org/en-US/docs/Web/API/Response) so that the consumer can\n * only get access to the headers and body size.\n *\n * This is to prevent consumers from directly accessing the Response object\n * and mutating it or running costly operations on it.\n *\n * IMPORTANT:\n *   * Do not make changes to this class without careful consideration\n *     of performance implications, memory usage and potential to mutate the customer's\n *     response.\n *   * Do not .clone() the Response object unless you need to access the body.\n *     Cloning will 2x the memory overhead of the response.\n *   * NEVER consume the body's stream. This will cause the response to be consumed\n *     meaning the body will be empty when the customer tries to access it.\n *     (ie: if the body is an instanceof https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\n *      never call any of the methods on it)\n */\nexport class ResponseWrapperFetch implements IResponseWrapper {\n  private _bodySize: number | undefined;\n  private clonedResponse?: ResponseCloneSafe;\n  constructor(private response: ResponseSafe) {}\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    if (this.response.headers instanceof Headers) {\n      const headersSafe = this.response.headers as HeadersResponseSafe;\n      const headersOut: Record<string, string> = {};\n      /* istanbul ignore next */\n      headersSafe?.forEach?.((value, key) => {\n        headersOut[key] = value;\n      });\n      return pruneHeaders(headersOut, { allow });\n    }\n\n    return;\n  }\n\n  get bodySize(): number | undefined {\n    if (this._bodySize !== undefined) return this._bodySize;\n    /* istanbul ignore next */\n    const contentLength = this.response.headers?.get?.('content-length');\n    const bodySize = contentLength ? parseInt(contentLength, 10) : undefined;\n    this._bodySize = bodySize;\n    return bodySize;\n  }\n\n  get status(): number {\n    return this.response.status;\n  }\n\n  async text(): Promise<string | null> {\n    // !!!IMPORTANT: we clone the response to avoid mutating the original response\n    // never call .text(), .json(), etc.. on the original response always clone it first\n    if (!this.clonedResponse) {\n      this.clonedResponse = this.response.clone();\n    }\n    try {\n      const textPromise = this.clonedResponse.text();\n      const timer = new Promise<null>((resolve) =>\n        setTimeout(\n          /* istanbul ignore next */\n          () => resolve(null),\n          TEXT_READ_TIMEOUT,\n        ),\n      );\n      const text = await Promise.race<string | null>([textPromise, timer]);\n      return text;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const text = await this.text();\n    return safeParseAndPruneBody(text, allow, exclude);\n  }\n}\n\nexport class ResponseWrapperXhr implements IResponseWrapper {\n  constructor(\n    readonly statusCode: number,\n    readonly headersString: string,\n    readonly size: number | undefined,\n    readonly getJson: () => any | null,\n  ) {}\n\n  get bodySize(): number | undefined {\n    return this.size;\n  }\n\n  get status(): number {\n    return this.statusCode;\n  }\n\n  headers(allow: string[] = []): Record<string, string> | undefined {\n    if (!this.headersString) {\n      return {};\n    }\n    const headers: Record<string, string> = {};\n    const headerLines = this.headersString.split('\\r\\n');\n    for (const line of headerLines) {\n      const [key, value] = line.split(': ');\n      if (key && value) {\n        headers[key] = value;\n      }\n    }\n    return pruneHeaders(headers, { allow });\n  }\n\n  async json(allow: string[] = [], exclude: string[] = []): Promise<JsonObject | null> {\n    if (allow.length === 0) {\n      return null;\n    }\n    const jsonBody = this.getJson() as JsonObject | null;\n    if (jsonBody) {\n      pruneJson(jsonBody, allow, exclude);\n      return jsonBody;\n    }\n    return null;\n  }\n}\n\nfunction safeParseAndPruneBody(text: string | null, allow: string[], exclude: string[]): JsonObject | null {\n  if (!text) return null;\n  try {\n    const json = JSON.parse(text) as JsonObject;\n    pruneJson(json, allow, exclude);\n    return json;\n  } catch (error) {\n    return null;\n  }\n}\n\nexport enum PRUNE_STRATEGY {\n  REDACT = 'redact',\n  REMOVE = 'remove',\n}\n\nconst REDACTED_VALUE = '[REDACTED]';\n\n/**\n * Prune headers from a headers record object.\n * @param headers - The headers to prune.\n * @param options - The options to prune the headers.\n * @param options.exclude - List of headers to delete from headers\n * @param options.include - List of headers to keep in headers, if not provided, all headers are kept by default\n * @returns The pruned headers.\n */\nexport const pruneHeaders = (\n  headers: Record<string, string>,\n  options: {\n    allow?: string[];\n    strategy?: PRUNE_STRATEGY;\n  },\n): Record<string, string> => {\n  const { allow = [], strategy = PRUNE_STRATEGY.REMOVE } = options;\n  const exclude = [...FORBIDDEN_HEADERS];\n  const headersPruned: Record<string, string> = {};\n\n  for (const key of Object.keys(headers)) {\n    const lowerKey = key.toLowerCase();\n\n    if (exclude.find((e) => e.toLowerCase() === lowerKey)) {\n      if (strategy === PRUNE_STRATEGY.REDACT) {\n        headersPruned[key] = REDACTED_VALUE;\n      }\n    } else if (!allow.find((i) => i.toLowerCase() === lowerKey)) {\n      if (strategy === PRUNE_STRATEGY.REDACT) {\n        headersPruned[key] = REDACTED_VALUE;\n      }\n    } else {\n      headersPruned[key] = headers[key];\n    }\n  }\n  return headersPruned;\n};\nexport class NetworkRequestEvent {\n  public requestHeaders?: Record<string, string>;\n  public responseHeaders?: Record<string, string>;\n  public requestBodyJson?: Promise<JsonObject | null>;\n  public responseBodyJson?: Promise<JsonObject | null>;\n  constructor(\n    public readonly type: 'xhr' | 'fetch',\n    public readonly method: string,\n    public readonly timestamp: number,\n    public readonly startTime: number,\n    public readonly url?: string,\n    public readonly requestWrapper?: IRequestWrapper,\n    public readonly status: number = 0,\n    public readonly duration?: number,\n    public readonly responseWrapper?: IResponseWrapper,\n    public readonly error?: {\n      name: string;\n      message: string;\n    },\n    public readonly endTime?: number,\n  ) {}\n\n  toSerializable(): Record<string, any> {\n    const serialized: Record<string, any> = {\n      type: this.type,\n      method: this.method,\n      url: this.url,\n      timestamp: this.timestamp,\n      status: this.status,\n      duration: this.duration,\n      error: this.error,\n      startTime: this.startTime,\n      endTime: this.endTime,\n      requestHeaders: this.requestWrapper?.headers([...SAFE_HEADERS]),\n      requestBodySize: this.requestWrapper?.bodySize,\n      responseHeaders: this.responseWrapper?.headers([...SAFE_HEADERS]),\n      responseBodySize: this.responseWrapper?.bodySize,\n    };\n\n    return Object.fromEntries(Object.entries(serialized).filter(([_, v]) => v !== undefined));\n  }\n}\n"]}