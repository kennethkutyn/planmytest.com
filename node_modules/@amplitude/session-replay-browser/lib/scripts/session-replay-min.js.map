{"version":3,"file":"session-replay-min.js","sources":["../../../analytics-core/lib/esm/types/event/event.js","../../../analytics-core/lib/esm/types/constants.js","../../../analytics-core/lib/esm/types/status.js","../../../analytics-core/lib/esm/global-scope.js","../../../analytics-core/lib/esm/types/loglevel.js","../../../analytics-core/lib/esm/utils/return-wrapper.js","../../../analytics-core/lib/esm/logger.js","../../../analytics-core/lib/esm/config.js","../../../../node_modules/@amplitude/analytics-connector/dist/analytics-connector.esm.js","../../../analytics-core/lib/esm/types/server-zone.js","../../../analytics-core/lib/esm/transports/base.js","../../../analytics-core/lib/esm/transports/fetch.js","../../../../node_modules/@amplitude/rrweb-types/dist/rrweb-types.js","../../../analytics-remote-config/node_modules/@amplitude/analytics-types/lib/esm/server-zone.js","../../../analytics-remote-config/node_modules/@amplitude/analytics-types/lib/esm/status.js","../../../analytics-remote-config/node_modules/@amplitude/analytics-core/lib/esm/transports/base.js","../../../analytics-remote-config/lib/esm/remote-config.js","../../../analytics-remote-config/lib/esm/index.js","../../../../src/config/types.ts","../../../../src/constants.ts","../../../../src/helpers.ts","../../../../src/utils/get-input-type.ts","../../../../src/logger.ts","../../../../src/config/local-config.ts","../../../../src/config/joined-config.ts","../../../../node_modules/@amplitude/rrweb-packer/dist/base-BrE4jft0.js","../../../../node_modules/@amplitude/rrweb-packer/dist/pack.js","../../../../src/events/event-compressor.ts","../../../../src/messages.ts","../../../../src/version.ts","../../../../src/track-destination.ts","../../../../src/events/base-events-store.ts","../../../../src/events/legacy-idb-types.ts","../../../../src/events/events-idb-store.ts","../../../../src/events/events-memory-store.ts","../../../../src/events/events-manager.ts","../../../../src/events/multi-manager.ts","../../../../node_modules/@amplitude/rrweb-utils/dist/rrweb-utils.js","../../../../src/utils/rrweb.ts","../../../../src/libs/finder.ts","../../../../src/hooks/click.ts","../../../../src/beacon-transport.ts","../../../../src/hooks/scroll.ts","../../../../src/identifiers.ts","../../../../src/targeting/targeting-idb-store.ts","../../../../src/plugins/url-tracking-plugin.ts","../../../../src/session-replay.ts","../../../../src/targeting/targeting-manager.ts","../../../analytics-core/lib/esm/analytics-connector.js"],"sourcesContent":["export var IdentifyOperation;\n(function (IdentifyOperation) {\n    // Base Operations to set values\n    IdentifyOperation[\"SET\"] = \"$set\";\n    IdentifyOperation[\"SET_ONCE\"] = \"$setOnce\";\n    // Operations around modifying existing values\n    IdentifyOperation[\"ADD\"] = \"$add\";\n    IdentifyOperation[\"APPEND\"] = \"$append\";\n    IdentifyOperation[\"PREPEND\"] = \"$prepend\";\n    IdentifyOperation[\"REMOVE\"] = \"$remove\";\n    // Operations around appending values *if* they aren't present\n    IdentifyOperation[\"PREINSERT\"] = \"$preInsert\";\n    IdentifyOperation[\"POSTINSERT\"] = \"$postInsert\";\n    // Operations around removing properties/values\n    IdentifyOperation[\"UNSET\"] = \"$unset\";\n    IdentifyOperation[\"CLEAR_ALL\"] = \"$clearAll\";\n})(IdentifyOperation || (IdentifyOperation = {}));\n/**\n * Strings that have special meaning when used as an event's type\n * and have different specifications.\n */\nexport var SpecialEventType;\n(function (SpecialEventType) {\n    SpecialEventType[\"IDENTIFY\"] = \"$identify\";\n    SpecialEventType[\"GROUP_IDENTIFY\"] = \"$groupidentify\";\n    SpecialEventType[\"REVENUE\"] = \"revenue_amount\";\n})(SpecialEventType || (SpecialEventType = {}));\n//# sourceMappingURL=event.js.map","export var UNSET_VALUE = '-';\nexport var AMPLITUDE_PREFIX = 'AMP';\nexport var STORAGE_PREFIX = \"\".concat(AMPLITUDE_PREFIX, \"_unsent\");\nexport var DEFAULT_INSTANCE_NAME = '$default_instance';\nexport var AMPLITUDE_SERVER_URL = 'https://api2.amplitude.com/2/httpapi';\nexport var EU_AMPLITUDE_SERVER_URL = 'https://api.eu.amplitude.com/2/httpapi';\nexport var AMPLITUDE_BATCH_SERVER_URL = 'https://api2.amplitude.com/batch';\nexport var EU_AMPLITUDE_BATCH_SERVER_URL = 'https://api.eu.amplitude.com/batch';\n// Campaign constants\nexport var UTM_CAMPAIGN = 'utm_campaign';\nexport var UTM_CONTENT = 'utm_content';\nexport var UTM_ID = 'utm_id';\nexport var UTM_MEDIUM = 'utm_medium';\nexport var UTM_SOURCE = 'utm_source';\nexport var UTM_TERM = 'utm_term';\nexport var DCLID = 'dclid';\nexport var FBCLID = 'fbclid';\nexport var GBRAID = 'gbraid';\nexport var GCLID = 'gclid';\nexport var KO_CLICK_ID = 'ko_click_id';\nexport var LI_FAT_ID = 'li_fat_id';\nexport var MSCLKID = 'msclkid';\nexport var RDT_CID = 'rdt_cid';\nexport var TTCLID = 'ttclid';\nexport var TWCLID = 'twclid';\nexport var WBRAID = 'wbraid';\nexport var EMPTY_VALUE = 'EMPTY';\nexport var BASE_CAMPAIGN = {\n    utm_campaign: undefined,\n    utm_content: undefined,\n    utm_id: undefined,\n    utm_medium: undefined,\n    utm_source: undefined,\n    utm_term: undefined,\n    referrer: undefined,\n    referring_domain: undefined,\n    dclid: undefined,\n    gbraid: undefined,\n    gclid: undefined,\n    fbclid: undefined,\n    ko_click_id: undefined,\n    li_fat_id: undefined,\n    msclkid: undefined,\n    rdt_cid: undefined,\n    ttclid: undefined,\n    twclid: undefined,\n    wbraid: undefined,\n};\nexport var MKTG = 'MKTG';\n// list of Network headers that are safe to capture\nexport var SAFE_HEADERS = [\n    'access-control-allow-origin',\n    'access-control-allow-credentials',\n    'access-control-expose-headers',\n    'access-control-max-age',\n    'access-control-allow-methods',\n    'access-control-allow-headers',\n    'accept-patch',\n    'accept-ranges',\n    'age',\n    'allow',\n    'alt-svc',\n    'cache-control',\n    'connection',\n    'content-disposition',\n    'content-encoding',\n    'content-language',\n    'content-length',\n    'content-location',\n    'content-md5',\n    'content-range',\n    'content-type',\n    'date',\n    'delta-base',\n    'etag',\n    'expires',\n    'im',\n    'last-modified',\n    'link',\n    'location',\n    'permanent',\n    'p3p',\n    'pragma',\n    'proxy-authenticate',\n    'public-key-pins',\n    'retry-after',\n    'server',\n    'status',\n    'strict-transport-security',\n    'trailer',\n    'transfer-encoding',\n    'tk',\n    'upgrade',\n    'vary',\n    'via',\n    'warning',\n    'www-authenticate',\n    'x-b3-traceid',\n    'x-frame-options',\n];\n// list of Network headers to never capture\nexport var FORBIDDEN_HEADERS = ['authorization', 'cookie', 'set-cookie'];\n//# sourceMappingURL=constants.js.map","/** The status of an event. */\nexport var Status;\n(function (Status) {\n    /** The status could not be determined. */\n    Status[\"Unknown\"] = \"unknown\";\n    /** The event was skipped due to configuration or callbacks. */\n    Status[\"Skipped\"] = \"skipped\";\n    /** The event was sent successfully. */\n    Status[\"Success\"] = \"success\";\n    /** A user or device in the payload is currently rate limited and should try again later. */\n    Status[\"RateLimit\"] = \"rate_limit\";\n    /** The sent payload was too large to be processed. */\n    Status[\"PayloadTooLarge\"] = \"payload_too_large\";\n    /** The event could not be processed. */\n    Status[\"Invalid\"] = \"invalid\";\n    /** A server-side error ocurred during submission. */\n    Status[\"Failed\"] = \"failed\";\n    /** a server or client side error occuring when a request takes too long and is cancelled */\n    Status[\"Timeout\"] = \"Timeout\";\n    /** NodeJS runtime environment error.. E.g. disconnected from network */\n    Status[\"SystemError\"] = \"SystemError\";\n})(Status || (Status = {}));\n//# sourceMappingURL=status.js.map","/* eslint-disable no-restricted-globals */\n/* Only file allowed to access to globalThis, window, self */\nexport var getGlobalScope = function () {\n    // This should only be used for integrations with Amplitude that are not running in a browser environment\n    //   We need to specify the name of the global variable as a string to prevent it from being minified\n    var ampIntegrationContextName = 'ampIntegrationContext';\n    if (typeof globalThis !== 'undefined' && typeof globalThis[ampIntegrationContextName] !== 'undefined') {\n        return globalThis[ampIntegrationContextName];\n    }\n    if (typeof globalThis !== 'undefined') {\n        return globalThis;\n    }\n    if (typeof window !== 'undefined') {\n        return window;\n    }\n    if (typeof self !== 'undefined') {\n        return self;\n    }\n    if (typeof global !== 'undefined') {\n        return global;\n    }\n    return undefined;\n};\n//# sourceMappingURL=global-scope.js.map","export var LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"None\"] = 0] = \"None\";\n    LogLevel[LogLevel[\"Error\"] = 1] = \"Error\";\n    LogLevel[LogLevel[\"Warn\"] = 2] = \"Warn\";\n    LogLevel[LogLevel[\"Verbose\"] = 3] = \"Verbose\";\n    LogLevel[LogLevel[\"Debug\"] = 4] = \"Debug\";\n})(LogLevel || (LogLevel = {}));\n//# sourceMappingURL=loglevel.js.map","export var returnWrapper = function (awaitable) { return ({\n    promise: awaitable || Promise.resolve(),\n}); };\n//# sourceMappingURL=return-wrapper.js.map","import { LogLevel } from './types/loglevel';\nvar PREFIX = 'Amplitude Logger ';\nvar Logger = /** @class */ (function () {\n    function Logger() {\n        this.logLevel = LogLevel.None;\n    }\n    Logger.prototype.disable = function () {\n        this.logLevel = LogLevel.None;\n    };\n    Logger.prototype.enable = function (logLevel) {\n        if (logLevel === void 0) { logLevel = LogLevel.Warn; }\n        this.logLevel = logLevel;\n    };\n    Logger.prototype.log = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this.logLevel < LogLevel.Verbose) {\n            return;\n        }\n        console.log(\"\".concat(PREFIX, \"[Log]: \").concat(args.join(' ')));\n    };\n    Logger.prototype.warn = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this.logLevel < LogLevel.Warn) {\n            return;\n        }\n        console.warn(\"\".concat(PREFIX, \"[Warn]: \").concat(args.join(' ')));\n    };\n    Logger.prototype.error = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this.logLevel < LogLevel.Error) {\n            return;\n        }\n        console.error(\"\".concat(PREFIX, \"[Error]: \").concat(args.join(' ')));\n    };\n    Logger.prototype.debug = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (this.logLevel < LogLevel.Debug) {\n            return;\n        }\n        // console.debug output is hidden by default in chrome\n        console.log(\"\".concat(PREFIX, \"[Debug]: \").concat(args.join(' ')));\n    };\n    return Logger;\n}());\nexport { Logger };\n//# sourceMappingURL=logger.js.map","import { AMPLITUDE_SERVER_URL, AMPLITUDE_BATCH_SERVER_URL, EU_AMPLITUDE_SERVER_URL, EU_AMPLITUDE_BATCH_SERVER_URL, DEFAULT_INSTANCE_NAME, } from './types/constants';\nimport { Logger } from './logger';\nimport { LogLevel } from './types/loglevel';\nexport var getDefaultConfig = function () { return ({\n    flushMaxRetries: 12,\n    flushQueueSize: 200,\n    flushIntervalMillis: 10000,\n    instanceName: DEFAULT_INSTANCE_NAME,\n    logLevel: LogLevel.Warn,\n    loggerProvider: new Logger(),\n    offline: false,\n    optOut: false,\n    serverUrl: AMPLITUDE_SERVER_URL,\n    serverZone: 'US',\n    useBatch: false,\n}); };\nvar Config = /** @class */ (function () {\n    function Config(options) {\n        var _a, _b, _c, _d;\n        this._optOut = false;\n        var defaultConfig = getDefaultConfig();\n        this.apiKey = options.apiKey;\n        this.flushIntervalMillis = (_a = options.flushIntervalMillis) !== null && _a !== void 0 ? _a : defaultConfig.flushIntervalMillis;\n        this.flushMaxRetries = options.flushMaxRetries || defaultConfig.flushMaxRetries;\n        this.flushQueueSize = options.flushQueueSize || defaultConfig.flushQueueSize;\n        this.instanceName = options.instanceName || defaultConfig.instanceName;\n        this.loggerProvider = options.loggerProvider || defaultConfig.loggerProvider;\n        this.logLevel = (_b = options.logLevel) !== null && _b !== void 0 ? _b : defaultConfig.logLevel;\n        this.minIdLength = options.minIdLength;\n        this.plan = options.plan;\n        this.ingestionMetadata = options.ingestionMetadata;\n        this.offline = options.offline !== undefined ? options.offline : defaultConfig.offline;\n        this.optOut = (_c = options.optOut) !== null && _c !== void 0 ? _c : defaultConfig.optOut;\n        this.serverUrl = options.serverUrl;\n        this.serverZone = options.serverZone || defaultConfig.serverZone;\n        this.storageProvider = options.storageProvider;\n        this.transportProvider = options.transportProvider;\n        this.useBatch = (_d = options.useBatch) !== null && _d !== void 0 ? _d : defaultConfig.useBatch;\n        this.loggerProvider.enable(this.logLevel);\n        var serverConfig = createServerConfig(options.serverUrl, options.serverZone, options.useBatch);\n        this.serverZone = serverConfig.serverZone;\n        this.serverUrl = serverConfig.serverUrl;\n    }\n    Object.defineProperty(Config.prototype, \"optOut\", {\n        get: function () {\n            return this._optOut;\n        },\n        set: function (optOut) {\n            this._optOut = optOut;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    return Config;\n}());\nexport { Config };\nexport var getServerUrl = function (serverZone, useBatch) {\n    if (serverZone === 'EU') {\n        return useBatch ? EU_AMPLITUDE_BATCH_SERVER_URL : EU_AMPLITUDE_SERVER_URL;\n    }\n    return useBatch ? AMPLITUDE_BATCH_SERVER_URL : AMPLITUDE_SERVER_URL;\n};\nexport var createServerConfig = function (serverUrl, serverZone, useBatch) {\n    if (serverUrl === void 0) { serverUrl = ''; }\n    if (serverZone === void 0) { serverZone = getDefaultConfig().serverZone; }\n    if (useBatch === void 0) { useBatch = getDefaultConfig().useBatch; }\n    if (serverUrl) {\n        return { serverUrl: serverUrl, serverZone: undefined };\n    }\n    var _serverZone = ['US', 'EU'].includes(serverZone) ? serverZone : getDefaultConfig().serverZone;\n    return {\n        serverZone: _serverZone,\n        serverUrl: getServerUrl(_serverZone, useBatch),\n    };\n};\nvar RequestMetadata = /** @class */ (function () {\n    function RequestMetadata() {\n        this.sdk = {\n            metrics: {\n                histogram: {},\n            },\n        };\n    }\n    RequestMetadata.prototype.recordHistogram = function (key, value) {\n        this.sdk.metrics.histogram[key] = value;\n    };\n    return RequestMetadata;\n}());\nexport { RequestMetadata };\nvar HistogramOptions = /** @class */ (function () {\n    function HistogramOptions() {\n    }\n    return HistogramOptions;\n}());\n//# sourceMappingURL=config.js.map","var ApplicationContextProviderImpl = /** @class */ (function () {\n    function ApplicationContextProviderImpl() {\n    }\n    ApplicationContextProviderImpl.prototype.getApplicationContext = function () {\n        return {\n            versionName: this.versionName,\n            language: getLanguage(),\n            platform: 'Web',\n            os: undefined,\n            deviceModel: undefined,\n        };\n    };\n    return ApplicationContextProviderImpl;\n}());\nvar getLanguage = function () {\n    return ((typeof navigator !== 'undefined' &&\n        ((navigator.languages && navigator.languages[0]) ||\n            navigator.language)) ||\n        '');\n};\n\nvar EventBridgeImpl = /** @class */ (function () {\n    function EventBridgeImpl() {\n        this.queue = [];\n    }\n    EventBridgeImpl.prototype.logEvent = function (event) {\n        if (!this.receiver) {\n            if (this.queue.length < 512) {\n                this.queue.push(event);\n            }\n        }\n        else {\n            this.receiver(event);\n        }\n    };\n    EventBridgeImpl.prototype.setEventReceiver = function (receiver) {\n        this.receiver = receiver;\n        if (this.queue.length > 0) {\n            this.queue.forEach(function (event) {\n                receiver(event);\n            });\n            this.queue = [];\n        }\n    };\n    return EventBridgeImpl;\n}());\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nfunction __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n}\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar isEqual = function (obj1, obj2) {\n    var e_1, _a;\n    var primitive = ['string', 'number', 'boolean', 'undefined'];\n    var typeA = typeof obj1;\n    var typeB = typeof obj2;\n    if (typeA !== typeB) {\n        return false;\n    }\n    try {\n        for (var primitive_1 = __values(primitive), primitive_1_1 = primitive_1.next(); !primitive_1_1.done; primitive_1_1 = primitive_1.next()) {\n            var p = primitive_1_1.value;\n            if (p === typeA) {\n                return obj1 === obj2;\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (primitive_1_1 && !primitive_1_1.done && (_a = primitive_1.return)) _a.call(primitive_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    // check null\n    if (obj1 == null && obj2 == null) {\n        return true;\n    }\n    else if (obj1 == null || obj2 == null) {\n        return false;\n    }\n    // if got here - objects\n    if (obj1.length !== obj2.length) {\n        return false;\n    }\n    //check if arrays\n    var isArrayA = Array.isArray(obj1);\n    var isArrayB = Array.isArray(obj2);\n    if (isArrayA !== isArrayB) {\n        return false;\n    }\n    if (isArrayA && isArrayB) {\n        //arrays\n        for (var i = 0; i < obj1.length; i++) {\n            if (!isEqual(obj1[i], obj2[i])) {\n                return false;\n            }\n        }\n    }\n    else {\n        //objects\n        var sorted1 = Object.keys(obj1).sort();\n        var sorted2 = Object.keys(obj2).sort();\n        if (!isEqual(sorted1, sorted2)) {\n            return false;\n        }\n        //compare object values\n        var result_1 = true;\n        Object.keys(obj1).forEach(function (key) {\n            if (!isEqual(obj1[key], obj2[key])) {\n                result_1 = false;\n            }\n        });\n        return result_1;\n    }\n    return true;\n};\n\nvar ID_OP_SET = '$set';\nvar ID_OP_UNSET = '$unset';\nvar ID_OP_CLEAR_ALL = '$clearAll';\n// Polyfill for Object.entries\nif (!Object.entries) {\n    Object.entries = function (obj) {\n        var ownProps = Object.keys(obj);\n        var i = ownProps.length;\n        var resArray = new Array(i);\n        while (i--) {\n            resArray[i] = [ownProps[i], obj[ownProps[i]]];\n        }\n        return resArray;\n    };\n}\nvar IdentityStoreImpl = /** @class */ (function () {\n    function IdentityStoreImpl() {\n        this.identity = { userProperties: {} };\n        this.listeners = new Set();\n    }\n    IdentityStoreImpl.prototype.editIdentity = function () {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        var self = this;\n        var actingUserProperties = __assign({}, this.identity.userProperties);\n        var actingIdentity = __assign(__assign({}, this.identity), { userProperties: actingUserProperties });\n        return {\n            setUserId: function (userId) {\n                actingIdentity.userId = userId;\n                return this;\n            },\n            setDeviceId: function (deviceId) {\n                actingIdentity.deviceId = deviceId;\n                return this;\n            },\n            setUserProperties: function (userProperties) {\n                actingIdentity.userProperties = userProperties;\n                return this;\n            },\n            setOptOut: function (optOut) {\n                actingIdentity.optOut = optOut;\n                return this;\n            },\n            updateUserProperties: function (actions) {\n                var e_1, _a, e_2, _b, e_3, _c;\n                var actingProperties = actingIdentity.userProperties || {};\n                try {\n                    for (var _d = __values(Object.entries(actions)), _e = _d.next(); !_e.done; _e = _d.next()) {\n                        var _f = __read(_e.value, 2), action = _f[0], properties = _f[1];\n                        switch (action) {\n                            case ID_OP_SET:\n                                try {\n                                    for (var _g = (e_2 = void 0, __values(Object.entries(properties))), _h = _g.next(); !_h.done; _h = _g.next()) {\n                                        var _j = __read(_h.value, 2), key = _j[0], value = _j[1];\n                                        actingProperties[key] = value;\n                                    }\n                                }\n                                catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                                finally {\n                                    try {\n                                        if (_h && !_h.done && (_b = _g.return)) _b.call(_g);\n                                    }\n                                    finally { if (e_2) throw e_2.error; }\n                                }\n                                break;\n                            case ID_OP_UNSET:\n                                try {\n                                    for (var _k = (e_3 = void 0, __values(Object.keys(properties))), _l = _k.next(); !_l.done; _l = _k.next()) {\n                                        var key = _l.value;\n                                        delete actingProperties[key];\n                                    }\n                                }\n                                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                                finally {\n                                    try {\n                                        if (_l && !_l.done && (_c = _k.return)) _c.call(_k);\n                                    }\n                                    finally { if (e_3) throw e_3.error; }\n                                }\n                                break;\n                            case ID_OP_CLEAR_ALL:\n                                actingProperties = {};\n                                break;\n                        }\n                    }\n                }\n                catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                finally {\n                    try {\n                        if (_e && !_e.done && (_a = _d.return)) _a.call(_d);\n                    }\n                    finally { if (e_1) throw e_1.error; }\n                }\n                actingIdentity.userProperties = actingProperties;\n                return this;\n            },\n            commit: function () {\n                self.setIdentity(actingIdentity);\n                return this;\n            },\n        };\n    };\n    IdentityStoreImpl.prototype.getIdentity = function () {\n        return __assign({}, this.identity);\n    };\n    IdentityStoreImpl.prototype.setIdentity = function (identity) {\n        var originalIdentity = __assign({}, this.identity);\n        this.identity = __assign({}, identity);\n        if (!isEqual(originalIdentity, this.identity)) {\n            this.listeners.forEach(function (listener) {\n                listener(identity);\n            });\n        }\n    };\n    IdentityStoreImpl.prototype.addIdentityListener = function (listener) {\n        this.listeners.add(listener);\n    };\n    IdentityStoreImpl.prototype.removeIdentityListener = function (listener) {\n        this.listeners.delete(listener);\n    };\n    return IdentityStoreImpl;\n}());\n\nvar safeGlobal = typeof globalThis !== 'undefined'\n    ? globalThis\n    : typeof global !== 'undefined'\n        ? global\n        : self;\n\nvar AnalyticsConnector = /** @class */ (function () {\n    function AnalyticsConnector() {\n        this.identityStore = new IdentityStoreImpl();\n        this.eventBridge = new EventBridgeImpl();\n        this.applicationContextProvider = new ApplicationContextProviderImpl();\n    }\n    AnalyticsConnector.getInstance = function (instanceName) {\n        if (!safeGlobal['analyticsConnectorInstances']) {\n            safeGlobal['analyticsConnectorInstances'] = {};\n        }\n        if (!safeGlobal['analyticsConnectorInstances'][instanceName]) {\n            safeGlobal['analyticsConnectorInstances'][instanceName] =\n                new AnalyticsConnector();\n        }\n        return safeGlobal['analyticsConnectorInstances'][instanceName];\n    };\n    return AnalyticsConnector;\n}());\n\nexport { AnalyticsConnector };\n","/**\n * @deprecated use ServerZoneType instead\n */\nexport var ServerZone;\n(function (ServerZone) {\n    ServerZone[\"US\"] = \"US\";\n    ServerZone[\"EU\"] = \"EU\";\n    /**\n     * Add for session-replay-browser migration from analytics-type v1.x.\n     */\n    ServerZone[\"STAGING\"] = \"STAGING\";\n})(ServerZone || (ServerZone = {}));\n//# sourceMappingURL=server-zone.js.map","import { Status } from '../types/status';\nvar BaseTransport = /** @class */ (function () {\n    function BaseTransport() {\n    }\n    BaseTransport.prototype.send = function (_serverUrl, _payload) {\n        return Promise.resolve(null);\n    };\n    BaseTransport.prototype.buildResponse = function (responseJSON) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x;\n        if (typeof responseJSON !== 'object') {\n            return null;\n        }\n        var statusCode = responseJSON.code || 0;\n        var status = this.buildStatus(statusCode);\n        switch (status) {\n            case Status.Success:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        eventsIngested: (_a = responseJSON.events_ingested) !== null && _a !== void 0 ? _a : 0,\n                        payloadSizeBytes: (_b = responseJSON.payload_size_bytes) !== null && _b !== void 0 ? _b : 0,\n                        serverUploadTime: (_c = responseJSON.server_upload_time) !== null && _c !== void 0 ? _c : 0,\n                    },\n                };\n            case Status.Invalid:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        error: (_d = responseJSON.error) !== null && _d !== void 0 ? _d : '',\n                        missingField: (_e = responseJSON.missing_field) !== null && _e !== void 0 ? _e : '',\n                        eventsWithInvalidFields: (_f = responseJSON.events_with_invalid_fields) !== null && _f !== void 0 ? _f : {},\n                        eventsWithMissingFields: (_g = responseJSON.events_with_missing_fields) !== null && _g !== void 0 ? _g : {},\n                        eventsWithInvalidIdLengths: (_h = responseJSON.events_with_invalid_id_lengths) !== null && _h !== void 0 ? _h : {},\n                        epsThreshold: (_j = responseJSON.eps_threshold) !== null && _j !== void 0 ? _j : 0,\n                        exceededDailyQuotaDevices: (_k = responseJSON.exceeded_daily_quota_devices) !== null && _k !== void 0 ? _k : {},\n                        silencedDevices: (_l = responseJSON.silenced_devices) !== null && _l !== void 0 ? _l : [],\n                        silencedEvents: (_m = responseJSON.silenced_events) !== null && _m !== void 0 ? _m : [],\n                        throttledDevices: (_o = responseJSON.throttled_devices) !== null && _o !== void 0 ? _o : {},\n                        throttledEvents: (_p = responseJSON.throttled_events) !== null && _p !== void 0 ? _p : [],\n                    },\n                };\n            case Status.PayloadTooLarge:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        error: (_q = responseJSON.error) !== null && _q !== void 0 ? _q : '',\n                    },\n                };\n            case Status.RateLimit:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        error: (_r = responseJSON.error) !== null && _r !== void 0 ? _r : '',\n                        epsThreshold: (_s = responseJSON.eps_threshold) !== null && _s !== void 0 ? _s : 0,\n                        throttledDevices: (_t = responseJSON.throttled_devices) !== null && _t !== void 0 ? _t : {},\n                        throttledUsers: (_u = responseJSON.throttled_users) !== null && _u !== void 0 ? _u : {},\n                        exceededDailyQuotaDevices: (_v = responseJSON.exceeded_daily_quota_devices) !== null && _v !== void 0 ? _v : {},\n                        exceededDailyQuotaUsers: (_w = responseJSON.exceeded_daily_quota_users) !== null && _w !== void 0 ? _w : {},\n                        throttledEvents: (_x = responseJSON.throttled_events) !== null && _x !== void 0 ? _x : [],\n                    },\n                };\n            case Status.Timeout:\n            default:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                };\n        }\n    };\n    BaseTransport.prototype.buildStatus = function (code) {\n        if (code >= 200 && code < 300) {\n            return Status.Success;\n        }\n        if (code === 429) {\n            return Status.RateLimit;\n        }\n        if (code === 413) {\n            return Status.PayloadTooLarge;\n        }\n        if (code === 408) {\n            return Status.Timeout;\n        }\n        if (code >= 400 && code < 500) {\n            return Status.Invalid;\n        }\n        if (code >= 500) {\n            return Status.Failed;\n        }\n        return Status.Unknown;\n    };\n    return BaseTransport;\n}());\nexport { BaseTransport };\n//# sourceMappingURL=base.js.map","import { __awaiter, __extends, __generator } from \"tslib\";\nimport { BaseTransport } from './base';\nvar FetchTransport = /** @class */ (function (_super) {\n    __extends(FetchTransport, _super);\n    function FetchTransport() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    FetchTransport.prototype.send = function (serverUrl, payload) {\n        return __awaiter(this, void 0, void 0, function () {\n            var options, response, responseText;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        /* istanbul ignore if */\n                        if (typeof fetch === 'undefined') {\n                            throw new Error('FetchTransport is not supported');\n                        }\n                        options = {\n                            headers: {\n                                'Content-Type': 'application/json',\n                                Accept: '*/*',\n                            },\n                            body: JSON.stringify(payload),\n                            method: 'POST',\n                        };\n                        return [4 /*yield*/, fetch(serverUrl, options)];\n                    case 1:\n                        response = _a.sent();\n                        return [4 /*yield*/, response.text()];\n                    case 2:\n                        responseText = _a.sent();\n                        try {\n                            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n                            return [2 /*return*/, this.buildResponse(JSON.parse(responseText))];\n                        }\n                        catch (_b) {\n                            return [2 /*return*/, this.buildResponse({ code: response.status })];\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    return FetchTransport;\n}(BaseTransport));\nexport { FetchTransport };\n//# sourceMappingURL=fetch.js.map","var EventType = /* @__PURE__ */ ((EventType2) => {\n  EventType2[EventType2[\"DomContentLoaded\"] = 0] = \"DomContentLoaded\";\n  EventType2[EventType2[\"Load\"] = 1] = \"Load\";\n  EventType2[EventType2[\"FullSnapshot\"] = 2] = \"FullSnapshot\";\n  EventType2[EventType2[\"IncrementalSnapshot\"] = 3] = \"IncrementalSnapshot\";\n  EventType2[EventType2[\"Meta\"] = 4] = \"Meta\";\n  EventType2[EventType2[\"Custom\"] = 5] = \"Custom\";\n  EventType2[EventType2[\"Plugin\"] = 6] = \"Plugin\";\n  return EventType2;\n})(EventType || {});\nvar IncrementalSource = /* @__PURE__ */ ((IncrementalSource2) => {\n  IncrementalSource2[IncrementalSource2[\"Mutation\"] = 0] = \"Mutation\";\n  IncrementalSource2[IncrementalSource2[\"MouseMove\"] = 1] = \"MouseMove\";\n  IncrementalSource2[IncrementalSource2[\"MouseInteraction\"] = 2] = \"MouseInteraction\";\n  IncrementalSource2[IncrementalSource2[\"Scroll\"] = 3] = \"Scroll\";\n  IncrementalSource2[IncrementalSource2[\"ViewportResize\"] = 4] = \"ViewportResize\";\n  IncrementalSource2[IncrementalSource2[\"Input\"] = 5] = \"Input\";\n  IncrementalSource2[IncrementalSource2[\"TouchMove\"] = 6] = \"TouchMove\";\n  IncrementalSource2[IncrementalSource2[\"MediaInteraction\"] = 7] = \"MediaInteraction\";\n  IncrementalSource2[IncrementalSource2[\"StyleSheetRule\"] = 8] = \"StyleSheetRule\";\n  IncrementalSource2[IncrementalSource2[\"CanvasMutation\"] = 9] = \"CanvasMutation\";\n  IncrementalSource2[IncrementalSource2[\"Font\"] = 10] = \"Font\";\n  IncrementalSource2[IncrementalSource2[\"Log\"] = 11] = \"Log\";\n  IncrementalSource2[IncrementalSource2[\"Drag\"] = 12] = \"Drag\";\n  IncrementalSource2[IncrementalSource2[\"StyleDeclaration\"] = 13] = \"StyleDeclaration\";\n  IncrementalSource2[IncrementalSource2[\"Selection\"] = 14] = \"Selection\";\n  IncrementalSource2[IncrementalSource2[\"AdoptedStyleSheet\"] = 15] = \"AdoptedStyleSheet\";\n  IncrementalSource2[IncrementalSource2[\"CustomElement\"] = 16] = \"CustomElement\";\n  return IncrementalSource2;\n})(IncrementalSource || {});\nvar MouseInteractions = /* @__PURE__ */ ((MouseInteractions2) => {\n  MouseInteractions2[MouseInteractions2[\"MouseUp\"] = 0] = \"MouseUp\";\n  MouseInteractions2[MouseInteractions2[\"MouseDown\"] = 1] = \"MouseDown\";\n  MouseInteractions2[MouseInteractions2[\"Click\"] = 2] = \"Click\";\n  MouseInteractions2[MouseInteractions2[\"ContextMenu\"] = 3] = \"ContextMenu\";\n  MouseInteractions2[MouseInteractions2[\"DblClick\"] = 4] = \"DblClick\";\n  MouseInteractions2[MouseInteractions2[\"Focus\"] = 5] = \"Focus\";\n  MouseInteractions2[MouseInteractions2[\"Blur\"] = 6] = \"Blur\";\n  MouseInteractions2[MouseInteractions2[\"TouchStart\"] = 7] = \"TouchStart\";\n  MouseInteractions2[MouseInteractions2[\"TouchMove_Departed\"] = 8] = \"TouchMove_Departed\";\n  MouseInteractions2[MouseInteractions2[\"TouchEnd\"] = 9] = \"TouchEnd\";\n  MouseInteractions2[MouseInteractions2[\"TouchCancel\"] = 10] = \"TouchCancel\";\n  return MouseInteractions2;\n})(MouseInteractions || {});\nvar PointerTypes = /* @__PURE__ */ ((PointerTypes2) => {\n  PointerTypes2[PointerTypes2[\"Mouse\"] = 0] = \"Mouse\";\n  PointerTypes2[PointerTypes2[\"Pen\"] = 1] = \"Pen\";\n  PointerTypes2[PointerTypes2[\"Touch\"] = 2] = \"Touch\";\n  return PointerTypes2;\n})(PointerTypes || {});\nvar CanvasContext = /* @__PURE__ */ ((CanvasContext2) => {\n  CanvasContext2[CanvasContext2[\"2D\"] = 0] = \"2D\";\n  CanvasContext2[CanvasContext2[\"WebGL\"] = 1] = \"WebGL\";\n  CanvasContext2[CanvasContext2[\"WebGL2\"] = 2] = \"WebGL2\";\n  return CanvasContext2;\n})(CanvasContext || {});\nvar MediaInteractions = /* @__PURE__ */ ((MediaInteractions2) => {\n  MediaInteractions2[MediaInteractions2[\"Play\"] = 0] = \"Play\";\n  MediaInteractions2[MediaInteractions2[\"Pause\"] = 1] = \"Pause\";\n  MediaInteractions2[MediaInteractions2[\"Seeked\"] = 2] = \"Seeked\";\n  MediaInteractions2[MediaInteractions2[\"VolumeChange\"] = 3] = \"VolumeChange\";\n  MediaInteractions2[MediaInteractions2[\"RateChange\"] = 4] = \"RateChange\";\n  return MediaInteractions2;\n})(MediaInteractions || {});\nvar ReplayerEvents = /* @__PURE__ */ ((ReplayerEvents2) => {\n  ReplayerEvents2[\"Start\"] = \"start\";\n  ReplayerEvents2[\"Pause\"] = \"pause\";\n  ReplayerEvents2[\"Resume\"] = \"resume\";\n  ReplayerEvents2[\"Resize\"] = \"resize\";\n  ReplayerEvents2[\"Finish\"] = \"finish\";\n  ReplayerEvents2[\"FullsnapshotRebuilded\"] = \"fullsnapshot-rebuilded\";\n  ReplayerEvents2[\"LoadStylesheetStart\"] = \"load-stylesheet-start\";\n  ReplayerEvents2[\"LoadStylesheetEnd\"] = \"load-stylesheet-end\";\n  ReplayerEvents2[\"SkipStart\"] = \"skip-start\";\n  ReplayerEvents2[\"SkipEnd\"] = \"skip-end\";\n  ReplayerEvents2[\"MouseInteraction\"] = \"mouse-interaction\";\n  ReplayerEvents2[\"EventCast\"] = \"event-cast\";\n  ReplayerEvents2[\"CustomEvent\"] = \"custom-event\";\n  ReplayerEvents2[\"Flush\"] = \"flush\";\n  ReplayerEvents2[\"StateChange\"] = \"state-change\";\n  ReplayerEvents2[\"PlayBack\"] = \"play-back\";\n  ReplayerEvents2[\"Destroy\"] = \"destroy\";\n  return ReplayerEvents2;\n})(ReplayerEvents || {});\nvar NodeType = /* @__PURE__ */ ((NodeType2) => {\n  NodeType2[NodeType2[\"Document\"] = 0] = \"Document\";\n  NodeType2[NodeType2[\"DocumentType\"] = 1] = \"DocumentType\";\n  NodeType2[NodeType2[\"Element\"] = 2] = \"Element\";\n  NodeType2[NodeType2[\"Text\"] = 3] = \"Text\";\n  NodeType2[NodeType2[\"CDATA\"] = 4] = \"CDATA\";\n  NodeType2[NodeType2[\"Comment\"] = 5] = \"Comment\";\n  return NodeType2;\n})(NodeType || {});\nexport {\n  CanvasContext,\n  EventType,\n  IncrementalSource,\n  MediaInteractions,\n  MouseInteractions,\n  NodeType,\n  PointerTypes,\n  ReplayerEvents\n};\n//# sourceMappingURL=rrweb-types.js.map\n","export var ServerZone;\n(function (ServerZone) {\n    ServerZone[\"US\"] = \"US\";\n    ServerZone[\"EU\"] = \"EU\";\n    ServerZone[\"STAGING\"] = \"STAGING\";\n})(ServerZone || (ServerZone = {}));\n//# sourceMappingURL=server-zone.js.map","/** The status of an event. */\nexport var Status;\n(function (Status) {\n    /** The status could not be determined. */\n    Status[\"Unknown\"] = \"unknown\";\n    /** The event was skipped due to configuration or callbacks. */\n    Status[\"Skipped\"] = \"skipped\";\n    /** The event was sent successfully. */\n    Status[\"Success\"] = \"success\";\n    /** A user or device in the payload is currently rate limited and should try again later. */\n    Status[\"RateLimit\"] = \"rate_limit\";\n    /** The sent payload was too large to be processed. */\n    Status[\"PayloadTooLarge\"] = \"payload_too_large\";\n    /** The event could not be processed. */\n    Status[\"Invalid\"] = \"invalid\";\n    /** A server-side error ocurred during submission. */\n    Status[\"Failed\"] = \"failed\";\n    /** a server or client side error occuring when a request takes too long and is cancelled */\n    Status[\"Timeout\"] = \"Timeout\";\n    /** NodeJS runtime environment error.. E.g. disconnected from network */\n    Status[\"SystemError\"] = \"SystemError\";\n})(Status || (Status = {}));\n//# sourceMappingURL=status.js.map","/* eslint-disable @typescript-eslint/no-unsafe-argument */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment */\n/* eslint-disable @typescript-eslint/no-unsafe-call */\nimport { Status } from '@amplitude/analytics-types';\nvar BaseTransport = /** @class */ (function () {\n    function BaseTransport() {\n    }\n    BaseTransport.prototype.send = function (_serverUrl, _payload) {\n        return Promise.resolve(null);\n    };\n    BaseTransport.prototype.buildResponse = function (responseJSON) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x;\n        if (typeof responseJSON !== 'object') {\n            return null;\n        }\n        var statusCode = responseJSON.code || 0;\n        var status = this.buildStatus(statusCode);\n        switch (status) {\n            case Status.Success:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        eventsIngested: (_a = responseJSON.events_ingested) !== null && _a !== void 0 ? _a : 0,\n                        payloadSizeBytes: (_b = responseJSON.payload_size_bytes) !== null && _b !== void 0 ? _b : 0,\n                        serverUploadTime: (_c = responseJSON.server_upload_time) !== null && _c !== void 0 ? _c : 0,\n                    },\n                };\n            case Status.Invalid:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        error: (_d = responseJSON.error) !== null && _d !== void 0 ? _d : '',\n                        missingField: (_e = responseJSON.missing_field) !== null && _e !== void 0 ? _e : '',\n                        eventsWithInvalidFields: (_f = responseJSON.events_with_invalid_fields) !== null && _f !== void 0 ? _f : {},\n                        eventsWithMissingFields: (_g = responseJSON.events_with_missing_fields) !== null && _g !== void 0 ? _g : {},\n                        eventsWithInvalidIdLengths: (_h = responseJSON.events_with_invalid_id_lengths) !== null && _h !== void 0 ? _h : {},\n                        epsThreshold: (_j = responseJSON.eps_threshold) !== null && _j !== void 0 ? _j : 0,\n                        exceededDailyQuotaDevices: (_k = responseJSON.exceeded_daily_quota_devices) !== null && _k !== void 0 ? _k : {},\n                        silencedDevices: (_l = responseJSON.silenced_devices) !== null && _l !== void 0 ? _l : [],\n                        silencedEvents: (_m = responseJSON.silenced_events) !== null && _m !== void 0 ? _m : [],\n                        throttledDevices: (_o = responseJSON.throttled_devices) !== null && _o !== void 0 ? _o : {},\n                        throttledEvents: (_p = responseJSON.throttled_events) !== null && _p !== void 0 ? _p : [],\n                    },\n                };\n            case Status.PayloadTooLarge:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        error: (_q = responseJSON.error) !== null && _q !== void 0 ? _q : '',\n                    },\n                };\n            case Status.RateLimit:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                    body: {\n                        error: (_r = responseJSON.error) !== null && _r !== void 0 ? _r : '',\n                        epsThreshold: (_s = responseJSON.eps_threshold) !== null && _s !== void 0 ? _s : 0,\n                        throttledDevices: (_t = responseJSON.throttled_devices) !== null && _t !== void 0 ? _t : {},\n                        throttledUsers: (_u = responseJSON.throttled_users) !== null && _u !== void 0 ? _u : {},\n                        exceededDailyQuotaDevices: (_v = responseJSON.exceeded_daily_quota_devices) !== null && _v !== void 0 ? _v : {},\n                        exceededDailyQuotaUsers: (_w = responseJSON.exceeded_daily_quota_users) !== null && _w !== void 0 ? _w : {},\n                        throttledEvents: (_x = responseJSON.throttled_events) !== null && _x !== void 0 ? _x : [],\n                    },\n                };\n            case Status.Timeout:\n            default:\n                return {\n                    status: status,\n                    statusCode: statusCode,\n                };\n        }\n    };\n    BaseTransport.prototype.buildStatus = function (code) {\n        if (code >= 200 && code < 300) {\n            return Status.Success;\n        }\n        if (code === 429) {\n            return Status.RateLimit;\n        }\n        if (code === 413) {\n            return Status.PayloadTooLarge;\n        }\n        if (code === 408) {\n            return Status.Timeout;\n        }\n        if (code >= 400 && code < 500) {\n            return Status.Invalid;\n        }\n        if (code >= 500) {\n            return Status.Failed;\n        }\n        return Status.Unknown;\n    };\n    return BaseTransport;\n}());\nexport { BaseTransport };\n//# sourceMappingURL=base.js.map","import { __assign, __awaiter, __generator, __values } from \"tslib\";\nimport { BaseTransport } from '@amplitude/analytics-core';\nimport { ServerZone, Status } from '@amplitude/analytics-types';\nvar UNEXPECTED_NETWORK_ERROR_MESSAGE = 'Network error occurred, remote config fetch failed';\nvar SUCCESS_REMOTE_CONFIG = 'Remote config successfully fetched';\nvar MAX_RETRIES_EXCEEDED_MESSAGE = 'Remote config fetch rejected due to exceeded retry count';\nvar TIMEOUT_MESSAGE = 'Remote config fetch rejected due to timeout after 5 seconds';\nvar UNEXPECTED_ERROR_MESSAGE = 'Unexpected error occurred';\nexport var REMOTE_CONFIG_SERVER_URL = 'https://sr-client-cfg.amplitude.com/config';\nexport var REMOTE_CONFIG_SERVER_URL_STAGING = 'https://sr-client-cfg.stag2.amplitude.com/config';\nexport var REMOTE_CONFIG_SERVER_URL_EU = 'https://sr-client-cfg.eu.amplitude.com/config';\nvar RemoteConfigFetch = /** @class */ (function () {\n    function RemoteConfigFetch(_a) {\n        var localConfig = _a.localConfig, configKeys = _a.configKeys;\n        var _this = this;\n        this.retryTimeout = 1000;\n        this.attempts = 0;\n        this.sessionTargetingMatch = false;\n        this.metrics = {};\n        this.getRemoteNamespaceConfig = function (configNamespace, sessionId) { return __awaiter(_this, void 0, void 0, function () {\n            var fetchStartTime, configAPIResponse, remoteConfig;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        fetchStartTime = Date.now();\n                        return [4 /*yield*/, this.fetchWithTimeout(sessionId)];\n                    case 1:\n                        configAPIResponse = _a.sent();\n                        if (configAPIResponse) {\n                            remoteConfig = configAPIResponse.configs && configAPIResponse.configs[configNamespace];\n                            if (remoteConfig) {\n                                this.metrics.fetchTimeAPISuccess = Date.now() - fetchStartTime;\n                                return [2 /*return*/, remoteConfig];\n                            }\n                        }\n                        this.metrics.fetchTimeAPIFail = Date.now() - fetchStartTime;\n                        return [2 /*return*/, undefined];\n                }\n            });\n        }); };\n        this.getRemoteConfig = function (configNamespace, key, sessionId) { return __awaiter(_this, void 0, void 0, function () {\n            var namespaceConfig;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.getRemoteNamespaceConfig(configNamespace, sessionId)];\n                    case 1:\n                        namespaceConfig = _a.sent();\n                        return [2 /*return*/, namespaceConfig === null || namespaceConfig === void 0 ? void 0 : namespaceConfig[key]];\n                }\n            });\n        }); };\n        this.fetchWithTimeout = function (sessionId) { return __awaiter(_this, void 0, void 0, function () {\n            var controller, timeoutId, remoteConfig;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        controller = new AbortController();\n                        timeoutId = setTimeout(function () { return controller.abort(); }, 5000);\n                        return [4 /*yield*/, this.fetchRemoteConfig(controller.signal, sessionId)];\n                    case 1:\n                        remoteConfig = _a.sent();\n                        clearTimeout(timeoutId);\n                        return [2 /*return*/, remoteConfig];\n                }\n            });\n        }); };\n        this.fetchRemoteConfig = function (signal, sessionId) { return __awaiter(_this, void 0, void 0, function () {\n            var urlParams, _a, _b, configKey, options, serverUrl, res, parsedStatus, e_1, knownError;\n            var e_2, _c;\n            var _d;\n            return __generator(this, function (_e) {\n                switch (_e.label) {\n                    case 0:\n                        if (sessionId === this.lastFetchedSessionId && this.attempts >= this.localConfig.flushMaxRetries) {\n                            return [2 /*return*/, this.completeRequest({ err: MAX_RETRIES_EXCEEDED_MESSAGE })];\n                        }\n                        else if (signal.aborted) {\n                            return [2 /*return*/, this.completeRequest({ err: TIMEOUT_MESSAGE })];\n                        }\n                        else if (sessionId !== this.lastFetchedSessionId) {\n                            this.lastFetchedSessionId = sessionId;\n                            this.attempts = 0;\n                        }\n                        _e.label = 1;\n                    case 1:\n                        _e.trys.push([1, 3, , 4]);\n                        urlParams = new URLSearchParams({\n                            api_key: this.localConfig.apiKey,\n                        });\n                        try {\n                            for (_a = __values(this.configKeys), _b = _a.next(); !_b.done; _b = _a.next()) {\n                                configKey = _b.value;\n                                urlParams.append('config_keys', configKey);\n                            }\n                        }\n                        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                        finally {\n                            try {\n                                if (_b && !_b.done && (_c = _a.return)) _c.call(_a);\n                            }\n                            finally { if (e_2) throw e_2.error; }\n                        }\n                        if (sessionId) {\n                            urlParams.set('session_id', String(sessionId));\n                        }\n                        options = {\n                            headers: {\n                                Accept: '*/*',\n                            },\n                            method: 'GET',\n                        };\n                        serverUrl = \"\".concat(this.getServerUrl(), \"?\").concat(urlParams.toString());\n                        this.attempts += 1;\n                        return [4 /*yield*/, fetch(serverUrl, __assign(__assign({}, options), { signal: signal }))];\n                    case 2:\n                        res = _e.sent();\n                        if (res === null) {\n                            return [2 /*return*/, this.completeRequest({ err: UNEXPECTED_ERROR_MESSAGE })];\n                        }\n                        parsedStatus = new BaseTransport().buildStatus(res.status);\n                        switch (parsedStatus) {\n                            case Status.Success:\n                                this.attempts = 0;\n                                return [2 /*return*/, this.parseAndStoreConfig(res)];\n                            case Status.Failed:\n                                return [2 /*return*/, this.retryFetch(signal, sessionId)];\n                            default:\n                                return [2 /*return*/, this.completeRequest({ err: UNEXPECTED_NETWORK_ERROR_MESSAGE })];\n                        }\n                        return [3 /*break*/, 4];\n                    case 3:\n                        e_1 = _e.sent();\n                        knownError = e_1;\n                        if (signal.aborted) {\n                            return [2 /*return*/, this.completeRequest({ err: TIMEOUT_MESSAGE })];\n                        }\n                        return [2 /*return*/, this.completeRequest({ err: (_d = knownError.message) !== null && _d !== void 0 ? _d : UNEXPECTED_ERROR_MESSAGE })];\n                    case 4: return [2 /*return*/];\n                }\n            });\n        }); };\n        this.retryFetch = function (signal, sessionId) { return __awaiter(_this, void 0, void 0, function () {\n            var _this = this;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, new Promise(function (resolve) { return setTimeout(resolve, _this.attempts * _this.retryTimeout); })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, this.fetchRemoteConfig(signal, sessionId)];\n                }\n            });\n        }); };\n        this.parseAndStoreConfig = function (res) { return __awaiter(_this, void 0, void 0, function () {\n            var remoteConfig;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, res.json()];\n                    case 1:\n                        remoteConfig = (_a.sent());\n                        this.completeRequest({ success: SUCCESS_REMOTE_CONFIG });\n                        return [2 /*return*/, remoteConfig];\n                }\n            });\n        }); };\n        this.localConfig = localConfig;\n        this.configKeys = configKeys;\n    }\n    RemoteConfigFetch.prototype.getServerUrl = function () {\n        if (this.localConfig.configServerUrl) {\n            return this.localConfig.configServerUrl;\n        }\n        if (this.localConfig.serverZone === ServerZone.STAGING) {\n            return REMOTE_CONFIG_SERVER_URL_STAGING;\n        }\n        if (this.localConfig.serverZone === ServerZone.EU) {\n            return REMOTE_CONFIG_SERVER_URL_EU;\n        }\n        return REMOTE_CONFIG_SERVER_URL;\n    };\n    RemoteConfigFetch.prototype.completeRequest = function (_a) {\n        var err = _a.err, success = _a.success;\n        if (err) {\n            throw new Error(err);\n        }\n        else if (success) {\n            this.localConfig.loggerProvider.log(success);\n        }\n    };\n    return RemoteConfigFetch;\n}());\nexport { RemoteConfigFetch };\nexport var createRemoteConfigFetch = function (_a) {\n    var localConfig = _a.localConfig, configKeys = _a.configKeys;\n    return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_b) {\n            return [2 /*return*/, new RemoteConfigFetch({ localConfig: localConfig, configKeys: configKeys })];\n        });\n    });\n};\n//# sourceMappingURL=remote-config.js.map","import * as remoteConfigFetch from './remote-config';\nexport var createRemoteConfigFetch = remoteConfigFetch.createRemoteConfigFetch;\n//# sourceMappingURL=index.js.map","import { IConfig, LogLevel, ILogger } from '@amplitude/analytics-core';\nimport { StoreType, ConsoleLogLevel } from '../typings/session-replay';\nimport { TargetingFlag } from '@amplitude/targeting';\n\nexport interface SamplingConfig {\n  sample_rate: number;\n  capture_enabled: boolean;\n}\n\nexport interface InteractionConfig {\n  trackEveryNms?: number;\n  enabled: boolean; // defaults to false\n  batch: boolean; // defaults to false\n  /**\n   * UGC filter rules.\n   */\n  ugcFilterRules?: UGCFilterRule[];\n}\n\nexport interface LoggingConfig {\n  console: {\n    enabled: boolean;\n    levels: ConsoleLogLevel[];\n  };\n  network?: {\n    enabled: boolean;\n  };\n}\n\nexport type TargetingConfig = TargetingFlag;\n\nexport type SessionReplayRemoteConfig = {\n  sr_sampling_config?: SamplingConfig;\n  sr_privacy_config?: PrivacyConfig;\n  sr_interaction_config?: InteractionConfig;\n  sr_logging_config?: LoggingConfig;\n  sr_targeting_config?: TargetingConfig;\n};\n\nexport interface SessionReplayRemoteConfigAPIResponse {\n  configs: {\n    sessionReplay: SessionReplayRemoteConfig;\n  };\n}\n\nexport type MaskLevel =\n  | 'light' // only mask a subset of inputs that's deemed sensitive - password, credit card, telephone #, email. These are information we never want to capture.\n  | 'medium' // mask all inputs\n  | 'conservative'; // mask all inputs and all texts\n\nexport const DEFAULT_MASK_LEVEL = 'medium';\n\n// err on the side of excluding more\nexport type PrivacyConfig = {\n  blockSelector?: string | string[]; // exclude in the UI\n  defaultMaskLevel?: MaskLevel;\n  maskSelector?: string[];\n  unmaskSelector?: string[];\n};\n\n/**\n * UGC filter rule.\n */\nexport type UGCFilterRule = {\n  /**\n   * The selector of the UGC element.\n   */\n  selector: string;\n  /**\n   * The replacement text for the UGC element.\n   */\n  replacement: string;\n};\n\nexport interface SessionReplayLocalConfig extends IConfig {\n  apiKey: string;\n  loggerProvider: ILogger;\n  /**\n   * LogLevel.None or LogLevel.Error or LogLevel.Warn or LogLevel.Verbose or LogLevel.Debug.\n   * Sets the log level.\n   *\n   * @defaultValue LogLevel.Warn\n   */\n  logLevel: LogLevel;\n  /**\n   * The maximum number of retries allowed for sending replay events.\n   * Once this limit is reached, failed events will no longer be sent.\n   *\n   * @defaultValue 2\n   */\n  flushMaxRetries: number;\n  /**\n   * Use this option to control how many sessions to select for replay collection.\n   * The number should be a decimal between 0 and 1, for example 0.4, representing\n   * the fraction of sessions to have randomly selected for replay collection.\n   * Over a large number of sessions, 0.4 would select 40% of those sessions.\n   * Sample rates as small as six decimal places (0.000001) are supported.\n   *\n   * @defaultValue 0\n   */\n  sampleRate: number;\n  privacyConfig?: PrivacyConfig;\n  /**\n   * Adds additional debug event property to help debug instrumentation issues\n   * (such as mismatching apps). Only recommended for debugging initial setup,\n   * and not recommended for production.\n   */\n  debugMode?: boolean;\n  /**\n   * Specifies the endpoint URL to fetch remote configuration.\n   * If provided, it overrides the default server zone configuration.\n   */\n  configServerUrl?: string;\n  /**\n   * Specifies the endpoint URL for sending session replay data.\n   * If provided, it overrides the default server zone configuration.\n   */\n  trackServerUrl?: string;\n  /**\n   * If stylesheets are inlined, the contents of the stylesheet will be stored.\n   * During replay, the stored stylesheet will be used instead of attempting to fetch it remotely.\n   * This prevents replays from appearing broken due to missing stylesheets.\n   * Note: Inlining stylesheets may not work in all cases.\n   */\n  shouldInlineStylesheet?: boolean;\n  version?: SessionReplayVersion;\n  /**\n   * Performance configuration config. If enabled, we will defer compression\n   * to be done during the browser's idle periods.\n   */\n  performanceConfig?: SessionReplayPerformanceConfig;\n  /**\n   * Specifies how replay events should be stored. `idb` uses IndexedDB to persist replay events\n   * when all events cannot be sent during capture. `memory` stores replay events only in memory,\n   * meaning events are lost when the page is closed. If IndexedDB is unavailable, the system falls back to `memory`.\n   */\n  storeType: StoreType;\n\n  /**\n   * Experimental features.\n   */\n  experimental?: {\n    /**\n     * If the SDK should compress the replay events using a webworker.\n     */\n    useWebWorker: boolean;\n  };\n  userProperties?: { [key: string]: any };\n\n  /**\n   * Remove certain parts of the DOM from being captured. These are typically ignored when blocking by selectors.\n   */\n  omitElementTags?: {\n    /**\n     * If true, removes script tags from the DOM, but not noscript tags.\n     */\n    script?: boolean;\n    /**\n     * If true, removes comment tags from the DOM.\n     */\n    comment?: boolean;\n  };\n\n  /**\n   * If true, applies a background color to blocked elements in the replay.\n   * This helps visualize which elements are blocked from being captured.\n   */\n  applyBackgroundColorToBlockedElements?: boolean;\n  /**\n   * Enables URL change polling as a fallback for SPA route tracking.\n   * When enabled, the SDK will periodically check for URL changes every second\n   * in addition to patching the History API. This is useful for edge cases where\n   * route changes might bypass the standard History API methods.\n   *\n   * @defaultValue false\n   */\n  enableUrlChangePolling?: boolean;\n  /**\n   * Specifies the interval in milliseconds for URL change polling when enableUrlChangePolling is true.\n   * The SDK will check for URL changes at this interval as a fallback for SPA route tracking.\n   *\n   * @defaultValue 1000\n   */\n  urlChangePollingInterval?: number;\n  /**\n   * Whether to capture document title in URL change events.\n   * When disabled, the title field will be empty in URL change events.\n   *\n   * @defaultValue false\n   */\n  captureDocumentTitle?: boolean;\n  interactionConfig?: InteractionConfig;\n}\n\nexport interface SessionReplayJoinedConfig extends SessionReplayLocalConfig {\n  captureEnabled?: boolean;\n  interactionConfig?: InteractionConfig;\n  loggingConfig?: LoggingConfig;\n  targetingConfig?: TargetingConfig;\n}\n\nexport interface SessionReplayRemoteConfigFetch {\n  getServerUrl: () => void;\n  getSamplingConfig: (sessionId?: number) => Promise<SessionReplayRemoteConfig['sr_sampling_config'] | void>;\n  fetchRemoteConfig: (sessionId?: number) => Promise<SessionReplayRemoteConfig | void>;\n  getRemoteConfig: (sessionId?: number) => Promise<SessionReplayRemoteConfig | void>;\n}\n\nexport interface SessionReplayConfigs {\n  localConfig: SessionReplayLocalConfig;\n  joinedConfig: SessionReplayJoinedConfig;\n  remoteConfig: SessionReplayRemoteConfig | undefined;\n}\nexport interface SessionReplayJoinedConfigGenerator {\n  generateJoinedConfig: (sessionId?: string | number) => Promise<SessionReplayConfigs>;\n}\n\nexport interface SessionReplayMetadata {\n  remoteConfig: SessionReplayRemoteConfig | undefined;\n  localConfig: SessionReplayLocalConfig;\n  joinedConfig: SessionReplayJoinedConfig;\n  framework?: {\n    name: string;\n    version: string;\n  };\n  sessionId: string | number | undefined;\n  hashValue?: number;\n  sampleRate: number;\n  replaySDKType: string | null;\n  replaySDKVersion: string | undefined;\n  standaloneSDKType: string;\n  standaloneSDKVersion: string | undefined;\n}\n\nexport interface SessionReplayVersion {\n  version: string;\n  type: SessionReplayType;\n}\n\n/**\n * Configuration options for session replay performance.\n */\nexport interface SessionReplayPerformanceConfig {\n  /**\n   * If enabled, event compression will be deferred to occur during the browser's idle periods.\n   */\n  enabled: boolean;\n  /**\n   * Optional timeout in milliseconds for the `requestIdleCallback` API.\n   * If specified, this value will be used to set a maximum time for the browser to wait\n   * before executing the deferred compression task, even if the browser is not idle.\n   */\n  timeout?: number;\n}\n\nexport type SessionReplayType = 'standalone' | 'plugin' | 'segment';\n","import { AMPLITUDE_PREFIX, ServerZone } from '@amplitude/analytics-core';\n\nexport const DEFAULT_EVENT_PROPERTY_PREFIX = '[Amplitude]';\n\nexport const DEFAULT_SESSION_REPLAY_PROPERTY = `${DEFAULT_EVENT_PROPERTY_PREFIX} Session Replay ID`;\nexport const DEFAULT_SESSION_START_EVENT = 'session_start';\nexport const DEFAULT_SESSION_END_EVENT = 'session_end';\nexport const DEFAULT_SAMPLE_RATE = 0;\nexport const DEFAULT_SERVER_ZONE = ServerZone.US;\nexport const DEFAULT_PERFORMANCE_CONFIG = { enabled: true };\nexport const DEFAULT_URL_CHANGE_POLLING_INTERVAL = 1000;\n\nexport const SESSION_REPLAY_DEBUG_PROPERTY = `${DEFAULT_EVENT_PROPERTY_PREFIX} Session Replay Debug`;\n\nexport const BLOCK_CLASS = 'amp-block';\nexport const MASK_TEXT_CLASS = 'amp-mask';\nexport const UNMASK_TEXT_CLASS = 'amp-unmask';\nexport const SESSION_REPLAY_SERVER_URL = 'https://api-sr.amplitude.com/sessions/v2/track';\nexport const SESSION_REPLAY_EU_URL = 'https://api-sr.eu.amplitude.com/sessions/v2/track';\nexport const SESSION_REPLAY_STAGING_URL = 'https://api-sr.stag2.amplitude.com/sessions/v2/track';\nexport const STORAGE_PREFIX = `${AMPLITUDE_PREFIX}_replay_unsent`;\nexport const MAX_EVENT_LIST_SIZE = 1 * 1000000; // ~1 MB limit for JSON serialized events payload\nexport const INTERACTION_MIN_INTERVAL = 30_000; // 30 seconds\nexport const INTERACTION_MAX_INTERVAL = 60_000; // 1 minute\nexport const MIN_INTERVAL = 500; // 500 ms\nexport const MAX_INTERVAL = 10 * 1000; // 10 seconds\nexport const MAX_IDB_STORAGE_LENGTH = 1000 * 60 * 60 * 24 * 3; // 3 days\nexport const KB_SIZE = 1024;\nexport const MAX_URL_LENGTH = 1000;\n\nexport enum CustomRRwebEvent {\n  GET_SR_PROPS = 'get-sr-props',\n  DEBUG_INFO = 'debug-info',\n  FETCH_REQUEST = 'fetch-request',\n  METADATA = 'metadata',\n  TARGETING_DECISION = 'targeting-decision',\n}\n","import { getGlobalScope, ServerZone } from '@amplitude/analytics-core';\nimport { DEFAULT_MASK_LEVEL, MaskLevel, PrivacyConfig, SessionReplayJoinedConfig, UGCFilterRule } from './config/types';\nimport {\n  KB_SIZE,\n  MASK_TEXT_CLASS,\n  SESSION_REPLAY_EU_URL,\n  SESSION_REPLAY_SERVER_URL,\n  SESSION_REPLAY_STAGING_URL,\n  UNMASK_TEXT_CLASS,\n} from './constants';\nimport { StorageData } from './typings/session-replay';\nimport { getInputType } from './utils/get-input-type';\n\ntype ChromeStorageEstimate = {\n  quota?: number;\n  usage?: number;\n  usageDetails?: { [key: string]: number };\n};\n\n/**\n * Light: Subset of inputs\n * Medium: All inputs\n * Conservative: All inputs and all texts\n */\nconst isMaskedForLevel = (elementType: 'input' | 'text', level: MaskLevel, element: HTMLElement | null): boolean => {\n  switch (level) {\n    case 'light': {\n      if (elementType !== 'input') {\n        return true;\n      }\n\n      const inputType = element ? getInputType(element) : '';\n      /* istanbul ignore if */ // TODO(lew): For some reason it's impossible to test this.\n      if (!inputType) {\n        return false;\n      }\n\n      if (['password', 'hidden', 'email', 'tel'].includes(inputType)) {\n        return true;\n      }\n\n      if ((element as HTMLInputElement).autocomplete.startsWith('cc-')) {\n        return true;\n      }\n\n      return false;\n    }\n    case 'medium':\n    case 'conservative':\n      return true;\n    default:\n      return isMaskedForLevel(elementType, DEFAULT_MASK_LEVEL, element);\n  }\n};\n\n/**\n * Checks if the given element set to be masked by rrweb\n *\n * Priority is:\n *  1. [In code] Element/class based masking/unmasking <> [Config based] Selector based masking/unmasking\n *  2. Use app defaults\n */\nconst isMasked = (\n  elementType: 'input' | 'text',\n  config: PrivacyConfig = { defaultMaskLevel: DEFAULT_MASK_LEVEL },\n  element: HTMLElement | null,\n): boolean => {\n  if (element) {\n    // Element or parent is explicitly instrumented in code to mask\n    if (element.closest('.' + MASK_TEXT_CLASS)) {\n      return true;\n    }\n\n    // Config has override for mask\n    const shouldMask = (config.maskSelector ?? []).some((selector) => element.closest(selector));\n    if (shouldMask) {\n      return true;\n    }\n\n    // Code or config has override to unmask\n    if (element.closest('.' + UNMASK_TEXT_CLASS)) {\n      return false;\n    }\n\n    // Here we are probably sent an element, but we want to match if they have a\n    // parent with an unmask selector.\n    const shouldUnmask = (config.unmaskSelector ?? []).some((selector) => element.closest(selector));\n    if (shouldUnmask) {\n      return false;\n    }\n  }\n\n  return isMaskedForLevel(elementType, config.defaultMaskLevel ?? DEFAULT_MASK_LEVEL, element);\n};\n\nexport const maskFn =\n  (elementType: 'text' | 'input', config?: PrivacyConfig) =>\n  (text: string, element: HTMLElement | null): string => {\n    return isMasked(elementType, config, element) ? text.replace(/[^\\s]/g, '*') : text;\n  };\n\nexport const generateHashCode = function (str: string) {\n  let hash = 0;\n  if (str.length === 0) return hash;\n  for (let i = 0; i < str.length; i++) {\n    const chr = str.charCodeAt(i);\n    hash = (hash << 5) - hash + chr;\n    hash |= 0;\n  }\n  return hash;\n};\n\nexport const isSessionInSample = function (sessionId: string | number, sampleRate: number) {\n  const hashNumber = generateHashCode(sessionId.toString());\n  const absHash = Math.abs(hashNumber);\n  const absHashMultiply = absHash * 31;\n  const mod = absHashMultiply % 1000000;\n  return mod / 1000000 < sampleRate;\n};\n\nexport const getCurrentUrl = () => {\n  const globalScope = getGlobalScope();\n  return globalScope?.location ? globalScope.location.href : '';\n};\n\nexport const generateSessionReplayId = (sessionId: string | number, deviceId: string): string => {\n  return `${deviceId}/${sessionId}`;\n};\n\nexport const getServerUrl = (serverZone?: keyof typeof ServerZone, trackServerUrl?: string): string => {\n  if (trackServerUrl) {\n    return trackServerUrl;\n  }\n\n  if (serverZone === ServerZone.STAGING) {\n    return SESSION_REPLAY_STAGING_URL;\n  }\n\n  if (serverZone === ServerZone.EU) {\n    return SESSION_REPLAY_EU_URL;\n  }\n\n  return SESSION_REPLAY_SERVER_URL;\n};\n\nconst isValidGlobUrl = (globUrl: string): boolean => {\n  if (typeof globUrl !== 'string' || globUrl.trim() === '') return false;\n  const urlPattern = /^\\/|^https?:\\/\\/[^\\s]+$/;\n  if (!urlPattern.test(globUrl)) return false;\n  return true;\n};\n\nconst globToRegex = (glob: string): RegExp => {\n  // Escape special regex characters, then convert globs\n  const escaped = glob\n    .replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&') // Escape regex specials\n    .replace(/\\*/g, '.*') // Convert * to .*\n    .replace(/\\?/g, '.'); // Convert ? to .\n\n  return new RegExp(`^${escaped}$`);\n};\n\nexport const validateUGCFilterRules = (ugcFilterRules: UGCFilterRule[]) => {\n  // validate ugcFilterRules\n  if (!ugcFilterRules.every((rule) => typeof rule.selector === 'string' && typeof rule.replacement === 'string')) {\n    throw new Error('ugcFilterRules must be an array of objects with selector and replacement properties');\n  }\n\n  // validate ugcFilterRules are valid globs\n  if (!ugcFilterRules.every((rule) => isValidGlobUrl(rule.selector))) {\n    throw new Error('ugcFilterRules must be an array of objects with valid globs');\n  }\n};\n\nexport const getPageUrl = (pageUrl: string, ugcFilterRules: UGCFilterRule[]) => {\n  // apply ugcFilterRules, order is important, first rule wins\n  for (const rule of ugcFilterRules) {\n    const regex = globToRegex(rule.selector);\n\n    if (regex.test(pageUrl)) {\n      return pageUrl.replace(regex, rule.replacement);\n    }\n  }\n\n  return pageUrl;\n};\n\nexport const getStorageSize = async (): Promise<StorageData> => {\n  try {\n    const globalScope = getGlobalScope();\n    if (globalScope) {\n      const { usage, quota, usageDetails }: ChromeStorageEstimate = await globalScope.navigator.storage.estimate();\n      const totalStorageSize = usage ? Math.round(usage / KB_SIZE) : 0;\n      const percentOfQuota = usage && quota ? Math.round((usage / quota + Number.EPSILON) * 1000) / 1000 : 0;\n      return { totalStorageSize, percentOfQuota, usageDetails: JSON.stringify(usageDetails) };\n    }\n  } catch (e) {\n    // swallow\n  }\n  return { totalStorageSize: 0, percentOfQuota: 0, usageDetails: '' };\n};\n\nexport const getDebugConfig = (config: SessionReplayJoinedConfig) => {\n  const debugConfig = {\n    ...config,\n  };\n  const { apiKey } = debugConfig;\n  debugConfig.apiKey = `****${apiKey.substring(apiKey.length - 4)}`;\n  return debugConfig;\n};\n","export function toLowerCase<T extends string>(str: T): Lowercase<T> {\n  return str.toLowerCase() as unknown as Lowercase<T>;\n}\n\n/**\n * Get the type of an input element.\n * This takes care of the case where a password input is changed to a text input.\n * In this case, we continue to consider this of type password, in order to avoid leaking sensitive data\n * where passwords should be masked.\n */\nexport function getInputType(element: HTMLElement): Lowercase<string> | null {\n  // when omitting the type of input element(e.g. <input />), the type is treated as text\n  const type = (element as HTMLInputElement).type;\n\n  return element.hasAttribute('data-rr-is-password')\n    ? 'password'\n    : type\n    ? // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n      toLowerCase(type)\n    : null;\n}\n","import { ILogger, LogLevel } from '@amplitude/analytics-core';\n\nexport class SafeLoggerProvider implements ILogger {\n  private logger: ILogger;\n\n  log: typeof console.log;\n  warn: typeof console.warn;\n  error: typeof console.error;\n  debug: typeof console.debug;\n\n  constructor(loggerProvider: ILogger) {\n    this.logger = loggerProvider;\n    this.log = this.getSafeMethod('log');\n    this.warn = this.getSafeMethod('warn');\n    this.error = this.getSafeMethod('error');\n    this.debug = this.getSafeMethod('debug');\n  }\n\n  private getSafeMethod<K extends keyof ILogger>(method: K): ILogger[K] {\n    if (!this.logger) {\n      return (() => {\n        // No-op function fallback\n      }) as ILogger[K];\n    }\n\n    const fn = this.logger[method];\n    if (typeof fn === 'function') {\n      const originalFn = (fn as { __rrweb_original__?: ILogger[K] }).__rrweb_original__ ?? fn;\n      return originalFn.bind(this.logger) as ILogger[K];\n    }\n\n    return (() => {\n      // No-op function fallback\n    }) as ILogger[K];\n  }\n\n  enable(logLevel: LogLevel) {\n    this.logger.enable(logLevel);\n  }\n\n  disable() {\n    this.logger.disable();\n  }\n}\n","import { Config, Logger, FetchTransport, LogLevel } from '@amplitude/analytics-core';\nimport {\n  DEFAULT_PERFORMANCE_CONFIG,\n  DEFAULT_SAMPLE_RATE,\n  DEFAULT_SERVER_ZONE,\n  DEFAULT_URL_CHANGE_POLLING_INTERVAL,\n} from '../constants';\nimport { SessionReplayOptions, StoreType } from '../typings/session-replay';\nimport {\n  SessionReplayLocalConfig as ISessionReplayLocalConfig,\n  InteractionConfig,\n  PrivacyConfig,\n  SessionReplayPerformanceConfig,\n  SessionReplayVersion,\n} from './types';\nimport { SafeLoggerProvider } from '../logger';\nimport { validateUGCFilterRules } from '../helpers';\n\nexport const getDefaultConfig = () => ({\n  flushMaxRetries: 2,\n  logLevel: LogLevel.Warn,\n  loggerProvider: new Logger(),\n  transportProvider: new FetchTransport(),\n});\n\nexport class SessionReplayLocalConfig extends Config implements ISessionReplayLocalConfig {\n  apiKey: string;\n  sampleRate: number;\n  privacyConfig?: PrivacyConfig;\n  interactionConfig?: InteractionConfig;\n  debugMode?: boolean;\n  configServerUrl?: string;\n  trackServerUrl?: string;\n  shouldInlineStylesheet?: boolean;\n  version?: SessionReplayVersion;\n  storeType: StoreType;\n  performanceConfig?: SessionReplayPerformanceConfig;\n  experimental?: { useWebWorker: boolean };\n  applyBackgroundColorToBlockedElements?: boolean;\n  omitElementTags?: {\n    script?: boolean;\n    comment?: boolean;\n  };\n  enableUrlChangePolling?: boolean;\n  urlChangePollingInterval?: number;\n  captureDocumentTitle?: boolean;\n\n  constructor(apiKey: string, options: SessionReplayOptions) {\n    const defaultConfig = getDefaultConfig();\n    super({\n      transportProvider: defaultConfig.transportProvider,\n      loggerProvider: new SafeLoggerProvider(options.loggerProvider || defaultConfig.loggerProvider),\n      ...options,\n      apiKey,\n    });\n    this.flushMaxRetries =\n      options.flushMaxRetries !== undefined && options.flushMaxRetries <= defaultConfig.flushMaxRetries\n        ? options.flushMaxRetries\n        : defaultConfig.flushMaxRetries;\n\n    this.apiKey = apiKey;\n    this.sampleRate = options.sampleRate || DEFAULT_SAMPLE_RATE;\n    this.serverZone = options.serverZone || DEFAULT_SERVER_ZONE;\n    this.configServerUrl = options.configServerUrl;\n    this.trackServerUrl = options.trackServerUrl;\n    this.shouldInlineStylesheet = options.shouldInlineStylesheet;\n    this.version = options.version;\n    this.performanceConfig = options.performanceConfig || DEFAULT_PERFORMANCE_CONFIG;\n    this.storeType = options.storeType ?? 'idb';\n    this.applyBackgroundColorToBlockedElements = options.applyBackgroundColorToBlockedElements ?? false;\n    this.enableUrlChangePolling = options.enableUrlChangePolling ?? false;\n    this.urlChangePollingInterval = options.urlChangePollingInterval ?? DEFAULT_URL_CHANGE_POLLING_INTERVAL;\n    this.captureDocumentTitle = options.captureDocumentTitle ?? false;\n\n    if (options.privacyConfig) {\n      this.privacyConfig = options.privacyConfig;\n    }\n    if (options.interactionConfig) {\n      this.interactionConfig = options.interactionConfig;\n\n      // validate ugcFilterRules, throw error if invalid - throw error at the beginning of the config\n      if (this.interactionConfig.ugcFilterRules) {\n        validateUGCFilterRules(this.interactionConfig.ugcFilterRules);\n      }\n    }\n    if (options.debugMode) {\n      this.debugMode = options.debugMode;\n    }\n    if (options.experimental) {\n      this.experimental = options.experimental;\n    }\n    if (options.omitElementTags) {\n      this.omitElementTags = options.omitElementTags;\n    }\n  }\n}\n","import { RemoteConfigFetch, createRemoteConfigFetch } from '@amplitude/analytics-remote-config';\nimport { ILogger } from '@amplitude/analytics-core';\nimport { getDebugConfig } from '../helpers';\nimport { SessionReplayOptions } from '../typings/session-replay';\nimport { SessionReplayLocalConfig } from './local-config';\nimport {\n  SessionReplayLocalConfig as ISessionReplayLocalConfig,\n  PrivacyConfig,\n  SessionReplayConfigs,\n  SessionReplayJoinedConfig,\n  SessionReplayRemoteConfig,\n} from './types';\n\nexport const removeInvalidSelectorsFromPrivacyConfig = (privacyConfig: PrivacyConfig, loggerProvider: ILogger) => {\n  // This allows us to not search the DOM.\n  const fragment = document.createDocumentFragment();\n\n  const dropInvalidSelectors = (selectors: string[] | string = []): string[] | undefined => {\n    if (typeof selectors === 'string') {\n      selectors = [selectors];\n    }\n    selectors = selectors.filter((selector: string) => {\n      try {\n        fragment.querySelector(selector);\n      } catch {\n        loggerProvider.warn(`[session-replay-browser] omitting selector \"${selector}\" because it is invalid`);\n        return false;\n      }\n      return true;\n    });\n    if (selectors.length === 0) {\n      return undefined;\n    }\n    return selectors;\n  };\n  privacyConfig.blockSelector = dropInvalidSelectors(privacyConfig.blockSelector);\n  privacyConfig.maskSelector = dropInvalidSelectors(privacyConfig.maskSelector);\n  privacyConfig.unmaskSelector = dropInvalidSelectors(privacyConfig.unmaskSelector);\n  return privacyConfig;\n};\nexport class SessionReplayJoinedConfigGenerator {\n  private readonly localConfig: ISessionReplayLocalConfig;\n  private readonly remoteConfigFetch: RemoteConfigFetch<SessionReplayRemoteConfig>;\n\n  constructor(remoteConfigFetch: RemoteConfigFetch<SessionReplayRemoteConfig>, localConfig: ISessionReplayLocalConfig) {\n    this.localConfig = localConfig;\n    this.remoteConfigFetch = remoteConfigFetch;\n  }\n\n  async generateJoinedConfig(sessionId?: string | number): Promise<SessionReplayConfigs> {\n    const config: SessionReplayJoinedConfig = { ...this.localConfig };\n    // Special case here as optOut is implemented via getter/setter\n    config.optOut = this.localConfig.optOut;\n    // We always want captureEnabled to be true, unless there's an override\n    // in the remote config.\n    config.captureEnabled = true;\n    let remoteConfig: SessionReplayRemoteConfig | undefined;\n    try {\n      const namespaceConfig = await this.remoteConfigFetch.getRemoteNamespaceConfig('sessionReplay', sessionId);\n      if (namespaceConfig) {\n        const samplingConfig = namespaceConfig.sr_sampling_config;\n        const privacyConfig = namespaceConfig.sr_privacy_config;\n        const targetingConfig = namespaceConfig.sr_targeting_config;\n\n        const ugcFilterRules = config.interactionConfig?.ugcFilterRules;\n        // This is intentionally forced to only be set through the remote config.\n        config.interactionConfig = namespaceConfig.sr_interaction_config;\n        if (config.interactionConfig && ugcFilterRules) {\n          config.interactionConfig.ugcFilterRules = ugcFilterRules;\n        }\n\n        // This is intentionally forced to only be set through the remote config.\n        config.loggingConfig = namespaceConfig.sr_logging_config;\n\n        if (samplingConfig || privacyConfig || targetingConfig) {\n          remoteConfig = {};\n          if (samplingConfig) {\n            remoteConfig.sr_sampling_config = samplingConfig;\n          }\n          if (privacyConfig) {\n            remoteConfig.sr_privacy_config = privacyConfig;\n          }\n          if (targetingConfig) {\n            remoteConfig.sr_targeting_config = targetingConfig;\n          }\n        }\n      }\n    } catch (err: unknown) {\n      const knownError = err as Error;\n      this.localConfig.loggerProvider.warn(knownError.message);\n      config.captureEnabled = false;\n    }\n\n    if (!remoteConfig) {\n      return {\n        localConfig: this.localConfig,\n        joinedConfig: config,\n        remoteConfig,\n      };\n    }\n\n    const {\n      sr_sampling_config: samplingConfig,\n      sr_privacy_config: remotePrivacyConfig,\n      sr_targeting_config: targetingConfig,\n    } = remoteConfig;\n    if (samplingConfig && Object.keys(samplingConfig).length > 0) {\n      if (Object.prototype.hasOwnProperty.call(samplingConfig, 'capture_enabled')) {\n        config.captureEnabled = samplingConfig.capture_enabled;\n      } else {\n        config.captureEnabled = false;\n      }\n\n      if (Object.prototype.hasOwnProperty.call(samplingConfig, 'sample_rate')) {\n        config.sampleRate = samplingConfig.sample_rate;\n      }\n    } else {\n      // If config API response was valid (ie 200), but no config returned, assume that\n      // customer has not yet set up config, and use sample rate from SDK options,\n      // allowing for immediate replay capture\n      config.captureEnabled = true;\n      this.localConfig.loggerProvider.debug(\n        'Remote config successfully fetched, but no values set for project, Session Replay capture enabled.',\n      );\n    }\n\n    // Remote config join acts somewhat like a left join between the remote and the local\n    // config. That is, remote config has precedence over local values as with sampling.\n    // However, non conflicting values will be added to the lists.\n    // Here's an example to illustrate:\n    //\n    // Remote config:   {'.selector1': 'MASK',   '.selector2': 'UNMASK'}\n    // Local config:    {'.selector1': 'UNMASK',                         '.selector3': 'MASK'}\n    //\n    // Resolved config: {'.selector1': 'MASK',   '.selector2': 'UNMASK', '.selector3': 'MASK'}\n    // config.privacyConfig = {\n    //   ...(config.privacyConfig ?? {}),\n    //   ...remotePrivacyConfig,\n    // };\n\n    if (remotePrivacyConfig) {\n      const localPrivacyConfig: PrivacyConfig = config.privacyConfig ?? {};\n\n      const joinedPrivacyConfig: Required<PrivacyConfig> & { blockSelector: string[] } = {\n        defaultMaskLevel: remotePrivacyConfig.defaultMaskLevel ?? localPrivacyConfig.defaultMaskLevel ?? 'medium',\n        blockSelector: [],\n        maskSelector: [],\n        unmaskSelector: [],\n      };\n\n      const privacyConfigSelectorMap = (privacyConfig: PrivacyConfig): Record<string, 'mask' | 'unmask' | 'block'> => {\n        const selectorMap: Record<string, 'mask' | 'unmask' | 'block'> = {};\n        if (typeof privacyConfig.blockSelector === 'string') {\n          privacyConfig.blockSelector = [privacyConfig.blockSelector];\n        }\n\n        for (const selector of privacyConfig.blockSelector ?? []) {\n          selectorMap[selector] = 'block';\n        }\n        for (const selector of privacyConfig.maskSelector ?? []) {\n          selectorMap[selector] = 'mask';\n        }\n        for (const selector of privacyConfig.unmaskSelector ?? []) {\n          selectorMap[selector] = 'unmask';\n        }\n        return selectorMap;\n      };\n\n      const selectorMap: Record<string, 'mask' | 'unmask' | 'block'> = {\n        ...privacyConfigSelectorMap(localPrivacyConfig),\n        ...privacyConfigSelectorMap(remotePrivacyConfig),\n      };\n\n      for (const [selector, selectorType] of Object.entries(selectorMap)) {\n        if (selectorType === 'mask') {\n          joinedPrivacyConfig.maskSelector.push(selector);\n        } else if (selectorType === 'block') {\n          joinedPrivacyConfig.blockSelector.push(selector);\n        } else if (selectorType === 'unmask') {\n          joinedPrivacyConfig.unmaskSelector.push(selector);\n        }\n      }\n\n      config.privacyConfig = removeInvalidSelectorsFromPrivacyConfig(\n        joinedPrivacyConfig,\n        this.localConfig.loggerProvider,\n      );\n    }\n\n    if (targetingConfig && Object.keys(targetingConfig).length > 0) {\n      config.targetingConfig = targetingConfig;\n    }\n\n    this.localConfig.loggerProvider.debug(\n      JSON.stringify({ name: 'session replay joined config', config: getDebugConfig(config) }, null, 2),\n    );\n\n    return {\n      localConfig: this.localConfig,\n      joinedConfig: config,\n      remoteConfig,\n    };\n  }\n}\n\nexport const createSessionReplayJoinedConfigGenerator = async (apiKey: string, options: SessionReplayOptions) => {\n  const localConfig = new SessionReplayLocalConfig(apiKey, options);\n  const remoteConfigFetch = await createRemoteConfigFetch<SessionReplayRemoteConfig>({\n    localConfig,\n    configKeys: ['sessionReplay'],\n  });\n\n  return new SessionReplayJoinedConfigGenerator(remoteConfigFetch, localConfig);\n};\n","var u8 = Uint8Array, u16 = Uint16Array, u32 = Uint32Array;\nvar fleb = new u8([\n  0,\n  0,\n  0,\n  0,\n  0,\n  0,\n  0,\n  0,\n  1,\n  1,\n  1,\n  1,\n  2,\n  2,\n  2,\n  2,\n  3,\n  3,\n  3,\n  3,\n  4,\n  4,\n  4,\n  4,\n  5,\n  5,\n  5,\n  5,\n  0,\n  /* unused */\n  0,\n  0,\n  /* impossible */\n  0\n]);\nvar fdeb = new u8([\n  0,\n  0,\n  0,\n  0,\n  1,\n  1,\n  2,\n  2,\n  3,\n  3,\n  4,\n  4,\n  5,\n  5,\n  6,\n  6,\n  7,\n  7,\n  8,\n  8,\n  9,\n  9,\n  10,\n  10,\n  11,\n  11,\n  12,\n  12,\n  13,\n  13,\n  /* unused */\n  0,\n  0\n]);\nvar clim = new u8([16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15]);\nvar freb = function(eb, start) {\n  var b = new u16(31);\n  for (var i = 0; i < 31; ++i) {\n    b[i] = start += 1 << eb[i - 1];\n  }\n  var r = new u32(b[30]);\n  for (var i = 1; i < 30; ++i) {\n    for (var j = b[i]; j < b[i + 1]; ++j) {\n      r[j] = j - b[i] << 5 | i;\n    }\n  }\n  return [b, r];\n};\nvar _a = freb(fleb, 2), fl = _a[0], revfl = _a[1];\nfl[28] = 258, revfl[258] = 28;\nvar _b = freb(fdeb, 0), fd = _b[0], revfd = _b[1];\nvar rev = new u16(32768);\nfor (var i = 0; i < 32768; ++i) {\n  var x = (i & 43690) >>> 1 | (i & 21845) << 1;\n  x = (x & 52428) >>> 2 | (x & 13107) << 2;\n  x = (x & 61680) >>> 4 | (x & 3855) << 4;\n  rev[i] = ((x & 65280) >>> 8 | (x & 255) << 8) >>> 1;\n}\nvar hMap = function(cd, mb, r) {\n  var s = cd.length;\n  var i = 0;\n  var l = new u16(mb);\n  for (; i < s; ++i)\n    ++l[cd[i] - 1];\n  var le = new u16(mb);\n  for (i = 0; i < mb; ++i) {\n    le[i] = le[i - 1] + l[i - 1] << 1;\n  }\n  var co;\n  if (r) {\n    co = new u16(1 << mb);\n    var rvb = 15 - mb;\n    for (i = 0; i < s; ++i) {\n      if (cd[i]) {\n        var sv = i << 4 | cd[i];\n        var r_1 = mb - cd[i];\n        var v = le[cd[i] - 1]++ << r_1;\n        for (var m = v | (1 << r_1) - 1; v <= m; ++v) {\n          co[rev[v] >>> rvb] = sv;\n        }\n      }\n    }\n  } else {\n    co = new u16(s);\n    for (i = 0; i < s; ++i)\n      co[i] = rev[le[cd[i] - 1]++] >>> 15 - cd[i];\n  }\n  return co;\n};\nvar flt = new u8(288);\nfor (var i = 0; i < 144; ++i)\n  flt[i] = 8;\nfor (var i = 144; i < 256; ++i)\n  flt[i] = 9;\nfor (var i = 256; i < 280; ++i)\n  flt[i] = 7;\nfor (var i = 280; i < 288; ++i)\n  flt[i] = 8;\nvar fdt = new u8(32);\nfor (var i = 0; i < 32; ++i)\n  fdt[i] = 5;\nvar flm = /* @__PURE__ */ hMap(flt, 9, 0), flrm = /* @__PURE__ */ hMap(flt, 9, 1);\nvar fdm = /* @__PURE__ */ hMap(fdt, 5, 0), fdrm = /* @__PURE__ */ hMap(fdt, 5, 1);\nvar max = function(a) {\n  var m = a[0];\n  for (var i = 1; i < a.length; ++i) {\n    if (a[i] > m)\n      m = a[i];\n  }\n  return m;\n};\nvar bits = function(d, p, m) {\n  var o = p / 8 >> 0;\n  return (d[o] | d[o + 1] << 8) >>> (p & 7) & m;\n};\nvar bits16 = function(d, p) {\n  var o = p / 8 >> 0;\n  return (d[o] | d[o + 1] << 8 | d[o + 2] << 16) >>> (p & 7);\n};\nvar shft = function(p) {\n  return (p / 8 >> 0) + (p & 7 && 1);\n};\nvar slc = function(v, s, e) {\n  if (e == null || e > v.length)\n    e = v.length;\n  var n = new (v instanceof u16 ? u16 : v instanceof u32 ? u32 : u8)(e - s);\n  n.set(v.subarray(s, e));\n  return n;\n};\nvar inflt = function(dat, buf, st) {\n  var sl = dat.length;\n  var noBuf = !buf || st;\n  var noSt = !st || st.i;\n  if (!st)\n    st = {};\n  if (!buf)\n    buf = new u8(sl * 3);\n  var cbuf = function(l2) {\n    var bl = buf.length;\n    if (l2 > bl) {\n      var nbuf = new u8(Math.max(bl * 2, l2));\n      nbuf.set(buf);\n      buf = nbuf;\n    }\n  };\n  var final = st.f || 0, pos = st.p || 0, bt = st.b || 0, lm = st.l, dm = st.d, lbt = st.m, dbt = st.n;\n  var tbts = sl * 8;\n  do {\n    if (!lm) {\n      st.f = final = bits(dat, pos, 1);\n      var type = bits(dat, pos + 1, 3);\n      pos += 3;\n      if (!type) {\n        var s = shft(pos) + 4, l = dat[s - 4] | dat[s - 3] << 8, t = s + l;\n        if (t > sl) {\n          if (noSt)\n            throw \"unexpected EOF\";\n          break;\n        }\n        if (noBuf)\n          cbuf(bt + l);\n        buf.set(dat.subarray(s, t), bt);\n        st.b = bt += l, st.p = pos = t * 8;\n        continue;\n      } else if (type == 1)\n        lm = flrm, dm = fdrm, lbt = 9, dbt = 5;\n      else if (type == 2) {\n        var hLit = bits(dat, pos, 31) + 257, hcLen = bits(dat, pos + 10, 15) + 4;\n        var tl = hLit + bits(dat, pos + 5, 31) + 1;\n        pos += 14;\n        var ldt = new u8(tl);\n        var clt = new u8(19);\n        for (var i = 0; i < hcLen; ++i) {\n          clt[clim[i]] = bits(dat, pos + i * 3, 7);\n        }\n        pos += hcLen * 3;\n        var clb = max(clt), clbmsk = (1 << clb) - 1;\n        if (!noSt && pos + tl * (clb + 7) > tbts)\n          break;\n        var clm = hMap(clt, clb, 1);\n        for (var i = 0; i < tl; ) {\n          var r = clm[bits(dat, pos, clbmsk)];\n          pos += r & 15;\n          var s = r >>> 4;\n          if (s < 16) {\n            ldt[i++] = s;\n          } else {\n            var c = 0, n = 0;\n            if (s == 16)\n              n = 3 + bits(dat, pos, 3), pos += 2, c = ldt[i - 1];\n            else if (s == 17)\n              n = 3 + bits(dat, pos, 7), pos += 3;\n            else if (s == 18)\n              n = 11 + bits(dat, pos, 127), pos += 7;\n            while (n--)\n              ldt[i++] = c;\n          }\n        }\n        var lt = ldt.subarray(0, hLit), dt = ldt.subarray(hLit);\n        lbt = max(lt);\n        dbt = max(dt);\n        lm = hMap(lt, lbt, 1);\n        dm = hMap(dt, dbt, 1);\n      } else\n        throw \"invalid block type\";\n      if (pos > tbts)\n        throw \"unexpected EOF\";\n    }\n    if (noBuf)\n      cbuf(bt + 131072);\n    var lms = (1 << lbt) - 1, dms = (1 << dbt) - 1;\n    var mxa = lbt + dbt + 18;\n    while (noSt || pos + mxa < tbts) {\n      var c = lm[bits16(dat, pos) & lms], sym = c >>> 4;\n      pos += c & 15;\n      if (pos > tbts)\n        throw \"unexpected EOF\";\n      if (!c)\n        throw \"invalid length/literal\";\n      if (sym < 256)\n        buf[bt++] = sym;\n      else if (sym == 256) {\n        lm = null;\n        break;\n      } else {\n        var add = sym - 254;\n        if (sym > 264) {\n          var i = sym - 257, b = fleb[i];\n          add = bits(dat, pos, (1 << b) - 1) + fl[i];\n          pos += b;\n        }\n        var d = dm[bits16(dat, pos) & dms], dsym = d >>> 4;\n        if (!d)\n          throw \"invalid distance\";\n        pos += d & 15;\n        var dt = fd[dsym];\n        if (dsym > 3) {\n          var b = fdeb[dsym];\n          dt += bits16(dat, pos) & (1 << b) - 1, pos += b;\n        }\n        if (pos > tbts)\n          throw \"unexpected EOF\";\n        if (noBuf)\n          cbuf(bt + 131072);\n        var end = bt + add;\n        for (; bt < end; bt += 4) {\n          buf[bt] = buf[bt - dt];\n          buf[bt + 1] = buf[bt + 1 - dt];\n          buf[bt + 2] = buf[bt + 2 - dt];\n          buf[bt + 3] = buf[bt + 3 - dt];\n        }\n        bt = end;\n      }\n    }\n    st.l = lm, st.p = pos, st.b = bt;\n    if (lm)\n      final = 1, st.m = lbt, st.d = dm, st.n = dbt;\n  } while (!final);\n  return bt == buf.length ? buf : slc(buf, 0, bt);\n};\nvar wbits = function(d, p, v) {\n  v <<= p & 7;\n  var o = p / 8 >> 0;\n  d[o] |= v;\n  d[o + 1] |= v >>> 8;\n};\nvar wbits16 = function(d, p, v) {\n  v <<= p & 7;\n  var o = p / 8 >> 0;\n  d[o] |= v;\n  d[o + 1] |= v >>> 8;\n  d[o + 2] |= v >>> 16;\n};\nvar hTree = function(d, mb) {\n  var t = [];\n  for (var i = 0; i < d.length; ++i) {\n    if (d[i])\n      t.push({ s: i, f: d[i] });\n  }\n  var s = t.length;\n  var t2 = t.slice();\n  if (!s)\n    return [new u8(0), 0];\n  if (s == 1) {\n    var v = new u8(t[0].s + 1);\n    v[t[0].s] = 1;\n    return [v, 1];\n  }\n  t.sort(function(a, b) {\n    return a.f - b.f;\n  });\n  t.push({ s: -1, f: 25001 });\n  var l = t[0], r = t[1], i0 = 0, i1 = 1, i2 = 2;\n  t[0] = { s: -1, f: l.f + r.f, l, r };\n  while (i1 != s - 1) {\n    l = t[t[i0].f < t[i2].f ? i0++ : i2++];\n    r = t[i0 != i1 && t[i0].f < t[i2].f ? i0++ : i2++];\n    t[i1++] = { s: -1, f: l.f + r.f, l, r };\n  }\n  var maxSym = t2[0].s;\n  for (var i = 1; i < s; ++i) {\n    if (t2[i].s > maxSym)\n      maxSym = t2[i].s;\n  }\n  var tr = new u16(maxSym + 1);\n  var mbt = ln(t[i1 - 1], tr, 0);\n  if (mbt > mb) {\n    var i = 0, dt = 0;\n    var lft = mbt - mb, cst = 1 << lft;\n    t2.sort(function(a, b) {\n      return tr[b.s] - tr[a.s] || a.f - b.f;\n    });\n    for (; i < s; ++i) {\n      var i2_1 = t2[i].s;\n      if (tr[i2_1] > mb) {\n        dt += cst - (1 << mbt - tr[i2_1]);\n        tr[i2_1] = mb;\n      } else\n        break;\n    }\n    dt >>>= lft;\n    while (dt > 0) {\n      var i2_2 = t2[i].s;\n      if (tr[i2_2] < mb)\n        dt -= 1 << mb - tr[i2_2]++ - 1;\n      else\n        ++i;\n    }\n    for (; i >= 0 && dt; --i) {\n      var i2_3 = t2[i].s;\n      if (tr[i2_3] == mb) {\n        --tr[i2_3];\n        ++dt;\n      }\n    }\n    mbt = mb;\n  }\n  return [new u8(tr), mbt];\n};\nvar ln = function(n, l, d) {\n  return n.s == -1 ? Math.max(ln(n.l, l, d + 1), ln(n.r, l, d + 1)) : l[n.s] = d;\n};\nvar lc = function(c) {\n  var s = c.length;\n  while (s && !c[--s])\n    ;\n  var cl = new u16(++s);\n  var cli = 0, cln = c[0], cls = 1;\n  var w = function(v) {\n    cl[cli++] = v;\n  };\n  for (var i = 1; i <= s; ++i) {\n    if (c[i] == cln && i != s)\n      ++cls;\n    else {\n      if (!cln && cls > 2) {\n        for (; cls > 138; cls -= 138)\n          w(32754);\n        if (cls > 2) {\n          w(cls > 10 ? cls - 11 << 5 | 28690 : cls - 3 << 5 | 12305);\n          cls = 0;\n        }\n      } else if (cls > 3) {\n        w(cln), --cls;\n        for (; cls > 6; cls -= 6)\n          w(8304);\n        if (cls > 2)\n          w(cls - 3 << 5 | 8208), cls = 0;\n      }\n      while (cls--)\n        w(cln);\n      cls = 1;\n      cln = c[i];\n    }\n  }\n  return [cl.subarray(0, cli), s];\n};\nvar clen = function(cf, cl) {\n  var l = 0;\n  for (var i = 0; i < cl.length; ++i)\n    l += cf[i] * cl[i];\n  return l;\n};\nvar wfblk = function(out, pos, dat) {\n  var s = dat.length;\n  var o = shft(pos + 2);\n  out[o] = s & 255;\n  out[o + 1] = s >>> 8;\n  out[o + 2] = out[o] ^ 255;\n  out[o + 3] = out[o + 1] ^ 255;\n  for (var i = 0; i < s; ++i)\n    out[o + i + 4] = dat[i];\n  return (o + 4 + s) * 8;\n};\nvar wblk = function(dat, out, final, syms, lf, df, eb, li, bs, bl, p) {\n  wbits(out, p++, final);\n  ++lf[256];\n  var _a2 = hTree(lf, 15), dlt = _a2[0], mlb = _a2[1];\n  var _b2 = hTree(df, 15), ddt = _b2[0], mdb = _b2[1];\n  var _c = lc(dlt), lclt = _c[0], nlc = _c[1];\n  var _d = lc(ddt), lcdt = _d[0], ndc = _d[1];\n  var lcfreq = new u16(19);\n  for (var i = 0; i < lclt.length; ++i)\n    lcfreq[lclt[i] & 31]++;\n  for (var i = 0; i < lcdt.length; ++i)\n    lcfreq[lcdt[i] & 31]++;\n  var _e = hTree(lcfreq, 7), lct = _e[0], mlcb = _e[1];\n  var nlcc = 19;\n  for (; nlcc > 4 && !lct[clim[nlcc - 1]]; --nlcc)\n    ;\n  var flen = bl + 5 << 3;\n  var ftlen = clen(lf, flt) + clen(df, fdt) + eb;\n  var dtlen = clen(lf, dlt) + clen(df, ddt) + eb + 14 + 3 * nlcc + clen(lcfreq, lct) + (2 * lcfreq[16] + 3 * lcfreq[17] + 7 * lcfreq[18]);\n  if (flen <= ftlen && flen <= dtlen)\n    return wfblk(out, p, dat.subarray(bs, bs + bl));\n  var lm, ll, dm, dl;\n  wbits(out, p, 1 + (dtlen < ftlen)), p += 2;\n  if (dtlen < ftlen) {\n    lm = hMap(dlt, mlb, 0), ll = dlt, dm = hMap(ddt, mdb, 0), dl = ddt;\n    var llm = hMap(lct, mlcb, 0);\n    wbits(out, p, nlc - 257);\n    wbits(out, p + 5, ndc - 1);\n    wbits(out, p + 10, nlcc - 4);\n    p += 14;\n    for (var i = 0; i < nlcc; ++i)\n      wbits(out, p + 3 * i, lct[clim[i]]);\n    p += 3 * nlcc;\n    var lcts = [lclt, lcdt];\n    for (var it = 0; it < 2; ++it) {\n      var clct = lcts[it];\n      for (var i = 0; i < clct.length; ++i) {\n        var len = clct[i] & 31;\n        wbits(out, p, llm[len]), p += lct[len];\n        if (len > 15)\n          wbits(out, p, clct[i] >>> 5 & 127), p += clct[i] >>> 12;\n      }\n    }\n  } else {\n    lm = flm, ll = flt, dm = fdm, dl = fdt;\n  }\n  for (var i = 0; i < li; ++i) {\n    if (syms[i] > 255) {\n      var len = syms[i] >>> 18 & 31;\n      wbits16(out, p, lm[len + 257]), p += ll[len + 257];\n      if (len > 7)\n        wbits(out, p, syms[i] >>> 23 & 31), p += fleb[len];\n      var dst = syms[i] & 31;\n      wbits16(out, p, dm[dst]), p += dl[dst];\n      if (dst > 3)\n        wbits16(out, p, syms[i] >>> 5 & 8191), p += fdeb[dst];\n    } else {\n      wbits16(out, p, lm[syms[i]]), p += ll[syms[i]];\n    }\n  }\n  wbits16(out, p, lm[256]);\n  return p + ll[256];\n};\nvar deo = /* @__PURE__ */ new u32([65540, 131080, 131088, 131104, 262176, 1048704, 1048832, 2114560, 2117632]);\nvar dflt = function(dat, lvl, plvl, pre, post, lst) {\n  var s = dat.length;\n  var o = new u8(pre + s + 5 * (1 + Math.floor(s / 7e3)) + post);\n  var w = o.subarray(pre, o.length - post);\n  var pos = 0;\n  if (!lvl || s < 8) {\n    for (var i = 0; i <= s; i += 65535) {\n      var e = i + 65535;\n      if (e < s) {\n        pos = wfblk(w, pos, dat.subarray(i, e));\n      } else {\n        w[i] = lst;\n        pos = wfblk(w, pos, dat.subarray(i, s));\n      }\n    }\n  } else {\n    var opt = deo[lvl - 1];\n    var n = opt >>> 13, c = opt & 8191;\n    var msk_1 = (1 << plvl) - 1;\n    var prev = new u16(32768), head = new u16(msk_1 + 1);\n    var bs1_1 = Math.ceil(plvl / 3), bs2_1 = 2 * bs1_1;\n    var hsh = function(i2) {\n      return (dat[i2] ^ dat[i2 + 1] << bs1_1 ^ dat[i2 + 2] << bs2_1) & msk_1;\n    };\n    var syms = new u32(25e3);\n    var lf = new u16(288), df = new u16(32);\n    var lc_1 = 0, eb = 0, i = 0, li = 0, wi = 0, bs = 0;\n    for (; i < s; ++i) {\n      var hv = hsh(i);\n      var imod = i & 32767;\n      var pimod = head[hv];\n      prev[imod] = pimod;\n      head[hv] = imod;\n      if (wi <= i) {\n        var rem = s - i;\n        if ((lc_1 > 7e3 || li > 24576) && rem > 423) {\n          pos = wblk(dat, w, 0, syms, lf, df, eb, li, bs, i - bs, pos);\n          li = lc_1 = eb = 0, bs = i;\n          for (var j = 0; j < 286; ++j)\n            lf[j] = 0;\n          for (var j = 0; j < 30; ++j)\n            df[j] = 0;\n        }\n        var l = 2, d = 0, ch_1 = c, dif = imod - pimod & 32767;\n        if (rem > 2 && hv == hsh(i - dif)) {\n          var maxn = Math.min(n, rem) - 1;\n          var maxd = Math.min(32767, i);\n          var ml = Math.min(258, rem);\n          while (dif <= maxd && --ch_1 && imod != pimod) {\n            if (dat[i + l] == dat[i + l - dif]) {\n              var nl = 0;\n              for (; nl < ml && dat[i + nl] == dat[i + nl - dif]; ++nl)\n                ;\n              if (nl > l) {\n                l = nl, d = dif;\n                if (nl > maxn)\n                  break;\n                var mmd = Math.min(dif, nl - 2);\n                var md = 0;\n                for (var j = 0; j < mmd; ++j) {\n                  var ti = i - dif + j + 32768 & 32767;\n                  var pti = prev[ti];\n                  var cd = ti - pti + 32768 & 32767;\n                  if (cd > md)\n                    md = cd, pimod = ti;\n                }\n              }\n            }\n            imod = pimod, pimod = prev[imod];\n            dif += imod - pimod + 32768 & 32767;\n          }\n        }\n        if (d) {\n          syms[li++] = 268435456 | revfl[l] << 18 | revfd[d];\n          var lin = revfl[l] & 31, din = revfd[d] & 31;\n          eb += fleb[lin] + fdeb[din];\n          ++lf[257 + lin];\n          ++df[din];\n          wi = i + l;\n          ++lc_1;\n        } else {\n          syms[li++] = dat[i];\n          ++lf[dat[i]];\n        }\n      }\n    }\n    pos = wblk(dat, w, lst, syms, lf, df, eb, li, bs, i - bs, pos);\n  }\n  return slc(o, 0, pre + shft(pos) + post);\n};\nvar adler = function() {\n  var a = 1, b = 0;\n  return {\n    p: function(d) {\n      var n = a, m = b;\n      var l = d.length;\n      for (var i = 0; i != l; ) {\n        var e = Math.min(i + 5552, l);\n        for (; i < e; ++i)\n          n += d[i], m += n;\n        n %= 65521, m %= 65521;\n      }\n      a = n, b = m;\n    },\n    d: function() {\n      return (a >>> 8 << 16 | (b & 255) << 8 | b >>> 8) + ((a & 255) << 23) * 2;\n    }\n  };\n};\nvar dopt = function(dat, opt, pre, post, st) {\n  return dflt(dat, opt.level == null ? 6 : opt.level, opt.mem == null ? Math.ceil(Math.max(8, Math.min(13, Math.log(dat.length))) * 1.5) : 12 + opt.mem, pre, post, !st);\n};\nvar wbytes = function(d, b, v) {\n  for (; v; ++b)\n    d[b] = v, v >>>= 8;\n};\nvar zlh = function(c, o) {\n  var lv = o.level, fl2 = lv == 0 ? 0 : lv < 6 ? 1 : lv == 9 ? 3 : 2;\n  c[0] = 120, c[1] = fl2 << 6 | (fl2 ? 32 - 2 * fl2 : 1);\n};\nvar zlv = function(d) {\n  if ((d[0] & 15) != 8 || d[0] >>> 4 > 7 || (d[0] << 8 | d[1]) % 31)\n    throw \"invalid zlib data\";\n  if (d[1] & 32)\n    throw \"invalid zlib data: preset dictionaries not supported\";\n};\nfunction zlibSync(data, opts) {\n  if (opts === void 0) {\n    opts = {};\n  }\n  var a = adler();\n  a.p(data);\n  var d = dopt(data, opts, 2, 4);\n  return zlh(d, opts), wbytes(d, d.length - 4, a.d()), d;\n}\nfunction unzlibSync(data, out) {\n  return inflt((zlv(data), data.subarray(2, -4)), out);\n}\nfunction strToU8(str, latin1) {\n  var l = str.length;\n  if (!latin1 && typeof TextEncoder != \"undefined\")\n    return new TextEncoder().encode(str);\n  var ar = new u8(str.length + (str.length >>> 1));\n  var ai = 0;\n  var w = function(v) {\n    ar[ai++] = v;\n  };\n  for (var i = 0; i < l; ++i) {\n    if (ai + 5 > ar.length) {\n      var n = new u8(ai + 8 + (l - i << 1));\n      n.set(ar);\n      ar = n;\n    }\n    var c = str.charCodeAt(i);\n    if (c < 128 || latin1)\n      w(c);\n    else if (c < 2048)\n      w(192 | c >>> 6), w(128 | c & 63);\n    else if (c > 55295 && c < 57344)\n      c = 65536 + (c & 1023 << 10) | str.charCodeAt(++i) & 1023, w(240 | c >>> 18), w(128 | c >>> 12 & 63), w(128 | c >>> 6 & 63), w(128 | c & 63);\n    else\n      w(224 | c >>> 12), w(128 | c >>> 6 & 63), w(128 | c & 63);\n  }\n  return slc(ar, 0, ai);\n}\nfunction strFromU8(dat, latin1) {\n  var r = \"\";\n  if (!latin1 && typeof TextDecoder != \"undefined\")\n    return new TextDecoder().decode(dat);\n  for (var i = 0; i < dat.length; ) {\n    var c = dat[i++];\n    if (c < 128 || latin1)\n      r += String.fromCharCode(c);\n    else if (c < 224)\n      r += String.fromCharCode((c & 31) << 6 | dat[i++] & 63);\n    else if (c < 240)\n      r += String.fromCharCode((c & 15) << 12 | (dat[i++] & 63) << 6 | dat[i++] & 63);\n    else\n      c = ((c & 15) << 18 | (dat[i++] & 63) << 12 | (dat[i++] & 63) << 6 | dat[i++] & 63) - 65536, r += String.fromCharCode(55296 | c >> 10, 56320 | c & 1023);\n  }\n  return r;\n}\nconst MARK = \"v1\";\nexport {\n  MARK as M,\n  strToU8 as a,\n  strFromU8 as s,\n  unzlibSync as u,\n  zlibSync as z\n};\n//# sourceMappingURL=base-BrE4jft0.js.map\n","import { M as MARK, s as strFromU8, z as zlibSync, a as strToU8 } from \"./base-BrE4jft0.js\";\nconst pack = (event) => {\n  const _e = {\n    ...event,\n    v: MARK\n  };\n  return strFromU8(zlibSync(strToU8(JSON.stringify(_e))), true);\n};\nexport {\n  pack\n};\n//# sourceMappingURL=pack.js.map\n","import { getGlobalScope } from '@amplitude/analytics-core';\nimport { pack } from '@amplitude/rrweb-packer';\nimport type { eventWithTime } from '@amplitude/rrweb-types';\nimport { SessionReplayJoinedConfig } from '../config/types';\nimport { SessionReplayEventsManager } from '../typings/session-replay';\n\ninterface TaskQueue {\n  event: eventWithTime;\n  sessionId: string | number;\n}\n\nconst DEFAULT_TIMEOUT = 2000;\nexport class EventCompressor {\n  taskQueue: TaskQueue[] = [];\n  isProcessing = false;\n  eventsManager?: SessionReplayEventsManager<'replay' | 'interaction', string>;\n  config: SessionReplayJoinedConfig;\n  deviceId: string | undefined;\n  canUseIdleCallback: boolean | undefined;\n  timeout: number;\n  worker?: Worker;\n\n  constructor(\n    eventsManager: SessionReplayEventsManager<'replay' | 'interaction', string>,\n    config: SessionReplayJoinedConfig,\n    deviceId: string | undefined,\n    workerScriptInternal?: string, // this is used for unit testing\n  ) {\n    const globalScope = getGlobalScope();\n    this.canUseIdleCallback = globalScope && 'requestIdleCallback' in globalScope;\n    this.eventsManager = eventsManager;\n    this.config = config;\n    this.deviceId = deviceId;\n    this.timeout = config.performanceConfig?.timeout || DEFAULT_TIMEOUT;\n\n    // These two lines will be changed at compile time.\n    const replace: Record<string, string> = {};\n    // This next line is going to be ridiculously hard to cover in unit tests, ignoring.\n    /* istanbul ignore next */\n    const workerScript = replace.COMPRESSION_WEBWORKER_BODY ?? workerScriptInternal;\n    if (this.config.experimental?.useWebWorker && globalScope && globalScope.Worker && workerScript) {\n      config.loggerProvider.log('[Experimental] Enabling web worker for compression');\n\n      const worker = new Worker(URL.createObjectURL(new Blob([workerScript], { type: 'application/javascript' })));\n      worker.onerror = (e) => {\n        config.loggerProvider.error(e);\n      };\n      worker.onmessage = (e) => {\n        const { compressedEvent, sessionId } = e.data as Record<string, string>;\n        this.addCompressedEventToManager(compressedEvent, sessionId);\n      };\n\n      this.worker = worker;\n    }\n  }\n\n  // Schedule processing during idle time\n  public scheduleIdleProcessing(): void {\n    if (!this.isProcessing) {\n      this.isProcessing = true;\n      requestIdleCallback(\n        (idleDeadline) => {\n          this.processQueue(idleDeadline);\n        },\n        { timeout: this.timeout },\n      );\n    }\n  }\n\n  // Add an event to the task queue if idle callback is supported or compress the event directly\n  public enqueueEvent(event: eventWithTime, sessionId: string | number): void {\n    if (this.canUseIdleCallback && this.config.performanceConfig?.enabled) {\n      this.config.loggerProvider.debug('Enqueuing event for processing during idle time.');\n      this.taskQueue.push({ event, sessionId });\n      this.scheduleIdleProcessing();\n    } else {\n      this.config.loggerProvider.debug('Processing event without idle callback.');\n      this.addCompressedEvent(event, sessionId);\n    }\n  }\n\n  // Process the task queue during idle time\n  public processQueue(idleDeadline: IdleDeadline): void {\n    // Process tasks while there's idle time or until the max number of tasks is reached\n    while (this.taskQueue.length > 0 && (idleDeadline.timeRemaining() > 0 || idleDeadline.didTimeout)) {\n      const task = this.taskQueue.shift();\n      if (task) {\n        const { event, sessionId } = task;\n        this.addCompressedEvent(event, sessionId);\n      }\n    }\n\n    // If there are still tasks in the queue, schedule the next idle callback\n    if (this.taskQueue.length > 0) {\n      requestIdleCallback(\n        (idleDeadline) => {\n          this.processQueue(idleDeadline);\n        },\n        { timeout: this.timeout },\n      );\n    } else {\n      this.isProcessing = false;\n    }\n  }\n\n  compressEvent = (event: eventWithTime) => {\n    const packedEvent = pack(event);\n    return JSON.stringify(packedEvent);\n  };\n\n  private addCompressedEventToManager = (compressedEvent: string, sessionId: string | number) => {\n    if (this.eventsManager && this.deviceId) {\n      this.eventsManager.addEvent({\n        event: { type: 'replay', data: compressedEvent },\n        sessionId,\n        deviceId: this.deviceId,\n      });\n    }\n  };\n\n  public addCompressedEvent = (event: eventWithTime, sessionId: string | number) => {\n    if (this.worker) {\n      // This indirectly compresses the event.\n      this.worker.postMessage({ event, sessionId });\n    } else {\n      const compressedEvent = this.compressEvent(event);\n      this.addCompressedEventToManager(compressedEvent, sessionId);\n    }\n  };\n\n  public terminate = () => {\n    this.worker?.terminate();\n  };\n}\n","export const UNEXPECTED_ERROR_MESSAGE = 'Unexpected error occurred';\nexport const UNEXPECTED_NETWORK_ERROR_MESSAGE = 'Network error occurred, event batch rejected';\nexport const MAX_RETRIES_EXCEEDED_MESSAGE = 'Session replay event batch rejected due to exceeded retry count';\nexport const STORAGE_FAILURE = 'Failed to store session replay events in IndexedDB';\nexport const MISSING_DEVICE_ID_MESSAGE = 'Session replay event batch not sent due to missing device ID';\nexport const MISSING_API_KEY_MESSAGE = 'Session replay event batch not sent due to missing api key';\n","// Autogenerated by `yarn version-file`. DO NOT EDIT\nexport const VERSION = '1.28.9';\n","import { BaseTransport, ILogger, Status } from '@amplitude/analytics-core';\nimport { getCurrentUrl, getServerUrl } from './helpers';\nimport {\n  MAX_RETRIES_EXCEEDED_MESSAGE,\n  MISSING_API_KEY_MESSAGE,\n  MISSING_DEVICE_ID_MESSAGE,\n  UNEXPECTED_ERROR_MESSAGE,\n  UNEXPECTED_NETWORK_ERROR_MESSAGE,\n} from './messages';\nimport {\n  SessionReplayTrackDestination as AmplitudeSessionReplayTrackDestination,\n  SessionReplayDestination,\n  SessionReplayDestinationContext,\n} from './typings/session-replay';\nimport { VERSION } from './version';\nimport { MAX_URL_LENGTH, KB_SIZE } from './constants';\n\nexport type PayloadBatcher = ({ version, events }: { version: number; events: string[] }) => {\n  version: number;\n  events: unknown[];\n};\n\nexport class SessionReplayTrackDestination implements AmplitudeSessionReplayTrackDestination {\n  loggerProvider: ILogger;\n  storageKey = '';\n  trackServerUrl?: string;\n  retryTimeout = 1000;\n  private scheduled: ReturnType<typeof setTimeout> | null = null;\n  payloadBatcher: PayloadBatcher;\n  queue: SessionReplayDestinationContext[] = [];\n\n  constructor({\n    trackServerUrl,\n    loggerProvider,\n    payloadBatcher,\n  }: {\n    trackServerUrl?: string;\n    loggerProvider: ILogger;\n    payloadBatcher?: PayloadBatcher;\n  }) {\n    this.loggerProvider = loggerProvider;\n    this.payloadBatcher = payloadBatcher ? payloadBatcher : (payload) => payload;\n    this.trackServerUrl = trackServerUrl;\n  }\n\n  sendEventsList(destinationData: SessionReplayDestination) {\n    this.addToQueue({\n      ...destinationData,\n      attempts: 0,\n      timeout: 0,\n    });\n  }\n\n  addToQueue(...list: SessionReplayDestinationContext[]) {\n    const tryable = list.filter((context) => {\n      if (context.attempts < (context.flushMaxRetries || 0)) {\n        context.attempts += 1;\n        return true;\n      }\n      this.completeRequest({\n        context,\n        err: MAX_RETRIES_EXCEEDED_MESSAGE,\n      });\n      return false;\n    });\n    tryable.forEach((context) => {\n      this.queue = this.queue.concat(context);\n      if (context.timeout === 0) {\n        this.schedule(0);\n        return;\n      }\n\n      setTimeout(() => {\n        context.timeout = 0;\n        this.schedule(0);\n      }, context.timeout);\n    });\n  }\n\n  schedule(timeout: number) {\n    if (this.scheduled) return;\n    this.scheduled = setTimeout(() => {\n      void this.flush(true).then(() => {\n        if (this.queue.length > 0) {\n          this.schedule(timeout);\n        }\n      });\n    }, timeout);\n  }\n\n  async flush(useRetry = false) {\n    const list: SessionReplayDestinationContext[] = [];\n    const later: SessionReplayDestinationContext[] = [];\n    this.queue.forEach((context) => (context.timeout === 0 ? list.push(context) : later.push(context)));\n    this.queue = later;\n\n    if (this.scheduled) {\n      clearTimeout(this.scheduled);\n      this.scheduled = null;\n    }\n\n    await Promise.all(list.map((context) => this.send(context, useRetry)));\n  }\n\n  async send(context: SessionReplayDestinationContext, useRetry = true) {\n    const apiKey = context.apiKey;\n    if (!apiKey) {\n      return this.completeRequest({ context, err: MISSING_API_KEY_MESSAGE });\n    }\n    const deviceId = context.deviceId;\n    if (!deviceId) {\n      return this.completeRequest({ context, err: MISSING_DEVICE_ID_MESSAGE });\n    }\n    const url = getCurrentUrl();\n    const version = VERSION;\n    const sampleRate = context.sampleRate;\n    const urlParams = new URLSearchParams({\n      device_id: deviceId,\n      session_id: `${context.sessionId}`,\n      type: `${context.type}`,\n    });\n    const sessionReplayLibrary = `${context.version?.type || 'standalone'}/${context.version?.version || version}`;\n    const payload = this.payloadBatcher({\n      version: 1,\n      events: context.events,\n    });\n\n    if (payload.events.length === 0) {\n      this.completeRequest({ context });\n      return;\n    }\n\n    try {\n      const options: RequestInit = {\n        headers: {\n          'Content-Type': 'application/json',\n          Accept: '*/*',\n          Authorization: `Bearer ${apiKey}`,\n          'X-Client-Version': version,\n          'X-Client-Library': sessionReplayLibrary,\n          'X-Client-Url': url.substring(0, MAX_URL_LENGTH), // limit url length to 1000 characters to avoid ELB 400 error\n          'X-Client-Sample-Rate': `${sampleRate}`,\n        },\n        body: JSON.stringify(payload),\n        method: 'POST',\n      };\n\n      const serverUrl = `${getServerUrl(context.serverZone, this.trackServerUrl)}?${urlParams.toString()}`;\n      const res = await fetch(serverUrl, options);\n      if (res === null) {\n        this.completeRequest({ context, err: UNEXPECTED_ERROR_MESSAGE });\n        return;\n      }\n      if (!useRetry) {\n        let responseBody = '';\n        try {\n          responseBody = JSON.stringify(res.body, null, 2);\n        } catch {\n          // to avoid crash, but don't care about the error, add comment to avoid empty block lint error\n        }\n        this.completeRequest({ context, success: `${res.status}: ${responseBody}` });\n      } else {\n        this.handleReponse(res.status, context);\n      }\n    } catch (e) {\n      this.completeRequest({ context, err: e as string });\n    }\n  }\n\n  handleReponse(status: number, context: SessionReplayDestinationContext) {\n    const parsedStatus = new BaseTransport().buildStatus(status);\n    switch (parsedStatus) {\n      case Status.Success:\n        this.handleSuccessResponse(context);\n        break;\n      case Status.Failed:\n        this.handleOtherResponse(context);\n        break;\n      default:\n        this.completeRequest({ context, err: UNEXPECTED_NETWORK_ERROR_MESSAGE });\n    }\n  }\n\n  handleSuccessResponse(context: SessionReplayDestinationContext) {\n    const sizeOfEventsList = Math.round(new Blob(context.events).size / KB_SIZE);\n    this.completeRequest({\n      context,\n      success: `Session replay event batch tracked successfully for session id ${context.sessionId}, size of events: ${sizeOfEventsList} KB`,\n    });\n  }\n\n  handleOtherResponse(context: SessionReplayDestinationContext) {\n    this.addToQueue({\n      ...context,\n      timeout: context.attempts * this.retryTimeout,\n    });\n  }\n\n  completeRequest({\n    context,\n    err,\n    success,\n  }: {\n    context: SessionReplayDestinationContext;\n    err?: string;\n    success?: string;\n  }) {\n    void context.onComplete();\n    if (err) {\n      this.loggerProvider.warn(err);\n    } else if (success) {\n      this.loggerProvider.log(success);\n    }\n  }\n}\n","import { MAX_EVENT_LIST_SIZE, MAX_INTERVAL, MIN_INTERVAL } from '../constants';\nimport { Events, EventsStore, SendingSequencesReturn } from '../typings/session-replay';\nimport { ILogger } from '@amplitude/analytics-core';\n\nexport type InstanceArgs = {\n  loggerProvider: ILogger;\n  minInterval?: number;\n  maxInterval?: number;\n  maxPersistedEventsSize?: number;\n};\n\nexport abstract class BaseEventsStore<KeyType> implements EventsStore<KeyType> {\n  protected readonly loggerProvider: ILogger;\n  private minInterval = MIN_INTERVAL;\n  private maxInterval = MAX_INTERVAL;\n  private maxPersistedEventsSize = MAX_EVENT_LIST_SIZE;\n  private interval = this.minInterval;\n  private _timeAtLastSplit = Date.now(); // Initialize this so we have a point of comparison when events are recorded\n\n  public get timeAtLastSplit() {\n    return this._timeAtLastSplit;\n  }\n\n  constructor(args: InstanceArgs) {\n    this.loggerProvider = args.loggerProvider;\n    this.minInterval = args.minInterval ?? this.minInterval;\n    this.maxInterval = args.maxInterval ?? this.maxInterval;\n    this.maxPersistedEventsSize = args.maxPersistedEventsSize ?? this.maxPersistedEventsSize;\n  }\n\n  abstract addEventToCurrentSequence(\n    sessionId: string | number,\n    event: string,\n  ): Promise<SendingSequencesReturn<KeyType> | undefined>;\n  abstract getSequencesToSend(): Promise<SendingSequencesReturn<KeyType>[] | undefined>;\n  abstract storeCurrentSequence(sessionId: number): Promise<SendingSequencesReturn<KeyType> | undefined>;\n  abstract storeSendingEvents(sessionId: string | number, events: Events): Promise<KeyType | undefined>;\n  abstract cleanUpSessionEventsStore(sessionId: number, sequenceId: KeyType): Promise<void>;\n\n  /**\n   * Calculates the character length of a string as size approximation\n   * Note: String length closely approximates byte size for most content\n   */\n  private getStringSize(str: string): number {\n    return str.length;\n  }\n\n  /**\n   * Calculates the total character length of events array\n   * Accounts for JSON serialization overhead when sent to backend\n   */\n  private getEventsArraySize(events: Events): number {\n    let totalSize = 0;\n    for (const event of events) {\n      totalSize += this.getStringSize(event);\n    }\n\n    // Additional overhead from using length instead of byte size\n    // - Array brackets: [] = 2 characters\n    // - Commas between events: events.length - 1\n    // - Double quotes around each event: events.length * 2\n    const overhead = 2 + Math.max(0, events.length - 1) + events.length * 2;\n\n    return totalSize + overhead;\n  }\n\n  /**\n   * Determines whether to send the events list to the backend and start a new\n   * empty events list, based on the size of the list as well as the last time sent\n   * @param nextEventString\n   * @returns boolean\n   */\n  shouldSplitEventsList = (events: Events, nextEventString: string): boolean => {\n    const sizeOfNextEvent = this.getStringSize(nextEventString);\n    const sizeOfEventsList = this.getEventsArraySize(events);\n\n    // Check size constraint first (most likely to trigger)\n    if (sizeOfEventsList + sizeOfNextEvent >= this.maxPersistedEventsSize) {\n      return true;\n    }\n    if (Date.now() - this.timeAtLastSplit > this.interval && events.length) {\n      this.interval = Math.min(this.maxInterval, this.interval + this.minInterval);\n      this._timeAtLastSplit = Date.now();\n      return true;\n    }\n    return false;\n  };\n}\n","import { SessionReplayRemoteConfig } from '../config/types';\nimport { Events } from '../typings/session-replay';\n\nexport enum RecordingStatus {\n  RECORDING = 'recording',\n  SENT = 'sent',\n}\n\nexport interface IDBStoreSequence {\n  events: Events;\n  status: RecordingStatus;\n}\n\ninterface IDBRemoteConfig {\n  config: SessionReplayRemoteConfig;\n  lastFetchedSessionId: number | undefined;\n}\nexport interface IDBStoreSession {\n  currentSequenceId: number;\n  sessionSequences: {\n    [sequenceId: number]: IDBStoreSequence;\n  };\n}\n\nexport interface IDBStore {\n  remoteConfig?: IDBRemoteConfig;\n  [sessionId: number]: IDBStoreSession;\n}\n","import { STORAGE_PREFIX, getGlobalScope } from '@amplitude/analytics-core';\nimport { DBSchema, IDBPDatabase, openDB } from 'idb';\nimport { STORAGE_FAILURE } from '../messages';\nimport { EventType, Events, SendingSequencesReturn } from '../typings/session-replay';\nimport { BaseEventsStore, InstanceArgs as BaseInstanceArgs } from './base-events-store';\nimport { IDBStore, IDBStoreSession, RecordingStatus } from './legacy-idb-types';\n\nexport const currentSequenceKey = 'sessionCurrentSequence';\nexport const sequencesToSendKey = 'sequencesToSend';\nexport const remoteConfigKey = 'remoteConfig';\n\nexport interface SessionReplayDB extends DBSchema {\n  sessionCurrentSequence: {\n    key: number;\n    value: Omit<SendingSequencesReturn<number>, 'sequenceId'>;\n  };\n  sequencesToSend: {\n    key: number;\n    value: Omit<SendingSequencesReturn<number>, 'sequenceId'>;\n    indexes: { sessionId: string | number };\n  };\n}\n\nexport const keyValDatabaseExists = function (): Promise<IDBDatabase | void> {\n  const globalScope = getGlobalScope();\n  return new Promise((resolve, reject) => {\n    if (!globalScope) {\n      return reject(new Error('Global scope not found'));\n    }\n\n    if (!globalScope.indexedDB) {\n      return reject(new Error('Session Replay: cannot find indexedDB'));\n    }\n\n    try {\n      const request = globalScope.indexedDB.open('keyval-store');\n      request.onupgradeneeded = function () {\n        if (request.result.version === 1) {\n          request.result.close();\n          request.transaction && request.transaction.abort();\n          globalScope.indexedDB.deleteDatabase('keyval-store');\n          resolve();\n        }\n      };\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n      request.onerror = function () {\n        reject(request.error);\n      };\n    } catch (e) {\n      reject(e);\n    }\n  });\n};\n\nconst batchPromiseAll = async (promiseBatch: Promise<any>[]) => {\n  while (promiseBatch.length > 0) {\n    const chunkSize = 10;\n    const batch = promiseBatch.splice(0, chunkSize);\n    await Promise.all(batch);\n  }\n};\n\nexport const defineObjectStores = (db: IDBPDatabase<SessionReplayDB>) => {\n  let sequencesStore;\n  let currentSequenceStore;\n  if (!db.objectStoreNames.contains(currentSequenceKey)) {\n    currentSequenceStore = db.createObjectStore(currentSequenceKey, {\n      keyPath: 'sessionId',\n    });\n  }\n  if (!db.objectStoreNames.contains(sequencesToSendKey)) {\n    sequencesStore = db.createObjectStore(sequencesToSendKey, {\n      keyPath: 'sequenceId',\n      autoIncrement: true,\n    });\n    sequencesStore.createIndex('sessionId', 'sessionId');\n  }\n  return {\n    sequencesStore,\n    currentSequenceStore,\n  };\n};\n\nexport const createStore = async (dbName: string) => {\n  return await openDB<SessionReplayDB>(dbName, 1, {\n    upgrade: defineObjectStores,\n  });\n};\n\ntype InstanceArgs = {\n  apiKey: string;\n  db: IDBPDatabase<SessionReplayDB>;\n} & BaseInstanceArgs;\n\nexport class SessionReplayEventsIDBStore extends BaseEventsStore<number> {\n  private readonly apiKey: string;\n  private readonly db: IDBPDatabase<SessionReplayDB>;\n\n  constructor(args: InstanceArgs) {\n    super(args);\n    this.apiKey = args.apiKey;\n    this.db = args.db;\n  }\n\n  static async new(\n    type: EventType,\n    args: Omit<InstanceArgs, 'db'>,\n    sessionId?: string | number,\n  ): Promise<SessionReplayEventsIDBStore | undefined> {\n    try {\n      const dbSuffix = type === 'replay' ? '' : `_${type}`;\n      const dbName = `${args.apiKey.substring(0, 10)}_amp_session_replay_events${dbSuffix}`;\n      const db = await createStore(dbName);\n      const eventsIDBStore = new SessionReplayEventsIDBStore({\n        ...args,\n        db,\n      });\n      await eventsIDBStore.transitionFromKeyValStore(sessionId);\n      return eventsIDBStore;\n    } catch (e) {\n      args.loggerProvider.warn(`${STORAGE_FAILURE}: ${e as string}`);\n    }\n    return;\n  }\n\n  async getCurrentSequenceEvents(sessionId?: number) {\n    if (sessionId) {\n      const events = await this.db.get('sessionCurrentSequence', sessionId);\n      if (!events) {\n        return undefined;\n      }\n      return [events];\n    }\n\n    const allEvents = [];\n    for (const events of await this.db.getAll('sessionCurrentSequence')) {\n      allEvents.push(events);\n    }\n\n    return allEvents;\n  }\n\n  getSequencesToSend = async (): Promise<SendingSequencesReturn<number>[] | undefined> => {\n    try {\n      const sequences: SendingSequencesReturn<number>[] = [];\n      let cursor = await this.db.transaction('sequencesToSend').store.openCursor();\n      while (cursor) {\n        const { sessionId, events } = cursor.value;\n        sequences.push({\n          events,\n          sequenceId: cursor.key,\n          sessionId,\n        });\n        cursor = await cursor.continue();\n      }\n\n      return sequences;\n    } catch (e) {\n      this.loggerProvider.warn(`${STORAGE_FAILURE}: ${e as string}`);\n    }\n    return undefined;\n  };\n\n  storeCurrentSequence = async (sessionId: number) => {\n    try {\n      const currentSequenceData = await this.db.get<'sessionCurrentSequence'>(currentSequenceKey, sessionId);\n      if (!currentSequenceData) {\n        return undefined;\n      }\n\n      const sequenceId = await this.db.put<'sequencesToSend'>(sequencesToSendKey, {\n        sessionId: sessionId,\n        events: currentSequenceData.events,\n      });\n\n      await this.db.put<'sessionCurrentSequence'>(currentSequenceKey, {\n        sessionId,\n        events: [],\n      });\n\n      return {\n        ...currentSequenceData,\n        sessionId,\n        sequenceId,\n      };\n    } catch (e) {\n      this.loggerProvider.warn(`${STORAGE_FAILURE}: ${e as string}`);\n    }\n    return undefined;\n  };\n\n  addEventToCurrentSequence = async (sessionId: number, event: string) => {\n    try {\n      const tx = this.db.transaction<'sessionCurrentSequence', 'readwrite'>(currentSequenceKey, 'readwrite');\n      const sequenceEvents = await tx.store.get(sessionId);\n      if (!sequenceEvents) {\n        await tx.store.put({ sessionId, events: [event] });\n        return;\n      }\n      let eventsToSend;\n      if (this.shouldSplitEventsList(sequenceEvents.events, event)) {\n        eventsToSend = sequenceEvents.events;\n        // set store to empty array\n        await tx.store.put({ sessionId, events: [event] });\n      } else {\n        // add event to array\n        const updatedEvents = sequenceEvents.events.concat(event);\n        await tx.store.put({ sessionId, events: updatedEvents });\n      }\n\n      await tx.done;\n      if (!eventsToSend) {\n        return undefined;\n      }\n\n      const sequenceId = await this.storeSendingEvents(sessionId, eventsToSend);\n\n      if (!sequenceId) {\n        return undefined;\n      }\n\n      return {\n        events: eventsToSend,\n        sessionId,\n        sequenceId,\n      };\n    } catch (e) {\n      this.loggerProvider.warn(`${STORAGE_FAILURE}: ${e as string}`);\n    }\n    return undefined;\n  };\n\n  storeSendingEvents = async (sessionId: number, events: Events) => {\n    try {\n      const sequenceId = await this.db.put<'sequencesToSend'>(sequencesToSendKey, {\n        sessionId: sessionId,\n        events: events,\n      });\n      return sequenceId;\n    } catch (e) {\n      this.loggerProvider.warn(`${STORAGE_FAILURE}: ${e as string}`);\n    }\n    return undefined;\n  };\n\n  cleanUpSessionEventsStore = async (_sessionId: number, sequenceId?: number) => {\n    if (!sequenceId) {\n      return;\n    }\n    try {\n      await this.db.delete<'sequencesToSend'>(sequencesToSendKey, sequenceId);\n    } catch (e) {\n      this.loggerProvider.warn(`${STORAGE_FAILURE}: ${e as string}`);\n    }\n  };\n\n  transitionFromKeyValStore = async (sessionId?: string | number) => {\n    try {\n      const keyValDb = await keyValDatabaseExists();\n      if (!keyValDb) {\n        return;\n      }\n\n      const transitionCurrentSessionSequences = async (numericSessionId: number, sessionStore: IDBStoreSession) => {\n        const currentSessionSequences = sessionStore.sessionSequences;\n        const promisesToBatch: Promise<number | SendingSequencesReturn<number> | undefined>[] = [];\n\n        Object.keys(currentSessionSequences).forEach((sequenceId) => {\n          const numericSequenceId = parseInt(sequenceId, 10);\n          const sequence = currentSessionSequences[numericSequenceId];\n          if (numericSequenceId === sessionStore.currentSequenceId) {\n            const eventAddPromises: Promise<SendingSequencesReturn<number> | undefined>[] = sequence.events.map(\n              async (event) => this.addEventToCurrentSequence(numericSessionId, event),\n            );\n            promisesToBatch.push(...eventAddPromises);\n          } else if (sequence.status !== RecordingStatus.SENT) {\n            promisesToBatch.push(this.storeSendingEvents(numericSessionId, sequence.events));\n          }\n        });\n\n        await batchPromiseAll(promisesToBatch);\n      };\n\n      const storageKey = `${STORAGE_PREFIX}_${this.apiKey.substring(0, 10)}`;\n      try {\n        const getAllRequest = keyValDb.transaction('keyval').objectStore('keyval').getAll(storageKey);\n        const transitionPromise = new Promise<void>((resolve) => {\n          getAllRequest.onsuccess = async (e) => {\n            const storedReplaySessionContextList = e && ((e.target as IDBRequest).result as IDBStore[]);\n            const storedReplaySessionContexts = storedReplaySessionContextList && storedReplaySessionContextList[0];\n            if (storedReplaySessionContexts) {\n              const promisesToBatch: Promise<any>[] = [];\n\n              Object.keys(storedReplaySessionContexts).forEach((storedSessionId) => {\n                const numericSessionId = parseInt(storedSessionId, 10);\n                const oldSessionStore = storedReplaySessionContexts[numericSessionId];\n\n                if (sessionId === numericSessionId) {\n                  promisesToBatch.push(transitionCurrentSessionSequences(numericSessionId, oldSessionStore));\n                } else {\n                  const oldSessionSequences = oldSessionStore.sessionSequences;\n                  Object.keys(oldSessionSequences).forEach((sequenceId) => {\n                    const numericSequenceId = parseInt(sequenceId, 10);\n                    if (oldSessionSequences[numericSequenceId].status !== RecordingStatus.SENT) {\n                      promisesToBatch.push(\n                        this.storeSendingEvents(numericSessionId, oldSessionSequences[numericSequenceId].events),\n                      );\n                    }\n                  });\n                }\n              });\n\n              await batchPromiseAll(promisesToBatch);\n            }\n            resolve();\n          };\n        });\n\n        await transitionPromise;\n        const globalScope = getGlobalScope();\n        if (globalScope) {\n          globalScope.indexedDB.deleteDatabase('keyval-store');\n        }\n      } catch (e) {\n        this.loggerProvider.warn(`Failed to transition session replay events from keyval to new store: ${e as string}`);\n      }\n    } catch (e) {\n      this.loggerProvider.warn(\n        `Failed to access keyval store: ${\n          e as string\n        }. For more information, visit: https://www.docs.developers.amplitude.com/session-replay/sdks/standalone/#indexeddb-best-practices`,\n      );\n    }\n  };\n}\n","import { Events, SendingSequencesReturn } from '../typings/session-replay';\nimport { BaseEventsStore } from './base-events-store';\n\nexport class InMemoryEventsStore extends BaseEventsStore<number> {\n  private finalizedSequences: Record<number, { sessionId: string | number; events: string[] }> = {};\n  private sequences: Record<string | number, string[]> = {};\n  private sequenceId = 0;\n\n  private resetCurrentSequence(sessionId: string | number) {\n    this.sequences[sessionId] = [];\n  }\n\n  private addSequence(sessionId: string | number): SendingSequencesReturn<number> {\n    const sequenceId = this.sequenceId++;\n    const events = [...this.sequences[sessionId]];\n    this.finalizedSequences[sequenceId] = { sessionId, events };\n    this.resetCurrentSequence(sessionId);\n    return { sequenceId, events, sessionId };\n  }\n\n  async getSequencesToSend(): Promise<SendingSequencesReturn<number>[] | undefined> {\n    return Object.entries(this.finalizedSequences).map(([sequenceId, { sessionId, events }]) => ({\n      sequenceId: Number(sequenceId),\n      sessionId,\n      events,\n    }));\n  }\n\n  async storeCurrentSequence(sessionId: string | number): Promise<SendingSequencesReturn<number> | undefined> {\n    if (!this.sequences[sessionId]) {\n      return undefined;\n    }\n    return this.addSequence(sessionId);\n  }\n\n  async addEventToCurrentSequence(\n    sessionId: number,\n    event: string,\n  ): Promise<SendingSequencesReturn<number> | undefined> {\n    if (!this.sequences[sessionId]) {\n      this.resetCurrentSequence(sessionId);\n    }\n\n    let sequenceReturn: SendingSequencesReturn<number> | undefined;\n    if (this.shouldSplitEventsList(this.sequences[sessionId], event)) {\n      sequenceReturn = this.addSequence(sessionId);\n    }\n\n    this.sequences[sessionId].push(event);\n\n    return sequenceReturn;\n  }\n\n  async storeSendingEvents(sessionId: number, events: Events): Promise<number | undefined> {\n    this.finalizedSequences[this.sequenceId] = { sessionId, events };\n\n    return this.sequenceId++;\n  }\n\n  async cleanUpSessionEventsStore(_sessionId: number, sequenceId?: number): Promise<void> {\n    if (sequenceId !== undefined) {\n      delete this.finalizedSequences[sequenceId];\n    }\n  }\n}\n","import {\n  SessionReplayEventsManager as AmplitudeSessionReplayEventsManager,\n  EventsStore,\n  EventType,\n  StoreType,\n} from '../typings/session-replay';\n\nimport { SessionReplayJoinedConfig } from '../config/types';\nimport { getStorageSize } from '../helpers';\nimport { PayloadBatcher, SessionReplayTrackDestination } from '../track-destination';\nimport { SessionReplayEventsIDBStore } from './events-idb-store';\nimport { InMemoryEventsStore } from './events-memory-store';\n\nexport const createEventsManager = async <Type extends EventType>({\n  config,\n  sessionId,\n  minInterval,\n  maxInterval,\n  type,\n  payloadBatcher,\n  storeType,\n}: {\n  config: SessionReplayJoinedConfig;\n  type: Type;\n  minInterval?: number;\n  maxInterval?: number;\n  sessionId?: string | number;\n  payloadBatcher?: PayloadBatcher;\n  storeType: StoreType;\n}): Promise<AmplitudeSessionReplayEventsManager<Type, string>> => {\n  const trackDestination = new SessionReplayTrackDestination({\n    ...config,\n    loggerProvider: config.loggerProvider,\n    payloadBatcher,\n  });\n\n  const getMemoryStore = (): EventsStore<number> => {\n    return new InMemoryEventsStore({\n      loggerProvider: config.loggerProvider,\n      maxInterval,\n      minInterval,\n    });\n  };\n\n  const getIdbStoreOrFallback = async (): Promise<EventsStore<number>> => {\n    const store = await SessionReplayEventsIDBStore.new(\n      type,\n      {\n        loggerProvider: config.loggerProvider,\n        minInterval,\n        maxInterval,\n        apiKey: config.apiKey,\n      },\n      sessionId,\n    );\n    config.loggerProvider.log('Failed to initialize idb store, falling back to memory store.');\n    return store ?? getMemoryStore();\n  };\n\n  const store: EventsStore<number> = storeType === 'idb' ? await getIdbStoreOrFallback() : getMemoryStore();\n\n  /**\n   * Immediately sends events to the track destination.\n   */\n  const sendEventsList = ({\n    events,\n    sessionId,\n    deviceId,\n    sequenceId,\n  }: {\n    events: string[];\n    sessionId: string | number;\n    deviceId: string;\n    sequenceId?: number;\n  }) => {\n    if (config.debugMode) {\n      getStorageSize()\n        .then(({ totalStorageSize, percentOfQuota, usageDetails }) => {\n          config.loggerProvider.debug(\n            `Total storage size: ${totalStorageSize} KB, percentage of quota: ${percentOfQuota}%, usage details: ${usageDetails}`,\n          );\n        })\n        .catch(() => {\n          // swallow error\n        });\n    }\n\n    trackDestination.sendEventsList({\n      events: events,\n      sessionId: sessionId,\n      flushMaxRetries: config.flushMaxRetries,\n      apiKey: config.apiKey,\n      deviceId: deviceId,\n      sampleRate: config.sampleRate,\n      serverZone: config.serverZone,\n      version: config.version,\n      type,\n      onComplete: async () => {\n        await store.cleanUpSessionEventsStore(sessionId, sequenceId);\n        return;\n      },\n    });\n  };\n\n  const sendCurrentSequenceEvents = ({ sessionId, deviceId }: { sessionId: number; deviceId: string }) => {\n    store\n      .storeCurrentSequence(sessionId)\n      .then((currentSequence) => {\n        if (currentSequence) {\n          sendEventsList({\n            sequenceId: currentSequence.sequenceId,\n            events: currentSequence.events,\n            sessionId: currentSequence.sessionId,\n            deviceId,\n          });\n        }\n      })\n      .catch((e) => {\n        config.loggerProvider.warn('Failed to get current sequence of session replay events for session:', e);\n      });\n  };\n\n  const sendStoredEvents = async ({ deviceId }: { deviceId: string }) => {\n    const sequencesToSend = await store.getSequencesToSend();\n    sequencesToSend &&\n      sequencesToSend.forEach((sequence) => {\n        sendEventsList({\n          sequenceId: sequence.sequenceId,\n          events: sequence.events,\n          sessionId: sequence.sessionId,\n          deviceId,\n        });\n      });\n  };\n\n  const addEvent = ({\n    event,\n    sessionId,\n    deviceId,\n  }: {\n    event: { type: Type; data: string };\n    sessionId: number;\n    deviceId: string;\n  }) => {\n    store\n      .addEventToCurrentSequence(sessionId, event.data)\n      .then((sequenceToSend) => {\n        return (\n          sequenceToSend &&\n          sendEventsList({\n            sequenceId: sequenceToSend.sequenceId,\n            events: sequenceToSend.events,\n            sessionId: sequenceToSend.sessionId,\n            deviceId,\n          })\n        );\n      })\n      .catch((e) => {\n        config.loggerProvider.warn('Failed to add event to session replay capture:', e);\n      });\n  };\n\n  async function flush(useRetry = false) {\n    return trackDestination.flush(useRetry);\n  }\n\n  return {\n    sendCurrentSequenceEvents,\n    addEvent,\n    sendStoredEvents,\n    flush,\n  };\n};\n","import {\n  SessionReplayEventsManager as AmplitudeSessionReplayEventsManager,\n  EventsManagerWithType,\n} from '../typings/session-replay';\n\n/**\n * \"Registers\" events managers internally. When an event is added this class routes the event to the correct\n * manager. For all send or flush methods this will invoke the event for all registered managers.\n */\nexport class MultiEventManager<EventType, EventDataType>\n  implements AmplitudeSessionReplayEventsManager<EventType, EventDataType>\n{\n  private managers: Map<EventType, AmplitudeSessionReplayEventsManager<EventType, EventDataType>>;\n\n  constructor(...managers: EventsManagerWithType<EventType, EventDataType>[]) {\n    const managersMap = new Map<EventType, AmplitudeSessionReplayEventsManager<EventType, EventDataType>>();\n    managers.forEach((t) => {\n      managersMap.set(t.name, t.manager);\n    });\n    this.managers = managersMap;\n  }\n\n  async sendStoredEvents(opts: { deviceId: string }): Promise<void> {\n    const promises: Promise<void>[] = [];\n    this.managers.forEach((manager) => {\n      promises.push(manager.sendStoredEvents(opts));\n    });\n    await Promise.all(promises);\n  }\n\n  addEvent({\n    sessionId,\n    event,\n    deviceId,\n  }: {\n    sessionId: number;\n    event: { type: EventType; data: EventDataType };\n    deviceId: string;\n  }): void {\n    this.managers.get(event.type)?.addEvent({ sessionId, event, deviceId });\n  }\n\n  sendCurrentSequenceEvents({ sessionId, deviceId }: { sessionId: number; deviceId: string }): void {\n    this.managers.forEach((manager) => {\n      manager.sendCurrentSequenceEvents({ sessionId, deviceId });\n    });\n  }\n\n  async flush(useRetry?: boolean | undefined): Promise<void> {\n    const promises: Promise<void>[] = [];\n    this.managers.forEach((manager) => {\n      promises.push(manager.flush(useRetry));\n    });\n    await Promise.all(promises);\n  }\n}\n","const testableAccessors = {\n  Node: [\"childNodes\", \"parentNode\", \"parentElement\", \"textContent\"],\n  ShadowRoot: [\"host\", \"styleSheets\"],\n  Element: [\"shadowRoot\", \"querySelector\", \"querySelectorAll\"],\n  MutationObserver: []\n};\nconst testableMethods = {\n  Node: [\"contains\", \"getRootNode\"],\n  ShadowRoot: [\"getSelection\"],\n  Element: [],\n  MutationObserver: [\"constructor\"]\n};\nconst untaintedBasePrototype = {};\nfunction angularZoneUnpatchedAlternative(key) {\n  var _a, _b;\n  const angularUnpatchedVersionSymbol = (_b = (_a = globalThis == null ? void 0 : globalThis.Zone) == null ? void 0 : _a.__symbol__) == null ? void 0 : _b.call(_a, key);\n  if (angularUnpatchedVersionSymbol && globalThis[angularUnpatchedVersionSymbol]) {\n    return globalThis[angularUnpatchedVersionSymbol];\n  } else {\n    return void 0;\n  }\n}\nfunction getUntaintedPrototype(key) {\n  if (untaintedBasePrototype[key])\n    return untaintedBasePrototype[key];\n  const candidate = angularZoneUnpatchedAlternative(key) || globalThis[key];\n  const defaultPrototype = candidate.prototype;\n  const accessorNames = key in testableAccessors ? testableAccessors[key] : void 0;\n  const isUntaintedAccessors = Boolean(\n    accessorNames && // @ts-expect-error 2345\n    accessorNames.every(\n      (accessor) => {\n        var _a, _b;\n        return Boolean(\n          (_b = (_a = Object.getOwnPropertyDescriptor(defaultPrototype, accessor)) == null ? void 0 : _a.get) == null ? void 0 : _b.toString().includes(\"[native code]\")\n        );\n      }\n    )\n  );\n  const methodNames = key in testableMethods ? testableMethods[key] : void 0;\n  const isUntaintedMethods = Boolean(\n    methodNames && methodNames.every(\n      // @ts-expect-error 2345\n      (method) => {\n        var _a;\n        return typeof defaultPrototype[method] === \"function\" && ((_a = defaultPrototype[method]) == null ? void 0 : _a.toString().includes(\"[native code]\"));\n      }\n    )\n  );\n  if (isUntaintedAccessors && isUntaintedMethods) {\n    untaintedBasePrototype[key] = candidate.prototype;\n    return candidate.prototype;\n  }\n  try {\n    const iframeEl = document.createElement(\"iframe\");\n    document.body.appendChild(iframeEl);\n    const win = iframeEl.contentWindow;\n    if (!win) return candidate.prototype;\n    const untaintedObject = win[key].prototype;\n    document.body.removeChild(iframeEl);\n    if (!untaintedObject) return defaultPrototype;\n    return untaintedBasePrototype[key] = untaintedObject;\n  } catch {\n    return defaultPrototype;\n  }\n}\nconst untaintedAccessorCache = {};\nfunction getUntaintedAccessor(key, instance, accessor) {\n  var _a;\n  const cacheKey = `${key}.${String(accessor)}`;\n  if (untaintedAccessorCache[cacheKey])\n    return untaintedAccessorCache[cacheKey].call(\n      instance\n    );\n  const untaintedPrototype = getUntaintedPrototype(key);\n  const untaintedAccessor = (_a = Object.getOwnPropertyDescriptor(\n    untaintedPrototype,\n    accessor\n  )) == null ? void 0 : _a.get;\n  if (!untaintedAccessor) return instance[accessor];\n  untaintedAccessorCache[cacheKey] = untaintedAccessor;\n  return untaintedAccessor.call(instance);\n}\nconst untaintedMethodCache = {};\nfunction getUntaintedMethod(key, instance, method) {\n  const cacheKey = `${key}.${String(method)}`;\n  if (untaintedMethodCache[cacheKey])\n    return untaintedMethodCache[cacheKey].bind(\n      instance\n    );\n  const untaintedPrototype = getUntaintedPrototype(key);\n  const untaintedMethod = untaintedPrototype[method];\n  if (typeof untaintedMethod !== \"function\") return instance[method];\n  untaintedMethodCache[cacheKey] = untaintedMethod;\n  return untaintedMethod.bind(instance);\n}\nfunction childNodes(n) {\n  return getUntaintedAccessor(\"Node\", n, \"childNodes\");\n}\nfunction parentNode(n) {\n  return getUntaintedAccessor(\"Node\", n, \"parentNode\");\n}\nfunction parentElement(n) {\n  return getUntaintedAccessor(\"Node\", n, \"parentElement\");\n}\nfunction textContent(n) {\n  return getUntaintedAccessor(\"Node\", n, \"textContent\");\n}\nfunction contains(n, other) {\n  return getUntaintedMethod(\"Node\", n, \"contains\")(other);\n}\nfunction getRootNode(n) {\n  return getUntaintedMethod(\"Node\", n, \"getRootNode\")();\n}\nfunction host(n) {\n  if (!n || !(\"host\" in n)) return null;\n  return getUntaintedAccessor(\"ShadowRoot\", n, \"host\");\n}\nfunction styleSheets(n) {\n  return n.styleSheets;\n}\nfunction shadowRoot(n) {\n  if (!n || !(\"shadowRoot\" in n)) return null;\n  return getUntaintedAccessor(\"Element\", n, \"shadowRoot\");\n}\nfunction querySelector(n, selectors) {\n  return getUntaintedAccessor(\"Element\", n, \"querySelector\")(selectors);\n}\nfunction querySelectorAll(n, selectors) {\n  return getUntaintedAccessor(\"Element\", n, \"querySelectorAll\")(selectors);\n}\nfunction mutationObserverCtor() {\n  return getUntaintedPrototype(\"MutationObserver\").constructor;\n}\nconst index = {\n  childNodes,\n  parentNode,\n  parentElement,\n  textContent,\n  contains,\n  getRootNode,\n  host,\n  styleSheets,\n  shadowRoot,\n  querySelector,\n  querySelectorAll,\n  mutationObserver: mutationObserverCtor\n};\nexport {\n  childNodes,\n  contains,\n  index as default,\n  getRootNode,\n  getUntaintedAccessor,\n  getUntaintedMethod,\n  getUntaintedPrototype,\n  host,\n  mutationObserverCtor,\n  parentElement,\n  parentNode,\n  querySelector,\n  querySelectorAll,\n  shadowRoot,\n  styleSheets,\n  textContent\n};\n//# sourceMappingURL=rrweb-utils.js.map\n","import { getGlobalScope } from '@amplitude/analytics-core';\nimport dom from '@amplitude/rrweb-utils';\nimport type { eventWithTime, scrollCallback } from '@amplitude/rrweb-types';\n\n// These functions are not exposed in rrweb package, so we will define it here to use\n// Ignoring this function since this is copied from rrweb\n/* istanbul ignore next */\nexport function getWindowScroll(win: Window) {\n  const doc = win.document;\n  return {\n    left: doc.scrollingElement\n      ? doc.scrollingElement.scrollLeft\n      : win.pageXOffset !== undefined\n      ? win.pageXOffset\n      : doc.documentElement.scrollLeft ||\n        (doc?.body && dom.parentElement(doc.body)?.scrollLeft) ||\n        doc?.body?.scrollLeft ||\n        0,\n    top: doc.scrollingElement\n      ? doc.scrollingElement.scrollTop\n      : win.pageYOffset !== undefined\n      ? win.pageYOffset\n      : doc?.documentElement.scrollTop ||\n        (doc?.body && dom.parentElement(doc.body)?.scrollTop) ||\n        doc?.body?.scrollTop ||\n        0,\n  };\n}\n\nexport function getWindowHeight(): number {\n  const globalScope = getGlobalScope();\n  return (\n    globalScope?.innerHeight ||\n    (document.documentElement && document.documentElement.clientHeight) ||\n    (document.body && document.body.clientHeight) ||\n    0\n  );\n}\n\nexport function getWindowWidth(): number {\n  const globalScope = getGlobalScope();\n  return (\n    globalScope?.innerWidth ||\n    (document.documentElement && document.documentElement.clientWidth) ||\n    (document.body && document.body.clientWidth) ||\n    0\n  );\n}\n\nexport type Mirror = {\n  getNode: (id: number) => Node | null;\n};\n\nexport type RecordFunction = {\n  (options: {\n    emit: (event: eventWithTime) => void;\n    inlineStylesheet?: boolean;\n    hooks?: {\n      mouseInteraction?: any;\n      scroll?: scrollCallback;\n    };\n    maskAllInputs?: boolean;\n    maskTextClass?: string;\n    blockClass?: string;\n    blockSelector?: string;\n    maskInputFn?: (text: string, element: HTMLElement | null) => string;\n    maskTextFn?: (text: string, element: HTMLElement | null) => string;\n    maskTextSelector?: string;\n    recordCanvas?: boolean;\n    slimDOMOptions?: {\n      script?: boolean;\n      comment?: boolean;\n    };\n    errorHandler?: (error: unknown) => boolean;\n    plugins?: any[];\n    applyBackgroundColorToBlockedElements?: boolean;\n  }): (() => void) | undefined;\n  addCustomEvent: (eventName: string, eventData: any) => void;\n  mirror: Mirror;\n};\n","/* istanbul ignore file */\n\n// DO NOT EDIT (unless you know what you're doing)\n// Taken directly from git@github.com:antonmedv/finder.git@77d33158440dfffee4a300d2975b43a5283004ab\n\n/* eslint-disable @typescript-eslint/no-unnecessary-type-assertion */\n/* eslint-disable prefer-const */\n\n// License: MIT\n// Author: Anton Medvedev <anton@medv.io>\n// Source: https://github.com/antonmedv/finder\n\ntype Knot = {\n  name: string;\n  penalty: number;\n  level?: number;\n};\n\ntype Path = Knot[];\n\nexport type Options = {\n  root: Element;\n  idName: (name: string) => boolean;\n  className: (name: string) => boolean;\n  tagName: (name: string) => boolean;\n  attr: (name: string, value: string) => boolean;\n  seedMinLength: number;\n  optimizedMinLength: number;\n  threshold: number;\n  maxNumberOfTries: number;\n  timeoutMs: number | undefined;\n};\n\nlet config: Options;\nlet rootDocument: Document | Element;\nlet start: Date;\n\nexport function finder(input: Element, options?: Partial<Options>): string {\n  start = new Date();\n  if (input.nodeType !== Node.ELEMENT_NODE) {\n    throw new Error(`Can't generate CSS selector for non-element node type.`);\n  }\n  if ('html' === input.tagName.toLowerCase()) {\n    return 'html';\n  }\n  const defaults: Options = {\n    root: document.body,\n    idName: (_name: string) => true,\n    className: (_name: string) => true,\n    tagName: (_name: string) => true,\n    attr: (_name: string, _value: string) => false,\n    seedMinLength: 1,\n    optimizedMinLength: 2,\n    threshold: 1000,\n    maxNumberOfTries: 10000,\n    timeoutMs: undefined,\n  };\n\n  config = { ...defaults, ...options };\n  rootDocument = findRootDocument(config.root, defaults);\n\n  let path = bottomUpSearch(input, 'all', () =>\n    bottomUpSearch(input, 'two', () => bottomUpSearch(input, 'one', () => bottomUpSearch(input, 'none'))),\n  );\n\n  if (path) {\n    const optimized = sort(optimize(path, input));\n    if (optimized.length > 0) {\n      path = optimized[0];\n    }\n    return selector(path);\n  } else {\n    throw new Error(`Selector was not found.`);\n  }\n}\n\nfunction findRootDocument(rootNode: Element | Document, defaults: Options) {\n  if (rootNode.nodeType === Node.DOCUMENT_NODE) {\n    return rootNode;\n  }\n  if (rootNode === defaults.root) {\n    return rootNode.ownerDocument as Document;\n  }\n  return rootNode;\n}\n\nfunction bottomUpSearch(\n  input: Element,\n  limit: 'all' | 'two' | 'one' | 'none',\n  fallback?: () => Path | null,\n): Path | null {\n  let path: Path | null = null;\n  let stack: Knot[][] = [];\n  let current: Element | null = input;\n  let i = 0;\n  while (current) {\n    const elapsedTime = new Date().getTime() - start.getTime();\n    if (config.timeoutMs !== undefined && elapsedTime > config.timeoutMs) {\n      throw new Error(`Timeout: Can't find a unique selector after ${elapsedTime}ms`);\n    }\n    let level: Knot[] = maybe(id(current)) ||\n      maybe(...attr(current)) ||\n      maybe(...classNames(current)) ||\n      maybe(tagName(current)) || [any()];\n    const nth = index(current);\n    if (limit == 'all') {\n      if (nth) {\n        level = level.concat(level.filter(dispensableNth).map((node) => nthChild(node, nth)));\n      }\n    } else if (limit == 'two') {\n      level = level.slice(0, 1);\n      if (nth) {\n        level = level.concat(level.filter(dispensableNth).map((node) => nthChild(node, nth)));\n      }\n    } else if (limit == 'one') {\n      const [node] = (level = level.slice(0, 1));\n      if (nth && dispensableNth(node)) {\n        level = [nthChild(node, nth)];\n      }\n    } else if (limit == 'none') {\n      level = [any()];\n      if (nth) {\n        level = [nthChild(level[0], nth)];\n      }\n    }\n    for (let node of level) {\n      node.level = i;\n    }\n    stack.push(level);\n    if (stack.length >= config.seedMinLength) {\n      path = findUniquePath(stack, fallback);\n      if (path) {\n        break;\n      }\n    }\n    current = current.parentElement;\n    i++;\n  }\n  if (!path) {\n    path = findUniquePath(stack, fallback);\n  }\n  if (!path && fallback) {\n    return fallback();\n  }\n  return path;\n}\n\nfunction findUniquePath(stack: Knot[][], fallback?: () => Path | null): Path | null {\n  const paths = sort(combinations(stack));\n  if (paths.length > config.threshold) {\n    return fallback ? fallback() : null;\n  }\n  for (let candidate of paths) {\n    if (unique(candidate)) {\n      return candidate;\n    }\n  }\n  return null;\n}\n\nfunction selector(path: Path): string {\n  let node = path[0];\n  let query = node.name;\n  for (let i = 1; i < path.length; i++) {\n    const level = path[i].level || 0;\n    if (node.level === level - 1) {\n      query = `${path[i].name} > ${query}`;\n    } else {\n      query = `${path[i].name} ${query}`;\n    }\n    node = path[i];\n  }\n  return query;\n}\n\nfunction penalty(path: Path): number {\n  return path.map((node) => node.penalty).reduce((acc, i) => acc + i, 0);\n}\n\nfunction unique(path: Path) {\n  const css = selector(path);\n  switch (rootDocument.querySelectorAll(css).length) {\n    case 0:\n      throw new Error(`Can't select any node with this selector: ${css}`);\n    case 1:\n      return true;\n    default:\n      return false;\n  }\n}\n\nfunction id(input: Element): Knot | null {\n  const elementId = input.getAttribute('id');\n  if (elementId && config.idName(elementId)) {\n    return {\n      name: '#' + CSS.escape(elementId),\n      penalty: 0,\n    };\n  }\n  return null;\n}\n\nfunction attr(input: Element): Knot[] {\n  const attrs = Array.from(input.attributes).filter((attr) => config.attr(attr.name, attr.value));\n  return attrs.map(\n    (attr): Knot => ({\n      name: `[${CSS.escape(attr.name)}=\"${CSS.escape(attr.value)}\"]`,\n      penalty: 0.5,\n    }),\n  );\n}\n\nfunction classNames(input: Element): Knot[] {\n  const names = Array.from(input.classList).filter(config.className);\n  return names.map(\n    (name): Knot => ({\n      name: '.' + CSS.escape(name),\n      penalty: 1,\n    }),\n  );\n}\n\nfunction tagName(input: Element): Knot | null {\n  const name = input.tagName.toLowerCase();\n  if (config.tagName(name)) {\n    return {\n      name,\n      penalty: 2,\n    };\n  }\n  return null;\n}\n\nfunction any(): Knot {\n  return {\n    name: '*',\n    penalty: 3,\n  };\n}\n\nfunction index(input: Element): number | null {\n  const parent = input.parentNode;\n  if (!parent) {\n    return null;\n  }\n  let child = parent.firstChild;\n  if (!child) {\n    return null;\n  }\n  let i = 0;\n  while (child) {\n    if (child.nodeType === Node.ELEMENT_NODE) {\n      i++;\n    }\n    if (child === input) {\n      break;\n    }\n    child = child.nextSibling;\n  }\n  return i;\n}\n\nfunction nthChild(node: Knot, i: number): Knot {\n  return {\n    name: node.name + `:nth-child(${i})`,\n    penalty: node.penalty + 1,\n  };\n}\n\nfunction dispensableNth(node: Knot) {\n  return node.name !== 'html' && !node.name.startsWith('#');\n}\n\nfunction maybe(...level: (Knot | null)[]): Knot[] | null {\n  const list = level.filter(notEmpty);\n  if (list.length > 0) {\n    return list;\n  }\n  return null;\n}\n\nfunction notEmpty<T>(value: T | null | undefined): value is T {\n  return value !== null && value !== undefined;\n}\n\nfunction* combinations(stack: Knot[][], path: Knot[] = []): Generator<Knot[]> {\n  if (stack.length > 0) {\n    for (let node of stack[0]) {\n      yield* combinations(stack.slice(1, stack.length), path.concat(node));\n    }\n  } else {\n    yield path;\n  }\n}\n\nfunction sort(paths: Iterable<Path>): Path[] {\n  return [...paths].sort((a, b) => penalty(a) - penalty(b));\n}\n\ntype Scope = {\n  counter: number;\n  visited: Map<string, boolean>;\n};\n\nfunction* optimize(\n  path: Path,\n  input: Element,\n  scope: Scope = {\n    counter: 0,\n    visited: new Map<string, boolean>(),\n  },\n): Generator<Knot[]> {\n  if (path.length > 2 && path.length > config.optimizedMinLength) {\n    for (let i = 1; i < path.length - 1; i++) {\n      if (scope.counter > config.maxNumberOfTries) {\n        return; // Okay At least I tried!\n      }\n      scope.counter += 1;\n      const newPath = [...path];\n      newPath.splice(i, 1);\n      const newPathKey = selector(newPath);\n      if (scope.visited.has(newPathKey)) {\n        return;\n      }\n      if (unique(newPath) && same(newPath, input)) {\n        yield newPath;\n        scope.visited.set(newPathKey, true);\n        yield* optimize(newPath, input, scope);\n      }\n    }\n  }\n}\n\nfunction same(path: Path, input: Element) {\n  return rootDocument.querySelector(selector(path)) === input;\n}\n","import type { mouseInteractionCallBack } from '@amplitude/rrweb-types';\nimport { MouseInteractions } from '@amplitude/rrweb-types';\nimport { getWindowScroll, Mirror } from '../utils/rrweb';\nimport { SessionReplayEventsManager as AmplitudeSessionReplayEventsManager } from '../typings/session-replay';\nimport { PayloadBatcher } from 'src/track-destination';\nimport { finder } from '../libs/finder';\nimport { getGlobalScope, ILogger } from '@amplitude/analytics-core';\nimport { UGCFilterRule } from 'src/config/types';\nimport { getPageUrl } from '../helpers';\n\n// exported for testing\nexport type ClickEvent = {\n  timestamp: number;\n  x: number;\n  y: number;\n  viewportWidth: number;\n  viewportHeight: number;\n  pageUrl: string;\n  selector?: string;\n  type: 'click';\n};\n\n// exported for testing\nexport type ClickEventWithCount = ClickEvent & { count: number };\n\ntype Options = {\n  sessionId: string | number;\n  deviceIdFn: () => string | undefined;\n  eventsManager: AmplitudeSessionReplayEventsManager<'interaction', string>;\n  mirror: Mirror;\n  ugcFilterRules: UGCFilterRule[];\n};\n\nconst HOUR_IN_MILLISECONDS = 3_600_000;\n\nexport const clickNonBatcher: PayloadBatcher = ({ version, events }) => {\n  const clickEvents: ClickEvent[] = [];\n  events.forEach((evt: string) => {\n    const record = JSON.parse(evt) as Record<string, unknown>;\n    record.count = 1;\n    if (record.type === 'click') {\n      clickEvents.push(record as ClickEvent);\n    }\n  });\n  return { version, events: clickEvents };\n};\n\nexport const clickBatcher: PayloadBatcher = ({ version, events }) => {\n  const clickEvents: ClickEvent[] = [];\n  events.forEach((evt: string) => {\n    const record = JSON.parse(evt) as Record<string, unknown>;\n    if (record.type === 'click') {\n      clickEvents.push(record as ClickEvent);\n    }\n  });\n\n  const reduced = clickEvents.reduce<Record<string, ClickEventWithCount>>((prev, curr) => {\n    const { x, y, selector, timestamp } = curr;\n\n    // round down to nearest hour.\n    const hour = timestamp - (timestamp % HOUR_IN_MILLISECONDS);\n\n    const k = `${x}:${y}:${selector ?? ''}:${hour}`;\n    if (!prev[k]) {\n      prev[k] = { ...curr, timestamp: hour, count: 1 };\n    } else {\n      prev[k].count += 1;\n    }\n    return prev;\n  }, {});\n\n  return { version, events: Object.values(reduced) };\n};\n\nexport const clickHook: (logger: ILogger, options: Options) => mouseInteractionCallBack =\n  (logger, { eventsManager, sessionId, deviceIdFn, mirror, ugcFilterRules }) =>\n  (e) => {\n    if (e.type !== MouseInteractions.Click) {\n      return;\n    }\n\n    const globalScope = getGlobalScope();\n    if (!globalScope) {\n      return;\n    }\n\n    const { location, innerHeight, innerWidth } = globalScope;\n    // it only makes sense to send events if a pageUrl exists\n    if (!location) {\n      return;\n    }\n\n    const { x, y } = e;\n    if (x === undefined || y === undefined) {\n      return;\n    }\n\n    const node = mirror.getNode(e.id);\n    let selector;\n    if (node) {\n      try {\n        selector = finder(node as Element);\n      } catch (err) {\n        logger.debug('error resolving selector from finder');\n      }\n    }\n\n    const { left: scrollX, top: scrollY } = getWindowScroll(globalScope as unknown as Window);\n\n    const pageUrl = getPageUrl(location.href, ugcFilterRules);\n\n    const event: ClickEvent = {\n      x: x + scrollX,\n      y: y + scrollY,\n      selector,\n\n      viewportHeight: innerHeight,\n      viewportWidth: innerWidth,\n      pageUrl,\n      timestamp: Date.now(),\n      type: 'click',\n    };\n    const deviceId = deviceIdFn();\n    if (deviceId) {\n      eventsManager.addEvent({ sessionId, event: { type: 'interaction', data: JSON.stringify(event) }, deviceId });\n    }\n  };\n","import { getGlobalScope } from '@amplitude/analytics-core';\nimport { SessionReplayJoinedConfig } from './config/types';\nimport { SessionReplayDestinationSessionMetadata } from './typings/session-replay';\nimport { getServerUrl } from './helpers';\n\ntype BeaconSendFn<T> = (pageUrl: string, payload: T) => boolean;\n\n/**\n * For very small payloads it's preferable to use the [Beacon API](https://developer.mozilla.org/en-US/docs/Web/API/Beacon_API).\n * While it doesn't provide 100% guarantees on sends, it greatly helps with overall reliability and page load performance. As\n * the Beacon API has a potential to fail due to size constraints we want to fall back to XHR if need be. This is mostly to\n * be used with 'pagehide' or 'beforeunload' events.\n *\n * Note there are only 3 CORS safelisted Content-Types you can send:\n *\n * - application/x-www-form-urlencoded\n * - multipart/form-data\n * - text/plain\n *\n * If we do not send one of these, some browsers like Chrome may not send this at all. Also we incur the overhead of a preflight\n * request. In our case we will add no additional content-type header. If you are trying to ping a server that requires this\n * header, you may want to use the regular fetch API or a different mechanism.\n */\nexport class BeaconTransport<T> {\n  private sendBeacon: BeaconSendFn<T>;\n  private sendXhr: BeaconSendFn<T>;\n  private readonly basePageUrl: string;\n  private readonly context: Omit<SessionReplayDestinationSessionMetadata, 'deviceId'>;\n  private readonly apiKey: string;\n\n  constructor(context: Omit<SessionReplayDestinationSessionMetadata, 'deviceId'>, config: SessionReplayJoinedConfig) {\n    const globalScope = getGlobalScope();\n    if (globalScope && globalScope.navigator && typeof globalScope.navigator.sendBeacon === 'function') {\n      this.sendBeacon = (pageUrl, payload) => {\n        try {\n          if (globalScope.navigator.sendBeacon(pageUrl, JSON.stringify(payload))) {\n            return true;\n          }\n        } catch (e) {\n          // not logging error, since it would be hard to view and just adds overhead.\n        }\n        return false;\n      };\n    } else {\n      this.sendBeacon = () => false;\n    }\n\n    this.sendXhr = (pageUrl, payload) => {\n      const xhr = new XMLHttpRequest();\n      xhr.open('POST', pageUrl, true);\n      xhr.setRequestHeader('Accept', '*/*');\n      xhr.send(JSON.stringify(payload));\n      return true;\n    };\n\n    this.basePageUrl = getServerUrl(config.serverZone, config.trackServerUrl);\n    this.apiKey = config.apiKey;\n    this.context = context;\n  }\n\n  send(deviceId: string, payload: T) {\n    const { sessionId, type } = this.context;\n    const urlParams = new URLSearchParams({\n      device_id: deviceId,\n      session_id: String(sessionId),\n      type: String(type),\n      api_key: this.apiKey,\n    });\n\n    const pageUrl = `${this.basePageUrl}?${urlParams.toString()}`;\n\n    // ideally send using the beacon API, but there is a chance it may fail, possibly due to a payload\n    // size limit. in this case, try best effort to send using xhr.\n    this.sendBeacon(pageUrl, payload) || this.sendXhr(pageUrl, payload);\n  }\n}\n","import { getWindowHeight, getWindowWidth } from '../utils/rrweb';\nimport type { scrollCallback, scrollPosition } from '@amplitude/rrweb-types';\nimport { BeaconTransport } from '../beacon-transport';\nimport { getGlobalScope } from '@amplitude/analytics-core';\nimport { SessionReplayJoinedConfig } from '../config/types';\nimport { SessionReplayDestinationSessionMetadata } from '../typings/session-replay';\nimport { getPageUrl } from '../helpers';\n\nexport type ScrollEvent = {\n  timestamp: number; // Timestamp the event occurred\n  maxScrollX: number; // Max window scroll X on a page\n  maxScrollY: number; // Max window scroll Y on a page\n  maxScrollHeight: number; // Max window scroll Y + window height on a page\n  maxScrollWidth: number; // Max window scroll X + window width on a page\n  viewportWidth: number;\n  viewportHeight: number;\n  pageUrl: string;\n  type: 'scroll';\n};\n\nexport type ScrollEventPayload = { version: number; events: ScrollEvent[] };\n\n/**\n * This is intended to watch and update max scroll activity when loaded for a particular page.\n * A new instance should be created if the page URL changes, since by default it does not reset\n * it's max scroll state. It is intended to send very few and very small events utilizing the\n * Beacon API.\n * @see {@link BeaconTransport} for more details on Beacon API usage.\n */\nexport class ScrollWatcher {\n  private timestamp = Date.now();\n  private _maxScrollX: number;\n  private _maxScrollY: number;\n  private _maxScrollWidth: number;\n  private _maxScrollHeight: number;\n  private readonly transport: BeaconTransport<ScrollEventPayload>;\n  private readonly config: Pick<SessionReplayJoinedConfig, 'loggerProvider' | 'interactionConfig'>;\n\n  static default(\n    context: Omit<SessionReplayDestinationSessionMetadata, 'deviceId'>,\n    config: SessionReplayJoinedConfig,\n  ): ScrollWatcher {\n    return new ScrollWatcher(new BeaconTransport<ScrollEventPayload>(context, config), config);\n  }\n\n  constructor(\n    transport: BeaconTransport<ScrollEventPayload>,\n    config: Pick<SessionReplayJoinedConfig, 'loggerProvider' | 'interactionConfig'>,\n  ) {\n    this._maxScrollX = 0;\n    this._maxScrollY = 0;\n    this._maxScrollWidth = getWindowWidth();\n    this._maxScrollHeight = getWindowHeight();\n    this.config = config;\n\n    this.transport = transport;\n  }\n\n  public get maxScrollX(): number {\n    return this._maxScrollX;\n  }\n\n  public get maxScrollY(): number {\n    return this._maxScrollY;\n  }\n\n  public get maxScrollWidth(): number {\n    return this._maxScrollWidth;\n  }\n\n  public get maxScrollHeight(): number {\n    return this._maxScrollHeight;\n  }\n\n  update(e: scrollPosition) {\n    const now = Date.now();\n    if (e.x > this._maxScrollX) {\n      const width = getWindowWidth();\n      this._maxScrollX = e.x;\n      const maxScrollWidth = e.x + width;\n      if (maxScrollWidth > this._maxScrollWidth) {\n        this._maxScrollWidth = maxScrollWidth;\n      }\n      this.timestamp = now;\n    }\n\n    if (e.y > this._maxScrollY) {\n      const height = getWindowHeight();\n      this._maxScrollY = e.y;\n      const maxScrollHeight = e.y + height;\n      if (maxScrollHeight > this._maxScrollHeight) {\n        this._maxScrollHeight = maxScrollHeight;\n      }\n      this.timestamp = now;\n    }\n  }\n\n  hook: scrollCallback = (e: scrollPosition) => {\n    this.update(e);\n  };\n\n  send: (deviceIdFn: () => string | undefined) => (_: PageTransitionEvent | Event) => void = (deviceIdFn) => (_) => {\n    const deviceId = deviceIdFn();\n    const globalScope = getGlobalScope();\n    if (globalScope && deviceId) {\n      this.transport.send(deviceId, {\n        version: 1,\n        events: [\n          {\n            maxScrollX: this._maxScrollX,\n            maxScrollY: this._maxScrollY,\n            maxScrollWidth: this._maxScrollWidth,\n            maxScrollHeight: this._maxScrollHeight,\n\n            viewportHeight: getWindowHeight(),\n            viewportWidth: getWindowWidth(),\n            pageUrl: getPageUrl(globalScope.location.href, this.config.interactionConfig?.ugcFilterRules ?? []),\n            timestamp: this.timestamp,\n            type: 'scroll',\n          },\n        ],\n      });\n    }\n  };\n}\n","import { generateSessionReplayId } from './helpers';\nimport { SessionIdentifiers as ISessionIdentifiers } from './typings/session-replay';\n\nexport class SessionIdentifiers implements ISessionIdentifiers {\n  deviceId?: string;\n  sessionId?: string | number;\n  sessionReplayId?: string;\n\n  constructor({ sessionId, deviceId }: { sessionId?: string | number; deviceId?: string }) {\n    this.deviceId = deviceId;\n    this.sessionId = sessionId;\n\n    if (sessionId && deviceId) {\n      this.sessionReplayId = generateSessionReplayId(sessionId, deviceId);\n    }\n  }\n}\n","import { Logger as ILogger } from '@amplitude/analytics-types';\nimport { DBSchema, IDBPDatabase, openDB } from 'idb';\n\nexport const MAX_IDB_STORAGE_LENGTH = 1000 * 60 * 60 * 24 * 2; // 2 days\n\nexport interface SessionReplayTargetingDB extends DBSchema {\n  sessionTargetingMatch: {\n    key: string;\n    value: {\n      sessionId: string;\n      targetingMatch: boolean;\n      lastUpdated: number;\n    };\n  };\n}\n\nexport class TargetingIDBStore {\n  dbs: { [apiKey: string]: IDBPDatabase<SessionReplayTargetingDB> } = {};\n\n  createStore = async (dbName: string) => {\n    return await openDB<SessionReplayTargetingDB>(dbName, 1, {\n      upgrade: (db: IDBPDatabase<SessionReplayTargetingDB>) => {\n        if (!db.objectStoreNames.contains('sessionTargetingMatch')) {\n          db.createObjectStore('sessionTargetingMatch', {\n            keyPath: 'sessionId',\n          });\n        }\n      },\n    });\n  };\n\n  openOrCreateDB = async (apiKey: string) => {\n    if (this.dbs && this.dbs[apiKey]) {\n      return this.dbs[apiKey];\n    }\n    const dbName = `${apiKey.substring(0, 10)}_amp_session_replay_targeting`;\n    const db = await this.createStore(dbName);\n    this.dbs[apiKey] = db;\n    return db;\n  };\n\n  getTargetingMatchForSession = async ({\n    loggerProvider,\n    apiKey,\n    sessionId,\n  }: {\n    loggerProvider: ILogger;\n    apiKey: string;\n    sessionId: string | number;\n  }) => {\n    try {\n      const db = await this.openOrCreateDB(apiKey);\n      const sessionIdStr = String(sessionId);\n      const targetingMatchForSession = await db.get<'sessionTargetingMatch'>('sessionTargetingMatch', sessionIdStr);\n\n      return targetingMatchForSession?.targetingMatch;\n    } catch (e) {\n      loggerProvider.warn(`Failed to get targeting match for session id ${sessionId}: ${e as string}`);\n    }\n    return undefined;\n  };\n\n  storeTargetingMatchForSession = async ({\n    loggerProvider,\n    apiKey,\n    sessionId,\n    targetingMatch,\n  }: {\n    loggerProvider: ILogger;\n    apiKey: string;\n    sessionId: string | number;\n    targetingMatch: boolean;\n  }) => {\n    try {\n      const db = await this.openOrCreateDB(apiKey);\n      const sessionIdStr = String(sessionId);\n      const targetingMatchForSession = await db.put<'sessionTargetingMatch'>('sessionTargetingMatch', {\n        targetingMatch,\n        sessionId: sessionIdStr,\n        lastUpdated: Date.now(),\n      });\n\n      return targetingMatchForSession;\n    } catch (e) {\n      loggerProvider.warn(`Failed to store targeting match for session id ${sessionId}: ${e as string}`);\n    }\n    return undefined;\n  };\n\n  clearStoreOfOldSessions = async ({\n    loggerProvider,\n    apiKey,\n    currentSessionId,\n  }: {\n    loggerProvider: ILogger;\n    apiKey: string;\n    currentSessionId: string | number;\n  }) => {\n    try {\n      const db = await this.openOrCreateDB(apiKey);\n      const currentSessionIdStr = String(currentSessionId);\n      const tx = db.transaction<'sessionTargetingMatch', 'readwrite'>('sessionTargetingMatch', 'readwrite');\n      const allTargetingMatchObjs = await tx.store.getAll();\n      for (let i = 0; i < allTargetingMatchObjs.length; i++) {\n        const targetingMatchObj = allTargetingMatchObjs[i];\n        const amountOfTimeSinceSession = Date.now() - targetingMatchObj.lastUpdated;\n        if (targetingMatchObj.sessionId !== currentSessionIdStr && amountOfTimeSinceSession > MAX_IDB_STORAGE_LENGTH) {\n          await tx.store.delete(targetingMatchObj.sessionId);\n        }\n      }\n      await tx.done;\n    } catch (e) {\n      loggerProvider.warn(`Failed to clear old targeting matches for sessions: ${e as string}`);\n    }\n  };\n}\nexport const targetingIDBStore = new TargetingIDBStore();\n","import { getPageUrl } from '../helpers';\nimport { UGCFilterRule } from '../config/types';\nimport { DEFAULT_URL_CHANGE_POLLING_INTERVAL } from '../constants';\nimport { RecordPlugin } from '@amplitude/rrweb-types';\n\n/**\n * Event emitted when URL changes are detected by the plugin\n * Contains the current page URL, title, and viewport dimensions\n */\nexport interface URLChangeEvent {\n  /** The current page URL (may be filtered if UGC rules are applied) */\n  href: string;\n  /** The current page title */\n  title: string;\n  /** Viewport height in pixels */\n  viewportHeight: number;\n  /** Viewport width in pixels */\n  viewportWidth: number;\n  /** The type of URL change event */\n  type: string;\n}\n\n/**\n * Configuration options for the URL tracking plugin\n */\nexport interface URLTrackingPluginOptions {\n  /** Rules for filtering sensitive URLs (User Generated Content) */\n  ugcFilterRules?: UGCFilterRule[];\n  /** Whether to use polling instead of history API events for URL detection */\n  enablePolling?: boolean;\n  /** Interval in milliseconds for polling URL changes (default: 1000ms) */\n  pollingInterval?: number;\n  /** Whether to capture document title in URL change events (default: false) */\n  captureDocumentTitle?: boolean;\n}\n\n/**\n * Creates a URL tracking plugin for rrweb record function\n *\n * This plugin monitors URL changes in the browser and emits events when the URL changes.\n * It supports three tracking modes:\n * 1. Polling (if explicitly enabled) - periodically checks for URL changes\n * 2. History API + Hash routing (default) - patches pushState/replaceState, listens to popstate and hashchange\n * 3. Hash routing only (fallback) - listens to hashchange events when History API is unavailable\n *\n * The plugin handles edge cases gracefully:\n * - Missing or null location objects\n * - Undefined, null, or empty location.href values\n * - Temporal dead zone issues with variable declarations\n * - Consistent URL normalization across all code paths\n *\n * @param options Configuration options for URL tracking\n * @returns RecordPlugin instance that can be used with rrweb\n */\nexport function createUrlTrackingPlugin(\n  options: URLTrackingPluginOptions = {},\n): RecordPlugin<URLTrackingPluginOptions> {\n  return {\n    name: 'amplitude/url-tracking@1',\n    observer(cb, globalScope, pluginOptions?: URLTrackingPluginOptions) {\n      // Merge options with plugin-level options taking precedence over constructor options\n      const config = { ...options, ...pluginOptions };\n      const ugcFilterRules = config.ugcFilterRules || [];\n      const enablePolling = config.enablePolling ?? false;\n      const pollingInterval = config.pollingInterval ?? DEFAULT_URL_CHANGE_POLLING_INTERVAL;\n      const captureDocumentTitle = config.captureDocumentTitle ?? false;\n\n      // Early return if no global scope is available\n      if (!globalScope) {\n        return () => {\n          // No cleanup needed if no global scope available\n        };\n      }\n\n      // Track the last URL to prevent duplicate events\n      // Initialize to undefined to ensure first call always emits an event\n      let lastTrackedUrl: string | undefined = undefined;\n\n      // Helper functions\n      /**\n       * Gets the current URL with proper normalization\n       * Handles edge cases where location.href might be undefined, null, or empty\n       * Ensures consistent behavior across all code paths\n       * @returns Normalized URL string (empty string if location unavailable)\n       */\n      const getCurrentUrl = (): string => {\n        if (!globalScope.location) return '';\n        return globalScope.location.href || '';\n      };\n\n      /**\n       * Creates a URL change event with current page information\n       * Applies UGC filtering if rules are configured\n       * Uses getCurrentUrl() for consistent URL normalization\n       * @returns URLChangeEvent with current page state\n       */\n      const createUrlChangeEvent = (): URLChangeEvent => {\n        const { innerHeight, innerWidth, document } = globalScope;\n        const currentUrl = getCurrentUrl();\n        let currentTitle = '';\n        if (captureDocumentTitle) {\n          currentTitle = document?.title || '';\n        }\n\n        // Apply UGC filtering if rules are provided, otherwise use original URL\n        const filteredUrl = ugcFilterRules.length > 0 ? getPageUrl(currentUrl, ugcFilterRules) : currentUrl;\n\n        return {\n          href: filteredUrl,\n          title: currentTitle,\n          viewportHeight: innerHeight,\n          viewportWidth: innerWidth,\n          type: 'url-change-event',\n        };\n      };\n\n      /**\n       * Emits a URL change event if the URL has actually changed\n       * Always emits on first call (when lastTrackedUrl is undefined)\n       * Prevents duplicate events for the same URL on subsequent calls\n       * Handles edge cases like undefined/null/empty URLs gracefully\n       */\n      const emitUrlChange = (): void => {\n        const currentUrl = getCurrentUrl();\n\n        // Always emit on first call, or if URL actually changed\n        if (lastTrackedUrl === undefined || currentUrl !== lastTrackedUrl) {\n          lastTrackedUrl = currentUrl;\n          const event = createUrlChangeEvent();\n          cb(event);\n        }\n      };\n\n      /**\n       * Creates a patched version of history methods (pushState/replaceState)\n       * that calls the original method and then emits a URL change event\n       * Ensures URL changes are detected even when history methods are called programmatically\n       * @param originalMethod The original history method to patch\n       * @returns Patched function that calls original method then emits URL change event\n       */\n      const createHistoryMethodPatch = <T extends typeof history.pushState | typeof history.replaceState>(\n        originalMethod: T,\n      ) => {\n        return function (this: History, ...args: Parameters<T>) {\n          // Call the original history method first\n          const result = originalMethod.apply(this, args);\n          // Then emit URL change event\n          emitUrlChange();\n          return result;\n        };\n      };\n\n      // Hashchange event handler - delegates to emitUrlChange for consistency\n      const hashChangeHandler = () => {\n        emitUrlChange();\n      };\n\n      // 1. if explicitly enable polling → use polling\n      if (enablePolling) {\n        // Use polling (covers everything)\n        const urlChangeInterval = globalScope.setInterval(() => {\n          emitUrlChange();\n        }, pollingInterval);\n\n        // Emit initial URL immediately\n        emitUrlChange();\n\n        // Return cleanup function to stop polling\n        return () => {\n          if (urlChangeInterval) {\n            globalScope.clearInterval(urlChangeInterval);\n          }\n        };\n      }\n\n      // 2. if polling not enabled → check history, if exist, use history\n      if (globalScope.history) {\n        // Use History API + hashchange (covers History API + hash routing)\n        // Store original history methods for restoration during cleanup\n        const originalPushState = globalScope.history.pushState.bind(globalScope.history);\n        const originalReplaceState = globalScope.history.replaceState.bind(globalScope.history);\n\n        /**\n         * Sets up history method patching to intercept pushState and replaceState calls\n         * This ensures URL changes are detected even when history methods are called programmatically\n         */\n        const setupHistoryPatching = (): void => {\n          // Patch pushState to emit URL change events\n          globalScope.history.pushState = createHistoryMethodPatch(originalPushState);\n\n          // Patch replaceState to emit URL change events\n          globalScope.history.replaceState = createHistoryMethodPatch(originalReplaceState);\n        };\n\n        // Apply history method patches\n        setupHistoryPatching();\n\n        // Listen to popstate events for browser back/forward navigation\n        globalScope.addEventListener('popstate', emitUrlChange);\n        // Listen to hashchange events for hash routing\n        globalScope.addEventListener('hashchange', hashChangeHandler);\n\n        // Emit initial URL immediately\n        emitUrlChange();\n\n        // Return cleanup function to restore original state\n        return () => {\n          // Restore original history methods\n          globalScope.history.pushState = originalPushState;\n          globalScope.history.replaceState = originalReplaceState;\n\n          // Remove popstate event listener\n          globalScope.removeEventListener('popstate', emitUrlChange);\n          // Remove hashchange event listener\n          globalScope.removeEventListener('hashchange', hashChangeHandler);\n        };\n      }\n\n      // 3. if not, then the framework is probably using hash router → do hash\n      // Fallback: just hashchange (for pure hash routing)\n      globalScope.addEventListener('hashchange', hashChangeHandler);\n      emitUrlChange();\n      return () => {\n        globalScope.removeEventListener('hashchange', hashChangeHandler);\n      };\n    },\n    options,\n  };\n}\n\n/**\n * Default URL tracking plugin instance with default options\n * Can be used directly without custom configuration\n */\nexport const urlTrackingPlugin = createUrlTrackingPlugin();\n","import {\n  getAnalyticsConnector,\n  getGlobalScope,\n  ILogger,\n  Logger,\n  LogLevel,\n  returnWrapper,\n  SpecialEventType,\n} from '@amplitude/analytics-core';\n\n// Import only specific types to avoid pulling in the entire rrweb-types package\nimport { eventWithTime, EventType as RRWebEventType, scrollCallback } from '@amplitude/rrweb-types';\nimport { TargetingParameters } from '@amplitude/targeting';\nimport { createSessionReplayJoinedConfigGenerator } from './config/joined-config';\nimport {\n  LoggingConfig,\n  SessionReplayJoinedConfig,\n  SessionReplayJoinedConfigGenerator,\n  SessionReplayLocalConfig,\n  SessionReplayMetadata,\n  SessionReplayRemoteConfig,\n} from './config/types';\nimport {\n  BLOCK_CLASS,\n  CustomRRwebEvent,\n  DEFAULT_SESSION_REPLAY_PROPERTY,\n  INTERACTION_MAX_INTERVAL,\n  INTERACTION_MIN_INTERVAL,\n  MASK_TEXT_CLASS,\n  SESSION_REPLAY_DEBUG_PROPERTY,\n} from './constants';\nimport { EventCompressor } from './events/event-compressor';\nimport { createEventsManager } from './events/events-manager';\nimport { MultiEventManager } from './events/multi-manager';\nimport { generateHashCode, getDebugConfig, getPageUrl, getStorageSize, isSessionInSample, maskFn } from './helpers';\nimport { clickBatcher, clickHook, clickNonBatcher } from './hooks/click';\nimport { ScrollWatcher } from './hooks/scroll';\nimport { SessionIdentifiers } from './identifiers';\nimport { SafeLoggerProvider } from './logger';\nimport { evaluateTargetingAndStore } from './targeting/targeting-manager';\nimport {\n  AmplitudeSessionReplay,\n  SessionReplayEventsManager as AmplitudeSessionReplayEventsManager,\n  DebugInfo,\n  EventsManagerWithType,\n  EventType,\n  SessionIdentifiers as ISessionIdentifiers,\n  SessionReplayOptions,\n} from './typings/session-replay';\nimport { VERSION } from './version';\n\n// Import only the type for NetworkRequestEvent to keep type safety\nimport type { NetworkObservers, NetworkRequestEvent } from './observers';\nimport { createUrlTrackingPlugin } from './plugins/url-tracking-plugin';\nimport type { RecordFunction } from './utils/rrweb';\n\ntype PageLeaveFn = (e: PageTransitionEvent | Event) => void;\n\nexport class SessionReplay implements AmplitudeSessionReplay {\n  name = '@amplitude/session-replay-browser';\n  config: SessionReplayJoinedConfig | undefined;\n  joinedConfigGenerator: SessionReplayJoinedConfigGenerator | undefined;\n  identifiers: ISessionIdentifiers | undefined;\n  eventsManager?: AmplitudeSessionReplayEventsManager<'replay' | 'interaction', string>;\n  loggerProvider: ILogger;\n  recordCancelCallback: ReturnType<RecordFunction> | null = null;\n  eventCount = 0;\n  eventCompressor: EventCompressor | undefined;\n  sessionTargetingMatch = false;\n  private lastTargetingParams?: Pick<TargetingParameters, 'event' | 'userProperties'>;\n  private lastShouldRecordDecision?: boolean;\n\n  // Visible for testing only\n  pageLeaveFns: PageLeaveFn[] = [];\n  private scrollHook?: scrollCallback;\n  private networkObservers?: NetworkObservers;\n  private metadata: SessionReplayMetadata | undefined;\n\n  // Cache the dynamically imported record function\n  private recordFunction: RecordFunction | null = null;\n\n  constructor() {\n    this.loggerProvider = new SafeLoggerProvider(new Logger());\n  }\n\n  init(apiKey: string, options: SessionReplayOptions) {\n    return returnWrapper(this._init(apiKey, options));\n  }\n\n  private teardownEventListeners = (teardown: boolean) => {\n    const globalScope = getGlobalScope();\n    if (globalScope) {\n      globalScope.removeEventListener('blur', this.blurListener);\n      globalScope.removeEventListener('focus', this.focusListener);\n      !teardown && globalScope.addEventListener('blur', this.blurListener);\n      !teardown && globalScope.addEventListener('focus', this.focusListener);\n      // prefer pagehide to unload events, this is the standard going forward. it is not\n      // 100% reliable, but is bfcache-compatible.\n      if (globalScope.self && 'onpagehide' in globalScope.self) {\n        globalScope.removeEventListener('pagehide', this.pageLeaveListener);\n        !teardown && globalScope.addEventListener('pagehide', this.pageLeaveListener);\n      } else {\n        // this has performance implications, but is the only way we can reliably send events\n        // in browser that don't support pagehide.\n        globalScope.removeEventListener('beforeunload', this.pageLeaveListener);\n        !teardown && globalScope.addEventListener('beforeunload', this.pageLeaveListener);\n      }\n    }\n  };\n\n  protected async _init(apiKey: string, options: SessionReplayOptions) {\n    this.loggerProvider = new SafeLoggerProvider(options.loggerProvider || new Logger());\n    Object.prototype.hasOwnProperty.call(options, 'logLevel') &&\n      this.loggerProvider.enable(options.logLevel as LogLevel);\n    this.identifiers = new SessionIdentifiers({ sessionId: options.sessionId, deviceId: options.deviceId });\n    this.joinedConfigGenerator = await createSessionReplayJoinedConfigGenerator(apiKey, options);\n    const { joinedConfig, localConfig, remoteConfig } = await this.joinedConfigGenerator.generateJoinedConfig(\n      this.identifiers.sessionId,\n    );\n    this.config = joinedConfig;\n\n    this.setMetadata(\n      options.sessionId,\n      joinedConfig,\n      localConfig,\n      remoteConfig,\n      options.version?.version,\n      VERSION,\n      options.version?.type,\n    );\n\n    if (options.sessionId && this.config.interactionConfig?.enabled) {\n      const scrollWatcher = ScrollWatcher.default(\n        {\n          sessionId: options.sessionId,\n          type: 'interaction',\n        },\n        this.config,\n      );\n      this.pageLeaveFns = [scrollWatcher.send(this.getDeviceId.bind(this)).bind(scrollWatcher)];\n      this.scrollHook = scrollWatcher.hook.bind(scrollWatcher);\n    }\n\n    const managers: EventsManagerWithType<EventType, string>[] = [];\n    let { storeType } = this.config;\n    if (storeType === 'idb' && !getGlobalScope()?.indexedDB) {\n      storeType = 'memory';\n      this.loggerProvider.warn('Could not use preferred indexedDB storage, reverting to in memory option.');\n    }\n    this.loggerProvider.log(`Using ${storeType} for event storage.`);\n    try {\n      const rrwebEventManager = await createEventsManager<'replay'>({\n        config: this.config,\n        sessionId: this.identifiers.sessionId,\n        type: 'replay',\n        storeType,\n      });\n      managers.push({ name: 'replay', manager: rrwebEventManager });\n    } catch (error) {\n      const typedError = error as Error;\n      this.loggerProvider.warn(`Error occurred while creating replay events manager: ${typedError.toString()}`);\n    }\n\n    if (this.config.interactionConfig?.enabled) {\n      const payloadBatcher = this.config.interactionConfig.batch ? clickBatcher : clickNonBatcher;\n      try {\n        const interactionEventManager = await createEventsManager<'interaction'>({\n          config: this.config,\n          sessionId: this.identifiers.sessionId,\n          type: 'interaction',\n          minInterval: this.config.interactionConfig.trackEveryNms ?? INTERACTION_MIN_INTERVAL,\n          maxInterval: INTERACTION_MAX_INTERVAL,\n          payloadBatcher,\n          storeType,\n        });\n        managers.push({ name: 'interaction', manager: interactionEventManager });\n      } catch (error) {\n        const typedError = error as Error;\n        this.loggerProvider.warn(`Error occurred while creating interaction events manager: ${typedError.toString()}`);\n      }\n    }\n\n    this.eventsManager = new MultiEventManager<'replay' | 'interaction', string>(...managers);\n    // To prevent too many threads.\n    if (this.eventCompressor) {\n      this.eventCompressor.terminate();\n    }\n    this.eventCompressor = new EventCompressor(this.eventsManager, this.config, this.getDeviceId());\n\n    await this.initializeNetworkObservers();\n\n    this.loggerProvider.log('Installing @amplitude/session-replay-browser.');\n\n    this.teardownEventListeners(false);\n\n    await this.evaluateTargetingAndCapture({ userProperties: options.userProperties }, true);\n  }\n\n  setSessionId(sessionId: string | number, deviceId?: string) {\n    return returnWrapper(this.asyncSetSessionId(sessionId, deviceId));\n  }\n\n  async asyncSetSessionId(\n    sessionId: string | number,\n    deviceId?: string,\n    options?: { userProperties?: { [key: string]: any } },\n  ) {\n    this.sessionTargetingMatch = false;\n    this.lastShouldRecordDecision = undefined; // Reset targeting decision for new session\n\n    const previousSessionId = this.identifiers && this.identifiers.sessionId;\n    if (previousSessionId) {\n      this.sendEvents(previousSessionId);\n    }\n\n    const deviceIdForReplayId = deviceId || this.getDeviceId();\n    this.identifiers = new SessionIdentifiers({\n      sessionId: sessionId,\n      deviceId: deviceIdForReplayId,\n    });\n\n    // If there is no previous session id, SDK is being initialized for the first time,\n    // and config was just fetched in initialization, so no need to fetch it a second time\n    if (this.joinedConfigGenerator && previousSessionId) {\n      const { joinedConfig } = await this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId);\n      this.config = joinedConfig;\n    }\n    await this.evaluateTargetingAndCapture({ userProperties: options?.userProperties });\n  }\n\n  getSessionReplayProperties() {\n    const config = this.config;\n    const identifiers = this.identifiers;\n    if (!config || !identifiers) {\n      this.loggerProvider.warn('Session replay init has not been called, cannot get session replay properties.');\n      return {};\n    }\n\n    const shouldRecord = this.getShouldRecord();\n    let eventProperties: { [key: string]: string | null } = {};\n\n    if (shouldRecord) {\n      eventProperties = {\n        [DEFAULT_SESSION_REPLAY_PROPERTY]: identifiers.sessionReplayId ? identifiers.sessionReplayId : null,\n      };\n      if (config.debugMode) {\n        eventProperties[SESSION_REPLAY_DEBUG_PROPERTY] = JSON.stringify({\n          appHash: generateHashCode(config.apiKey).toString(),\n        });\n      }\n    }\n\n    void this.addCustomRRWebEvent(\n      CustomRRwebEvent.GET_SR_PROPS,\n      {\n        shouldRecord,\n        eventProperties: eventProperties,\n      },\n      this.eventCount === 10,\n    );\n    if (this.eventCount === 10) {\n      this.eventCount = 0;\n    }\n    this.eventCount++;\n\n    return eventProperties;\n  }\n\n  blurListener = () => {\n    this.sendEvents();\n  };\n\n  focusListener = () => {\n    // Restart recording on focus to ensure that when user\n    // switches tabs, we take a full snapshot\n    void this.recordEvents(false);\n  };\n\n  /**\n   * This is an instance member so that if init is called multiple times\n   * it doesn't add another listener to the page leave event. This is to\n   * prevent duplicate listener actions from firing.\n   */\n  private pageLeaveListener = (e: PageTransitionEvent | Event) => {\n    this.pageLeaveFns.forEach((fn) => {\n      fn(e);\n    });\n  };\n\n  evaluateTargetingAndCapture = async (\n    targetingParams: Pick<TargetingParameters, 'event' | 'userProperties'>,\n    isInit = false,\n  ) => {\n    if (!this.identifiers || !this.identifiers.sessionId || !this.config) {\n      if (this.identifiers && !this.identifiers.sessionId) {\n        this.loggerProvider.log('Session ID has not been set yet, cannot evaluate targeting for Session Replay.');\n      } else {\n        this.loggerProvider.warn('Session replay init has not been called, cannot evaluate targeting.');\n      }\n      return;\n    }\n\n    // Store targeting parameters for use in getShouldRecord\n    this.lastTargetingParams = targetingParams;\n\n    if (this.config.targetingConfig && !this.sessionTargetingMatch) {\n      let eventForTargeting = targetingParams.event;\n      if (\n        eventForTargeting &&\n        Object.values(SpecialEventType).includes(eventForTargeting.event_type as SpecialEventType)\n      ) {\n        eventForTargeting = undefined;\n      }\n\n      // We're setting this on this class because fetching the value from idb\n      // is async, we need to access this value synchronously (for record\n      // and for getSessionReplayProperties - both synchronous fns)\n      this.sessionTargetingMatch = await evaluateTargetingAndStore({\n        sessionId: this.identifiers.sessionId,\n        targetingConfig: this.config.targetingConfig,\n        loggerProvider: this.loggerProvider,\n        apiKey: this.config.apiKey,\n        targetingParams: { userProperties: targetingParams.userProperties, event: eventForTargeting },\n      });\n\n      // Log the targeting config to debug\n      this.loggerProvider.debug(\n        JSON.stringify(\n          {\n            name: 'targeted replay capture config',\n            sessionTargetingMatch: this.sessionTargetingMatch,\n            event: eventForTargeting,\n            targetingParams: targetingParams,\n          },\n          null,\n          2,\n        ),\n      );\n    }\n\n    if (isInit) {\n      void this.initialize(true);\n    } else {\n      await this.recordEvents();\n    }\n  };\n\n  sendEvents(sessionId?: string | number) {\n    const sessionIdToSend = sessionId || this.identifiers?.sessionId;\n    const deviceId = this.getDeviceId();\n    this.eventsManager &&\n      sessionIdToSend &&\n      deviceId &&\n      this.eventsManager.sendCurrentSequenceEvents({ sessionId: sessionIdToSend, deviceId });\n  }\n\n  async initialize(shouldSendStoredEvents = false) {\n    if (!this.identifiers?.sessionId) {\n      this.loggerProvider.log(`Session is not being recorded due to lack of session id.`);\n      return Promise.resolve();\n    }\n\n    const deviceId = this.getDeviceId();\n    if (!deviceId) {\n      this.loggerProvider.log(`Session is not being recorded due to lack of device id.`);\n      return Promise.resolve();\n    }\n    this.eventsManager && shouldSendStoredEvents && void this.eventsManager.sendStoredEvents({ deviceId });\n\n    return this.recordEvents();\n  }\n\n  shouldOptOut() {\n    let identityStoreOptOut: boolean | undefined;\n    if (this.config?.instanceName) {\n      const identityStore = getAnalyticsConnector(this.config.instanceName).identityStore;\n      identityStoreOptOut = identityStore.getIdentity().optOut;\n    }\n\n    return identityStoreOptOut !== undefined ? identityStoreOptOut : this.config?.optOut;\n  }\n\n  getShouldRecord() {\n    if (!this.identifiers || !this.config || !this.identifiers.sessionId) {\n      this.loggerProvider.warn(`Session is not being recorded due to lack of config, please call sessionReplay.init.`);\n      return false;\n    }\n    if (!this.config.captureEnabled) {\n      this.loggerProvider.log(\n        `Session ${this.identifiers.sessionId} not being captured due to capture being disabled for project or because the remote config could not be fetched.`,\n      );\n      return false;\n    }\n\n    if (this.shouldOptOut()) {\n      this.loggerProvider.log(`Opting session ${this.identifiers.sessionId} out of recording due to optOut config.`);\n      return false;\n    }\n\n    let shouldRecord = false;\n    let message = '';\n    let matched = false;\n\n    // If targetingConfig exists, we'll use the sessionTargetingMatch to determine whether to record\n    // Otherwise, we'll evaluate the session against the overall sample rate\n    if (this.config.targetingConfig) {\n      if (!this.sessionTargetingMatch) {\n        message = `Not capturing replays for session ${this.identifiers.sessionId} due to not matching targeting conditions.`;\n        this.loggerProvider.log(message);\n        shouldRecord = false;\n        matched = false;\n      } else {\n        message = `Capturing replays for session ${this.identifiers.sessionId} due to matching targeting conditions.`;\n        this.loggerProvider.log(message);\n        shouldRecord = true;\n        matched = true;\n      }\n    } else {\n      const isInSample = isSessionInSample(this.identifiers.sessionId, this.config.sampleRate);\n      if (!isInSample) {\n        message = `Opting session ${this.identifiers.sessionId} out of recording due to sample rate.`;\n        this.loggerProvider.log(message);\n        shouldRecord = false;\n        matched = false;\n      } else {\n        shouldRecord = true;\n        matched = true;\n      }\n    }\n\n    // Only send custom rrweb event for targeting decision when the decision changes\n    if (this.lastShouldRecordDecision !== shouldRecord && this.config.targetingConfig) {\n      void this.addCustomRRWebEvent(CustomRRwebEvent.TARGETING_DECISION, {\n        message,\n        sessionId: this.identifiers.sessionId,\n        matched,\n        targetingParams: this.lastTargetingParams,\n      });\n      this.lastShouldRecordDecision = shouldRecord;\n    }\n\n    return shouldRecord;\n  }\n\n  getBlockSelectors(): string | string[] | undefined {\n    // For some reason, this defaults to empty array ([]) if undefined in the compiled script.\n    // Empty arrays cause errors when being evaluated in Safari.\n    // Force the selector to be undefined if it's an empty array.\n    const blockSelector = this.config?.privacyConfig?.blockSelector ?? [];\n    if (blockSelector.length === 0) {\n      return undefined;\n    }\n    return blockSelector;\n  }\n\n  getMaskTextSelectors(): string | undefined {\n    if (this.config?.privacyConfig?.defaultMaskLevel === 'conservative') {\n      return '*';\n    }\n\n    const maskSelector = this.config?.privacyConfig?.maskSelector;\n    if (!maskSelector) {\n      return;\n    }\n\n    return maskSelector as unknown as string;\n  }\n\n  async getRecordingPlugins(loggingConfig: LoggingConfig | undefined) {\n    const plugins = [];\n\n    // Add URL tracking plugin\n    try {\n      const urlTrackingPlugin = createUrlTrackingPlugin({\n        ugcFilterRules: this.config?.interactionConfig?.ugcFilterRules || [],\n        enablePolling: this.config?.enableUrlChangePolling || false,\n        pollingInterval: this.config?.urlChangePollingInterval,\n        captureDocumentTitle: this.config?.captureDocumentTitle,\n      });\n\n      plugins.push(urlTrackingPlugin);\n    } catch (error) {\n      this.loggerProvider.warn('Failed to create URL tracking plugin:', error);\n    }\n\n    // Default plugin settings -\n    // {\n    //   level: ['info', 'log', 'warn', 'error'],\n    //   lengthThreshold: 10000,\n    //   stringifyOptions: {\n    //     stringLengthLimit: undefined,\n    //     numOfKeysLimit: 50,\n    //     depthOfLimit: 4,\n    //   },\n    //   logger: window.console,\n    //   }\n    if (loggingConfig?.console?.enabled) {\n      try {\n        // Dynamic import keeps console plugin separate and only loads when needed\n        const { getRecordConsolePlugin } = await import('@amplitude/rrweb-plugin-console-record');\n        plugins.push(getRecordConsolePlugin({ level: loggingConfig.console.levels }));\n      } catch (error) {\n        this.loggerProvider.warn('Failed to load console plugin:', error);\n      }\n    }\n\n    return plugins.length > 0 ? plugins : undefined;\n  }\n\n  private async getRecordFunction(): Promise<RecordFunction | null> {\n    if (this.recordFunction) {\n      return this.recordFunction;\n    }\n\n    try {\n      const { record } = await import('@amplitude/rrweb-record');\n      this.recordFunction = record;\n      return record;\n    } catch (error) {\n      this.loggerProvider.warn('Failed to load rrweb-record module:', error);\n      return null;\n    }\n  }\n\n  async recordEvents(shouldLogMetadata = true) {\n    const config = this.config;\n    const shouldRecord = this.getShouldRecord();\n    const sessionId = this.identifiers?.sessionId;\n    if (!shouldRecord || !sessionId || !config) {\n      return;\n    }\n    this.stopRecordingEvents();\n\n    const recordFunction = await this.getRecordFunction();\n\n    // May be undefined if cannot import rrweb-record\n    if (!recordFunction) {\n      return;\n    }\n\n    await this.initializeNetworkObservers();\n\n    this.networkObservers?.start((event: NetworkRequestEvent) => {\n      void this.addCustomRRWebEvent(CustomRRwebEvent.FETCH_REQUEST, event);\n    });\n    const { privacyConfig, interactionConfig, loggingConfig } = config;\n\n    const hooks = interactionConfig?.enabled\n      ? {\n          mouseInteraction:\n            this.eventsManager &&\n            clickHook(this.loggerProvider, {\n              eventsManager: this.eventsManager,\n              sessionId,\n              deviceIdFn: this.getDeviceId.bind(this),\n              mirror: recordFunction.mirror,\n              ugcFilterRules: interactionConfig.ugcFilterRules ?? [],\n            }),\n          scroll: this.scrollHook,\n        }\n      : {};\n\n    const ugcFilterRules =\n      interactionConfig?.enabled && interactionConfig.ugcFilterRules ? interactionConfig.ugcFilterRules : [];\n\n    this.loggerProvider.log(`Session Replay capture beginning for ${sessionId}.`);\n\n    try {\n      this.recordCancelCallback = recordFunction({\n        emit: (event: eventWithTime) => {\n          if (this.shouldOptOut()) {\n            this.loggerProvider.log(`Opting session ${sessionId} out of recording due to optOut config.`);\n            this.stopRecordingEvents();\n            this.sendEvents();\n            return;\n          }\n\n          if (event.type === RRWebEventType.Meta) {\n            event.data.href = getPageUrl(event.data.href, ugcFilterRules);\n          }\n\n          if (this.eventCompressor) {\n            // Schedule processing during idle time if the browser supports requestIdleCallback\n            this.eventCompressor.enqueueEvent(event, sessionId);\n          }\n        },\n        inlineStylesheet: config.shouldInlineStylesheet,\n        hooks,\n        maskAllInputs: true,\n        maskTextClass: MASK_TEXT_CLASS,\n        blockClass: BLOCK_CLASS,\n        blockSelector: this.getBlockSelectors() as string | undefined,\n        applyBackgroundColorToBlockedElements: config.applyBackgroundColorToBlockedElements,\n        maskInputFn: maskFn('input', privacyConfig),\n        maskTextFn: maskFn('text', privacyConfig),\n        maskTextSelector: this.getMaskTextSelectors(),\n        recordCanvas: false,\n        slimDOMOptions: {\n          script: config.omitElementTags?.script,\n          comment: config.omitElementTags?.comment,\n        },\n        errorHandler: (error: unknown) => {\n          const typedError = error as Error & { _external_?: boolean };\n\n          // styled-components relies on this error being thrown and bubbled up, rrweb is otherwise suppressing it\n          if (typedError.message.includes('insertRule') && typedError.message.includes('CSSStyleSheet')) {\n            throw typedError;\n          }\n\n          // rrweb does monkey patching on certain window functions such as CSSStyleSheet.proptype.insertRule,\n          // and errors from external clients calling these functions can get suppressed. Styled components depend\n          // on these errors being re-thrown.\n          if (typedError._external_) {\n            throw typedError;\n          }\n\n          this.loggerProvider.warn('Error while capturing replay: ', typedError.toString());\n          // Return true so that we don't clutter user's consoles with internal rrweb errors\n          return true;\n        },\n        plugins: await this.getRecordingPlugins(loggingConfig),\n      });\n\n      void this.addCustomRRWebEvent(CustomRRwebEvent.DEBUG_INFO);\n      if (shouldLogMetadata) {\n        void this.addCustomRRWebEvent(CustomRRwebEvent.METADATA, this.metadata);\n      }\n    } catch (error) {\n      this.loggerProvider.warn('Failed to initialize session replay:', error);\n    }\n  }\n\n  addCustomRRWebEvent = async (\n    eventName: CustomRRwebEvent,\n    eventData: { [key: string]: any } = {},\n    addStorageInfo = true,\n  ) => {\n    try {\n      let debugInfo: DebugInfo | undefined = undefined;\n      const config = this.config;\n      // Only add debug info for non-metadata events\n      if (config && eventName !== CustomRRwebEvent.METADATA) {\n        debugInfo = {\n          config: getDebugConfig(config),\n          version: VERSION,\n        };\n        if (addStorageInfo) {\n          const storageSizeData = await getStorageSize();\n          debugInfo = {\n            ...storageSizeData,\n            ...debugInfo,\n          };\n        }\n      }\n      // Check first to ensure we are recording\n      if (this.recordCancelCallback && this.recordFunction) {\n        this.recordFunction.addCustomEvent(eventName, {\n          ...eventData,\n          ...debugInfo,\n        });\n      } else {\n        this.loggerProvider.debug(\n          `Not able to add custom replay capture event ${eventName} due to no ongoing recording.`,\n        );\n      }\n    } catch (e) {\n      this.loggerProvider.debug('Error while adding custom replay capture event: ', e);\n    }\n  };\n\n  stopRecordingEvents = () => {\n    try {\n      this.loggerProvider.log('Session Replay capture stopping.');\n      this.recordCancelCallback && this.recordCancelCallback();\n      this.recordCancelCallback = null;\n      this.networkObservers?.stop();\n    } catch (error) {\n      const typedError = error as Error;\n      this.loggerProvider.warn(`Error occurred while stopping replay capture: ${typedError.toString()}`);\n    }\n  };\n\n  getDeviceId() {\n    return this.identifiers?.deviceId;\n  }\n\n  getSessionId() {\n    return this.identifiers?.sessionId;\n  }\n\n  async flush(useRetry = false) {\n    return this.eventsManager?.flush(useRetry);\n  }\n\n  shutdown() {\n    this.teardownEventListeners(true);\n    this.stopRecordingEvents();\n    this.sendEvents();\n  }\n\n  private mapSDKType(sdkType: string | undefined) {\n    if (sdkType === 'plugin') {\n      return '@amplitude/plugin-session-replay-browser';\n    }\n\n    if (sdkType === 'segment') {\n      return '@amplitude/segment-session-replay-plugin';\n    }\n\n    return null;\n  }\n\n  private setMetadata(\n    sessionId: string | number | undefined,\n    joinedConfig: SessionReplayJoinedConfig,\n    localConfig: SessionReplayLocalConfig,\n    remoteConfig: SessionReplayRemoteConfig | undefined,\n    replaySDKVersion: string | undefined,\n    standaloneSDKVersion: string | undefined,\n    sdkType: string | undefined,\n  ) {\n    const hashValue = sessionId?.toString() ? generateHashCode(sessionId.toString()) : undefined;\n\n    this.metadata = {\n      joinedConfig,\n      localConfig,\n      remoteConfig,\n      sessionId,\n      hashValue,\n      sampleRate: joinedConfig.sampleRate,\n      replaySDKType: this.mapSDKType(sdkType),\n      replaySDKVersion,\n      standaloneSDKType: '@amplitude/session-replay-browser',\n      standaloneSDKVersion,\n    };\n  }\n\n  private async initializeNetworkObservers(): Promise<void> {\n    if (this.config?.loggingConfig?.network?.enabled && !this.networkObservers) {\n      try {\n        const { NetworkObservers: NetworkObserversClass } = await import('./observers');\n        this.networkObservers = new NetworkObserversClass();\n      } catch (error) {\n        this.loggerProvider.warn('Failed to import or instantiate NetworkObservers:', error);\n      }\n    }\n  }\n}\n","import type { TargetingParameters } from '@amplitude/targeting';\nimport { TargetingConfig } from '../config/types';\nimport { Logger } from '@amplitude/analytics-types';\nimport { targetingIDBStore } from './targeting-idb-store';\n\nexport const evaluateTargetingAndStore = async ({\n  sessionId,\n  targetingConfig,\n  loggerProvider,\n  apiKey,\n  targetingParams,\n}: {\n  sessionId: string | number;\n  targetingConfig: TargetingConfig;\n  loggerProvider: Logger;\n  apiKey: string;\n  targetingParams?: Pick<TargetingParameters, 'event' | 'userProperties'>;\n}) => {\n  await targetingIDBStore.clearStoreOfOldSessions({\n    loggerProvider: loggerProvider,\n    apiKey: apiKey,\n    currentSessionId: sessionId,\n  });\n\n  const idbTargetingMatch = await targetingIDBStore.getTargetingMatchForSession({\n    loggerProvider: loggerProvider,\n    apiKey: apiKey,\n    sessionId: sessionId,\n  });\n  if (idbTargetingMatch === true) {\n    return true;\n  }\n\n  // If the targeting config is undefined or an empty object,\n  // assume the response was valid but no conditions were set,\n  // so all users match targeting\n  let sessionTargetingMatch = true;\n  try {\n    // Dynamic import of the targeting package\n    const { evaluateTargeting: evaluateTargetingPackage } = await import('@amplitude/targeting');\n\n    const targetingResult = await evaluateTargetingPackage({\n      ...targetingParams,\n      flag: targetingConfig,\n      sessionId: sessionId,\n      apiKey: apiKey,\n      loggerProvider: loggerProvider,\n    });\n    if (targetingResult && targetingResult.sr_targeting_config) {\n      sessionTargetingMatch = targetingResult.sr_targeting_config.key === 'on';\n    }\n\n    void targetingIDBStore.storeTargetingMatchForSession({\n      loggerProvider: loggerProvider,\n      apiKey: apiKey,\n      sessionId: sessionId,\n      targetingMatch: sessionTargetingMatch,\n    });\n  } catch (err: unknown) {\n    const knownError = err as Error;\n    loggerProvider.warn(knownError.message);\n  }\n  return sessionTargetingMatch;\n};\n","import { AnalyticsConnector } from '@amplitude/analytics-connector';\nimport { DEFAULT_INSTANCE_NAME } from './types/constants';\nexport var getAnalyticsConnector = function (instanceName) {\n    if (instanceName === void 0) { instanceName = DEFAULT_INSTANCE_NAME; }\n    return AnalyticsConnector.getInstance(instanceName);\n};\nexport var setConnectorUserId = function (userId, instanceName) {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    getAnalyticsConnector(instanceName).identityStore.editIdentity().setUserId(userId).commit();\n};\nexport var setConnectorDeviceId = function (deviceId, instanceName) {\n    getAnalyticsConnector(instanceName).identityStore.editIdentity().setDeviceId(deviceId).commit();\n};\n//# sourceMappingURL=analytics-connector.js.map"],"names":["IdentifyOperation","SpecialEventType","Status","STORAGE_PREFIX","concat","DEFAULT_INSTANCE_NAME","AMPLITUDE_SERVER_URL","LogLevel","getGlobalScope","ampIntegrationContextName","globalThis","window","self","global","returnWrapper","awaitable","promise","Promise","resolve","PREFIX","Logger","this","logLevel","None","prototype","disable","enable","Warn","log","args","_i","arguments","length","Verbose","console","join","warn","error","Error","debug","Debug","getDefaultConfig","flushMaxRetries","flushQueueSize","flushIntervalMillis","instanceName","loggerProvider","offline","optOut","serverUrl","serverZone","useBatch","Config","options","_a","_b","_c","_d","_optOut","defaultConfig","apiKey","minIdLength","plan","ingestionMetadata","undefined","storageProvider","transportProvider","serverConfig","createServerConfig","Object","defineProperty","get","set","enumerable","configurable","getServerUrl","_serverZone","includes","ApplicationContextProviderImpl","getApplicationContext","versionName","language","getLanguage","platform","os","deviceModel","navigator","languages","EventBridgeImpl","queue","logEvent","event","receiver","push","setEventReceiver","forEach","__assign","assign","t","s","i","n","p","hasOwnProperty","call","apply","__values","o","Symbol","iterator","m","next","value","done","TypeError","__read","r","e","ar","SuppressedError","isEqual","obj1","obj2","e_1","typeA","primitive_1","primitive_1_1","e_1_1","return","isArrayA","Array","isArray","isArrayB","sorted1","keys","sort","sorted2","result_1","key","entries","obj","ownProps","resArray","ServerZone","IdentityStoreImpl","identity","userProperties","listeners","Set","editIdentity","actingUserProperties","actingIdentity","setUserId","userId","setDeviceId","deviceId","setUserProperties","setOptOut","updateUserProperties","actions","e_2","e_3","actingProperties","_e","_f","action","properties","_g","_h","_j","e_2_1","_k","_l","e_3_1","commit","setIdentity","getIdentity","originalIdentity","listener","addIdentityListener","add","removeIdentityListener","delete","safeGlobal","AnalyticsConnector","identityStore","eventBridge","applicationContextProvider","getInstance","BaseTransport","send","_serverUrl","_payload","buildResponse","responseJSON","_m","_o","_p","_q","_r","_s","_t","_u","_v","_w","_x","statusCode","code","status","buildStatus","Success","body","eventsIngested","events_ingested","payloadSizeBytes","payload_size_bytes","serverUploadTime","server_upload_time","Invalid","missingField","missing_field","eventsWithInvalidFields","events_with_invalid_fields","eventsWithMissingFields","events_with_missing_fields","eventsWithInvalidIdLengths","events_with_invalid_id_lengths","epsThreshold","eps_threshold","exceededDailyQuotaDevices","exceeded_daily_quota_devices","silencedDevices","silenced_devices","silencedEvents","silenced_events","throttledDevices","throttled_devices","throttledEvents","throttled_events","PayloadTooLarge","RateLimit","throttledUsers","throttled_users","exceededDailyQuotaUsers","exceeded_daily_quota_users","Timeout","Failed","Unknown","FetchTransport","_super","__extends","payload","__awaiter","response","responseText","__generator","label","fetch","headers","Accept","JSON","stringify","method","sent","text","parse","EventType","EventType2","MouseInteractions","MouseInteractions2","TIMEOUT_MESSAGE","UNEXPECTED_ERROR_MESSAGE","RemoteConfigFetch","localConfig","configKeys","_this","retryTimeout","attempts","sessionTargetingMatch","metrics","getRemoteNamespaceConfig","configNamespace","sessionId","fetchStartTime","configAPIResponse","remoteConfig","Date","now","fetchWithTimeout","configs","fetchTimeAPISuccess","fetchTimeAPIFail","getRemoteConfig","namespaceConfig","controller","timeoutId","AbortController","setTimeout","abort","fetchRemoteConfig","signal","clearTimeout","urlParams","configKey","res","knownError","lastFetchedSessionId","completeRequest","err","aborted","trys","URLSearchParams","api_key","append","String","toString","parseAndStoreConfig","retryFetch","message","json","success","configServerUrl","STAGING","EU","createRemoteConfigFetch","DEFAULT_MASK_LEVEL","DEFAULT_EVENT_PROPERTY_PREFIX","DEFAULT_SESSION_REPLAY_PROPERTY","DEFAULT_SERVER_ZONE","US","DEFAULT_PERFORMANCE_CONFIG","enabled","SESSION_REPLAY_DEBUG_PROPERTY","MASK_TEXT_CLASS","CustomRRwebEvent","isMaskedForLevel","elementType","level","element","inputType","type","hasAttribute","toLowerCase","getInputType","autocomplete","startsWith","maskFn","config","defaultMaskLevel","closest","shouldMask","maskSelector","some","selector","shouldUnmask","unmaskSelector","isMasked","replace","generateHashCode","str","hash","charCodeAt","trackServerUrl","globToRegex","glob","escaped","RegExp","getPageUrl","pageUrl","ugcFilterRules","rule","regex","test","replacement","getStorageSize","globalScope","usage","quota","usageDetails","storage","estimate","totalStorageSize","Math","round","percentOfQuota","Number","EPSILON","getDebugConfig","debugConfig","substring","SafeLoggerProvider","constructor","logger","getSafeMethod","fn","__rrweb_original__","bind","SessionReplayLocalConfig","super","sampleRate","shouldInlineStylesheet","version","performanceConfig","storeType","applyBackgroundColorToBlockedElements","enableUrlChangePolling","urlChangePollingInterval","captureDocumentTitle","privacyConfig","interactionConfig","every","isValidGlobUrl","globUrl","trim","validateUGCFilterRules","debugMode","experimental","omitElementTags","SessionReplayJoinedConfigGenerator","remoteConfigFetch","generateJoinedConfig","captureEnabled","samplingConfig","sr_sampling_config","sr_privacy_config","targetingConfig","sr_targeting_config","sr_interaction_config","loggingConfig","sr_logging_config","joinedConfig","remotePrivacyConfig","capture_enabled","sample_rate","localPrivacyConfig","joinedPrivacyConfig","blockSelector","privacyConfigSelectorMap","selectorMap","selectorType","fragment","document","createDocumentFragment","dropInvalidSelectors","selectors","filter","querySelector","removeInvalidSelectorsFromPrivacyConfig","name","u8","Uint8Array","u16","Uint16Array","u32","Uint32Array","fleb","fdeb","clim","freb","eb","start","b","j","fl","revfl","revfd","rev","x","hMap","cd","mb","l","co","le","rvb","sv","r_1","v","flt","fdt","flm","fdm","shft","slc","subarray","wbits","d","wbits16","hTree","f","t2","slice","a","i0","i1","i2","maxSym","tr","mbt","ln","dt","lft","cst","i2_1","i2_2","i2_3","max","lc","c","cl","cli","cln","cls","w","clen","cf","wfblk","out","pos","dat","wblk","final","syms","lf","df","li","bs","bl","_a2","dlt","mlb","_b2","ddt","mdb","lclt","nlc","lcdt","ndc","lcfreq","lct","mlcb","nlcc","lm","ll","dm","dl","flen","ftlen","dtlen","llm","lcts","it","clct","len","dst","deo","dopt","opt","pre","post","st","lvl","plvl","lst","floor","msk_1","prev","head","bs1_1","ceil","bs2_1","hsh","lc_1","wi","hv","imod","pimod","rem","ch_1","dif","maxn","min","maxd","ml","nl","mmd","md","ti","lin","din","dflt","mem","zlibSync","data","opts","adler","lv","fl2","wbytes","pack","latin1","TextDecoder","decode","fromCharCode","strFromU8","TextEncoder","encode","ai","strToU8","EventCompressor","eventsManager","workerScriptInternal","taskQueue","isProcessing","compressEvent","packedEvent","addCompressedEventToManager","compressedEvent","addEvent","addCompressedEvent","worker","postMessage","terminate","canUseIdleCallback","timeout","workerScript","useWebWorker","Worker","URL","createObjectURL","Blob","onerror","onmessage","scheduleIdleProcessing","requestIdleCallback","idleDeadline","processQueue","enqueueEvent","timeRemaining","didTimeout","task","shift","STORAGE_FAILURE","VERSION","SessionReplayTrackDestination","payloadBatcher","storageKey","scheduled","sendEventsList","destinationData","addToQueue","list","context","schedule","flush","then","useRetry","later","all","map","url","location","href","getCurrentUrl","device_id","session_id","sessionReplayLibrary","events","Authorization","handleReponse","responseBody","handleSuccessResponse","handleOtherResponse","sizeOfEventsList","size","onComplete","BaseEventsStore","timeAtLastSplit","_timeAtLastSplit","minInterval","maxInterval","maxPersistedEventsSize","interval","shouldSplitEventsList","nextEventString","sizeOfNextEvent","getStringSize","getEventsArraySize","totalSize","RecordingStatus","currentSequenceKey","sequencesToSendKey","batchPromiseAll","promiseBatch","chunkSize","batch","splice","defineObjectStores","db","sequencesStore","currentSequenceStore","objectStoreNames","contains","createObjectStore","keyPath","autoIncrement","createIndex","SessionReplayEventsIDBStore","getSequencesToSend","sequences","cursor","transaction","store","openCursor","sequenceId","continue","storeCurrentSequence","currentSequenceData","put","addEventToCurrentSequence","tx","sequenceEvents","eventsToSend","updatedEvents","storeSendingEvents","cleanUpSessionEventsStore","_sessionId","transitionFromKeyValStore","keyValDb","reject","indexedDB","request","open","onupgradeneeded","result","close","deleteDatabase","onsuccess","keyValDatabaseExists","transitionCurrentSessionSequences","numericSessionId","sessionStore","currentSessionSequences","sessionSequences","promisesToBatch","numericSequenceId","parseInt","sequence","currentSequenceId","eventAddPromises","SENT","getAllRequest","objectStore","getAll","transitionPromise","storedReplaySessionContextList","target","storedReplaySessionContexts","storedSessionId","oldSessionStore","oldSessionSequences","dbSuffix","dbName","openDB","upgrade","createStore","eventsIDBStore","getCurrentSequenceEvents","allEvents","InMemoryEventsStore","finalizedSequences","resetCurrentSequence","addSequence","sequenceReturn","createEventsManager","trackDestination","getMemoryStore","new","catch","sendCurrentSequenceEvents","currentSequence","sequenceToSend","sendStoredEvents","sequencesToSend","MultiEventManager","managers","managersMap","Map","manager","promises","testableAccessors","Node","ShadowRoot","Element","MutationObserver","testableMethods","untaintedBasePrototype","getUntaintedPrototype","candidate","angularUnpatchedVersionSymbol","Zone","__symbol__","angularZoneUnpatchedAlternative","defaultPrototype","accessorNames","isUntaintedAccessors","Boolean","accessor","getOwnPropertyDescriptor","methodNames","isUntaintedMethods","iframeEl","createElement","appendChild","win","contentWindow","untaintedObject","removeChild","untaintedAccessorCache","getUntaintedAccessor","instance","cacheKey","untaintedPrototype","untaintedAccessor","untaintedMethodCache","getUntaintedMethod","untaintedMethod","index","childNodes","parentNode","parentElement","textContent","other","getRootNode","host","styleSheets","shadowRoot","querySelectorAll","mutationObserver","getWindowHeight","innerHeight","documentElement","clientHeight","getWindowWidth","innerWidth","clientWidth","rootDocument","finder","input","nodeType","ELEMENT_NODE","tagName","defaults","root","idName","_name","className","attr","_value","seedMinLength","optimizedMinLength","threshold","maxNumberOfTries","timeoutMs","rootNode","DOCUMENT_NODE","ownerDocument","findRootDocument","path","bottomUpSearch","optimized","optimize","limit","fallback","stack","current","elapsedTime","getTime","maybe","id","classNames","penalty","nth","dispensableNth","node","nthChild","findUniquePath","paths","combinations","unique","query","reduce","acc","css","elementId","getAttribute","CSS","escape","attrs","from","attributes","classList","parent","child","firstChild","nextSibling","notEmpty","scope","counter","visited","newPath","newPathKey","has","same","clickNonBatcher","clickEvents","evt","record","count","clickBatcher","reduced","curr","y","timestamp","hour","k","values","clickHook","deviceIdFn","mirror","Click","getNode","left","scrollX","top","scrollY","doc","scrollingElement","scrollLeft","pageXOffset","dom","scrollTop","pageYOffset","getWindowScroll","viewportHeight","viewportWidth","BeaconTransport","sendBeacon","sendXhr","xhr","XMLHttpRequest","setRequestHeader","basePageUrl","ScrollWatcher","transport","hook","update","_","maxScrollX","_maxScrollX","maxScrollY","_maxScrollY","maxScrollWidth","_maxScrollWidth","maxScrollHeight","_maxScrollHeight","width","height","SessionIdentifiers","sessionReplayId","generateSessionReplayId","targetingIDBStore","dbs","openOrCreateDB","getTargetingMatchForSession","sessionIdStr","targetingMatchForSession","targetingMatch","storeTargetingMatchForSession","lastUpdated","clearStoreOfOldSessions","currentSessionId","currentSessionIdStr","allTargetingMatchObjs","targetingMatchObj","amountOfTimeSinceSession","createUrlTrackingPlugin","observer","cb","pluginOptions","enablePolling","pollingInterval","lastTrackedUrl","emitUrlChange","currentUrl","currentTitle","title","createUrlChangeEvent","createHistoryMethodPatch","originalMethod","hashChangeHandler","urlChangeInterval","setInterval","clearInterval","history","originalPushState","pushState","originalReplaceState","replaceState","setupHistoryPatching","addEventListener","removeEventListener","SessionReplay","recordCancelCallback","eventCount","pageLeaveFns","recordFunction","teardownEventListeners","teardown","blurListener","focusListener","pageLeaveListener","sendEvents","recordEvents","evaluateTargetingAndCapture","targetingParams","isInit","identifiers","lastTargetingParams","eventForTargeting","event_type","evaluateTargeting","evaluateTargetingPackage","import","targetingResult","flag","evaluateTargetingAndStore","initialize","addCustomRRWebEvent","eventName","eventData","addStorageInfo","debugInfo","METADATA","storageSizeData","addCustomEvent","stopRecordingEvents","networkObservers","stop","typedError","init","_init","joinedConfigGenerator","createSessionReplayJoinedConfigGenerator","setMetadata","scrollWatcher","default","getDeviceId","scrollHook","rrwebEventManager","interactionEventManager","trackEveryNms","eventCompressor","initializeNetworkObservers","setSessionId","asyncSetSessionId","lastShouldRecordDecision","previousSessionId","deviceIdForReplayId","getSessionReplayProperties","shouldRecord","getShouldRecord","eventProperties","appHash","GET_SR_PROPS","sessionIdToSend","shouldSendStoredEvents","shouldOptOut","identityStoreOptOut","matched","hashNumber","abs","isSessionInSample","TARGETING_DECISION","getBlockSelectors","getMaskTextSelectors","getRecordingPlugins","plugins","urlTrackingPlugin","getRecordConsolePlugin","levels","getRecordFunction","shouldLogMetadata","FETCH_REQUEST","hooks","mouseInteraction","scroll","emit","RRWebEventType","Meta","inlineStylesheet","maskAllInputs","maskTextClass","blockClass","maskInputFn","maskTextFn","maskTextSelector","recordCanvas","slimDOMOptions","script","comment","errorHandler","_external_","DEBUG_INFO","metadata","getSessionId","shutdown","mapSDKType","sdkType","replaySDKVersion","standaloneSDKVersion","hashValue","replaySDKType","standaloneSDKType","network","NetworkObservers","NetworkObserversClass"],"mappings":"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"}