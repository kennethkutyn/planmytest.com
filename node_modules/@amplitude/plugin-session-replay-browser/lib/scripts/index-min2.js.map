{"version":3,"file":"index-min2.js","sources":["../../../../node_modules/@amplitude/experiment-core/dist/experiment-core.esm.js","../../../targeting/lib/esm/targeting-idb-store.js","../../../targeting/lib/esm/targeting.js","../../../targeting/lib/esm/index.js","../../../targeting/lib/esm/targeting-factory.js"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n/* global Reflect, Promise, SuppressedError, Symbol */\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n  };\n  return extendStatics(d, b);\n};\nfunction __extends(d, b) {\n  if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n  extendStatics(d, b);\n  function __() {\n    this.constructor = d;\n  }\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\nfunction __generator(thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n}\nfunction __values(o) {\n  var s = typeof Symbol === \"function\" && Symbol.iterator,\n    m = s && o[s],\n    i = 0;\n  if (m) return m.call(o);\n  if (o && typeof o.length === \"number\") return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n  throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n}\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n    r,\n    ar = [],\n    e;\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n  return ar;\n}\nfunction __spreadArray(to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n}\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\n  var e = new Error(message);\n  return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\n};\n\nvar EvaluationOperator = {\n    IS: 'is',\n    IS_NOT: 'is not',\n    CONTAINS: 'contains',\n    DOES_NOT_CONTAIN: 'does not contain',\n    LESS_THAN: 'less',\n    LESS_THAN_EQUALS: 'less or equal',\n    GREATER_THAN: 'greater',\n    GREATER_THAN_EQUALS: 'greater or equal',\n    VERSION_LESS_THAN: 'version less',\n    VERSION_LESS_THAN_EQUALS: 'version less or equal',\n    VERSION_GREATER_THAN: 'version greater',\n    VERSION_GREATER_THAN_EQUALS: 'version greater or equal',\n    SET_IS: 'set is',\n    SET_IS_NOT: 'set is not',\n    SET_CONTAINS: 'set contains',\n    SET_DOES_NOT_CONTAIN: 'set does not contain',\n    SET_CONTAINS_ANY: 'set contains any',\n    SET_DOES_NOT_CONTAIN_ANY: 'set does not contain any',\n    REGEX_MATCH: 'regex match',\n    REGEX_DOES_NOT_MATCH: 'regex does not match',\n};\n\nvar stringToUtf8ByteArray = function (str) {\n    var out = [];\n    var p = 0;\n    for (var i = 0; i < str.length; i++) {\n        var c = str.charCodeAt(i);\n        if (c < 128) {\n            out[p++] = c;\n        }\n        else if (c < 2048) {\n            out[p++] = (c >> 6) | 192;\n            out[p++] = (c & 63) | 128;\n        }\n        else if ((c & 0xfc00) == 0xd800 &&\n            i + 1 < str.length &&\n            (str.charCodeAt(i + 1) & 0xfc00) == 0xdc00) {\n            // Surrogate Pair\n            c = 0x10000 + ((c & 0x03ff) << 10) + (str.charCodeAt(++i) & 0x03ff);\n            out[p++] = (c >> 18) | 240;\n            out[p++] = ((c >> 12) & 63) | 128;\n            out[p++] = ((c >> 6) & 63) | 128;\n            out[p++] = (c & 63) | 128;\n        }\n        else {\n            out[p++] = (c >> 12) | 224;\n            out[p++] = ((c >> 6) & 63) | 128;\n            out[p++] = (c & 63) | 128;\n        }\n    }\n    return Uint8Array.from(out);\n};\n\nvar C1_32 = -0x3361d2af;\nvar C2_32 = 0x1b873593;\nvar R1_32 = 15;\nvar R2_32 = 13;\nvar M_32 = 5;\nvar N_32 = -0x19ab949c;\nvar hash32x86 = function (input, seed) {\n    if (seed === void 0) { seed = 0; }\n    var data = stringToUtf8ByteArray(input);\n    var length = data.length;\n    var nBlocks = length >> 2;\n    var hash = seed;\n    // body\n    for (var i = 0; i < nBlocks; i++) {\n        var index_1 = i << 2;\n        var k = readIntLe(data, index_1);\n        hash = mix32(k, hash);\n    }\n    // tail\n    var index = nBlocks << 2;\n    var k1 = 0;\n    switch (length - index) {\n        case 3:\n            k1 ^= data[index + 2] << 16;\n            k1 ^= data[index + 1] << 8;\n            k1 ^= data[index];\n            k1 = Math.imul(k1, C1_32);\n            k1 = rotateLeft(k1, R1_32);\n            k1 = Math.imul(k1, C2_32);\n            hash ^= k1;\n            break;\n        case 2:\n            k1 ^= data[index + 1] << 8;\n            k1 ^= data[index];\n            k1 = Math.imul(k1, C1_32);\n            k1 = rotateLeft(k1, R1_32);\n            k1 = Math.imul(k1, C2_32);\n            hash ^= k1;\n            break;\n        case 1:\n            k1 ^= data[index];\n            k1 = Math.imul(k1, C1_32);\n            k1 = rotateLeft(k1, R1_32);\n            k1 = Math.imul(k1, C2_32);\n            hash ^= k1;\n            break;\n    }\n    hash ^= length;\n    return fmix32(hash) >>> 0;\n};\nvar mix32 = function (k, hash) {\n    var kResult = k;\n    var hashResult = hash;\n    kResult = Math.imul(kResult, C1_32);\n    kResult = rotateLeft(kResult, R1_32);\n    kResult = Math.imul(kResult, C2_32);\n    hashResult ^= kResult;\n    hashResult = rotateLeft(hashResult, R2_32);\n    hashResult = Math.imul(hashResult, M_32);\n    return (hashResult + N_32) | 0;\n};\nvar fmix32 = function (hash) {\n    var hashResult = hash;\n    hashResult ^= hashResult >>> 16;\n    hashResult = Math.imul(hashResult, -0x7a143595);\n    hashResult ^= hashResult >>> 13;\n    hashResult = Math.imul(hashResult, -0x3d4d51cb);\n    hashResult ^= hashResult >>> 16;\n    return hashResult;\n};\nvar rotateLeft = function (x, n, width) {\n    if (width === void 0) { width = 32; }\n    if (n > width)\n        n = n % width;\n    var mask = (0xffffffff << (width - n)) >>> 0;\n    var r = (((x & mask) >>> 0) >>> (width - n)) >>> 0;\n    return ((x << n) | r) >>> 0;\n};\nvar readIntLe = function (data, index) {\n    if (index === void 0) { index = 0; }\n    var n = (data[index] << 24) |\n        (data[index + 1] << 16) |\n        (data[index + 2] << 8) |\n        data[index + 3];\n    return reverseBytes(n);\n};\nvar reverseBytes = function (n) {\n    return (((n & -0x1000000) >>> 24) |\n        ((n & 0x00ff0000) >>> 8) |\n        ((n & 0x0000ff00) << 8) |\n        ((n & 0x000000ff) << 24));\n};\n\nvar select = function (selectable, selector) {\n    var e_1, _a;\n    if (!selector || selector.length === 0) {\n        return undefined;\n    }\n    try {\n        for (var selector_1 = __values(selector), selector_1_1 = selector_1.next(); !selector_1_1.done; selector_1_1 = selector_1.next()) {\n            var selectorElement = selector_1_1.value;\n            if (!selectorElement || !selectable || typeof selectable !== 'object') {\n                return undefined;\n            }\n            selectable = selectable[selectorElement];\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (selector_1_1 && !selector_1_1.done && (_a = selector_1.return)) _a.call(selector_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    if (!selectable) {\n        return undefined;\n    }\n    else {\n        return selectable;\n    }\n};\n\n// major and minor should be non-negative numbers separated by a dot\nvar MAJOR_MINOR_REGEX = '(\\\\d+)\\\\.(\\\\d+)';\n// patch should be a non-negative number\nvar PATCH_REGEX = '(\\\\d+)';\n// prerelease is optional. If provided, it should be a hyphen followed by a\n// series of dot separated identifiers where an identifer can contain anything in [-0-9a-zA-Z]\nvar PRERELEASE_REGEX = '(-(([-\\\\w]+\\\\.?)*))?';\n// version pattern should be major.minor(.patchAndPreRelease) where .patchAndPreRelease is optional\nvar VERSION_PATTERN = \"^\".concat(MAJOR_MINOR_REGEX, \"(\\\\.\").concat(PATCH_REGEX).concat(PRERELEASE_REGEX, \")?$\");\nvar SemanticVersion = /** @class */ (function () {\n    function SemanticVersion(major, minor, patch, preRelease) {\n        if (preRelease === void 0) { preRelease = undefined; }\n        this.major = major;\n        this.minor = minor;\n        this.patch = patch;\n        this.preRelease = preRelease;\n    }\n    SemanticVersion.parse = function (version) {\n        if (!version) {\n            return undefined;\n        }\n        var matchGroup = new RegExp(VERSION_PATTERN).exec(version);\n        if (!matchGroup) {\n            return undefined;\n        }\n        var major = Number(matchGroup[1]);\n        var minor = Number(matchGroup[2]);\n        if (isNaN(major) || isNaN(minor)) {\n            return undefined;\n        }\n        var patch = Number(matchGroup[4]) || 0;\n        var preRelease = matchGroup[5] || undefined;\n        return new SemanticVersion(major, minor, patch, preRelease);\n    };\n    SemanticVersion.prototype.compareTo = function (other) {\n        if (this.major > other.major)\n            return 1;\n        if (this.major < other.major)\n            return -1;\n        if (this.minor > other.minor)\n            return 1;\n        if (this.minor < other.minor)\n            return -1;\n        if (this.patch > other.patch)\n            return 1;\n        if (this.patch < other.patch)\n            return -1;\n        if (this.preRelease && !other.preRelease)\n            return -1;\n        if (!this.preRelease && other.preRelease)\n            return 1;\n        if (this.preRelease && other.preRelease) {\n            if (this.preRelease > other.preRelease)\n                return 1;\n            if (this.preRelease < other.preRelease)\n                return -1;\n            return 0;\n        }\n        return 0;\n    };\n    return SemanticVersion;\n}());\n\nvar EvaluationEngine = /** @class */ (function () {\n    function EvaluationEngine() {\n    }\n    EvaluationEngine.prototype.evaluate = function (context, flags) {\n        var e_1, _a;\n        var results = {};\n        var target = {\n            context: context,\n            result: results,\n        };\n        try {\n            for (var flags_1 = __values(flags), flags_1_1 = flags_1.next(); !flags_1_1.done; flags_1_1 = flags_1.next()) {\n                var flag = flags_1_1.value;\n                // Evaluate flag and update results.\n                var variant = this.evaluateFlag(target, flag);\n                if (variant) {\n                    results[flag.key] = variant;\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (flags_1_1 && !flags_1_1.done && (_a = flags_1.return)) _a.call(flags_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        return results;\n    };\n    EvaluationEngine.prototype.evaluateFlag = function (target, flag) {\n        var e_2, _a;\n        var result;\n        try {\n            for (var _b = __values(flag.segments), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var segment = _c.value;\n                result = this.evaluateSegment(target, flag, segment);\n                if (result) {\n                    // Merge all metadata into the result\n                    var metadata = __assign(__assign(__assign({}, flag.metadata), segment.metadata), result.metadata);\n                    result = __assign(__assign({}, result), { metadata: metadata });\n                    break;\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return result;\n    };\n    EvaluationEngine.prototype.evaluateSegment = function (target, flag, segment) {\n        var e_3, _a, e_4, _b;\n        if (!segment.conditions) {\n            // Null conditions always match\n            var variantKey = this.bucket(target, segment);\n            if (variantKey !== undefined) {\n                return flag.variants[variantKey];\n            }\n            else {\n                return undefined;\n            }\n        }\n        try {\n            // Outer list logic is \"or\" (||)\n            for (var _c = __values(segment.conditions), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var conditions = _d.value;\n                var match = true;\n                try {\n                    for (var conditions_1 = (e_4 = void 0, __values(conditions)), conditions_1_1 = conditions_1.next(); !conditions_1_1.done; conditions_1_1 = conditions_1.next()) {\n                        var condition = conditions_1_1.value;\n                        match = this.matchCondition(target, condition);\n                        if (!match) {\n                            break;\n                        }\n                    }\n                }\n                catch (e_4_1) { e_4 = { error: e_4_1 }; }\n                finally {\n                    try {\n                        if (conditions_1_1 && !conditions_1_1.done && (_b = conditions_1.return)) _b.call(conditions_1);\n                    }\n                    finally { if (e_4) throw e_4.error; }\n                }\n                // On match, bucket the user.\n                if (match) {\n                    var variantKey = this.bucket(target, segment);\n                    if (variantKey !== undefined) {\n                        return flag.variants[variantKey];\n                    }\n                    else {\n                        return undefined;\n                    }\n                }\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n        return undefined;\n    };\n    EvaluationEngine.prototype.matchCondition = function (target, condition) {\n        var propValue = select(target, condition.selector);\n        // We need special matching for null properties and set type prop values\n        // and operators. All other values are matched as strings, since the\n        // filter values are always strings.\n        if (!propValue) {\n            return this.matchNull(condition.op, condition.values);\n        }\n        else if (this.isSetOperator(condition.op)) {\n            var propValueStringList = this.coerceStringArray(propValue);\n            if (!propValueStringList) {\n                return false;\n            }\n            return this.matchSet(propValueStringList, condition.op, condition.values);\n        }\n        else {\n            var propValueString = this.coerceString(propValue);\n            if (propValueString !== undefined) {\n                return this.matchString(propValueString, condition.op, condition.values);\n            }\n            else {\n                return false;\n            }\n        }\n    };\n    EvaluationEngine.prototype.getHash = function (key) {\n        return hash32x86(key);\n    };\n    EvaluationEngine.prototype.bucket = function (target, segment) {\n        var e_5, _a, e_6, _b;\n        if (!segment.bucket) {\n            // A null bucket means the segment is fully rolled out. Select the\n            // default variant.\n            return segment.variant;\n        }\n        // Select the bucketing value.\n        var bucketingValue = this.coerceString(select(target, segment.bucket.selector));\n        if (!bucketingValue || bucketingValue.length === 0) {\n            // A null or empty bucketing value cannot be bucketed. Select the\n            // default variant.\n            return segment.variant;\n        }\n        // Salt and has the value, and compute the allocation and distribution\n        // values.\n        var keyToHash = \"\".concat(segment.bucket.salt, \"/\").concat(bucketingValue);\n        var hash = this.getHash(keyToHash);\n        var allocationValue = hash % 100;\n        var distributionValue = Math.floor(hash / 100);\n        try {\n            for (var _c = __values(segment.bucket.allocations), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var allocation = _d.value;\n                var allocationStart = allocation.range[0];\n                var allocationEnd = allocation.range[1];\n                if (allocationValue >= allocationStart &&\n                    allocationValue < allocationEnd) {\n                    try {\n                        for (var _e = (e_6 = void 0, __values(allocation.distributions)), _f = _e.next(); !_f.done; _f = _e.next()) {\n                            var distribution = _f.value;\n                            var distributionStart = distribution.range[0];\n                            var distributionEnd = distribution.range[1];\n                            if (distributionValue >= distributionStart &&\n                                distributionValue < distributionEnd) {\n                                return distribution.variant;\n                            }\n                        }\n                    }\n                    catch (e_6_1) { e_6 = { error: e_6_1 }; }\n                    finally {\n                        try {\n                            if (_f && !_f.done && (_b = _e.return)) _b.call(_e);\n                        }\n                        finally { if (e_6) throw e_6.error; }\n                    }\n                }\n            }\n        }\n        catch (e_5_1) { e_5 = { error: e_5_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_5) throw e_5.error; }\n        }\n        return segment.variant;\n    };\n    EvaluationEngine.prototype.matchNull = function (op, filterValues) {\n        var containsNone = this.containsNone(filterValues);\n        switch (op) {\n            case EvaluationOperator.IS:\n            case EvaluationOperator.CONTAINS:\n            case EvaluationOperator.LESS_THAN:\n            case EvaluationOperator.LESS_THAN_EQUALS:\n            case EvaluationOperator.GREATER_THAN:\n            case EvaluationOperator.GREATER_THAN_EQUALS:\n            case EvaluationOperator.VERSION_LESS_THAN:\n            case EvaluationOperator.VERSION_LESS_THAN_EQUALS:\n            case EvaluationOperator.VERSION_GREATER_THAN:\n            case EvaluationOperator.VERSION_GREATER_THAN_EQUALS:\n            case EvaluationOperator.SET_IS:\n            case EvaluationOperator.SET_CONTAINS:\n            case EvaluationOperator.SET_CONTAINS_ANY:\n                return containsNone;\n            case EvaluationOperator.IS_NOT:\n            case EvaluationOperator.DOES_NOT_CONTAIN:\n            case EvaluationOperator.SET_DOES_NOT_CONTAIN:\n            case EvaluationOperator.SET_DOES_NOT_CONTAIN_ANY:\n                return !containsNone;\n            default:\n                return false;\n        }\n    };\n    EvaluationEngine.prototype.matchSet = function (propValues, op, filterValues) {\n        switch (op) {\n            case EvaluationOperator.SET_IS:\n                return this.setEquals(propValues, filterValues);\n            case EvaluationOperator.SET_IS_NOT:\n                return !this.setEquals(propValues, filterValues);\n            case EvaluationOperator.SET_CONTAINS:\n                return this.matchesSetContainsAll(propValues, filterValues);\n            case EvaluationOperator.SET_DOES_NOT_CONTAIN:\n                return !this.matchesSetContainsAll(propValues, filterValues);\n            case EvaluationOperator.SET_CONTAINS_ANY:\n                return this.matchesSetContainsAny(propValues, filterValues);\n            case EvaluationOperator.SET_DOES_NOT_CONTAIN_ANY:\n                return !this.matchesSetContainsAny(propValues, filterValues);\n            default:\n                return false;\n        }\n    };\n    EvaluationEngine.prototype.matchString = function (propValue, op, filterValues) {\n        var _this = this;\n        switch (op) {\n            case EvaluationOperator.IS:\n                return this.matchesIs(propValue, filterValues);\n            case EvaluationOperator.IS_NOT:\n                return !this.matchesIs(propValue, filterValues);\n            case EvaluationOperator.CONTAINS:\n                return this.matchesContains(propValue, filterValues);\n            case EvaluationOperator.DOES_NOT_CONTAIN:\n                return !this.matchesContains(propValue, filterValues);\n            case EvaluationOperator.LESS_THAN:\n            case EvaluationOperator.LESS_THAN_EQUALS:\n            case EvaluationOperator.GREATER_THAN:\n            case EvaluationOperator.GREATER_THAN_EQUALS:\n                return this.matchesComparable(propValue, op, filterValues, function (value) { return _this.parseNumber(value); }, this.comparator);\n            case EvaluationOperator.VERSION_LESS_THAN:\n            case EvaluationOperator.VERSION_LESS_THAN_EQUALS:\n            case EvaluationOperator.VERSION_GREATER_THAN:\n            case EvaluationOperator.VERSION_GREATER_THAN_EQUALS:\n                return this.matchesComparable(propValue, op, filterValues, function (value) { return SemanticVersion.parse(value); }, this.versionComparator);\n            case EvaluationOperator.REGEX_MATCH:\n                return this.matchesRegex(propValue, filterValues);\n            case EvaluationOperator.REGEX_DOES_NOT_MATCH:\n                return !this.matchesRegex(propValue, filterValues);\n            default:\n                return false;\n        }\n    };\n    EvaluationEngine.prototype.matchesIs = function (propValue, filterValues) {\n        if (this.containsBooleans(filterValues)) {\n            var lower_1 = propValue.toLowerCase();\n            if (lower_1 === 'true' || lower_1 === 'false') {\n                return filterValues.some(function (value) { return value.toLowerCase() === lower_1; });\n            }\n        }\n        return filterValues.some(function (value) { return propValue === value; });\n    };\n    EvaluationEngine.prototype.matchesContains = function (propValue, filterValues) {\n        var e_7, _a;\n        try {\n            for (var filterValues_1 = __values(filterValues), filterValues_1_1 = filterValues_1.next(); !filterValues_1_1.done; filterValues_1_1 = filterValues_1.next()) {\n                var filterValue = filterValues_1_1.value;\n                if (propValue.toLowerCase().includes(filterValue.toLowerCase())) {\n                    return true;\n                }\n            }\n        }\n        catch (e_7_1) { e_7 = { error: e_7_1 }; }\n        finally {\n            try {\n                if (filterValues_1_1 && !filterValues_1_1.done && (_a = filterValues_1.return)) _a.call(filterValues_1);\n            }\n            finally { if (e_7) throw e_7.error; }\n        }\n        return false;\n    };\n    EvaluationEngine.prototype.matchesComparable = function (propValue, op, filterValues, typeTransformer, typeComparator) {\n        var _this = this;\n        var propValueTransformed = typeTransformer(propValue);\n        var filterValuesTransformed = filterValues\n            .map(function (filterValue) {\n            return typeTransformer(filterValue);\n        })\n            .filter(function (filterValue) {\n            return filterValue !== undefined;\n        });\n        if (propValueTransformed === undefined ||\n            filterValuesTransformed.length === 0) {\n            return filterValues.some(function (filterValue) {\n                return _this.comparator(propValue, op, filterValue);\n            });\n        }\n        else {\n            return filterValuesTransformed.some(function (filterValueTransformed) {\n                return typeComparator(propValueTransformed, op, filterValueTransformed);\n            });\n        }\n    };\n    EvaluationEngine.prototype.comparator = function (propValue, op, filterValue) {\n        switch (op) {\n            case EvaluationOperator.LESS_THAN:\n            case EvaluationOperator.VERSION_LESS_THAN:\n                return propValue < filterValue;\n            case EvaluationOperator.LESS_THAN_EQUALS:\n            case EvaluationOperator.VERSION_LESS_THAN_EQUALS:\n                return propValue <= filterValue;\n            case EvaluationOperator.GREATER_THAN:\n            case EvaluationOperator.VERSION_GREATER_THAN:\n                return propValue > filterValue;\n            case EvaluationOperator.GREATER_THAN_EQUALS:\n            case EvaluationOperator.VERSION_GREATER_THAN_EQUALS:\n                return propValue >= filterValue;\n            default:\n                return false;\n        }\n    };\n    EvaluationEngine.prototype.versionComparator = function (propValue, op, filterValue) {\n        var compareTo = propValue.compareTo(filterValue);\n        switch (op) {\n            case EvaluationOperator.LESS_THAN:\n            case EvaluationOperator.VERSION_LESS_THAN:\n                return compareTo < 0;\n            case EvaluationOperator.LESS_THAN_EQUALS:\n            case EvaluationOperator.VERSION_LESS_THAN_EQUALS:\n                return compareTo <= 0;\n            case EvaluationOperator.GREATER_THAN:\n            case EvaluationOperator.VERSION_GREATER_THAN:\n                return compareTo > 0;\n            case EvaluationOperator.GREATER_THAN_EQUALS:\n            case EvaluationOperator.VERSION_GREATER_THAN_EQUALS:\n                return compareTo >= 0;\n            default:\n                return false;\n        }\n    };\n    EvaluationEngine.prototype.matchesRegex = function (propValue, filterValues) {\n        return filterValues.some(function (filterValue) {\n            return Boolean(new RegExp(filterValue).exec(propValue));\n        });\n    };\n    EvaluationEngine.prototype.containsNone = function (filterValues) {\n        return filterValues.some(function (filterValue) {\n            return filterValue === '(none)';\n        });\n    };\n    EvaluationEngine.prototype.containsBooleans = function (filterValues) {\n        return filterValues.some(function (filterValue) {\n            switch (filterValue.toLowerCase()) {\n                case 'true':\n                case 'false':\n                    return true;\n                default:\n                    return false;\n            }\n        });\n    };\n    EvaluationEngine.prototype.parseNumber = function (value) {\n        var _a;\n        return (_a = Number(value)) !== null && _a !== void 0 ? _a : undefined;\n    };\n    EvaluationEngine.prototype.coerceString = function (value) {\n        if (!value) {\n            return undefined;\n        }\n        if (typeof value === 'object') {\n            return JSON.stringify(value);\n        }\n        return String(value);\n    };\n    EvaluationEngine.prototype.coerceStringArray = function (value) {\n        var _this = this;\n        if (Array.isArray(value)) {\n            var anyArray = value;\n            return anyArray\n                .map(function (e) { return _this.coerceString(e); })\n                .filter(Boolean);\n        }\n        var stringValue = String(value);\n        try {\n            var parsedValue = JSON.parse(stringValue);\n            if (Array.isArray(parsedValue)) {\n                var anyArray = value;\n                return anyArray\n                    .map(function (e) { return _this.coerceString(e); })\n                    .filter(Boolean);\n            }\n            else {\n                return undefined;\n            }\n        }\n        catch (_a) {\n            return undefined;\n        }\n    };\n    EvaluationEngine.prototype.isSetOperator = function (op) {\n        switch (op) {\n            case EvaluationOperator.SET_IS:\n            case EvaluationOperator.SET_IS_NOT:\n            case EvaluationOperator.SET_CONTAINS:\n            case EvaluationOperator.SET_DOES_NOT_CONTAIN:\n            case EvaluationOperator.SET_CONTAINS_ANY:\n            case EvaluationOperator.SET_DOES_NOT_CONTAIN_ANY:\n                return true;\n            default:\n                return false;\n        }\n    };\n    EvaluationEngine.prototype.setEquals = function (xa, ya) {\n        var xs = new Set(xa);\n        var ys = new Set(ya);\n        return xs.size === ys.size && __spreadArray([], __read(ys), false).every(function (y) { return xs.has(y); });\n    };\n    EvaluationEngine.prototype.matchesSetContainsAll = function (propValues, filterValues) {\n        var e_8, _a;\n        if (propValues.length < filterValues.length) {\n            return false;\n        }\n        try {\n            for (var filterValues_2 = __values(filterValues), filterValues_2_1 = filterValues_2.next(); !filterValues_2_1.done; filterValues_2_1 = filterValues_2.next()) {\n                var filterValue = filterValues_2_1.value;\n                if (!this.matchesIs(filterValue, propValues)) {\n                    return false;\n                }\n            }\n        }\n        catch (e_8_1) { e_8 = { error: e_8_1 }; }\n        finally {\n            try {\n                if (filterValues_2_1 && !filterValues_2_1.done && (_a = filterValues_2.return)) _a.call(filterValues_2);\n            }\n            finally { if (e_8) throw e_8.error; }\n        }\n        return true;\n    };\n    EvaluationEngine.prototype.matchesSetContainsAny = function (propValues, filterValues) {\n        var e_9, _a;\n        try {\n            for (var filterValues_3 = __values(filterValues), filterValues_3_1 = filterValues_3.next(); !filterValues_3_1.done; filterValues_3_1 = filterValues_3.next()) {\n                var filterValue = filterValues_3_1.value;\n                if (this.matchesIs(filterValue, propValues)) {\n                    return true;\n                }\n            }\n        }\n        catch (e_9_1) { e_9 = { error: e_9_1 }; }\n        finally {\n            try {\n                if (filterValues_3_1 && !filterValues_3_1.done && (_a = filterValues_3.return)) _a.call(filterValues_3);\n            }\n            finally { if (e_9) throw e_9.error; }\n        }\n        return false;\n    };\n    return EvaluationEngine;\n}());\n\nvar topologicalSort = function (flags, flagKeys) {\n    var e_1, _a;\n    var available = __assign({}, flags);\n    var result = [];\n    var startingKeys = flagKeys || Object.keys(available);\n    try {\n        for (var startingKeys_1 = __values(startingKeys), startingKeys_1_1 = startingKeys_1.next(); !startingKeys_1_1.done; startingKeys_1_1 = startingKeys_1.next()) {\n            var flagKey = startingKeys_1_1.value;\n            var traversal = parentTraversal(flagKey, available);\n            if (traversal) {\n                result.push.apply(result, __spreadArray([], __read(traversal), false));\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (startingKeys_1_1 && !startingKeys_1_1.done && (_a = startingKeys_1.return)) _a.call(startingKeys_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    return result;\n};\nvar parentTraversal = function (flagKey, available, path) {\n    var e_2, _a;\n    if (path === void 0) { path = []; }\n    var flag = available[flagKey];\n    if (!flag) {\n        return undefined;\n    }\n    else if (!flag.dependencies || flag.dependencies.length === 0) {\n        delete available[flag.key];\n        return [flag];\n    }\n    path.push(flag.key);\n    var result = [];\n    var _loop_1 = function (parentKey) {\n        if (path.some(function (p) { return p === parentKey; })) {\n            throw Error(\"Detected a cycle between flags \".concat(path));\n        }\n        var traversal = parentTraversal(parentKey, available, path);\n        if (traversal) {\n            result.push.apply(result, __spreadArray([], __read(traversal), false));\n        }\n    };\n    try {\n        for (var _b = __values(flag.dependencies), _c = _b.next(); !_c.done; _c = _b.next()) {\n            var parentKey = _c.value;\n            _loop_1(parentKey);\n        }\n    }\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\n    finally {\n        try {\n            if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n        }\n        finally { if (e_2) throw e_2.error; }\n    }\n    result.push(flag);\n    path.pop();\n    delete available[flag.key];\n    return result;\n};\n\n/**\n *  base64.ts\n *\n *  Licensed under the BSD 3-Clause License.\n *    http://opensource.org/licenses/BSD-3-Clause\n *\n *  References:\n *    http://en.wikipedia.org/wiki/Base64\n *\n * @author Dan Kogai (https://github.com/dankogai)\n */\nconst version = '3.7.5';\n/**\n * @deprecated use lowercase `version`.\n */\nconst VERSION = version;\nconst _hasatob = typeof atob === 'function';\nconst _hasbtoa = typeof btoa === 'function';\nconst _hasBuffer = typeof Buffer === 'function';\nconst _TD = typeof TextDecoder === 'function' ? new TextDecoder() : undefined;\nconst _TE = typeof TextEncoder === 'function' ? new TextEncoder() : undefined;\nconst b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst b64chs = Array.prototype.slice.call(b64ch);\nconst b64tab = (a => {\n  let tab = {};\n  a.forEach((c, i) => tab[c] = i);\n  return tab;\n})(b64chs);\nconst b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/;\nconst _fromCC = String.fromCharCode.bind(String);\nconst _U8Afrom = typeof Uint8Array.from === 'function' ? Uint8Array.from.bind(Uint8Array) : it => new Uint8Array(Array.prototype.slice.call(it, 0));\nconst _mkUriSafe = src => src.replace(/=/g, '').replace(/[+\\/]/g, m0 => m0 == '+' ? '-' : '_');\nconst _tidyB64 = s => s.replace(/[^A-Za-z0-9\\+\\/]/g, '');\n/**\n * polyfill version of `btoa`\n */\nconst btoaPolyfill = bin => {\n  // console.log('polyfilled');\n  let u32,\n    c0,\n    c1,\n    c2,\n    asc = '';\n  const pad = bin.length % 3;\n  for (let i = 0; i < bin.length;) {\n    if ((c0 = bin.charCodeAt(i++)) > 255 || (c1 = bin.charCodeAt(i++)) > 255 || (c2 = bin.charCodeAt(i++)) > 255) throw new TypeError('invalid character found');\n    u32 = c0 << 16 | c1 << 8 | c2;\n    asc += b64chs[u32 >> 18 & 63] + b64chs[u32 >> 12 & 63] + b64chs[u32 >> 6 & 63] + b64chs[u32 & 63];\n  }\n  return pad ? asc.slice(0, pad - 3) + \"===\".substring(pad) : asc;\n};\n/**\n * does what `window.btoa` of web browsers do.\n * @param {String} bin binary string\n * @returns {string} Base64-encoded string\n */\nconst _btoa = _hasbtoa ? bin => btoa(bin) : _hasBuffer ? bin => Buffer.from(bin, 'binary').toString('base64') : btoaPolyfill;\nconst _fromUint8Array = _hasBuffer ? u8a => Buffer.from(u8a).toString('base64') : u8a => {\n  // cf. https://stackoverflow.com/questions/12710001/how-to-convert-uint8-array-to-base64-encoded-string/12713326#12713326\n  const maxargs = 0x1000;\n  let strs = [];\n  for (let i = 0, l = u8a.length; i < l; i += maxargs) {\n    strs.push(_fromCC.apply(null, u8a.subarray(i, i + maxargs)));\n  }\n  return _btoa(strs.join(''));\n};\n/**\n * converts a Uint8Array to a Base64 string.\n * @param {boolean} [urlsafe] URL-and-filename-safe a la RFC4648 ยง5\n * @returns {string} Base64 string\n */\nconst fromUint8Array = (u8a, urlsafe = false) => urlsafe ? _mkUriSafe(_fromUint8Array(u8a)) : _fromUint8Array(u8a);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const utob = (src: string) => unescape(encodeURIComponent(src));\n// reverting good old fationed regexp\nconst cb_utob = c => {\n  if (c.length < 2) {\n    var cc = c.charCodeAt(0);\n    return cc < 0x80 ? c : cc < 0x800 ? _fromCC(0xc0 | cc >>> 6) + _fromCC(0x80 | cc & 0x3f) : _fromCC(0xe0 | cc >>> 12 & 0x0f) + _fromCC(0x80 | cc >>> 6 & 0x3f) + _fromCC(0x80 | cc & 0x3f);\n  } else {\n    var cc = 0x10000 + (c.charCodeAt(0) - 0xD800) * 0x400 + (c.charCodeAt(1) - 0xDC00);\n    return _fromCC(0xf0 | cc >>> 18 & 0x07) + _fromCC(0x80 | cc >>> 12 & 0x3f) + _fromCC(0x80 | cc >>> 6 & 0x3f) + _fromCC(0x80 | cc & 0x3f);\n  }\n};\nconst re_utob = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g;\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-8 string\n * @returns {string} UTF-16 string\n */\nconst utob = u => u.replace(re_utob, cb_utob);\n//\nconst _encode = _hasBuffer ? s => Buffer.from(s, 'utf8').toString('base64') : _TE ? s => _fromUint8Array(_TE.encode(s)) : s => _btoa(utob(s));\n/**\n * converts a UTF-8-encoded string to a Base64 string.\n * @param {boolean} [urlsafe] if `true` make the result URL-safe\n * @returns {string} Base64 string\n */\nconst encode = (src, urlsafe = false) => urlsafe ? _mkUriSafe(_encode(src)) : _encode(src);\n/**\n * converts a UTF-8-encoded string to URL-safe Base64 RFC4648 ยง5.\n * @returns {string} Base64 string\n */\nconst encodeURI = src => encode(src, true);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const btou = (src: string) => decodeURIComponent(escape(src));\n// reverting good old fationed regexp\nconst re_btou = /[\\xC0-\\xDF][\\x80-\\xBF]|[\\xE0-\\xEF][\\x80-\\xBF]{2}|[\\xF0-\\xF7][\\x80-\\xBF]{3}/g;\nconst cb_btou = cccc => {\n  switch (cccc.length) {\n    case 4:\n      var cp = (0x07 & cccc.charCodeAt(0)) << 18 | (0x3f & cccc.charCodeAt(1)) << 12 | (0x3f & cccc.charCodeAt(2)) << 6 | 0x3f & cccc.charCodeAt(3),\n        offset = cp - 0x10000;\n      return _fromCC((offset >>> 10) + 0xD800) + _fromCC((offset & 0x3FF) + 0xDC00);\n    case 3:\n      return _fromCC((0x0f & cccc.charCodeAt(0)) << 12 | (0x3f & cccc.charCodeAt(1)) << 6 | 0x3f & cccc.charCodeAt(2));\n    default:\n      return _fromCC((0x1f & cccc.charCodeAt(0)) << 6 | 0x3f & cccc.charCodeAt(1));\n  }\n};\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-16 string\n * @returns {string} UTF-8 string\n */\nconst btou = b => b.replace(re_btou, cb_btou);\n/**\n * polyfill version of `atob`\n */\nconst atobPolyfill = asc => {\n  // console.log('polyfilled');\n  asc = asc.replace(/\\s+/g, '');\n  if (!b64re.test(asc)) throw new TypeError('malformed base64.');\n  asc += '=='.slice(2 - (asc.length & 3));\n  let u24,\n    bin = '',\n    r1,\n    r2;\n  for (let i = 0; i < asc.length;) {\n    u24 = b64tab[asc.charAt(i++)] << 18 | b64tab[asc.charAt(i++)] << 12 | (r1 = b64tab[asc.charAt(i++)]) << 6 | (r2 = b64tab[asc.charAt(i++)]);\n    bin += r1 === 64 ? _fromCC(u24 >> 16 & 255) : r2 === 64 ? _fromCC(u24 >> 16 & 255, u24 >> 8 & 255) : _fromCC(u24 >> 16 & 255, u24 >> 8 & 255, u24 & 255);\n  }\n  return bin;\n};\n/**\n * does what `window.atob` of web browsers do.\n * @param {String} asc Base64-encoded string\n * @returns {string} binary string\n */\nconst _atob = _hasatob ? asc => atob(_tidyB64(asc)) : _hasBuffer ? asc => Buffer.from(asc, 'base64').toString('binary') : atobPolyfill;\n//\nconst _toUint8Array = _hasBuffer ? a => _U8Afrom(Buffer.from(a, 'base64')) : a => _U8Afrom(_atob(a).split('').map(c => c.charCodeAt(0)));\n/**\n * converts a Base64 string to a Uint8Array.\n */\nconst toUint8Array = a => _toUint8Array(_unURI(a));\n//\nconst _decode = _hasBuffer ? a => Buffer.from(a, 'base64').toString('utf8') : _TD ? a => _TD.decode(_toUint8Array(a)) : a => btou(_atob(a));\nconst _unURI = a => _tidyB64(a.replace(/[-_]/g, m0 => m0 == '-' ? '+' : '/'));\n/**\n * converts a Base64 string to a UTF-8 string.\n * @param {String} src Base64 string.  Both normal and URL-safe are supported\n * @returns {string} UTF-8 string\n */\nconst decode = src => _decode(_unURI(src));\n/**\n * check if a value is a valid Base64 string\n * @param {String} src a value to check\n  */\nconst isValid = src => {\n  if (typeof src !== 'string') return false;\n  const s = src.replace(/\\s+/g, '').replace(/={0,2}$/, '');\n  return !/[^\\s0-9a-zA-Z\\+/]/.test(s) || !/[^\\s0-9a-zA-Z\\-_]/.test(s);\n};\n//\nconst _noEnum = v => {\n  return {\n    value: v,\n    enumerable: false,\n    writable: true,\n    configurable: true\n  };\n};\n/**\n * extend String.prototype with relevant methods\n */\nconst extendString = function () {\n  const _add = (name, body) => Object.defineProperty(String.prototype, name, _noEnum(body));\n  _add('fromBase64', function () {\n    return decode(this);\n  });\n  _add('toBase64', function (urlsafe) {\n    return encode(this, urlsafe);\n  });\n  _add('toBase64URI', function () {\n    return encode(this, true);\n  });\n  _add('toBase64URL', function () {\n    return encode(this, true);\n  });\n  _add('toUint8Array', function () {\n    return toUint8Array(this);\n  });\n};\n/**\n * extend Uint8Array.prototype with relevant methods\n */\nconst extendUint8Array = function () {\n  const _add = (name, body) => Object.defineProperty(Uint8Array.prototype, name, _noEnum(body));\n  _add('toBase64', function (urlsafe) {\n    return fromUint8Array(this, urlsafe);\n  });\n  _add('toBase64URI', function () {\n    return fromUint8Array(this, true);\n  });\n  _add('toBase64URL', function () {\n    return fromUint8Array(this, true);\n  });\n};\n/**\n * extend Builtin prototypes with relevant methods\n */\nconst extendBuiltins = () => {\n  extendString();\n  extendUint8Array();\n};\nconst gBase64 = {\n  version: version,\n  VERSION: VERSION,\n  atob: _atob,\n  atobPolyfill: atobPolyfill,\n  btoa: _btoa,\n  btoaPolyfill: btoaPolyfill,\n  fromBase64: decode,\n  toBase64: encode,\n  encode: encode,\n  encodeURI: encodeURI,\n  encodeURL: encodeURI,\n  utob: utob,\n  btou: btou,\n  decode: decode,\n  isValid: isValid,\n  fromUint8Array: fromUint8Array,\n  toUint8Array: toUint8Array,\n  extendString: extendString,\n  extendUint8Array: extendUint8Array,\n  extendBuiltins: extendBuiltins\n};\n\nvar FetchError = /** @class */ (function (_super) {\n    __extends(FetchError, _super);\n    function FetchError(statusCode, message) {\n        var _this = _super.call(this, message) || this;\n        _this.statusCode = statusCode;\n        Object.setPrototypeOf(_this, FetchError.prototype);\n        return _this;\n    }\n    return FetchError;\n}(Error));\n\nvar SdkEvaluationApi = /** @class */ (function () {\n    function SdkEvaluationApi(deploymentKey, serverUrl, httpClient) {\n        this.deploymentKey = deploymentKey;\n        this.serverUrl = serverUrl;\n        this.httpClient = httpClient;\n    }\n    SdkEvaluationApi.prototype.getVariants = function (user, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var userJsonBase64, headers, response;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        userJsonBase64 = gBase64.encodeURL(JSON.stringify(user));\n                        headers = {\n                            Authorization: \"Api-Key \".concat(this.deploymentKey),\n                            'X-Amp-Exp-User': userJsonBase64,\n                        };\n                        if (options === null || options === void 0 ? void 0 : options.flagKeys) {\n                            headers['X-Amp-Exp-Flag-Keys'] = gBase64.encodeURL(JSON.stringify(options.flagKeys));\n                        }\n                        if (options === null || options === void 0 ? void 0 : options.trackingOption) {\n                            headers['X-Amp-Exp-Track'] = options.trackingOption;\n                        }\n                        return [4 /*yield*/, this.httpClient.request({\n                                requestUrl: \"\".concat(this.serverUrl, \"/sdk/v2/vardata?v=0\"),\n                                method: 'GET',\n                                headers: headers,\n                                timeoutMillis: options === null || options === void 0 ? void 0 : options.timeoutMillis,\n                            })];\n                    case 1:\n                        response = _a.sent();\n                        if (response.status != 200) {\n                            throw new FetchError(response.status, \"Fetch error response: status=\".concat(response.status));\n                        }\n                        return [2 /*return*/, JSON.parse(response.body)];\n                }\n            });\n        });\n    };\n    return SdkEvaluationApi;\n}());\n\nvar SdkFlagApi = /** @class */ (function () {\n    function SdkFlagApi(deploymentKey, serverUrl, httpClient) {\n        this.deploymentKey = deploymentKey;\n        this.serverUrl = serverUrl;\n        this.httpClient = httpClient;\n    }\n    SdkFlagApi.prototype.getFlags = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var headers, response, flagsArray;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        headers = {\n                            Authorization: \"Api-Key \".concat(this.deploymentKey),\n                        };\n                        if ((options === null || options === void 0 ? void 0 : options.libraryName) && (options === null || options === void 0 ? void 0 : options.libraryVersion)) {\n                            headers['X-Amp-Exp-Library'] = \"\".concat(options.libraryName, \"/\").concat(options.libraryVersion);\n                        }\n                        return [4 /*yield*/, this.httpClient.request({\n                                requestUrl: \"\".concat(this.serverUrl, \"/sdk/v2/flags\"),\n                                method: 'GET',\n                                headers: headers,\n                                timeoutMillis: options === null || options === void 0 ? void 0 : options.timeoutMillis,\n                            })];\n                    case 1:\n                        response = _a.sent();\n                        if (response.status != 200) {\n                            throw Error(\"Flags error response: status=\".concat(response.status));\n                        }\n                        flagsArray = JSON.parse(response.body);\n                        return [2 /*return*/, flagsArray.reduce(function (map, flag) {\n                                map[flag.key] = flag;\n                                return map;\n                            }, {})];\n                }\n            });\n        });\n    };\n    return SdkFlagApi;\n}());\n\nvar safeGlobal = typeof globalThis !== 'undefined' ? globalThis : global || self;\n\nvar Poller = /** @class */ (function () {\n    function Poller(action, ms) {\n        this.poller = undefined;\n        this.action = action;\n        this.ms = ms;\n    }\n    Poller.prototype.start = function () {\n        if (this.poller) {\n            return;\n        }\n        this.poller = safeGlobal.setInterval(this.action, this.ms);\n        void this.action();\n    };\n    Poller.prototype.stop = function () {\n        if (!this.poller) {\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        safeGlobal.clearInterval(this.poller);\n        this.poller = undefined;\n    };\n    return Poller;\n}());\n\nexport { EvaluationEngine, EvaluationOperator, FetchError, Poller, SdkEvaluationApi, SdkFlagApi, safeGlobal, topologicalSort };\n","import { __assign, __awaiter, __generator } from \"tslib\";\nimport { openDB } from 'idb';\nexport var MAX_IDB_STORAGE_LENGTH = 1000 * 60 * 60 * 24 * 2; // 2 days\nvar TargetingIDBStore = /** @class */ (function () {\n    function TargetingIDBStore() {\n        var _this = this;\n        this.dbs = {};\n        this.createStore = function (dbName) { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, openDB(dbName, 1, {\n                            upgrade: function (db) {\n                                if (!db.objectStoreNames.contains('eventTypesForSession')) {\n                                    db.createObjectStore('eventTypesForSession', {\n                                        keyPath: 'sessionId',\n                                    });\n                                }\n                            },\n                        })];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        }); };\n        this.openOrCreateDB = function (apiKey) { return __awaiter(_this, void 0, void 0, function () {\n            var dbName, db;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (this.dbs && this.dbs[apiKey]) {\n                            return [2 /*return*/, this.dbs[apiKey]];\n                        }\n                        dbName = \"\".concat(apiKey.substring(0, 10), \"_amp_targeting\");\n                        return [4 /*yield*/, this.createStore(dbName)];\n                    case 1:\n                        db = _a.sent();\n                        this.dbs[apiKey] = db;\n                        return [2 /*return*/, db];\n                }\n            });\n        }); };\n        this.updateEventListForSession = function (_a) {\n            var sessionId = _a.sessionId, eventType = _a.eventType, eventTime = _a.eventTime, loggerProvider = _a.loggerProvider, tx = _a.tx;\n            return __awaiter(_this, void 0, void 0, function () {\n                var sessionIdStr, sessionData, eventTypes, eventTypeStore, updatedEventTypes, updatedSessionData, e_1;\n                var _b, _c;\n                return __generator(this, function (_d) {\n                    switch (_d.label) {\n                        case 0:\n                            _d.trys.push([0, 3, , 4]);\n                            sessionIdStr = String(sessionId);\n                            return [4 /*yield*/, tx.store.get(sessionIdStr)];\n                        case 1:\n                            sessionData = _d.sent();\n                            eventTypes = sessionData ? sessionData.eventTypes : {};\n                            eventTypeStore = eventTypes[eventType] || {};\n                            updatedEventTypes = __assign(__assign({}, eventTypes), (_b = {}, _b[eventType] = __assign(__assign({}, eventTypeStore), (_c = {}, _c[eventTime] = { event_type: eventType }, _c)), _b));\n                            updatedSessionData = {\n                                sessionId: sessionIdStr,\n                                eventTypes: updatedEventTypes,\n                                lastUpdated: Date.now(),\n                            };\n                            return [4 /*yield*/, tx.store.put(updatedSessionData)];\n                        case 2:\n                            _d.sent();\n                            return [2 /*return*/, updatedEventTypes];\n                        case 3:\n                            e_1 = _d.sent();\n                            loggerProvider.warn(\"Failed to store events for targeting \".concat(sessionId, \": \").concat(e_1));\n                            return [3 /*break*/, 4];\n                        case 4: return [2 /*return*/, undefined];\n                    }\n                });\n            });\n        };\n        this.deleteOldSessionEventTypes = function (_a) {\n            var currentSessionId = _a.currentSessionId, loggerProvider = _a.loggerProvider, tx = _a.tx;\n            return __awaiter(_this, void 0, void 0, function () {\n                var currentSessionIdStr, allSessions, i, session, amountOfTimeSinceSession, e_2;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            _b.trys.push([0, 6, , 7]);\n                            currentSessionIdStr = String(currentSessionId);\n                            return [4 /*yield*/, tx.store.getAll()];\n                        case 1:\n                            allSessions = _b.sent();\n                            i = 0;\n                            _b.label = 2;\n                        case 2:\n                            if (!(i < allSessions.length)) return [3 /*break*/, 5];\n                            session = allSessions[i];\n                            amountOfTimeSinceSession = Date.now() - session.lastUpdated;\n                            if (!(session.sessionId !== currentSessionIdStr && amountOfTimeSinceSession > MAX_IDB_STORAGE_LENGTH)) return [3 /*break*/, 4];\n                            return [4 /*yield*/, tx.store.delete(session.sessionId)];\n                        case 3:\n                            _b.sent();\n                            _b.label = 4;\n                        case 4:\n                            i++;\n                            return [3 /*break*/, 2];\n                        case 5: return [3 /*break*/, 7];\n                        case 6:\n                            e_2 = _b.sent();\n                            loggerProvider.warn(\"Failed to clear old session event types for targeting: \".concat(e_2));\n                            return [3 /*break*/, 7];\n                        case 7: return [2 /*return*/];\n                    }\n                });\n            });\n        };\n        this.storeEventTypeForSession = function (_a) {\n            var loggerProvider = _a.loggerProvider, sessionId = _a.sessionId, eventType = _a.eventType, eventTime = _a.eventTime, apiKey = _a.apiKey;\n            return __awaiter(_this, void 0, void 0, function () {\n                var db, tx, updatedEventTypes, e_3;\n                return __generator(this, function (_b) {\n                    switch (_b.label) {\n                        case 0:\n                            _b.trys.push([0, 5, , 6]);\n                            return [4 /*yield*/, this.openOrCreateDB(apiKey)];\n                        case 1:\n                            db = _b.sent();\n                            tx = db.transaction('eventTypesForSession', 'readwrite');\n                            if (!tx) {\n                                return [2 /*return*/];\n                            }\n                            return [4 /*yield*/, this.updateEventListForSession({\n                                    sessionId: sessionId,\n                                    tx: tx,\n                                    loggerProvider: loggerProvider,\n                                    eventType: eventType,\n                                    eventTime: eventTime,\n                                })];\n                        case 2:\n                            updatedEventTypes = _b.sent();\n                            // Clear out sessions older than 2 days\n                            return [4 /*yield*/, this.deleteOldSessionEventTypes({ currentSessionId: sessionId, tx: tx, loggerProvider: loggerProvider })];\n                        case 3:\n                            // Clear out sessions older than 2 days\n                            _b.sent();\n                            return [4 /*yield*/, tx.done];\n                        case 4:\n                            _b.sent();\n                            return [2 /*return*/, updatedEventTypes];\n                        case 5:\n                            e_3 = _b.sent();\n                            loggerProvider.warn(\"Failed to store events for targeting \".concat(sessionId, \": \").concat(e_3));\n                            return [3 /*break*/, 6];\n                        case 6: return [2 /*return*/, undefined];\n                    }\n                });\n            });\n        };\n    }\n    return TargetingIDBStore;\n}());\nexport { TargetingIDBStore };\nexport var targetingIDBStore = new TargetingIDBStore();\n//# sourceMappingURL=targeting-idb-store.js.map","import { __awaiter, __generator } from \"tslib\";\nimport { EvaluationEngine } from '@amplitude/experiment-core';\nimport { targetingIDBStore } from './targeting-idb-store';\nvar Targeting = /** @class */ (function () {\n    function Targeting() {\n        var _this = this;\n        this.evaluateTargeting = function (_a) {\n            var apiKey = _a.apiKey, loggerProvider = _a.loggerProvider, event = _a.event, sessionId = _a.sessionId, userProperties = _a.userProperties, deviceId = _a.deviceId, flag = _a.flag;\n            return __awaiter(_this, void 0, void 0, function () {\n                var eventTypes, _b, eventStrings, context, targetingBucket;\n                return __generator(this, function (_c) {\n                    switch (_c.label) {\n                        case 0:\n                            if (!(event && event.time)) return [3 /*break*/, 2];\n                            return [4 /*yield*/, targetingIDBStore.storeEventTypeForSession({\n                                    loggerProvider: loggerProvider,\n                                    apiKey: apiKey,\n                                    sessionId: sessionId,\n                                    eventType: event.event_type,\n                                    eventTime: event.time,\n                                })];\n                        case 1:\n                            _b = _c.sent();\n                            return [3 /*break*/, 3];\n                        case 2:\n                            _b = undefined;\n                            _c.label = 3;\n                        case 3:\n                            eventTypes = _b;\n                            eventStrings = eventTypes && new Set(Object.keys(eventTypes));\n                            context = {\n                                session_id: sessionId,\n                                event: event,\n                                event_types: eventStrings && Array.from(eventStrings),\n                                user: {\n                                    device_id: deviceId,\n                                    user_properties: userProperties,\n                                },\n                            };\n                            targetingBucket = this.evaluationEngine.evaluate(context, [flag]);\n                            return [2 /*return*/, targetingBucket];\n                    }\n                });\n            });\n        };\n        this.evaluationEngine = new EvaluationEngine();\n    }\n    return Targeting;\n}());\nexport { Targeting };\n//# sourceMappingURL=targeting.js.map","import targeting from './targeting-factory';\nexport var evaluateTargeting = targeting.evaluateTargeting;\n//# sourceMappingURL=index.js.map","import { Targeting } from './targeting';\nvar createInstance = function () {\n    var targeting = new Targeting();\n    return {\n        evaluateTargeting: targeting.evaluateTargeting.bind(targeting),\n    };\n};\nexport default createInstance();\n//# sourceMappingURL=targeting-factory.js.map"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","__assign","assign","t","s","i","n","arguments","length","apply","this","__values","o","Symbol","iterator","m","next","value","done","TypeError","SuppressedError","EvaluationOperator","C1_32","C2_32","hash32x86","input","seed","data","str","out","c","charCodeAt","Uint8Array","from","stringToUtf8ByteArray","nBlocks","hash","k","readIntLe","mix32","index","k1","Math","imul","rotateLeft","fmix32","kResult","hashResult","x","width","reverseBytes","select","selectable","selector","e_1","_a","selector_1","selector_1_1","selectorElement","e_1_1","error","return","VERSION_PATTERN","concat","SemanticVersion","major","minor","patch","preRelease","undefined","parse","version","matchGroup","RegExp","exec","Number","isNaN","compareTo","other","EvaluationEngine","evaluate","context","flags","results","target","result","flags_1","flags_1_1","flag","variant","evaluateFlag","key","e_2","_b","segments","_c","segment","evaluateSegment","metadata","e_2_1","e_3","e_4","conditions","variantKey","bucket","variants","_d","match","conditions_1","conditions_1_1","condition","matchCondition","e_4_1","e_3_1","propValue","isSetOperator","op","propValueStringList","coerceStringArray","matchSet","values","propValueString","coerceString","matchString","matchNull","getHash","e_5","e_6","bucketingValue","keyToHash","salt","allocationValue","distributionValue","floor","allocations","allocation","allocationStart","range","allocationEnd","_e","distributions","_f","distribution","distributionStart","distributionEnd","e_6_1","e_5_1","filterValues","containsNone","propValues","setEquals","matchesSetContainsAll","matchesSetContainsAny","_this","matchesIs","matchesContains","matchesComparable","parseNumber","comparator","versionComparator","matchesRegex","containsBooleans","lower_1","toLowerCase","some","e_7","filterValues_1","filterValues_1_1","filterValue","includes","e_7_1","typeTransformer","typeComparator","propValueTransformed","filterValuesTransformed","map","filter","filterValueTransformed","Boolean","JSON","stringify","String","isArray","e","stringValue","parsedValue","xa","ya","xs","Set","ys","size","to","pack","ar","l","slice","__spreadArray","r","push","__read","every","y","has","e_8","filterValues_2","filterValues_2_1","e_8_1","e_9","filterValues_3","filterValues_3_1","e_9_1","TextDecoder","TextEncoder","b64chs","tab","forEach","fromCharCode","bind","_super","FetchError","statusCode","message","__","constructor","create","__extends","Error","targetingIDBStore","dbs","createStore","dbName","__awaiter","__generator","label","openDB","upgrade","db","objectStoreNames","contains","createObjectStore","keyPath","sent","openOrCreateDB","apiKey","substring","updateEventListForSession","sessionId","eventType","eventTime","loggerProvider","tx","sessionIdStr","sessionData","eventTypes","eventTypeStore","updatedEventTypes","updatedSessionData","trys","store","get","event_type","lastUpdated","Date","now","put","warn","deleteOldSessionEventTypes","currentSessionId","currentSessionIdStr","allSessions","session","amountOfTimeSinceSession","getAll","delete","storeEventTypeForSession","transaction","Targeting","evaluateTargeting","event","userProperties","deviceId","eventStrings","time","keys","session_id","event_types","user","device_id","user_properties","evaluationEngine","targeting","createInstance"],"mappings":"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"}