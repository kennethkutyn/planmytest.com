var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n,r,o=function(){return o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},o.apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}function a(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function c(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError,function(e){e.SET="$set",e.SET_ONCE="$setOnce",e.ADD="$add",e.APPEND="$append",e.PREPEND="$prepend",e.REMOVE="$remove",e.PREINSERT="$preInsert",e.POSTINSERT="$postInsert",e.UNSET="$unset",e.CLEAR_ALL="$clearAll"}(n||(n={})),function(e){e.IDENTIFY="$identify",e.GROUP_IDENTIFY="$groupidentify",e.REVENUE="revenue_amount"}(r||(r={}));var l,d="".concat("AMP","_unsent"),f="$default_instance",v="https://api2.amplitude.com/2/httpapi";!function(e){e.Unknown="unknown",e.Skipped="skipped",e.Success="success",e.RateLimit="rate_limit",e.PayloadTooLarge="payload_too_large",e.Invalid="invalid",e.Failed="failed",e.Timeout="Timeout",e.SystemError="SystemError"}(l||(l={}));var h,g=function(){var e="ampIntegrationContext";return"undefined"!=typeof globalThis&&void 0!==globalThis[e]?globalThis[e]:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:void 0},p=function(e){return{promise:e||Promise.resolve()}};!function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Verbose=3]="Verbose",e[e.Debug=4]="Debug"}(h||(h={}));var y="Amplitude Logger ",m=function(){function e(){this.logLevel=h.None}return e.prototype.disable=function(){this.logLevel=h.None},e.prototype.enable=function(e){void 0===e&&(e=h.Warn),this.logLevel=e},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logLevel<h.Verbose||console.log("".concat(y,"[Log]: ").concat(e.join(" ")))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logLevel<h.Warn||console.warn("".concat(y,"[Warn]: ").concat(e.join(" ")))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logLevel<h.Error||console.error("".concat(y,"[Error]: ").concat(e.join(" ")))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.logLevel<h.Debug||console.log("".concat(y,"[Debug]: ").concat(e.join(" ")))},e}(),b=function(){return{flushMaxRetries:12,flushQueueSize:200,flushIntervalMillis:1e4,instanceName:f,logLevel:h.Warn,loggerProvider:new m,offline:!1,optOut:!1,serverUrl:v,serverZone:"US",useBatch:!1}},S=function(){function e(e){var t,n,r,o;this._optOut=!1;var i=b();this.apiKey=e.apiKey,this.flushIntervalMillis=null!==(t=e.flushIntervalMillis)&&void 0!==t?t:i.flushIntervalMillis,this.flushMaxRetries=e.flushMaxRetries||i.flushMaxRetries,this.flushQueueSize=e.flushQueueSize||i.flushQueueSize,this.instanceName=e.instanceName||i.instanceName,this.loggerProvider=e.loggerProvider||i.loggerProvider,this.logLevel=null!==(n=e.logLevel)&&void 0!==n?n:i.logLevel,this.minIdLength=e.minIdLength,this.plan=e.plan,this.ingestionMetadata=e.ingestionMetadata,this.offline=void 0!==e.offline?e.offline:i.offline,this.optOut=null!==(r=e.optOut)&&void 0!==r?r:i.optOut,this.serverUrl=e.serverUrl,this.serverZone=e.serverZone||i.serverZone,this.storageProvider=e.storageProvider,this.transportProvider=e.transportProvider,this.useBatch=null!==(o=e.useBatch)&&void 0!==o?o:i.useBatch,this.loggerProvider.enable(this.logLevel);var s=I(e.serverUrl,e.serverZone,e.useBatch);this.serverZone=s.serverZone,this.serverUrl=s.serverUrl}return Object.defineProperty(e.prototype,"optOut",{get:function(){return this._optOut},set:function(e){this._optOut=e},enumerable:!1,configurable:!0}),e}(),w=function(e,t){return"EU"===e?t?"https://api.eu.amplitude.com/batch":"https://api.eu.amplitude.com/2/httpapi":t?"https://api2.amplitude.com/batch":v},I=function(e,t,n){if(void 0===e&&(e=""),void 0===t&&(t=b().serverZone),void 0===n&&(n=b().useBatch),e)return{serverUrl:e,serverZone:void 0};var r=["US","EU"].includes(t)?t:b().serverZone;return{serverZone:r,serverUrl:w(r,n)}},E=function(){function e(){}return e.prototype.getApplicationContext=function(){return{versionName:this.versionName,language:C(),platform:"Web",os:void 0,deviceModel:void 0}},e}(),C=function(){return"undefined"!=typeof navigator&&(navigator.languages&&navigator.languages[0]||navigator.language)||""},P=function(){function e(){this.queue=[]}return e.prototype.logEvent=function(e){this.receiver?this.receiver(e):this.queue.length<512&&this.queue.push(e)},e.prototype.setEventReceiver=function(e){this.receiver=e,this.queue.length>0&&(this.queue.forEach((function(t){e(t)})),this.queue=[])},e}(),T=function(){return T=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},T.apply(this,arguments)};function R(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}"function"==typeof SuppressedError&&SuppressedError;var k=function(e,t){var n,r,o=typeof e;if(o!==typeof t)return!1;try{for(var i=R(["string","number","boolean","undefined"]),s=i.next();!s.done;s=i.next()){if(s.value===o)return e===t}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}if(null==e&&null==t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;var a=Array.isArray(e),u=Array.isArray(t);if(a!==u)return!1;if(!a||!u){var c=Object.keys(e).sort(),l=Object.keys(t).sort();if(!k(c,l))return!1;var d=!0;return Object.keys(e).forEach((function(n){k(e[n],t[n])||(d=!1)})),d}for(var f=0;f<e.length;f++)if(!k(e[f],t[f]))return!1;return!0};Object.entries||(Object.entries=function(e){for(var t=Object.keys(e),n=t.length,r=new Array(n);n--;)r[n]=[t[n],e[t[n]]];return r});var x,O=function(){function e(){this.identity={userProperties:{}},this.listeners=new Set}return e.prototype.editIdentity=function(){var e=this,t=T({},this.identity.userProperties),n=T(T({},this.identity),{userProperties:t});return{setUserId:function(e){return n.userId=e,this},setDeviceId:function(e){return n.deviceId=e,this},setUserProperties:function(e){return n.userProperties=e,this},setOptOut:function(e){return n.optOut=e,this},updateUserProperties:function(e){var t,r,o,i,s,a,u=n.userProperties||{};try{for(var c=R(Object.entries(e)),l=c.next();!l.done;l=c.next()){var d=_(l.value,2),f=d[0],v=d[1];switch(f){case"$set":try{for(var h=(o=void 0,R(Object.entries(v))),g=h.next();!g.done;g=h.next()){var p=_(g.value,2),y=p[0],m=p[1];u[y]=m}}catch(e){o={error:e}}finally{try{g&&!g.done&&(i=h.return)&&i.call(h)}finally{if(o)throw o.error}}break;case"$unset":try{for(var b=(s=void 0,R(Object.keys(v))),S=b.next();!S.done;S=b.next()){delete u[y=S.value]}}catch(e){s={error:e}}finally{try{S&&!S.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}break;case"$clearAll":u={}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return n.userProperties=u,this},commit:function(){return e.setIdentity(n),this}}},e.prototype.getIdentity=function(){return T({},this.identity)},e.prototype.setIdentity=function(e){var t=T({},this.identity);this.identity=T({},e),k(t,this.identity)||this.listeners.forEach((function(t){t(e)}))},e.prototype.addIdentityListener=function(e){this.listeners.add(e)},e.prototype.removeIdentityListener=function(e){this.listeners.delete(e)},e}(),M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:self,D=function(){function e(){this.identityStore=new O,this.eventBridge=new P,this.applicationContextProvider=new E}return e.getInstance=function(t){return M.analyticsConnectorInstances||(M.analyticsConnectorInstances={}),M.analyticsConnectorInstances[t]||(M.analyticsConnectorInstances[t]=new e),M.analyticsConnectorInstances[t]},e}(),q=function(e,t,n,r,o){return void 0===o&&(o=null),function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];var a=n(),u=a.logger,c=a.logLevel;if(c&&c<h.Debug||!c||!u)return e.apply(o,i);var l,d={type:"invoke public method",name:t,args:i,stacktrace:(l=1,void 0===l&&(l=0),((new Error).stack||"").split("\n").slice(2+l).map((function(e){return e.trim()}))),time:{start:(new Date).toISOString()},states:{}};r&&d.states&&(d.states.before=r());var f=e.apply(o,i);return f&&f.promise?f.promise.then((function(){r&&d.states&&(d.states.after=r()),d.time&&(d.time.end=(new Date).toISOString()),u.debug(JSON.stringify(d,null,2))})):(r&&d.states&&(d.states.after=r()),d.time&&(d.time.end=(new Date).toISOString()),u.debug(JSON.stringify(d,null,2))),f}},L=function(){function e(){}return e.prototype.send=function(e,t){return Promise.resolve(null)},e.prototype.buildResponse=function(e){var t,n,r,o,i,s,a,u,c,d,f,v,h,g,p,y,m,b,S,w,I,E;if("object"!=typeof e)return null;var C=e.code||0,P=this.buildStatus(C);switch(P){case l.Success:return{status:P,statusCode:C,body:{eventsIngested:null!==(t=e.events_ingested)&&void 0!==t?t:0,payloadSizeBytes:null!==(n=e.payload_size_bytes)&&void 0!==n?n:0,serverUploadTime:null!==(r=e.server_upload_time)&&void 0!==r?r:0}};case l.Invalid:return{status:P,statusCode:C,body:{error:null!==(o=e.error)&&void 0!==o?o:"",missingField:null!==(i=e.missing_field)&&void 0!==i?i:"",eventsWithInvalidFields:null!==(s=e.events_with_invalid_fields)&&void 0!==s?s:{},eventsWithMissingFields:null!==(a=e.events_with_missing_fields)&&void 0!==a?a:{},eventsWithInvalidIdLengths:null!==(u=e.events_with_invalid_id_lengths)&&void 0!==u?u:{},epsThreshold:null!==(c=e.eps_threshold)&&void 0!==c?c:0,exceededDailyQuotaDevices:null!==(d=e.exceeded_daily_quota_devices)&&void 0!==d?d:{},silencedDevices:null!==(f=e.silenced_devices)&&void 0!==f?f:[],silencedEvents:null!==(v=e.silenced_events)&&void 0!==v?v:[],throttledDevices:null!==(h=e.throttled_devices)&&void 0!==h?h:{},throttledEvents:null!==(g=e.throttled_events)&&void 0!==g?g:[]}};case l.PayloadTooLarge:return{status:P,statusCode:C,body:{error:null!==(p=e.error)&&void 0!==p?p:""}};case l.RateLimit:return{status:P,statusCode:C,body:{error:null!==(y=e.error)&&void 0!==y?y:"",epsThreshold:null!==(m=e.eps_threshold)&&void 0!==m?m:0,throttledDevices:null!==(b=e.throttled_devices)&&void 0!==b?b:{},throttledUsers:null!==(S=e.throttled_users)&&void 0!==S?S:{},exceededDailyQuotaDevices:null!==(w=e.exceeded_daily_quota_devices)&&void 0!==w?w:{},exceededDailyQuotaUsers:null!==(I=e.exceeded_daily_quota_users)&&void 0!==I?I:{},throttledEvents:null!==(E=e.throttled_events)&&void 0!==E?E:[]}};case l.Timeout:default:return{status:P,statusCode:C}}},e.prototype.buildStatus=function(e){return e>=200&&e<300?l.Success:429===e?l.RateLimit:413===e?l.PayloadTooLarge:408===e?l.Timeout:e>=400&&e<500?l.Invalid:e>=500?l.Failed:l.Unknown},e}(),N=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.send=function(e,t){return i(this,void 0,void 0,(function(){var n,r,o;return s(this,(function(i){switch(i.label){case 0:if("undefined"==typeof fetch)throw new Error("FetchTransport is not supported");return n={headers:{"Content-Type":"application/json",Accept:"*/*"},body:JSON.stringify(t),method:"POST"},[4,fetch(e,n)];case 1:return[4,(r=i.sent()).text()];case 2:o=i.sent();try{return[2,this.buildResponse(JSON.parse(o))]}catch(e){return[2,this.buildResponse({code:r.status})]}return[2]}}))}))},n}(L);!function(e){e.US="US",e.EU="EU",e.STAGING="STAGING"}(x||(x={}));var U,A="[Amplitude]",j="".concat(A," Session Replay ID"),F=x.US,B={enabled:!0},K="".concat(A," Session Replay Debug"),$="amp-mask";!function(e){e.GET_SR_PROPS="get-sr-props",e.DEBUG_INFO="debug-info",e.FETCH_REQUEST="fetch-request",e.METADATA="metadata",e.TARGETING_DECISION="targeting-decision"}(U||(U={}));var W=function(){function e(e){this.logger=e,this.log=this.getSafeMethod("log"),this.warn=this.getSafeMethod("warn"),this.error=this.getSafeMethod("error"),this.debug=this.getSafeMethod("debug")}return e.prototype.getSafeMethod=function(e){var t;if(!this.logger)return function(){};var n=this.logger[e];return"function"==typeof n?(null!==(t=n.__rrweb_original__)&&void 0!==t?t:n).bind(this.logger):function(){}},e.prototype.enable=function(e){this.logger.enable(e)},e.prototype.disable=function(){this.logger.disable()},e}(),z="medium";var G,V,Q=function(e,t,n){switch(t){case"light":if("input"!==e)return!0;var r=n?function(e){var t=e.type;return e.hasAttribute("data-rr-is-password")?"password":t?t.toLowerCase():null}(n):"";return!!r&&(!!["password","hidden","email","tel"].includes(r)||!!n.autocomplete.startsWith("cc-"));case"medium":case"conservative":return!0;default:return Q(e,z,n)}},H=function(e,t){return function(n,r){return function(e,t,n){var r,o,i;if(void 0===t&&(t={defaultMaskLevel:z}),n){if(n.closest("."+$))return!0;var s=(null!==(r=t.maskSelector)&&void 0!==r?r:[]).some((function(e){return n.closest(e)}));if(s)return!0;if(n.closest(".amp-unmask"))return!1;var a=(null!==(o=t.unmaskSelector)&&void 0!==o?o:[]).some((function(e){return n.closest(e)}));if(a)return!1}return Q(e,null!==(i=t.defaultMaskLevel)&&void 0!==i?i:z,n)}(e,t,r)?n.replace(/[^\s]/g,"*"):n}},J=function(e){var t=0;if(0===e.length)return t;for(var n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t|=0}return t},Z=function(e,t){return t||(e===x.STAGING?"https://api-sr.stag2.amplitude.com/sessions/v2/track":e===x.EU?"https://api-sr.eu.amplitude.com/sessions/v2/track":"https://api-sr.amplitude.com/sessions/v2/track")},X=function(e,t){var n,r,o,i;try{for(var s=a(t),u=s.next();!u.done;u=s.next()){var c=u.value,l=(o=c.selector,i=void 0,i=o.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*").replace(/\?/g,"."),new RegExp("^".concat(i,"$")));if(l.test(e))return e.replace(l,c.replacement)}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return e},Y=function(){return i(void 0,void 0,void 0,(function(){var e,t,n,r,o,i,a;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),(e=g())?[4,e.navigator.storage.estimate()]:[3,2];case 1:return t=s.sent(),n=t.usage,r=t.quota,o=t.usageDetails,i=n?Math.round(n/1024):0,a=n&&r?Math.round(1e3*(n/r+Number.EPSILON))/1e3:0,[2,{totalStorageSize:i,percentOfQuota:a,usageDetails:JSON.stringify(o)}];case 2:return[3,4];case 3:return s.sent(),[3,4];case 4:return[2,{totalStorageSize:0,percentOfQuota:0,usageDetails:""}]}}))}))},ee=function(e){var t=o({},e),n=t.apiKey;return t.apiKey="****".concat(n.substring(n.length-4)),t},te=function(){return{flushMaxRetries:2,logLevel:h.Warn,loggerProvider:new m,transportProvider:new N}},ne=function(e){function n(t,n){var r,i,s,a,u,c=this,l=te();return(c=e.call(this,o(o({transportProvider:l.transportProvider,loggerProvider:new W(n.loggerProvider||l.loggerProvider)},n),{apiKey:t}))||this).flushMaxRetries=void 0!==n.flushMaxRetries&&n.flushMaxRetries<=l.flushMaxRetries?n.flushMaxRetries:l.flushMaxRetries,c.apiKey=t,c.sampleRate=n.sampleRate||0,c.serverZone=n.serverZone||F,c.configServerUrl=n.configServerUrl,c.trackServerUrl=n.trackServerUrl,c.shouldInlineStylesheet=n.shouldInlineStylesheet,c.version=n.version,c.performanceConfig=n.performanceConfig||B,c.storeType=null!==(r=n.storeType)&&void 0!==r?r:"idb",c.applyBackgroundColorToBlockedElements=null!==(i=n.applyBackgroundColorToBlockedElements)&&void 0!==i&&i,c.enableUrlChangePolling=null!==(s=n.enableUrlChangePolling)&&void 0!==s&&s,c.urlChangePollingInterval=null!==(a=n.urlChangePollingInterval)&&void 0!==a?a:1e3,c.captureDocumentTitle=null!==(u=n.captureDocumentTitle)&&void 0!==u&&u,n.privacyConfig&&(c.privacyConfig=n.privacyConfig),n.interactionConfig&&(c.interactionConfig=n.interactionConfig,c.interactionConfig.ugcFilterRules&&function(e){if(!e.every((function(e){return"string"==typeof e.selector&&"string"==typeof e.replacement})))throw new Error("ugcFilterRules must be an array of objects with selector and replacement properties");if(!e.every((function(e){return"string"==typeof(t=e.selector)&&""!==t.trim()&&!!/^\/|^https?:\/\/[^\s]+$/.test(t);var t})))throw new Error("ugcFilterRules must be an array of objects with valid globs")}(c.interactionConfig.ugcFilterRules)),n.debugMode&&(c.debugMode=n.debugMode),n.experimental&&(c.experimental=n.experimental),n.omitElementTags&&(c.omitElementTags=n.omitElementTags),c}return t(n,e),n}(S),re=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(re||{}),oe=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(oe||{});!function(e){e.US="US",e.EU="EU",e.STAGING="STAGING"}(G||(G={})),function(e){e.Unknown="unknown",e.Skipped="skipped",e.Success="success",e.RateLimit="rate_limit",e.PayloadTooLarge="payload_too_large",e.Invalid="invalid",e.Failed="failed",e.Timeout="Timeout",e.SystemError="SystemError"}(V||(V={}));var ie=function(){function e(){}return e.prototype.send=function(e,t){return Promise.resolve(null)},e.prototype.buildResponse=function(e){var t,n,r,o,i,s,a,u,c,l,d,f,v,h,g,p,y,m,b,S,w,I;if("object"!=typeof e)return null;var E=e.code||0,C=this.buildStatus(E);switch(C){case V.Success:return{status:C,statusCode:E,body:{eventsIngested:null!==(t=e.events_ingested)&&void 0!==t?t:0,payloadSizeBytes:null!==(n=e.payload_size_bytes)&&void 0!==n?n:0,serverUploadTime:null!==(r=e.server_upload_time)&&void 0!==r?r:0}};case V.Invalid:return{status:C,statusCode:E,body:{error:null!==(o=e.error)&&void 0!==o?o:"",missingField:null!==(i=e.missing_field)&&void 0!==i?i:"",eventsWithInvalidFields:null!==(s=e.events_with_invalid_fields)&&void 0!==s?s:{},eventsWithMissingFields:null!==(a=e.events_with_missing_fields)&&void 0!==a?a:{},eventsWithInvalidIdLengths:null!==(u=e.events_with_invalid_id_lengths)&&void 0!==u?u:{},epsThreshold:null!==(c=e.eps_threshold)&&void 0!==c?c:0,exceededDailyQuotaDevices:null!==(l=e.exceeded_daily_quota_devices)&&void 0!==l?l:{},silencedDevices:null!==(d=e.silenced_devices)&&void 0!==d?d:[],silencedEvents:null!==(f=e.silenced_events)&&void 0!==f?f:[],throttledDevices:null!==(v=e.throttled_devices)&&void 0!==v?v:{},throttledEvents:null!==(h=e.throttled_events)&&void 0!==h?h:[]}};case V.PayloadTooLarge:return{status:C,statusCode:E,body:{error:null!==(g=e.error)&&void 0!==g?g:""}};case V.RateLimit:return{status:C,statusCode:E,body:{error:null!==(p=e.error)&&void 0!==p?p:"",epsThreshold:null!==(y=e.eps_threshold)&&void 0!==y?y:0,throttledDevices:null!==(m=e.throttled_devices)&&void 0!==m?m:{},throttledUsers:null!==(b=e.throttled_users)&&void 0!==b?b:{},exceededDailyQuotaDevices:null!==(S=e.exceeded_daily_quota_devices)&&void 0!==S?S:{},exceededDailyQuotaUsers:null!==(w=e.exceeded_daily_quota_users)&&void 0!==w?w:{},throttledEvents:null!==(I=e.throttled_events)&&void 0!==I?I:[]}};case V.Timeout:default:return{status:C,statusCode:E}}},e.prototype.buildStatus=function(e){return e>=200&&e<300?V.Success:429===e?V.RateLimit:413===e?V.PayloadTooLarge:408===e?V.Timeout:e>=400&&e<500?V.Invalid:e>=500?V.Failed:V.Unknown},e}(),se="Remote config fetch rejected due to timeout after 5 seconds",ae="Unexpected error occurred",ue=function(){function e(e){var t=e.localConfig,n=e.configKeys,r=this;this.retryTimeout=1e3,this.attempts=0,this.sessionTargetingMatch=!1,this.metrics={},this.getRemoteNamespaceConfig=function(e,t){return i(r,void 0,void 0,(function(){var n,r,o;return s(this,(function(i){switch(i.label){case 0:return n=Date.now(),[4,this.fetchWithTimeout(t)];case 1:return(r=i.sent())&&(o=r.configs&&r.configs[e])?(this.metrics.fetchTimeAPISuccess=Date.now()-n,[2,o]):(this.metrics.fetchTimeAPIFail=Date.now()-n,[2,void 0])}}))}))},this.getRemoteConfig=function(e,t,n){return i(r,void 0,void 0,(function(){var r;return s(this,(function(o){switch(o.label){case 0:return[4,this.getRemoteNamespaceConfig(e,n)];case 1:return[2,null==(r=o.sent())?void 0:r[t]]}}))}))},this.fetchWithTimeout=function(e){return i(r,void 0,void 0,(function(){var t,n,r;return s(this,(function(o){switch(o.label){case 0:return t=new AbortController,n=setTimeout((function(){return t.abort()}),5e3),[4,this.fetchRemoteConfig(t.signal,e)];case 1:return r=o.sent(),clearTimeout(n),[2,r]}}))}))},this.fetchRemoteConfig=function(e,t){return i(r,void 0,void 0,(function(){var n,r,i,u,c,l,d,f,v,h,g,p;return s(this,(function(s){switch(s.label){case 0:if(t===this.lastFetchedSessionId&&this.attempts>=this.localConfig.flushMaxRetries)return[2,this.completeRequest({err:"Remote config fetch rejected due to exceeded retry count"})];if(e.aborted)return[2,this.completeRequest({err:se})];t!==this.lastFetchedSessionId&&(this.lastFetchedSessionId=t,this.attempts=0),s.label=1;case 1:s.trys.push([1,3,,4]),n=new URLSearchParams({api_key:this.localConfig.apiKey});try{for(r=a(this.configKeys),i=r.next();!i.done;i=r.next())u=i.value,n.append("config_keys",u)}catch(e){h={error:e}}finally{try{i&&!i.done&&(g=r.return)&&g.call(r)}finally{if(h)throw h.error}}return t&&n.set("session_id",String(t)),c={headers:{Accept:"*/*"},method:"GET"},l="".concat(this.getServerUrl(),"?").concat(n.toString()),this.attempts+=1,[4,fetch(l,o(o({},c),{signal:e}))];case 2:if(null===(d=s.sent()))return[2,this.completeRequest({err:ae})];switch((new ie).buildStatus(d.status)){case V.Success:return this.attempts=0,[2,this.parseAndStoreConfig(d)];case V.Failed:return[2,this.retryFetch(e,t)];default:return[2,this.completeRequest({err:"Network error occurred, remote config fetch failed"})]}case 3:return f=s.sent(),v=f,e.aborted?[2,this.completeRequest({err:se})]:[2,this.completeRequest({err:null!==(p=v.message)&&void 0!==p?p:ae})];case 4:return[2]}}))}))},this.retryFetch=function(e,t){return i(r,void 0,void 0,(function(){var n=this;return s(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(e){return setTimeout(e,n.attempts*n.retryTimeout)}))];case 1:return r.sent(),[2,this.fetchRemoteConfig(e,t)]}}))}))},this.parseAndStoreConfig=function(e){return i(r,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return[4,e.json()];case 1:return t=n.sent(),this.completeRequest({success:"Remote config successfully fetched"}),[2,t]}}))}))},this.localConfig=t,this.configKeys=n}return e.prototype.getServerUrl=function(){return this.localConfig.configServerUrl?this.localConfig.configServerUrl:this.localConfig.serverZone===G.STAGING?"https://sr-client-cfg.stag2.amplitude.com/config":this.localConfig.serverZone===G.EU?"https://sr-client-cfg.eu.amplitude.com/config":"https://sr-client-cfg.amplitude.com/config"},e.prototype.completeRequest=function(e){var t=e.err,n=e.success;if(t)throw new Error(t);n&&this.localConfig.loggerProvider.log(n)},e}(),ce=function(e){var t=e.localConfig,n=e.configKeys;return i(void 0,void 0,void 0,(function(){return s(this,(function(e){return[2,new ue({localConfig:t,configKeys:n})]}))}))},le=function(){function e(e,t){this.localConfig=t,this.remoteConfigFetch=e}return e.prototype.generateJoinedConfig=function(e){var t,n,r,c;return i(this,void 0,void 0,(function(){var i,l,d,f,v,h,g,p,y,m,b,S,w,I,E,C,P,T,R,_,k,x,O;return s(this,(function(s){switch(s.label){case 0:(i=o({},this.localConfig)).optOut=this.localConfig.optOut,i.captureEnabled=!0,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.remoteConfigFetch.getRemoteNamespaceConfig("sessionReplay",e)];case 2:return(d=s.sent())&&(f=d.sr_sampling_config,v=d.sr_privacy_config,h=d.sr_targeting_config,g=null===(t=i.interactionConfig)||void 0===t?void 0:t.ugcFilterRules,i.interactionConfig=d.sr_interaction_config,i.interactionConfig&&g&&(i.interactionConfig.ugcFilterRules=g),i.loggingConfig=d.sr_logging_config,(f||v||h)&&(l={},f&&(l.sr_sampling_config=f),v&&(l.sr_privacy_config=v),h&&(l.sr_targeting_config=h))),[3,4];case 3:return p=s.sent(),y=p,this.localConfig.loggerProvider.warn(y.message),i.captureEnabled=!1,[3,4];case 4:if(!l)return[2,{localConfig:this.localConfig,joinedConfig:i,remoteConfig:l}];if(m=l.sr_sampling_config,b=l.sr_privacy_config,S=l.sr_targeting_config,m&&Object.keys(m).length>0?(Object.prototype.hasOwnProperty.call(m,"capture_enabled")?i.captureEnabled=m.capture_enabled:i.captureEnabled=!1,Object.prototype.hasOwnProperty.call(m,"sample_rate")&&(i.sampleRate=m.sample_rate)):(i.captureEnabled=!0,this.localConfig.loggerProvider.debug("Remote config successfully fetched, but no values set for project, Session Replay capture enabled.")),b){w=null!==(n=i.privacyConfig)&&void 0!==n?n:{},I={defaultMaskLevel:null!==(c=null!==(r=b.defaultMaskLevel)&&void 0!==r?r:w.defaultMaskLevel)&&void 0!==c?c:"medium",blockSelector:[],maskSelector:[],unmaskSelector:[]},E=function(e){var t,n,r,o,i,s,u,c,l,d={};"string"==typeof e.blockSelector&&(e.blockSelector=[e.blockSelector]);try{for(var f=a(null!==(u=e.blockSelector)&&void 0!==u?u:[]),v=f.next();!v.done;v=f.next()){d[v.value]="block"}}catch(e){t={error:e}}finally{try{v&&!v.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}try{for(var h=a(null!==(c=e.maskSelector)&&void 0!==c?c:[]),g=h.next();!g.done;g=h.next()){d[g.value]="mask"}}catch(e){r={error:e}}finally{try{g&&!g.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}try{for(var p=a(null!==(l=e.unmaskSelector)&&void 0!==l?l:[]),y=p.next();!y.done;y=p.next()){d[y.value]="unmask"}}catch(e){i={error:e}}finally{try{y&&!y.done&&(s=p.return)&&s.call(p)}finally{if(i)throw i.error}}return d},C=o(o({},E(w)),E(b));try{for(P=a(Object.entries(C)),T=P.next();!T.done;T=P.next())R=u(T.value,2),_=R[0],"mask"===(k=R[1])?I.maskSelector.push(_):"block"===k?I.blockSelector.push(_):"unmask"===k&&I.unmaskSelector.push(_)}catch(e){x={error:e}}finally{try{T&&!T.done&&(O=P.return)&&O.call(P)}finally{if(x)throw x.error}}i.privacyConfig=function(e,t){var n=document.createDocumentFragment(),r=function(e){if(void 0===e&&(e=[]),"string"==typeof e&&(e=[e]),e=e.filter((function(e){try{n.querySelector(e)}catch(n){return t.warn('[session-replay-browser] omitting selector "'.concat(e,'" because it is invalid')),!1}return!0})),0!==e.length)return e};return e.blockSelector=r(e.blockSelector),e.maskSelector=r(e.maskSelector),e.unmaskSelector=r(e.unmaskSelector),e}(I,this.localConfig.loggerProvider)}return S&&Object.keys(S).length>0&&(i.targetingConfig=S),this.localConfig.loggerProvider.debug(JSON.stringify({name:"session replay joined config",config:ee(i)},null,2)),[2,{localConfig:this.localConfig,joinedConfig:i,remoteConfig:l}]}}))}))},e}(),de=function(e,t){return i(void 0,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:return n=new ne(e,t),[4,ce({localConfig:n,configKeys:["sessionReplay"]})];case 1:return r=o.sent(),[2,new le(r,n)]}}))}))},fe=Uint8Array,ve=Uint16Array,he=Uint32Array,ge=new fe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),pe=new fe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ye=new fe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),me=function(e,t){for(var n=new ve(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var o=new he(n[30]);for(r=1;r<30;++r)for(var i=n[r];i<n[r+1];++i)o[i]=i-n[r]<<5|r;return[n,o]},be=me(ge,2),Se=be[0],we=be[1];Se[28]=258,we[258]=28;for(var Ie=me(pe,0)[1],Ee=new ve(32768),Ce=0;Ce<32768;++Ce){var Pe=(43690&Ce)>>>1|(21845&Ce)<<1;Pe=(61680&(Pe=(52428&Pe)>>>2|(13107&Pe)<<2))>>>4|(3855&Pe)<<4,Ee[Ce]=((65280&Pe)>>>8|(255&Pe)<<8)>>>1}var Te=function(e,t,n){for(var r=e.length,o=0,i=new ve(t);o<r;++o)++i[e[o]-1];var s,a=new ve(t);for(o=0;o<t;++o)a[o]=a[o-1]+i[o-1]<<1;if(n){s=new ve(1<<t);var u=15-t;for(o=0;o<r;++o)if(e[o])for(var c=o<<4|e[o],l=t-e[o],d=a[e[o]-1]++<<l,f=d|(1<<l)-1;d<=f;++d)s[Ee[d]>>>u]=c}else for(s=new ve(r),o=0;o<r;++o)s[o]=Ee[a[e[o]-1]++]>>>15-e[o];return s},Re=new fe(288);for(Ce=0;Ce<144;++Ce)Re[Ce]=8;for(Ce=144;Ce<256;++Ce)Re[Ce]=9;for(Ce=256;Ce<280;++Ce)Re[Ce]=7;for(Ce=280;Ce<288;++Ce)Re[Ce]=8;var _e=new fe(32);for(Ce=0;Ce<32;++Ce)_e[Ce]=5;var ke=Te(Re,9,0),xe=Te(_e,5,0),Oe=function(e){return(e/8|0)+(7&e&&1)},Me=function(e,t,n){(null==n||n>e.length)&&(n=e.length);var r=new(e instanceof ve?ve:e instanceof he?he:fe)(n-t);return r.set(e.subarray(t,n)),r},De=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8},qe=function(e,t,n){n<<=7&t;var r=t/8|0;e[r]|=n,e[r+1]|=n>>>8,e[r+2]|=n>>>16},Le=function(e,t){for(var n=[],r=0;r<e.length;++r)e[r]&&n.push({s:r,f:e[r]});var o=n.length,i=n.slice();if(!o)return[new fe(0),0];if(1==o){var s=new fe(n[0].s+1);return s[n[0].s]=1,[s,1]}n.sort((function(e,t){return e.f-t.f})),n.push({s:-1,f:25001});var a=n[0],u=n[1],c=0,l=1,d=2;for(n[0]={s:-1,f:a.f+u.f,l:a,r:u};l!=o-1;)a=n[n[c].f<n[d].f?c++:d++],u=n[c!=l&&n[c].f<n[d].f?c++:d++],n[l++]={s:-1,f:a.f+u.f,l:a,r:u};var f=i[0].s;for(r=1;r<o;++r)i[r].s>f&&(f=i[r].s);var v=new ve(f+1),h=Ne(n[l-1],v,0);if(h>t){r=0;var g=0,p=h-t,y=1<<p;for(i.sort((function(e,t){return v[t.s]-v[e.s]||e.f-t.f}));r<o;++r){var m=i[r].s;if(!(v[m]>t))break;g+=y-(1<<h-v[m]),v[m]=t}for(g>>>=p;g>0;){var b=i[r].s;v[b]<t?g-=1<<t-v[b]++-1:++r}for(;r>=0&&g;--r){var S=i[r].s;v[S]==t&&(--v[S],++g)}h=t}return[new fe(v),h]},Ne=function(e,t,n){return-1==e.s?Math.max(Ne(e.l,t,n+1),Ne(e.r,t,n+1)):t[e.s]=n},Ue=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new ve(++t),r=0,o=e[0],i=1,s=function(e){n[r++]=e},a=1;a<=t;++a)if(e[a]==o&&a!=t)++i;else{if(!o&&i>2){for(;i>138;i-=138)s(32754);i>2&&(s(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(s(o),--i;i>6;i-=6)s(8304);i>2&&(s(i-3<<5|8208),i=0)}for(;i--;)s(o);i=1,o=e[a]}return[n.subarray(0,r),t]},Ae=function(e,t){for(var n=0,r=0;r<t.length;++r)n+=e[r]*t[r];return n},je=function(e,t,n){var r=n.length,o=Oe(t+2);e[o]=255&r,e[o+1]=r>>>8,e[o+2]=255^e[o],e[o+3]=255^e[o+1];for(var i=0;i<r;++i)e[o+i+4]=n[i];return 8*(o+4+r)},Fe=function(e,t,n,r,o,i,s,a,u,c,l){De(t,l++,n),++o[256];for(var d=Le(o,15),f=d[0],v=d[1],h=Le(i,15),g=h[0],p=h[1],y=Ue(f),m=y[0],b=y[1],S=Ue(g),w=S[0],I=S[1],E=new ve(19),C=0;C<m.length;++C)E[31&m[C]]++;for(C=0;C<w.length;++C)E[31&w[C]]++;for(var P=Le(E,7),T=P[0],R=P[1],_=19;_>4&&!T[ye[_-1]];--_);var k,x,O,M,D=c+5<<3,q=Ae(o,Re)+Ae(i,_e)+s,L=Ae(o,f)+Ae(i,g)+s+14+3*_+Ae(E,T)+(2*E[16]+3*E[17]+7*E[18]);if(D<=q&&D<=L)return je(t,l,e.subarray(u,u+c));if(De(t,l,1+(L<q)),l+=2,L<q){k=Te(f,v,0),x=f,O=Te(g,p,0),M=g;var N=Te(T,R,0);De(t,l,b-257),De(t,l+5,I-1),De(t,l+10,_-4),l+=14;for(C=0;C<_;++C)De(t,l+3*C,T[ye[C]]);l+=3*_;for(var U=[m,w],A=0;A<2;++A){var j=U[A];for(C=0;C<j.length;++C){var F=31&j[C];De(t,l,N[F]),l+=T[F],F>15&&(De(t,l,j[C]>>>5&127),l+=j[C]>>>12)}}}else k=ke,x=Re,O=xe,M=_e;for(C=0;C<a;++C)if(r[C]>255){F=r[C]>>>18&31;qe(t,l,k[F+257]),l+=x[F+257],F>7&&(De(t,l,r[C]>>>23&31),l+=ge[F]);var B=31&r[C];qe(t,l,O[B]),l+=M[B],B>3&&(qe(t,l,r[C]>>>5&8191),l+=pe[B])}else qe(t,l,k[r[C]]),l+=x[r[C]];return qe(t,l,k[256]),l+x[256]},Be=new he([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Ke=function(e,t,n,r,o){return function(e,t,n,r,o,i){var s=e.length,a=new fe(r+s+5*(1+Math.floor(s/7e3))+o),u=a.subarray(r,a.length-o),c=0;if(!t||s<8)for(var l=0;l<=s;l+=65535){var d=l+65535;d<s?c=je(u,c,e.subarray(l,d)):(u[l]=i,c=je(u,c,e.subarray(l,s)))}else{for(var f=Be[t-1],v=f>>>13,h=8191&f,g=(1<<n)-1,p=new ve(32768),y=new ve(g+1),m=Math.ceil(n/3),b=2*m,S=function(t){return(e[t]^e[t+1]<<m^e[t+2]<<b)&g},w=new he(25e3),I=new ve(288),E=new ve(32),C=0,P=0,T=(l=0,0),R=0,_=0;l<s;++l){var k=S(l),x=32767&l,O=y[k];if(p[x]=O,y[k]=x,R<=l){var M=s-l;if((C>7e3||T>24576)&&M>423){c=Fe(e,u,0,w,I,E,P,T,_,l-_,c),T=C=P=0,_=l;for(var D=0;D<286;++D)I[D]=0;for(D=0;D<30;++D)E[D]=0}var q=2,L=0,N=h,U=x-O&32767;if(M>2&&k==S(l-U))for(var A=Math.min(v,M)-1,j=Math.min(32767,l),F=Math.min(258,M);U<=j&&--N&&x!=O;){if(e[l+q]==e[l+q-U]){for(var B=0;B<F&&e[l+B]==e[l+B-U];++B);if(B>q){if(q=B,L=U,B>A)break;var K=Math.min(U,B-2),$=0;for(D=0;D<K;++D){var W=l-U+D+32768&32767,z=W-p[W]+32768&32767;z>$&&($=z,O=W)}}}U+=(x=O)-(O=p[x])+32768&32767}if(L){w[T++]=268435456|we[q]<<18|Ie[L];var G=31&we[q],V=31&Ie[L];P+=ge[G]+pe[V],++I[257+G],++E[V],R=l+q,++C}else w[T++]=e[l],++I[e[l]]}}c=Fe(e,u,i,w,I,E,P,T,_,l-_,c)}return Me(a,0,r+Oe(c)+o)}(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,n,r,!o)};function $e(e,t){void 0===t&&(t={});var n=function(){var e=1,t=0;return{p:function(n){for(var r=e,o=t,i=n.length,s=0;s!=i;){for(var a=Math.min(s+5552,i);s<a;++s)o+=r+=n[s];r%=65521,o%=65521}e=r,t=o},d:function(){return(e>>>8<<16|(255&t)<<8|t>>>8)+2*((255&e)<<23)}}}();n.p(e);var r,o,i,s=Ke(e,t,2,4);return r=s,o=t.level,i=0==o?0:o<6?1:9==o?3:2,r[0]=120,r[1]=i<<6|(i?32-2*i:1),function(e,t,n){for(;n;++t)e[t]=n,n>>>=8}(s,s.length-4,n.d()),s}const We=e=>{const t={...e,v:"v1"};return function(e,t){var n="";if(!t&&"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var r=0;r<e.length;){var o=e[r++];o<128||t?n+=String.fromCharCode(o):o<224?n+=String.fromCharCode((31&o)<<6|63&e[r++]):o<240?n+=String.fromCharCode((15&o)<<12|(63&e[r++])<<6|63&e[r++]):(o=((15&o)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536,n+=String.fromCharCode(55296|o>>10,56320|1023&o))}return n}($e(function(e,t){var n=e.length;if(!t&&"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);for(var r=new fe(e.length+(e.length>>>1)),o=0,i=function(e){r[o++]=e},s=0;s<n;++s){if(o+5>r.length){var a=new fe(o+8+(n-s<<1));a.set(r),r=a}var u=e.charCodeAt(s);u<128||t?i(u):u<2048?(i(192|u>>>6),i(128|63&u)):u>55295&&u<57344?(i(240|(u=65536+(1047552&u)|1023&e.charCodeAt(++s))>>>18),i(128|u>>>12&63),i(128|u>>>6&63),i(128|63&u)):(i(224|u>>>12),i(128|u>>>6&63),i(128|63&u))}return Me(r,0,o)}(JSON.stringify(t))),!0)};var ze=function(){function e(e,t,n,r){var o,i,s,a=this;this.taskQueue=[],this.isProcessing=!1,this.compressEvent=function(e){var t=We(e);return JSON.stringify(t)},this.addCompressedEventToManager=function(e,t){a.eventsManager&&a.deviceId&&a.eventsManager.addEvent({event:{type:"replay",data:e},sessionId:t,deviceId:a.deviceId})},this.addCompressedEvent=function(e,t){if(a.worker)a.worker.postMessage({event:e,sessionId:t});else{var n=a.compressEvent(e);a.addCompressedEventToManager(n,t)}},this.terminate=function(){var e;null===(e=a.worker)||void 0===e||e.terminate()};var u=g();this.canUseIdleCallback=u&&"requestIdleCallback"in u,this.eventsManager=e,this.config=t,this.deviceId=n,this.timeout=(null===(o=t.performanceConfig)||void 0===o?void 0:o.timeout)||2e3;var c=null!==(i='var WebWorker=function(r){"use strict";var n=Uint8Array,e=Uint16Array,f=Uint32Array,t=new n([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new n([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new n([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(r,n){for(var t=new e(31),o=0;o<31;++o)t[o]=n+=1<<r[o-1];var a=new f(t[30]);for(o=1;o<30;++o)for(var i=t[o];i<t[o+1];++i)a[i]=i-t[o]<<5|o;return[t,a]},v=i(t,2),u=v[0],s=v[1];u[28]=258,s[258]=28;for(var l=i(o,0)[1],c=new e(32768),h=0;h<32768;++h){var g=(43690&h)>>>1|(21845&h)<<1;g=(61680&(g=(52428&g)>>>2|(13107&g)<<2))>>>4|(3855&g)<<4,c[h]=((65280&g)>>>8|(255&g)<<8)>>>1}var w=function(r,n,f){for(var t=r.length,o=0,a=new e(n);o<t;++o)++a[r[o]-1];var i,v=new e(n);for(o=0;o<n;++o)v[o]=v[o-1]+a[o-1]<<1;if(f){i=new e(1<<n);var u=15-n;for(o=0;o<t;++o)if(r[o])for(var s=o<<4|r[o],l=n-r[o],h=v[r[o]-1]++<<l,g=h|(1<<l)-1;h<=g;++h)i[c[h]>>>u]=s}else for(i=new e(t),o=0;o<t;++o)i[o]=c[v[r[o]-1]++]>>>15-r[o];return i},d=new n(288);for(h=0;h<144;++h)d[h]=8;for(h=144;h<256;++h)d[h]=9;for(h=256;h<280;++h)d[h]=7;for(h=280;h<288;++h)d[h]=8;var m=new n(32);for(h=0;h<32;++h)m[h]=5;var M=w(d,9,0),y=w(m,5,0),b=function(r){return(r/8|0)+(7&r&&1)},p=function(r,t,o){(null==o||o>r.length)&&(o=r.length);var a=new(r instanceof e?e:r instanceof f?f:n)(o-t);return a.set(r.subarray(t,o)),a},C=function(r,n,e){e<<=7&n;var f=n/8|0;r[f]|=e,r[f+1]|=e>>>8},x=function(r,n,e){e<<=7&n;var f=n/8|0;r[f]|=e,r[f+1]|=e>>>8,r[f+2]|=e>>>16},S=function(r,f){for(var t=[],o=0;o<r.length;++o)r[o]&&t.push({s:o,f:r[o]});var a=t.length,i=t.slice();if(!a)return[new n(0),0];if(1==a){var v=new n(t[0].s+1);return v[t[0].s]=1,[v,1]}t.sort((function(r,n){return r.f-n.f})),t.push({s:-1,f:25001});var u=t[0],s=t[1],l=0,c=1,h=2;for(t[0]={s:-1,f:u.f+s.f,l:u,r:s};c!=a-1;)u=t[t[l].f<t[h].f?l++:h++],s=t[l!=c&&t[l].f<t[h].f?l++:h++],t[c++]={s:-1,f:u.f+s.f,l:u,r:s};var g=i[0].s;for(o=1;o<a;++o)i[o].s>g&&(g=i[o].s);var w=new e(g+1),d=A(t[c-1],w,0);if(d>f){o=0;var m=0,M=d-f,y=1<<M;for(i.sort((function(r,n){return w[n.s]-w[r.s]||r.f-n.f}));o<a;++o){var b=i[o].s;if(!(w[b]>f))break;m+=y-(1<<d-w[b]),w[b]=f}for(m>>>=M;m>0;){var p=i[o].s;w[p]<f?m-=1<<f-w[p]++-1:++o}for(;o>=0&&m;--o){var C=i[o].s;w[C]==f&&(--w[C],++m)}d=f}return[new n(w),d]},A=function(r,n,e){return-1==r.s?Math.max(A(r.l,n,e+1),A(r.r,n,e+1)):n[r.s]=e},O=function(r){for(var n=r.length;n&&!r[--n];);for(var f=new e(++n),t=0,o=r[0],a=1,i=function(r){f[t++]=r},v=1;v<=n;++v)if(r[v]==o&&v!=n)++a;else{if(!o&&a>2){for(;a>138;a-=138)i(32754);a>2&&(i(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(i(o),--a;a>6;a-=6)i(8304);a>2&&(i(a-3<<5|8208),a=0)}for(;a--;)i(o);a=1,o=r[v]}return[f.subarray(0,t),n]},T=function(r,n){for(var e=0,f=0;f<n.length;++f)e+=r[f]*n[f];return e},k=function(r,n,e){var f=e.length,t=b(n+2);r[t]=255&f,r[t+1]=f>>>8,r[t+2]=255^r[t],r[t+3]=255^r[t+1];for(var o=0;o<f;++o)r[t+o+4]=e[o];return 8*(t+4+f)},E=function(r,n,f,i,v,u,s,l,c,h,g){C(n,g++,f),++v[256];for(var b=S(v,15),p=b[0],A=b[1],E=S(u,15),U=E[0],D=E[1],I=O(p),J=I[0],N=I[1],W=O(U),_=W[0],j=W[1],P=new e(19),q=0;q<J.length;++q)P[31&J[q]]++;for(q=0;q<_.length;++q)P[31&_[q]]++;for(var z=S(P,7),B=z[0],F=z[1],G=19;G>4&&!B[a[G-1]];--G);var H,K,L,Q,R=h+5<<3,V=T(v,d)+T(u,m)+s,X=T(v,p)+T(u,U)+s+14+3*G+T(P,B)+(2*P[16]+3*P[17]+7*P[18]);if(R<=V&&R<=X)return k(n,g,r.subarray(c,c+h));if(C(n,g,1+(X<V)),g+=2,X<V){H=w(p,A,0),K=p,L=w(U,D,0),Q=U;var Y=w(B,F,0);C(n,g,N-257),C(n,g+5,j-1),C(n,g+10,G-4),g+=14;for(q=0;q<G;++q)C(n,g+3*q,B[a[q]]);g+=3*G;for(var Z=[J,_],$=0;$<2;++$){var rr=Z[$];for(q=0;q<rr.length;++q){var nr=31&rr[q];C(n,g,Y[nr]),g+=B[nr],nr>15&&(C(n,g,rr[q]>>>5&127),g+=rr[q]>>>12)}}}else H=M,K=d,L=y,Q=m;for(q=0;q<l;++q)if(i[q]>255){nr=i[q]>>>18&31;x(n,g,H[nr+257]),g+=K[nr+257],nr>7&&(C(n,g,i[q]>>>23&31),g+=t[nr]);var er=31&i[q];x(n,g,L[er]),g+=Q[er],er>3&&(x(n,g,i[q]>>>5&8191),g+=o[er])}else x(n,g,H[i[q]]),g+=K[i[q]];return x(n,g,H[256]),g+K[256]},U=new f([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),D=function(r,a,i,v,u){return function(r,a,i,v,u,c){var h=r.length,g=new n(v+h+5*(1+Math.floor(h/7e3))+u),w=g.subarray(v,g.length-u),d=0;if(!a||h<8)for(var m=0;m<=h;m+=65535){var M=m+65535;M<h?d=k(w,d,r.subarray(m,M)):(w[m]=c,d=k(w,d,r.subarray(m,h)))}else{for(var y=U[a-1],C=y>>>13,x=8191&y,S=(1<<i)-1,A=new e(32768),O=new e(S+1),T=Math.ceil(i/3),D=2*T,I=function(n){return(r[n]^r[n+1]<<T^r[n+2]<<D)&S},J=new f(25e3),N=new e(288),W=new e(32),_=0,j=0,P=(m=0,0),q=0,z=0;m<h;++m){var B=I(m),F=32767&m,G=O[B];if(A[F]=G,O[B]=F,q<=m){var H=h-m;if((_>7e3||P>24576)&&H>423){d=E(r,w,0,J,N,W,j,P,z,m-z,d),P=_=j=0,z=m;for(var K=0;K<286;++K)N[K]=0;for(K=0;K<30;++K)W[K]=0}var L=2,Q=0,R=x,V=F-G&32767;if(H>2&&B==I(m-V))for(var X=Math.min(C,H)-1,Y=Math.min(32767,m),Z=Math.min(258,H);V<=Y&&--R&&F!=G;){if(r[m+L]==r[m+L-V]){for(var $=0;$<Z&&r[m+$]==r[m+$-V];++$);if($>L){if(L=$,Q=V,$>X)break;var rr=Math.min(V,$-2),nr=0;for(K=0;K<rr;++K){var er=m-V+K+32768&32767,fr=er-A[er]+32768&32767;fr>nr&&(nr=fr,G=er)}}}V+=(F=G)-(G=A[F])+32768&32767}if(Q){J[P++]=268435456|s[L]<<18|l[Q];var tr=31&s[L],or=31&l[Q];j+=t[tr]+o[or],++N[257+tr],++W[or],q=m+L,++_}else J[P++]=r[m],++N[r[m]]}}d=E(r,w,c,J,N,W,j,P,z,m-z,d)}return p(g,0,v+b(d)+u)}(r,null==a.level?6:a.level,null==a.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(r.length)))):12+a.mem,i,v,!u)};function I(r,n){void 0===n&&(n={});var e=function(){var r=1,n=0;return{p:function(e){for(var f=r,t=n,o=e.length,a=0;a!=o;){for(var i=Math.min(a+5552,o);a<i;++a)t+=f+=e[a];f%=65521,t%=65521}r=f,n=t},d:function(){return(r>>>8<<16|(255&n)<<8|n>>>8)+2*((255&r)<<23)}}}();e.p(r);var f,t,o,a=D(r,n,2,4);return f=a,t=n.level,o=0==t?0:t<6?1:9==t?3:2,f[0]=120,f[1]=o<<6|(o?32-2*o:1),function(r,n,e){for(;e;++n)r[n]=e,e>>>=8}(a,a.length-4,e.d()),a}const J=r=>{const e={...r,v:"v1"};return function(r,n){var e="";if(!n&&"undefined"!=typeof TextDecoder)return(new TextDecoder).decode(r);for(var f=0;f<r.length;){var t=r[f++];t<128||n?e+=String.fromCharCode(t):t<224?e+=String.fromCharCode((31&t)<<6|63&r[f++]):t<240?e+=String.fromCharCode((15&t)<<12|(63&r[f++])<<6|63&r[f++]):(t=((15&t)<<18|(63&r[f++])<<12|(63&r[f++])<<6|63&r[f++])-65536,e+=String.fromCharCode(55296|t>>10,56320|1023&t))}return e}(I(function(r,e){var f=r.length;if(!e&&"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(r);for(var t=new n(r.length+(r.length>>>1)),o=0,a=function(r){t[o++]=r},i=0;i<f;++i){if(o+5>t.length){var v=new n(o+8+(f-i<<1));v.set(t),t=v}var u=r.charCodeAt(i);u<128||e?a(u):u<2048?(a(192|u>>>6),a(128|63&u)):u>55295&&u<57344?(a(240|(u=65536+(1047552&u)|1023&r.charCodeAt(++i))>>>18),a(128|u>>>12&63),a(128|u>>>6&63),a(128|63&u)):(a(224|u>>>12),a(128|u>>>6&63),a(128|63&u))}return p(t,0,o)}(JSON.stringify(e))),!0)};onmessage=r=>{const{event:n,sessionId:e}=r.data,f=JSON.stringify(J(n));postMessage({compressedEvent:f,sessionId:e})};const N=onmessage;return r.compressionOnMessage=N,Object.defineProperty(r,"__esModule",{value:!0}),r}({});\n')?i:r;if((null===(s=this.config.experimental)||void 0===s?void 0:s.useWebWorker)&&u&&u.Worker&&c){t.loggerProvider.log("[Experimental] Enabling web worker for compression");var l=new Worker(URL.createObjectURL(new Blob([c],{type:"application/javascript"})));l.onerror=function(e){t.loggerProvider.error(e)},l.onmessage=function(e){var t=e.data,n=t.compressedEvent,r=t.sessionId;a.addCompressedEventToManager(n,r)},this.worker=l}}return e.prototype.scheduleIdleProcessing=function(){var e=this;this.isProcessing||(this.isProcessing=!0,requestIdleCallback((function(t){e.processQueue(t)}),{timeout:this.timeout}))},e.prototype.enqueueEvent=function(e,t){var n;this.canUseIdleCallback&&(null===(n=this.config.performanceConfig)||void 0===n?void 0:n.enabled)?(this.config.loggerProvider.debug("Enqueuing event for processing during idle time."),this.taskQueue.push({event:e,sessionId:t}),this.scheduleIdleProcessing()):(this.config.loggerProvider.debug("Processing event without idle callback."),this.addCompressedEvent(e,t))},e.prototype.processQueue=function(e){for(var t=this;this.taskQueue.length>0&&(e.timeRemaining()>0||e.didTimeout);){var n=this.taskQueue.shift();if(n){var r=n.event,o=n.sessionId;this.addCompressedEvent(r,o)}}this.taskQueue.length>0?requestIdleCallback((function(e){t.processQueue(e)}),{timeout:this.timeout}):this.isProcessing=!1},e}(),Ge="Failed to store session replay events in IndexedDB",Ve="1.28.9",Qe=function(){function e(e){var t=e.trackServerUrl,n=e.loggerProvider,r=e.payloadBatcher;this.storageKey="",this.retryTimeout=1e3,this.scheduled=null,this.queue=[],this.loggerProvider=n,this.payloadBatcher=r||function(e){return e},this.trackServerUrl=t}return e.prototype.sendEventsList=function(e){this.addToQueue(o(o({},e),{attempts:0,timeout:0}))},e.prototype.addToQueue=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.filter((function(t){return t.attempts<(t.flushMaxRetries||0)?(t.attempts+=1,!0):(e.completeRequest({context:t,err:"Session replay event batch rejected due to exceeded retry count"}),!1)})).forEach((function(t){e.queue=e.queue.concat(t),0!==t.timeout?setTimeout((function(){t.timeout=0,e.schedule(0)}),t.timeout):e.schedule(0)}))},e.prototype.schedule=function(e){var t=this;this.scheduled||(this.scheduled=setTimeout((function(){t.flush(!0).then((function(){t.queue.length>0&&t.schedule(e)}))}),e))},e.prototype.flush=function(e){return void 0===e&&(e=!1),i(this,void 0,void 0,(function(){var t,n,r=this;return s(this,(function(o){switch(o.label){case 0:return t=[],n=[],this.queue.forEach((function(e){return 0===e.timeout?t.push(e):n.push(e)})),this.queue=n,this.scheduled&&(clearTimeout(this.scheduled),this.scheduled=null),[4,Promise.all(t.map((function(t){return r.send(t,e)})))];case 1:return o.sent(),[2]}}))}))},e.prototype.send=function(e,t){var n,r;return void 0===t&&(t=!0),i(this,void 0,void 0,(function(){var o,i,a,u,c,l,d,f,v,h,p,y,m;return s(this,(function(s){switch(s.label){case 0:if(!(o=e.apiKey))return[2,this.completeRequest({context:e,err:"Session replay event batch not sent due to missing api key"})];if(!(i=e.deviceId))return[2,this.completeRequest({context:e,err:"Session replay event batch not sent due to missing device ID"})];if(b=g(),a=(null==b?void 0:b.location)?b.location.href:"",u=Ve,c=e.sampleRate,l=new URLSearchParams({device_id:i,session_id:"".concat(e.sessionId),type:"".concat(e.type)}),d="".concat((null===(n=e.version)||void 0===n?void 0:n.type)||"standalone","/").concat((null===(r=e.version)||void 0===r?void 0:r.version)||u),0===(f=this.payloadBatcher({version:1,events:e.events})).events.length)return this.completeRequest({context:e}),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),v={headers:{"Content-Type":"application/json",Accept:"*/*",Authorization:"Bearer ".concat(o),"X-Client-Version":u,"X-Client-Library":d,"X-Client-Url":a.substring(0,1e3),"X-Client-Sample-Rate":"".concat(c)},body:JSON.stringify(f),method:"POST"},h="".concat(Z(e.serverZone,this.trackServerUrl),"?").concat(l.toString()),[4,fetch(h,v)];case 2:if(null===(p=s.sent()))return this.completeRequest({context:e,err:"Unexpected error occurred"}),[2];if(t)this.handleReponse(p.status,e);else{y="";try{y=JSON.stringify(p.body,null,2)}catch(e){}this.completeRequest({context:e,success:"".concat(p.status,": ").concat(y)})}return[3,4];case 3:return m=s.sent(),this.completeRequest({context:e,err:m}),[3,4];case 4:return[2]}var b}))}))},e.prototype.handleReponse=function(e,t){switch((new L).buildStatus(e)){case l.Success:this.handleSuccessResponse(t);break;case l.Failed:this.handleOtherResponse(t);break;default:this.completeRequest({context:t,err:"Network error occurred, event batch rejected"})}},e.prototype.handleSuccessResponse=function(e){var t=Math.round(new Blob(e.events).size/1024);this.completeRequest({context:e,success:"Session replay event batch tracked successfully for session id ".concat(e.sessionId,", size of events: ").concat(t," KB")})},e.prototype.handleOtherResponse=function(e){this.addToQueue(o(o({},e),{timeout:e.attempts*this.retryTimeout}))},e.prototype.completeRequest=function(e){var t=e.context,n=e.err,r=e.success;t.onComplete(),n?this.loggerProvider.warn(n):r&&this.loggerProvider.log(r)},e}();const He=(e,t)=>t.some((t=>e instanceof t));let Je,Ze;const Xe=new WeakMap,Ye=new WeakMap,et=new WeakMap;let tt={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Xe.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return it(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function nt(e){tt=e(tt)}function rt(e){return(Ze||(Ze=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(st(this),t),it(this.request)}:function(...t){return it(e.apply(st(this),t))}}function ot(e){return"function"==typeof e?rt(e):(e instanceof IDBTransaction&&function(e){if(Xe.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",i),e.removeEventListener("abort",i)},o=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",o),e.addEventListener("error",i),e.addEventListener("abort",i)}));Xe.set(e,t)}(e),He(e,Je||(Je=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,tt):e)}function it(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(it(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",o),e.addEventListener("error",i)}));return et.set(t,e),t}(e);if(Ye.has(e))return Ye.get(e);const t=ot(e);return t!==e&&(Ye.set(e,t),et.set(t,e)),t}const st=e=>et.get(e);function at(e,t,{blocked:n,upgrade:r,blocking:o,terminated:i}={}){const s=indexedDB.open(e,t),a=it(s);return r&&s.addEventListener("upgradeneeded",(e=>{r(it(s.result),e.oldVersion,e.newVersion,it(s.transaction),e)})),n&&s.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),o&&e.addEventListener("versionchange",(e=>o(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}const ut=["get","getKey","getAll","getAllKeys","count"],ct=["put","add","delete","clear"],lt=new Map;function dt(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(lt.get(t))return lt.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,o=ct.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!o&&!ut.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,o?"readwrite":"readonly");let s=i.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),o&&i.done]))[0]};return lt.set(t,i),i}nt((e=>({...e,get:(t,n,r)=>dt(t,n)||e.get(t,n,r),has:(t,n)=>!!dt(t,n)||e.has(t,n)})));const ft=["continue","continuePrimaryKey","advance"],vt={},ht=new WeakMap,gt=new WeakMap,pt={get(e,t){if(!ft.includes(t))return e[t];let n=vt[t];return n||(n=vt[t]=function(...e){ht.set(this,gt.get(this)[t](...e))}),n}};async function*yt(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const n=new Proxy(t,pt);for(gt.set(n,t),et.set(n,st(t));t;)yield n,t=await(ht.get(n)||t.continue()),ht.delete(n)}function mt(e,t){return t===Symbol.asyncIterator&&He(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&He(e,[IDBIndex,IDBObjectStore])}nt((e=>({...e,get:(t,n,r)=>mt(t,n)?yt:e.get(t,n,r),has:(t,n)=>mt(t,n)||e.has(t,n)})));var bt,St=function(){function e(e){var t,n,r,o=this;this.minInterval=500,this.maxInterval=1e4,this.maxPersistedEventsSize=1e6,this.interval=this.minInterval,this._timeAtLastSplit=Date.now(),this.shouldSplitEventsList=function(e,t){var n=o.getStringSize(t);return o.getEventsArraySize(e)+n>=o.maxPersistedEventsSize||!!(Date.now()-o.timeAtLastSplit>o.interval&&e.length)&&(o.interval=Math.min(o.maxInterval,o.interval+o.minInterval),o._timeAtLastSplit=Date.now(),!0)},this.loggerProvider=e.loggerProvider,this.minInterval=null!==(t=e.minInterval)&&void 0!==t?t:this.minInterval,this.maxInterval=null!==(n=e.maxInterval)&&void 0!==n?n:this.maxInterval,this.maxPersistedEventsSize=null!==(r=e.maxPersistedEventsSize)&&void 0!==r?r:this.maxPersistedEventsSize}return Object.defineProperty(e.prototype,"timeAtLastSplit",{get:function(){return this._timeAtLastSplit},enumerable:!1,configurable:!0}),e.prototype.getStringSize=function(e){return e.length},e.prototype.getEventsArraySize=function(e){var t,n,r=0;try{for(var o=a(e),i=o.next();!i.done;i=o.next()){var s=i.value;r+=this.getStringSize(s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r+(2+Math.max(0,e.length-1)+2*e.length)},e}();!function(e){e.RECORDING="recording",e.SENT="sent"}(bt||(bt={}));var wt="sessionCurrentSequence",It="sequencesToSend",Et=function(){var e=g();return new Promise((function(t,n){if(!e)return n(new Error("Global scope not found"));if(!e.indexedDB)return n(new Error("Session Replay: cannot find indexedDB"));try{var r=e.indexedDB.open("keyval-store");r.onupgradeneeded=function(){1===r.result.version&&(r.result.close(),r.transaction&&r.transaction.abort(),e.indexedDB.deleteDatabase("keyval-store"),t())},r.onsuccess=function(){t(r.result)},r.onerror=function(){n(r.error)}}catch(e){n(e)}}))},Ct=function(e){return i(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return e.length>0?(t=e.splice(0,10),[4,Promise.all(t)]):[3,2];case 1:return n.sent(),[3,0];case 2:return[2]}}))}))},Pt=function(e){var t,n;return e.objectStoreNames.contains(wt)||(n=e.createObjectStore(wt,{keyPath:"sessionId"})),e.objectStoreNames.contains(It)||(t=e.createObjectStore(It,{keyPath:"sequenceId",autoIncrement:!0})).createIndex("sessionId","sessionId"),{sequencesStore:t,currentSequenceStore:n}},Tt=function(e){return i(void 0,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,at(e,1,{upgrade:Pt})];case 1:return[2,t.sent()]}}))}))},Rt=function(e){function n(t){var n=e.call(this,t)||this;return n.getSequencesToSend=function(){return i(n,void 0,void 0,(function(){var e,t,n,r,o,i;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,5,,6]),e=[],[4,this.db.transaction("sequencesToSend").store.openCursor()];case 1:t=s.sent(),s.label=2;case 2:return t?(n=t.value,r=n.sessionId,o=n.events,e.push({events:o,sequenceId:t.key,sessionId:r}),[4,t.continue()]):[3,4];case 3:return t=s.sent(),[3,2];case 4:return[2,e];case 5:return i=s.sent(),this.loggerProvider.warn("".concat(Ge,": ").concat(i)),[3,6];case 6:return[2,void 0]}}))}))},n.storeCurrentSequence=function(e){return i(n,void 0,void 0,(function(){var t,n,r;return s(this,(function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),[4,this.db.get(wt,e)];case 1:return(t=i.sent())?[4,this.db.put(It,{sessionId:e,events:t.events})]:[2,void 0];case 2:return n=i.sent(),[4,this.db.put(wt,{sessionId:e,events:[]})];case 3:return i.sent(),[2,o(o({},t),{sessionId:e,sequenceId:n})];case 4:return r=i.sent(),this.loggerProvider.warn("".concat(Ge,": ").concat(r)),[3,5];case 5:return[2,void 0]}}))}))},n.addEventToCurrentSequence=function(e,t){return i(n,void 0,void 0,(function(){var n,r,o,i,a,u;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,10,,11]),[4,(n=this.db.transaction(wt,"readwrite")).store.get(e)];case 1:return(r=s.sent())?[3,3]:[4,n.store.put({sessionId:e,events:[t]})];case 2:return s.sent(),[2];case 3:return o=void 0,this.shouldSplitEventsList(r.events,t)?(o=r.events,[4,n.store.put({sessionId:e,events:[t]})]):[3,5];case 4:return s.sent(),[3,7];case 5:return i=r.events.concat(t),[4,n.store.put({sessionId:e,events:i})];case 6:s.sent(),s.label=7;case 7:return[4,n.done];case 8:return s.sent(),o?[4,this.storeSendingEvents(e,o)]:[2,void 0];case 9:return(a=s.sent())?[2,{events:o,sessionId:e,sequenceId:a}]:[2,void 0];case 10:return u=s.sent(),this.loggerProvider.warn("".concat(Ge,": ").concat(u)),[3,11];case 11:return[2,void 0]}}))}))},n.storeSendingEvents=function(e,t){return i(n,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.db.put(It,{sessionId:e,events:t})];case 1:return[2,r.sent()];case 2:return n=r.sent(),this.loggerProvider.warn("".concat(Ge,": ").concat(n)),[3,3];case 3:return[2,void 0]}}))}))},n.cleanUpSessionEventsStore=function(e,t){return i(n,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:if(!t)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.db.delete(It,t)];case 2:return n.sent(),[3,4];case 3:return e=n.sent(),this.loggerProvider.warn("".concat(Ge,": ").concat(e)),[3,4];case 4:return[2]}}))}))},n.transitionFromKeyValStore=function(e){return i(n,void 0,void 0,(function(){var t,n,r,o,a,l,f,v,h=this;return s(this,(function(p){switch(p.label){case 0:return p.trys.push([0,6,,7]),[4,Et()];case 1:if(!(t=p.sent()))return[2];n=function(e,t){return i(h,void 0,void 0,(function(){var n,r,o=this;return s(this,(function(a){switch(a.label){case 0:return n=t.sessionSequences,r=[],Object.keys(n).forEach((function(a){var l=parseInt(a,10),d=n[l];if(l===t.currentSequenceId){var f=d.events.map((function(t){return i(o,void 0,void 0,(function(){return s(this,(function(n){return[2,this.addEventToCurrentSequence(e,t)]}))}))}));r.push.apply(r,c([],u(f),!1))}else d.status!==bt.SENT&&r.push(o.storeSendingEvents(e,d.events))})),[4,Ct(r)];case 1:return a.sent(),[2]}}))}))},r="".concat(d,"_").concat(this.apiKey.substring(0,10)),p.label=2;case 2:return p.trys.push([2,4,,5]),o=t.transaction("keyval").objectStore("keyval").getAll(r),a=new Promise((function(t){o.onsuccess=function(r){return i(h,void 0,void 0,(function(){var o,i,a,u=this;return s(this,(function(s){switch(s.label){case 0:return o=r&&r.target.result,(i=o&&o[0])?(a=[],Object.keys(i).forEach((function(t){var r=parseInt(t,10),o=i[r];if(e===r)a.push(n(r,o));else{var s=o.sessionSequences;Object.keys(s).forEach((function(e){var t=parseInt(e,10);s[t].status!==bt.SENT&&a.push(u.storeSendingEvents(r,s[t].events))}))}})),[4,Ct(a)]):[3,2];case 1:s.sent(),s.label=2;case 2:return t(),[2]}}))}))}})),[4,a];case 3:return p.sent(),(l=g())&&l.indexedDB.deleteDatabase("keyval-store"),[3,5];case 4:return f=p.sent(),this.loggerProvider.warn("Failed to transition session replay events from keyval to new store: ".concat(f)),[3,5];case 5:return[3,7];case 6:return v=p.sent(),this.loggerProvider.warn("Failed to access keyval store: ".concat(v,". For more information, visit: https://www.docs.developers.amplitude.com/session-replay/sdks/standalone/#indexeddb-best-practices")),[3,7];case 7:return[2]}}))}))},n.apiKey=t.apiKey,n.db=t.db,n}return t(n,e),n.new=function(e,t,r){return i(this,void 0,void 0,(function(){var i,a,u,c,l;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),i="replay"===e?"":"_".concat(e),a="".concat(t.apiKey.substring(0,10),"_amp_session_replay_events").concat(i),[4,Tt(a)];case 1:return u=s.sent(),[4,(c=new n(o(o({},t),{db:u}))).transitionFromKeyValStore(r)];case 2:return s.sent(),[2,c];case 3:return l=s.sent(),t.loggerProvider.warn("".concat(Ge,": ").concat(l)),[3,4];case 4:return[2]}}))}))},n.prototype.getCurrentSequenceEvents=function(e){return i(this,void 0,void 0,(function(){var t,n,r,o,i,u,c;return s(this,(function(s){switch(s.label){case 0:return e?[4,this.db.get("sessionCurrentSequence",e)]:[3,2];case 1:return(o=s.sent())?[2,[o]]:[2,void 0];case 2:t=[],s.label=3;case 3:return s.trys.push([3,8,9,10]),[4,this.db.getAll("sessionCurrentSequence")];case 4:n=a.apply(void 0,[s.sent()]),r=n.next(),s.label=5;case 5:if(r.done)return[3,7];o=r.value,t.push(o),s.label=6;case 6:return r=n.next(),[3,5];case 7:return[3,10];case 8:return i=s.sent(),u={error:i},[3,10];case 9:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 10:return[2,t]}}))}))},n}(St),_t=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.finalizedSequences={},t.sequences={},t.sequenceId=0,t}return t(n,e),n.prototype.resetCurrentSequence=function(e){this.sequences[e]=[]},n.prototype.addSequence=function(e){var t=this.sequenceId++,n=c([],u(this.sequences[e]),!1);return this.finalizedSequences[t]={sessionId:e,events:n},this.resetCurrentSequence(e),{sequenceId:t,events:n,sessionId:e}},n.prototype.getSequencesToSend=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,Object.entries(this.finalizedSequences).map((function(e){var t=u(e,2),n=t[0],r=t[1],o=r.sessionId,i=r.events;return{sequenceId:Number(n),sessionId:o,events:i}}))]}))}))},n.prototype.storeCurrentSequence=function(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){return this.sequences[e]?[2,this.addSequence(e)]:[2,void 0]}))}))},n.prototype.addEventToCurrentSequence=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return this.sequences[e]||this.resetCurrentSequence(e),this.shouldSplitEventsList(this.sequences[e],t)&&(n=this.addSequence(e)),this.sequences[e].push(t),[2,n]}))}))},n.prototype.storeSendingEvents=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(n){return this.finalizedSequences[this.sequenceId]={sessionId:e,events:t},[2,this.sequenceId++]}))}))},n.prototype.cleanUpSessionEventsStore=function(e,t){return i(this,void 0,void 0,(function(){return s(this,(function(e){return void 0!==t&&delete this.finalizedSequences[t],[2]}))}))},n}(St),kt=function(e){var t=e.config,n=e.sessionId,r=e.minInterval,a=e.maxInterval,u=e.type,c=e.payloadBatcher,l=e.storeType;return i(void 0,void 0,void 0,(function(){function e(e){return void 0===e&&(e=!1),i(this,void 0,void 0,(function(){return s(this,(function(t){return[2,d.flush(e)]}))}))}var d,f,v,h,g,p,y,m,b;return s(this,(function(S){switch(S.label){case 0:return d=new Qe(o(o({},t),{loggerProvider:t.loggerProvider,payloadBatcher:c})),f=function(){return new _t({loggerProvider:t.loggerProvider,maxInterval:a,minInterval:r})},v=function(){return i(void 0,void 0,void 0,(function(){var e;return s(this,(function(o){switch(o.label){case 0:return[4,Rt.new(u,{loggerProvider:t.loggerProvider,minInterval:r,maxInterval:a,apiKey:t.apiKey},n)];case 1:return e=o.sent(),t.loggerProvider.log("Failed to initialize idb store, falling back to memory store."),[2,null!=e?e:f()]}}))}))},"idb"!==l?[3,2]:[4,v()];case 1:return g=S.sent(),[3,3];case 2:g=f(),S.label=3;case 3:return h=g,p=function(e){var n=e.events,r=e.sessionId,o=e.deviceId,a=e.sequenceId;t.debugMode&&Y().then((function(e){var n=e.totalStorageSize,r=e.percentOfQuota,o=e.usageDetails;t.loggerProvider.debug("Total storage size: ".concat(n," KB, percentage of quota: ").concat(r,"%, usage details: ").concat(o))})).catch((function(){})),d.sendEventsList({events:n,sessionId:r,flushMaxRetries:t.flushMaxRetries,apiKey:t.apiKey,deviceId:o,sampleRate:t.sampleRate,serverZone:t.serverZone,version:t.version,type:u,onComplete:function(){return i(void 0,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,h.cleanUpSessionEventsStore(r,a)];case 1:return e.sent(),[2]}}))}))}})},y=function(e){var n=e.sessionId,r=e.deviceId;h.storeCurrentSequence(n).then((function(e){e&&p({sequenceId:e.sequenceId,events:e.events,sessionId:e.sessionId,deviceId:r})})).catch((function(e){t.loggerProvider.warn("Failed to get current sequence of session replay events for session:",e)}))},m=function(e){var t=e.deviceId;return i(void 0,void 0,void 0,(function(){var e;return s(this,(function(n){switch(n.label){case 0:return[4,h.getSequencesToSend()];case 1:return(e=n.sent())&&e.forEach((function(e){p({sequenceId:e.sequenceId,events:e.events,sessionId:e.sessionId,deviceId:t})})),[2]}}))}))},b=function(e){var n=e.event,r=e.sessionId,o=e.deviceId;h.addEventToCurrentSequence(r,n.data).then((function(e){return e&&p({sequenceId:e.sequenceId,events:e.events,sessionId:e.sessionId,deviceId:o})})).catch((function(e){t.loggerProvider.warn("Failed to add event to session replay capture:",e)}))},[2,{sendCurrentSequenceEvents:y,addEvent:b,sendStoredEvents:m,flush:e}]}}))}))},xt=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=new Map;e.forEach((function(e){n.set(e.name,e.manager)})),this.managers=n}return e.prototype.sendStoredEvents=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=[],this.managers.forEach((function(n){t.push(n.sendStoredEvents(e))})),[4,Promise.all(t)];case 1:return n.sent(),[2]}}))}))},e.prototype.addEvent=function(e){var t,n=e.sessionId,r=e.event,o=e.deviceId;null===(t=this.managers.get(r.type))||void 0===t||t.addEvent({sessionId:n,event:r,deviceId:o})},e.prototype.sendCurrentSequenceEvents=function(e){var t=e.sessionId,n=e.deviceId;this.managers.forEach((function(e){e.sendCurrentSequenceEvents({sessionId:t,deviceId:n})}))},e.prototype.flush=function(e){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return t=[],this.managers.forEach((function(n){t.push(n.flush(e))})),[4,Promise.all(t)];case 1:return n.sent(),[2]}}))}))},e}();const Ot={Node:["childNodes","parentNode","parentElement","textContent"],ShadowRoot:["host","styleSheets"],Element:["shadowRoot","querySelector","querySelectorAll"],MutationObserver:[]},Mt={Node:["contains","getRootNode"],ShadowRoot:["getSelection"],Element:[],MutationObserver:["constructor"]},Dt={};function qt(e){if(Dt[e])return Dt[e];const t=function(e){var t,n;const r=null==(n=null==(t=null==globalThis?void 0:globalThis.Zone)?void 0:t.__symbol__)?void 0:n.call(t,e);return r&&globalThis[r]?globalThis[r]:void 0}(e)||globalThis[e],n=t.prototype,r=e in Ot?Ot[e]:void 0,o=Boolean(r&&r.every((e=>{var t,r;return Boolean(null==(r=null==(t=Object.getOwnPropertyDescriptor(n,e))?void 0:t.get)?void 0:r.toString().includes("[native code]"))}))),i=e in Mt?Mt[e]:void 0,s=Boolean(i&&i.every((e=>{var t;return"function"==typeof n[e]&&(null==(t=n[e])?void 0:t.toString().includes("[native code]"))})));if(o&&s)return Dt[e]=t.prototype,t.prototype;try{const r=document.createElement("iframe");document.body.appendChild(r);const o=r.contentWindow;if(!o)return t.prototype;const i=o[e].prototype;return document.body.removeChild(r),i?Dt[e]=i:n}catch{return n}}const Lt={};function Nt(e,t,n){var r;const o=`${e}.${String(n)}`;if(Lt[o])return Lt[o].call(t);const i=qt(e),s=null==(r=Object.getOwnPropertyDescriptor(i,n))?void 0:r.get;return s?(Lt[o]=s,s.call(t)):t[n]}const Ut={};function At(e,t,n){const r=`${e}.${String(n)}`;if(Ut[r])return Ut[r].bind(t);const o=qt(e)[n];return"function"!=typeof o?t[n]:(Ut[r]=o,o.bind(t))}const jt={childNodes:function(e){return Nt("Node",e,"childNodes")},parentNode:function(e){return Nt("Node",e,"parentNode")},parentElement:function(e){return Nt("Node",e,"parentElement")},textContent:function(e){return Nt("Node",e,"textContent")},contains:function(e,t){return At("Node",e,"contains")(t)},getRootNode:function(e){return At("Node",e,"getRootNode")()},host:function(e){return e&&"host"in e?Nt("ShadowRoot",e,"host"):null},styleSheets:function(e){return e.styleSheets},shadowRoot:function(e){return e&&"shadowRoot"in e?Nt("Element",e,"shadowRoot"):null},querySelector:function(e,t){return Nt("Element",e,"querySelector")(t)},querySelectorAll:function(e,t){return Nt("Element",e,"querySelectorAll")(t)},mutationObserver:function(){return qt("MutationObserver").constructor}};function Ft(){var e=g();return(null==e?void 0:e.innerHeight)||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight||0}function Bt(){var e=g();return(null==e?void 0:e.innerWidth)||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth||0}var Kt,$t,Wt;function zt(e,t){if(Wt=new Date,e.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if("html"===e.tagName.toLowerCase())return"html";var n={root:document.body,idName:function(e){return!0},className:function(e){return!0},tagName:function(e){return!0},attr:function(e,t){return!1},seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4,timeoutMs:void 0};Kt=o(o({},n),t),$t=function(e,t){if(e.nodeType===Node.DOCUMENT_NODE)return e;if(e===t.root)return e.ownerDocument;return e}(Kt.root,n);var r=Gt(e,"all",(function(){return Gt(e,"two",(function(){return Gt(e,"one",(function(){return Gt(e,"none")}))}))}));if(r){var i=nn(rn(r,e));return i.length>0&&(r=i[0]),Qt(r)}throw new Error("Selector was not found.")}function Gt(e,t,n){for(var r=null,o=[],i=e,s=0,l=function(){var e,l,d=(new Date).getTime()-Wt.getTime();if(void 0!==Kt.timeoutMs&&d>Kt.timeoutMs)throw new Error("Timeout: Can't find a unique selector after ".concat(d,"ms"));var f=Yt(function(e){var t=e.getAttribute("id");if(t&&Kt.idName(t))return{name:"#"+CSS.escape(t),penalty:0};return null}(i))||Yt.apply(void 0,c([],u(function(e){var t=Array.from(e.attributes).filter((function(e){return Kt.attr(e.name,e.value)}));return t.map((function(e){return{name:"[".concat(CSS.escape(e.name),'="').concat(CSS.escape(e.value),'"]'),penalty:.5}}))}(i)),!1))||Yt.apply(void 0,c([],u(function(e){var t=Array.from(e.classList).filter(Kt.className);return t.map((function(e){return{name:"."+CSS.escape(e),penalty:1}}))}(i)),!1))||Yt(function(e){var t=e.tagName.toLowerCase();if(Kt.tagName(t))return{name:t,penalty:2};return null}(i))||[{name:"*",penalty:3}],v=function(e){var t=e.parentNode;if(!t)return null;var n=t.firstChild;if(!n)return null;var r=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&r++,n!==e);)n=n.nextSibling;return r}(i);if("all"==t)v&&(f=f.concat(f.filter(Xt).map((function(e){return Zt(e,v)}))));else if("two"==t)f=f.slice(0,1),v&&(f=f.concat(f.filter(Xt).map((function(e){return Zt(e,v)}))));else if("one"==t){var h=u(f=f.slice(0,1),1)[0];v&&Xt(h)&&(f=[Zt(h,v)])}else"none"==t&&(f=[{name:"*",penalty:3}],v&&(f=[Zt(f[0],v)]));try{for(var g=(e=void 0,a(f)),p=g.next();!p.done;p=g.next()){(h=p.value).level=s}}catch(t){e={error:t}}finally{try{p&&!p.done&&(l=g.return)&&l.call(g)}finally{if(e)throw e.error}}if(o.push(f),o.length>=Kt.seedMinLength&&(r=Vt(o,n)))return"break";i=i.parentElement,s++};i;){if("break"===l())break}return r||(r=Vt(o,n)),!r&&n?n():r}function Vt(e,t){var n,r,o=nn(tn(e));if(o.length>Kt.threshold)return t?t():null;try{for(var i=a(o),s=i.next();!s.done;s=i.next()){var u=s.value;if(Jt(u))return u}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return null}function Qt(e){for(var t=e[0],n=t.name,r=1;r<e.length;r++){var o=e[r].level||0;n=t.level===o-1?"".concat(e[r].name," > ").concat(n):"".concat(e[r].name," ").concat(n),t=e[r]}return n}function Ht(e){return e.map((function(e){return e.penalty})).reduce((function(e,t){return e+t}),0)}function Jt(e){var t=Qt(e);switch($t.querySelectorAll(t).length){case 0:throw new Error("Can't select any node with this selector: ".concat(t));case 1:return!0;default:return!1}}function Zt(e,t){return{name:e.name+":nth-child(".concat(t,")"),penalty:e.penalty+1}}function Xt(e){return"html"!==e.name&&!e.name.startsWith("#")}function Yt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.filter(en);return n.length>0?n:null}function en(e){return null!=e}function tn(e,t){var n,r,o,i,u,c;return void 0===t&&(t=[]),s(this,(function(s){switch(s.label){case 0:if(!(e.length>0))return[3,9];s.label=1;case 1:s.trys.push([1,6,7,8]),n=a(e[0]),r=n.next(),s.label=2;case 2:return r.done?[3,5]:(o=r.value,[5,a(tn(e.slice(1,e.length),t.concat(o)))]);case 3:s.sent(),s.label=4;case 4:return r=n.next(),[3,2];case 5:return[3,8];case 6:return i=s.sent(),u={error:i},[3,8];case 7:try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(u)throw u.error}return[7];case 8:return[3,11];case 9:return[4,t];case 10:s.sent(),s.label=11;case 11:return[2]}}))}function nn(e){return c([],u(e),!1).sort((function(e,t){return Ht(e)-Ht(t)}))}function rn(e,t,n){var r,o,i;return void 0===n&&(n={counter:0,visited:new Map}),s(this,(function(s){switch(s.label){case 0:if(!(e.length>2&&e.length>Kt.optimizedMinLength))return[3,5];r=1,s.label=1;case 1:return r<e.length-1?n.counter>Kt.maxNumberOfTries?[2]:(n.counter+=1,(o=c([],u(e),!1)).splice(r,1),i=Qt(o),n.visited.has(i)?[2]:Jt(o)&&function(e,t){return $t.querySelector(Qt(e))===t}(o,t)?[4,o]:[3,4]):[3,5];case 2:return s.sent(),n.visited.set(i,!0),[5,a(rn(o,t,n))];case 3:s.sent(),s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}var on=function(e){var t=e.version,n=e.events,r=[];return n.forEach((function(e){var t=JSON.parse(e);t.count=1,"click"===t.type&&r.push(t)})),{version:t,events:r}},sn=function(e){var t=e.version,n=e.events,r=[];n.forEach((function(e){var t=JSON.parse(e);"click"===t.type&&r.push(t)}));var i=r.reduce((function(e,t){var n=t.x,r=t.y,i=t.selector,s=t.timestamp,a=s-s%36e5,u="".concat(n,":").concat(r,":").concat(null!=i?i:"",":").concat(a);return e[u]?e[u].count+=1:e[u]=o(o({},t),{timestamp:a,count:1}),e}),{});return{version:t,events:Object.values(i)}},an=function(e,t){var n=t.eventsManager,r=t.sessionId,o=t.deviceIdFn,i=t.mirror,s=t.ugcFilterRules;return function(t){if(t.type===oe.Click){var a=g();if(a){var u=a.location,c=a.innerHeight,l=a.innerWidth;if(u){var d=t.x,f=t.y;if(void 0!==d&&void 0!==f){var v,h=i.getNode(t.id);if(h)try{v=zt(h)}catch(t){e.debug("error resolving selector from finder")}var p=function(e){var t,n,r,o,i=e.document;return{left:i.scrollingElement?i.scrollingElement.scrollLeft:void 0!==e.pageXOffset?e.pageXOffset:i.documentElement.scrollLeft||(null==i?void 0:i.body)&&(null===(t=jt.parentElement(i.body))||void 0===t?void 0:t.scrollLeft)||(null===(n=null==i?void 0:i.body)||void 0===n?void 0:n.scrollLeft)||0,top:i.scrollingElement?i.scrollingElement.scrollTop:void 0!==e.pageYOffset?e.pageYOffset:(null==i?void 0:i.documentElement.scrollTop)||(null==i?void 0:i.body)&&(null===(r=jt.parentElement(i.body))||void 0===r?void 0:r.scrollTop)||(null===(o=null==i?void 0:i.body)||void 0===o?void 0:o.scrollTop)||0}}(a),y={x:d+p.left,y:f+p.top,selector:v,viewportHeight:c,viewportWidth:l,pageUrl:X(u.href,s),timestamp:Date.now(),type:"click"},m=o();m&&n.addEvent({sessionId:r,event:{type:"interaction",data:JSON.stringify(y)},deviceId:m})}}}}}},un=function(){function e(e,t){var n=g();n&&n.navigator&&"function"==typeof n.navigator.sendBeacon?this.sendBeacon=function(e,t){try{if(n.navigator.sendBeacon(e,JSON.stringify(t)))return!0}catch(e){}return!1}:this.sendBeacon=function(){return!1},this.sendXhr=function(e,t){var n=new XMLHttpRequest;return n.open("POST",e,!0),n.setRequestHeader("Accept","*/*"),n.send(JSON.stringify(t)),!0},this.basePageUrl=Z(t.serverZone,t.trackServerUrl),this.apiKey=t.apiKey,this.context=e}return e.prototype.send=function(e,t){var n=this.context,r=n.sessionId,o=n.type,i=new URLSearchParams({device_id:e,session_id:String(r),type:String(o),api_key:this.apiKey}),s="".concat(this.basePageUrl,"?").concat(i.toString());this.sendBeacon(s,t)||this.sendXhr(s,t)},e}(),cn=function(){function e(e,t){var n=this;this.timestamp=Date.now(),this.hook=function(e){n.update(e)},this.send=function(e){return function(t){var r,o,i=e(),s=g();s&&i&&n.transport.send(i,{version:1,events:[{maxScrollX:n._maxScrollX,maxScrollY:n._maxScrollY,maxScrollWidth:n._maxScrollWidth,maxScrollHeight:n._maxScrollHeight,viewportHeight:Ft(),viewportWidth:Bt(),pageUrl:X(s.location.href,null!==(o=null===(r=n.config.interactionConfig)||void 0===r?void 0:r.ugcFilterRules)&&void 0!==o?o:[]),timestamp:n.timestamp,type:"scroll"}]})}},this._maxScrollX=0,this._maxScrollY=0,this._maxScrollWidth=Bt(),this._maxScrollHeight=Ft(),this.config=t,this.transport=e}return e.default=function(t,n){return new e(new un(t,n),n)},Object.defineProperty(e.prototype,"maxScrollX",{get:function(){return this._maxScrollX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxScrollY",{get:function(){return this._maxScrollY},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxScrollWidth",{get:function(){return this._maxScrollWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxScrollHeight",{get:function(){return this._maxScrollHeight},enumerable:!1,configurable:!0}),e.prototype.update=function(e){var t=Date.now();if(e.x>this._maxScrollX){var n=Bt();this._maxScrollX=e.x;var r=e.x+n;r>this._maxScrollWidth&&(this._maxScrollWidth=r),this.timestamp=t}if(e.y>this._maxScrollY){var o=Ft();this._maxScrollY=e.y;var i=e.y+o;i>this._maxScrollHeight&&(this._maxScrollHeight=i),this.timestamp=t}},e}(),ln=function(e){var t=e.sessionId,n=e.deviceId;this.deviceId=n,this.sessionId=t,t&&n&&(this.sessionReplayId=function(e,t){return"".concat(t,"/").concat(e)}(t,n))},dn=function(){var e=this;this.dbs={},this.createStore=function(t){return i(e,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,at(t,1,{upgrade:function(e){e.objectStoreNames.contains("sessionTargetingMatch")||e.createObjectStore("sessionTargetingMatch",{keyPath:"sessionId"})}})];case 1:return[2,e.sent()]}}))}))},this.openOrCreateDB=function(t){return i(e,void 0,void 0,(function(){var e,n;return s(this,(function(r){switch(r.label){case 0:return this.dbs&&this.dbs[t]?[2,this.dbs[t]]:(e="".concat(t.substring(0,10),"_amp_session_replay_targeting"),[4,this.createStore(e)]);case 1:return n=r.sent(),this.dbs[t]=n,[2,n]}}))}))},this.getTargetingMatchForSession=function(t){var n=t.loggerProvider,r=t.apiKey,o=t.sessionId;return i(e,void 0,void 0,(function(){var e,t,i,a;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,this.openOrCreateDB(r)];case 1:return e=s.sent(),t=String(o),[4,e.get("sessionTargetingMatch",t)];case 2:return[2,null==(i=s.sent())?void 0:i.targetingMatch];case 3:return a=s.sent(),n.warn("Failed to get targeting match for session id ".concat(o,": ").concat(a)),[3,4];case 4:return[2,void 0]}}))}))},this.storeTargetingMatchForSession=function(t){var n=t.loggerProvider,r=t.apiKey,o=t.sessionId,a=t.targetingMatch;return i(e,void 0,void 0,(function(){var e,t,i;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,this.openOrCreateDB(r)];case 1:return e=s.sent(),t=String(o),[4,e.put("sessionTargetingMatch",{targetingMatch:a,sessionId:t,lastUpdated:Date.now()})];case 2:return[2,s.sent()];case 3:return i=s.sent(),n.warn("Failed to store targeting match for session id ".concat(o,": ").concat(i)),[3,4];case 4:return[2,void 0]}}))}))},this.clearStoreOfOldSessions=function(t){var n=t.loggerProvider,r=t.apiKey,o=t.currentSessionId;return i(e,void 0,void 0,(function(){var e,t,i,a,u,c,l,d;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,8,,9]),[4,this.openOrCreateDB(r)];case 1:return e=s.sent(),t=String(o),[4,(i=e.transaction("sessionTargetingMatch","readwrite")).store.getAll()];case 2:a=s.sent(),u=0,s.label=3;case 3:return u<a.length?(c=a[u],l=Date.now()-c.lastUpdated,c.sessionId!==t&&l>1728e5?[4,i.store.delete(c.sessionId)]:[3,5]):[3,6];case 4:s.sent(),s.label=5;case 5:return u++,[3,3];case 6:return[4,i.done];case 7:return s.sent(),[3,9];case 8:return d=s.sent(),n.warn("Failed to clear old targeting matches for sessions: ".concat(d)),[3,9];case 9:return[2]}}))}))}},fn=new dn,vn=function(e){var t=e.sessionId,n=e.targetingConfig,r=e.loggerProvider,a=e.apiKey,u=e.targetingParams;return i(void 0,void 0,void 0,(function(){var e,i,c,l;return s(this,(function(s){switch(s.label){case 0:return[4,fn.clearStoreOfOldSessions({loggerProvider:r,apiKey:a,currentSessionId:t})];case 1:return s.sent(),[4,fn.getTargetingMatchForSession({loggerProvider:r,apiKey:a,sessionId:t})];case 2:if(!0===s.sent())return[2,!0];e=!0,s.label=3;case 3:return s.trys.push([3,6,,7]),[4,import("./index-min2.js")];case 4:return[4,(0,s.sent().evaluateTargeting)(o(o({},u),{flag:n,sessionId:t,apiKey:a,loggerProvider:r}))];case 5:return(i=s.sent())&&i.sr_targeting_config&&(e="on"===i.sr_targeting_config.key),fn.storeTargetingMatchForSession({loggerProvider:r,apiKey:a,sessionId:t,targetingMatch:e}),[3,7];case 6:return c=s.sent(),l=c,r.warn(l.message),[3,7];case 7:return[2,e]}}))}))};function hn(e){return void 0===e&&(e={}),{name:"amplitude/url-tracking@1",observer:function(t,n,r){var i,s,a,u=o(o({},e),r),c=u.ugcFilterRules||[],l=null!==(i=u.enablePolling)&&void 0!==i&&i,d=null!==(s=u.pollingInterval)&&void 0!==s?s:1e3,f=null!==(a=u.captureDocumentTitle)&&void 0!==a&&a;if(!n)return function(){};var v=void 0,h=function(){return n.location&&n.location.href||""},g=function(){var e=h();if(void 0===v||e!==v){v=e;var r=function(){var e=n.innerHeight,t=n.innerWidth,r=n.document,o=h(),i="";return f&&(i=(null==r?void 0:r.title)||""),{href:c.length>0?X(o,c):o,title:i,viewportHeight:e,viewportWidth:t,type:"url-change-event"}}();t(r)}},p=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=e.apply(this,t);return g(),r}},y=function(){g()};if(l){var m=n.setInterval((function(){g()}),d);return g(),function(){m&&n.clearInterval(m)}}if(n.history){var b=n.history.pushState.bind(n.history),S=n.history.replaceState.bind(n.history);return n.history.pushState=p(b),n.history.replaceState=p(S),n.addEventListener("popstate",g),n.addEventListener("hashchange",y),g(),function(){n.history.pushState=b,n.history.replaceState=S,n.removeEventListener("popstate",g),n.removeEventListener("hashchange",y)}}return n.addEventListener("hashchange",y),g(),function(){n.removeEventListener("hashchange",y)}},options:e}}hn();var gn,pn,yn,mn=function(){function e(){var e=this;this.name="@amplitude/session-replay-browser",this.recordCancelCallback=null,this.eventCount=0,this.sessionTargetingMatch=!1,this.pageLeaveFns=[],this.recordFunction=null,this.teardownEventListeners=function(t){var n=g();n&&(n.removeEventListener("blur",e.blurListener),n.removeEventListener("focus",e.focusListener),!t&&n.addEventListener("blur",e.blurListener),!t&&n.addEventListener("focus",e.focusListener),n.self&&"onpagehide"in n.self?(n.removeEventListener("pagehide",e.pageLeaveListener),!t&&n.addEventListener("pagehide",e.pageLeaveListener)):(n.removeEventListener("beforeunload",e.pageLeaveListener),!t&&n.addEventListener("beforeunload",e.pageLeaveListener)))},this.blurListener=function(){e.sendEvents()},this.focusListener=function(){e.recordEvents(!1)},this.pageLeaveListener=function(t){e.pageLeaveFns.forEach((function(e){e(t)}))},this.evaluateTargetingAndCapture=function(t,n){return void 0===n&&(n=!1),i(e,void 0,void 0,(function(){var e,o;return s(this,(function(i){switch(i.label){case 0:return this.identifiers&&this.identifiers.sessionId&&this.config?(this.lastTargetingParams=t,!this.config.targetingConfig||this.sessionTargetingMatch?[3,2]:((e=t.event)&&Object.values(r).includes(e.event_type)&&(e=void 0),o=this,[4,vn({sessionId:this.identifiers.sessionId,targetingConfig:this.config.targetingConfig,loggerProvider:this.loggerProvider,apiKey:this.config.apiKey,targetingParams:{userProperties:t.userProperties,event:e}})])):(this.identifiers&&!this.identifiers.sessionId?this.loggerProvider.log("Session ID has not been set yet, cannot evaluate targeting for Session Replay."):this.loggerProvider.warn("Session replay init has not been called, cannot evaluate targeting."),[2]);case 1:o.sessionTargetingMatch=i.sent(),this.loggerProvider.debug(JSON.stringify({name:"targeted replay capture config",sessionTargetingMatch:this.sessionTargetingMatch,event:e,targetingParams:t},null,2)),i.label=2;case 2:return n?(this.initialize(!0),[3,5]):[3,3];case 3:return[4,this.recordEvents()];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},this.addCustomRRWebEvent=function(t,n,r){return void 0===n&&(n={}),void 0===r&&(r=!0),i(e,void 0,void 0,(function(){var e,i,a,u;return s(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),e=void 0,(i=this.config)&&t!==U.METADATA?(e={config:ee(i),version:Ve},r?[4,Y()]:[3,2]):[3,2];case 1:a=s.sent(),e=o(o({},a),e),s.label=2;case 2:return this.recordCancelCallback&&this.recordFunction?this.recordFunction.addCustomEvent(t,o(o({},n),e)):this.loggerProvider.debug("Not able to add custom replay capture event ".concat(t," due to no ongoing recording.")),[3,4];case 3:return u=s.sent(),this.loggerProvider.debug("Error while adding custom replay capture event: ",u),[3,4];case 4:return[2]}}))}))},this.stopRecordingEvents=function(){var t;try{e.loggerProvider.log("Session Replay capture stopping."),e.recordCancelCallback&&e.recordCancelCallback(),e.recordCancelCallback=null,null===(t=e.networkObservers)||void 0===t||t.stop()}catch(t){var n=t;e.loggerProvider.warn("Error occurred while stopping replay capture: ".concat(n.toString()))}},this.loggerProvider=new W(new m)}return e.prototype.init=function(e,t){return p(this._init(e,t))},e.prototype._init=function(e,t){var n,r,o,a,l,d;return i(this,void 0,void 0,(function(){var i,f,v,h,p,y,b,S,w,I,E,C,P,T;return s(this,(function(s){switch(s.label){case 0:return this.loggerProvider=new W(t.loggerProvider||new m),Object.prototype.hasOwnProperty.call(t,"logLevel")&&this.loggerProvider.enable(t.logLevel),this.identifiers=new ln({sessionId:t.sessionId,deviceId:t.deviceId}),i=this,[4,de(e,t)];case 1:return i.joinedConfigGenerator=s.sent(),[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)];case 2:f=s.sent(),v=f.joinedConfig,h=f.localConfig,p=f.remoteConfig,this.config=v,this.setMetadata(t.sessionId,v,h,p,null===(n=t.version)||void 0===n?void 0:n.version,Ve,null===(r=t.version)||void 0===r?void 0:r.type),t.sessionId&&(null===(o=this.config.interactionConfig)||void 0===o?void 0:o.enabled)&&(y=cn.default({sessionId:t.sessionId,type:"interaction"},this.config),this.pageLeaveFns=[y.send(this.getDeviceId.bind(this)).bind(y)],this.scrollHook=y.hook.bind(y)),b=[],"idb"!==(S=this.config.storeType)||(null===(a=g())||void 0===a?void 0:a.indexedDB)||(S="memory",this.loggerProvider.warn("Could not use preferred indexedDB storage, reverting to in memory option.")),this.loggerProvider.log("Using ".concat(S," for event storage.")),s.label=3;case 3:return s.trys.push([3,5,,6]),[4,kt({config:this.config,sessionId:this.identifiers.sessionId,type:"replay",storeType:S})];case 4:return w=s.sent(),b.push({name:"replay",manager:w}),[3,6];case 5:return I=s.sent(),T=I,this.loggerProvider.warn("Error occurred while creating replay events manager: ".concat(T.toString())),[3,6];case 6:if(!(null===(l=this.config.interactionConfig)||void 0===l?void 0:l.enabled))return[3,10];E=this.config.interactionConfig.batch?sn:on,s.label=7;case 7:return s.trys.push([7,9,,10]),[4,kt({config:this.config,sessionId:this.identifiers.sessionId,type:"interaction",minInterval:null!==(d=this.config.interactionConfig.trackEveryNms)&&void 0!==d?d:3e4,maxInterval:6e4,payloadBatcher:E,storeType:S})];case 8:return C=s.sent(),b.push({name:"interaction",manager:C}),[3,10];case 9:return P=s.sent(),T=P,this.loggerProvider.warn("Error occurred while creating interaction events manager: ".concat(T.toString())),[3,10];case 10:return this.eventsManager=new(xt.bind.apply(xt,c([void 0],u(b),!1))),this.eventCompressor&&this.eventCompressor.terminate(),this.eventCompressor=new ze(this.eventsManager,this.config,this.getDeviceId()),[4,this.initializeNetworkObservers()];case 11:return s.sent(),this.loggerProvider.log("Installing @amplitude/session-replay-browser."),this.teardownEventListeners(!1),[4,this.evaluateTargetingAndCapture({userProperties:t.userProperties},!0)];case 12:return s.sent(),[2]}}))}))},e.prototype.setSessionId=function(e,t){return p(this.asyncSetSessionId(e,t))},e.prototype.asyncSetSessionId=function(e,t,n){return i(this,void 0,void 0,(function(){var r,o,i;return s(this,(function(s){switch(s.label){case 0:return this.sessionTargetingMatch=!1,this.lastShouldRecordDecision=void 0,(r=this.identifiers&&this.identifiers.sessionId)&&this.sendEvents(r),o=t||this.getDeviceId(),this.identifiers=new ln({sessionId:e,deviceId:o}),this.joinedConfigGenerator&&r?[4,this.joinedConfigGenerator.generateJoinedConfig(this.identifiers.sessionId)]:[3,2];case 1:i=s.sent().joinedConfig,this.config=i,s.label=2;case 2:return[4,this.evaluateTargetingAndCapture({userProperties:null==n?void 0:n.userProperties})];case 3:return s.sent(),[2]}}))}))},e.prototype.getSessionReplayProperties=function(){var e,t=this.config,n=this.identifiers;if(!t||!n)return this.loggerProvider.warn("Session replay init has not been called, cannot get session replay properties."),{};var r=this.getShouldRecord(),o={};return r&&((e={})[j]=n.sessionReplayId?n.sessionReplayId:null,o=e,t.debugMode&&(o[K]=JSON.stringify({appHash:J(t.apiKey).toString()}))),this.addCustomRRWebEvent(U.GET_SR_PROPS,{shouldRecord:r,eventProperties:o},10===this.eventCount),10===this.eventCount&&(this.eventCount=0),this.eventCount++,o},e.prototype.sendEvents=function(e){var t,n=e||(null===(t=this.identifiers)||void 0===t?void 0:t.sessionId),r=this.getDeviceId();this.eventsManager&&n&&r&&this.eventsManager.sendCurrentSequenceEvents({sessionId:n,deviceId:r})},e.prototype.initialize=function(e){var t;return void 0===e&&(e=!1),i(this,void 0,void 0,(function(){var n;return s(this,(function(r){return(null===(t=this.identifiers)||void 0===t?void 0:t.sessionId)?(n=this.getDeviceId())?(this.eventsManager&&e&&this.eventsManager.sendStoredEvents({deviceId:n}),[2,this.recordEvents()]):(this.loggerProvider.log("Session is not being recorded due to lack of device id."),[2,Promise.resolve()]):(this.loggerProvider.log("Session is not being recorded due to lack of session id."),[2,Promise.resolve()])}))}))},e.prototype.shouldOptOut=function(){var e,t,n,r;(null===(e=this.config)||void 0===e?void 0:e.instanceName)&&(n=(r=this.config.instanceName,void 0===r&&(r=f),D.getInstance(r)).identityStore.getIdentity().optOut);return void 0!==n?n:null===(t=this.config)||void 0===t?void 0:t.optOut},e.prototype.getShouldRecord=function(){if(!this.identifiers||!this.config||!this.identifiers.sessionId)return this.loggerProvider.warn("Session is not being recorded due to lack of config, please call sessionReplay.init."),!1;if(!this.config.captureEnabled)return this.loggerProvider.log("Session ".concat(this.identifiers.sessionId," not being captured due to capture being disabled for project or because the remote config could not be fetched.")),!1;if(this.shouldOptOut())return this.loggerProvider.log("Opting session ".concat(this.identifiers.sessionId," out of recording due to optOut config.")),!1;var e,t,n,r=!1,o="",i=!1;this.config.targetingConfig?this.sessionTargetingMatch?(o="Capturing replays for session ".concat(this.identifiers.sessionId," due to matching targeting conditions."),this.loggerProvider.log(o),r=!0,i=!0):(o="Not capturing replays for session ".concat(this.identifiers.sessionId," due to not matching targeting conditions."),this.loggerProvider.log(o),r=!1,i=!1):(e=this.identifiers.sessionId,t=this.config.sampleRate,n=J(e.toString()),31*Math.abs(n)%1e6/1e6<t)?(r=!0,i=!0):(o="Opting session ".concat(this.identifiers.sessionId," out of recording due to sample rate."),this.loggerProvider.log(o),r=!1,i=!1);return this.lastShouldRecordDecision!==r&&this.config.targetingConfig&&(this.addCustomRRWebEvent(U.TARGETING_DECISION,{message:o,sessionId:this.identifiers.sessionId,matched:i,targetingParams:this.lastTargetingParams}),this.lastShouldRecordDecision=r),r},e.prototype.getBlockSelectors=function(){var e,t,n,r=null!==(n=null===(t=null===(e=this.config)||void 0===e?void 0:e.privacyConfig)||void 0===t?void 0:t.blockSelector)&&void 0!==n?n:[];if(0!==r.length)return r},e.prototype.getMaskTextSelectors=function(){var e,t,n,r;if("conservative"===(null===(t=null===(e=this.config)||void 0===e?void 0:e.privacyConfig)||void 0===t?void 0:t.defaultMaskLevel))return"*";var o=null===(r=null===(n=this.config)||void 0===n?void 0:n.privacyConfig)||void 0===r?void 0:r.maskSelector;return o||void 0},e.prototype.getRecordingPlugins=function(e){var t,n,r,o,a,u;return i(this,void 0,void 0,(function(){var i,c,l,d;return s(this,(function(s){switch(s.label){case 0:i=[];try{c=hn({ugcFilterRules:(null===(n=null===(t=this.config)||void 0===t?void 0:t.interactionConfig)||void 0===n?void 0:n.ugcFilterRules)||[],enablePolling:(null===(r=this.config)||void 0===r?void 0:r.enableUrlChangePolling)||!1,pollingInterval:null===(o=this.config)||void 0===o?void 0:o.urlChangePollingInterval,captureDocumentTitle:null===(a=this.config)||void 0===a?void 0:a.captureDocumentTitle}),i.push(c)}catch(e){this.loggerProvider.warn("Failed to create URL tracking plugin:",e)}if(!(null===(u=null==e?void 0:e.console)||void 0===u?void 0:u.enabled))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,import("./console-plugin-min.js")];case 2:return l=s.sent().getRecordConsolePlugin,i.push(l({level:e.console.levels})),[3,4];case 3:return d=s.sent(),this.loggerProvider.warn("Failed to load console plugin:",d),[3,4];case 4:return[2,i.length>0?i:void 0]}}))}))},e.prototype.getRecordFunction=function(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(this.recordFunction)return[2,this.recordFunction];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,import("./rrweb-record-min.js")];case 2:return e=n.sent().record,this.recordFunction=e,[2,e];case 3:return t=n.sent(),this.loggerProvider.warn("Failed to load rrweb-record module:",t),[2,null];case 4:return[2]}}))}))},e.prototype.recordEvents=function(e){var t,n,r,o,a;return void 0===e&&(e=!0),i(this,void 0,void 0,(function(){var i,u,c,l,d,f,v,h,g,p,y,m,b,S=this;return s(this,(function(s){switch(s.label){case 0:return i=this.config,u=this.getShouldRecord(),c=null===(t=this.identifiers)||void 0===t?void 0:t.sessionId,u&&c&&i?(this.stopRecordingEvents(),[4,this.getRecordFunction()]):[2];case 1:return(l=s.sent())?[4,this.initializeNetworkObservers()]:[2];case 2:s.sent(),null===(n=this.networkObservers)||void 0===n||n.start((function(e){S.addCustomRRWebEvent(U.FETCH_REQUEST,e)})),d=i.privacyConfig,f=i.interactionConfig,v=i.loggingConfig,h=(null==f?void 0:f.enabled)?{mouseInteraction:this.eventsManager&&an(this.loggerProvider,{eventsManager:this.eventsManager,sessionId:c,deviceIdFn:this.getDeviceId.bind(this),mirror:l.mirror,ugcFilterRules:null!==(r=f.ugcFilterRules)&&void 0!==r?r:[]}),scroll:this.scrollHook}:{},g=(null==f?void 0:f.enabled)&&f.ugcFilterRules?f.ugcFilterRules:[],this.loggerProvider.log("Session Replay capture beginning for ".concat(c,".")),s.label=3;case 3:return s.trys.push([3,5,,6]),p=this,y=l,b={emit:function(e){if(S.shouldOptOut())return S.loggerProvider.log("Opting session ".concat(c," out of recording due to optOut config.")),S.stopRecordingEvents(),void S.sendEvents();e.type===re.Meta&&(e.data.href=X(e.data.href,g)),S.eventCompressor&&S.eventCompressor.enqueueEvent(e,c)},inlineStylesheet:i.shouldInlineStylesheet,hooks:h,maskAllInputs:!0,maskTextClass:$,blockClass:"amp-block",blockSelector:this.getBlockSelectors(),applyBackgroundColorToBlockedElements:i.applyBackgroundColorToBlockedElements,maskInputFn:H("input",d),maskTextFn:H("text",d),maskTextSelector:this.getMaskTextSelectors(),recordCanvas:!1,slimDOMOptions:{script:null===(o=i.omitElementTags)||void 0===o?void 0:o.script,comment:null===(a=i.omitElementTags)||void 0===a?void 0:a.comment},errorHandler:function(e){var t=e;if(t.message.includes("insertRule")&&t.message.includes("CSSStyleSheet"))throw t;if(t._external_)throw t;return S.loggerProvider.warn("Error while capturing replay: ",t.toString()),!0}},[4,this.getRecordingPlugins(v)];case 4:return p.recordCancelCallback=y.apply(void 0,[(b.plugins=s.sent(),b)]),this.addCustomRRWebEvent(U.DEBUG_INFO),e&&this.addCustomRRWebEvent(U.METADATA,this.metadata),[3,6];case 5:return m=s.sent(),this.loggerProvider.warn("Failed to initialize session replay:",m),[3,6];case 6:return[2]}}))}))},e.prototype.getDeviceId=function(){var e;return null===(e=this.identifiers)||void 0===e?void 0:e.deviceId},e.prototype.getSessionId=function(){var e;return null===(e=this.identifiers)||void 0===e?void 0:e.sessionId},e.prototype.flush=function(e){var t;return void 0===e&&(e=!1),i(this,void 0,void 0,(function(){return s(this,(function(n){return[2,null===(t=this.eventsManager)||void 0===t?void 0:t.flush(e)]}))}))},e.prototype.shutdown=function(){this.teardownEventListeners(!0),this.stopRecordingEvents(),this.sendEvents()},e.prototype.mapSDKType=function(e){return"plugin"===e?"@amplitude/plugin-session-replay-browser":"segment"===e?"@amplitude/segment-session-replay-plugin":null},e.prototype.setMetadata=function(e,t,n,r,o,i,s){var a=(null==e?void 0:e.toString())?J(e.toString()):void 0;this.metadata={joinedConfig:t,localConfig:n,remoteConfig:r,sessionId:e,hashValue:a,sampleRate:t.sampleRate,replaySDKType:this.mapSDKType(s),replaySDKVersion:o,standaloneSDKType:"@amplitude/session-replay-browser",standaloneSDKVersion:i}},e.prototype.initializeNetworkObservers=function(){var e,t,n;return i(this,void 0,void 0,(function(){var r,o;return s(this,(function(i){switch(i.label){case 0:if(!(null===(n=null===(t=null===(e=this.config)||void 0===e?void 0:e.loggingConfig)||void 0===t?void 0:t.network)||void 0===n?void 0:n.enabled)||this.networkObservers)return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,import("./observers-min.js")];case 2:return r=i.sent().NetworkObservers,this.networkObservers=new r,[3,4];case 3:return o=i.sent(),this.loggerProvider.warn("Failed to import or instantiate NetworkObservers:",o),[3,4];case 4:return[2]}}))}))},e}(),bn=function(e){return function(){var t=e.config||te();return{logger:t.loggerProvider,logLevel:t.logLevel}}},Sn=function(){var e=new mn;return{init:q(e.init.bind(e),"init",bn(e)),evaluateTargetingAndCapture:q(e.evaluateTargetingAndCapture.bind(e),"evaluateTargetingAndRecord",bn(e)),setSessionId:q(e.setSessionId.bind(e),"setSessionId",bn(e)),getSessionId:q(e.getSessionId.bind(e),"getSessionId",bn(e)),getSessionReplayProperties:q(e.getSessionReplayProperties.bind(e),"getSessionReplayProperties",bn(e)),flush:q(e.flush.bind(e),"flush",bn(e)),shutdown:q(e.shutdown.bind(e),"shutdown",bn(e))}}(),wn=Sn.init,In=Sn.setSessionId,En=Sn.getSessionId,Cn=Sn.getSessionReplayProperties,Pn=Sn.flush,Tn=Sn.shutdown,Rn=Sn.evaluateTargetingAndCapture;!function(e){e.SET="$set",e.SET_ONCE="$setOnce",e.ADD="$add",e.APPEND="$append",e.PREPEND="$prepend",e.REMOVE="$remove",e.PREINSERT="$preInsert",e.POSTINSERT="$postInsert",e.UNSET="$unset",e.CLEAR_ALL="$clearAll"}(gn||(gn={})),function(e){e.REVENUE_PRODUCT_ID="$productId",e.REVENUE_QUANTITY="$quantity",e.REVENUE_PRICE="$price",e.REVENUE_TYPE="$revenueType",e.REVENUE_CURRENCY="$currency",e.REVENUE="$revenue"}(pn||(pn={})),function(e){e.IDENTIFY="$identify",e.GROUP_IDENTIFY="$groupidentify",e.REVENUE="revenue_amount"}(yn||(yn={}));const _n=[gn.SET,gn.SET_ONCE,gn.ADD,gn.APPEND,gn.PREPEND,gn.POSTINSERT],kn="1.22.12";class xn{constructor(e){this.name=xn.pluginName,this.type="enrichment",this.sessionReplay={flush:Pn,getSessionId:En,getSessionReplayProperties:Cn,init:wn,setSessionId:In,shutdown:Tn,evaluateTargetingAndCapture:Rn},this.options=Object.assign({forceSessionTracking:!1},e),this.srInitOptions=this.options}setup(e,t){var n,r,o,s,a;return i(this,void 0,void 0,(function*(){try{null==e||e.loggerProvider.log(`Installing @amplitude/plugin-session-replay, version ${kn}.`),this.config=e,this.options.forceSessionTracking&&("boolean"==typeof e.defaultTracking?!1===e.defaultTracking&&(e.defaultTracking={pageViews:!1,formInteractions:!1,fileDownloads:!1,sessions:!0}):e.defaultTracking=Object.assign(Object.assign({},e.defaultTracking),{sessions:!0}));const i=(t=this.config.instanceName,void 0===t&&(t="$default_instance"),D.getInstance(t)).identityStore.getIdentity().userProperties;this.srInitOptions={instanceName:this.config.instanceName,deviceId:null!==(n=this.options.deviceId)&&void 0!==n?n:this.config.deviceId,optOut:this.config.optOut,sessionId:this.options.customSessionId?void 0:this.config.sessionId,loggerProvider:this.config.loggerProvider,logLevel:this.config.logLevel,flushMaxRetries:this.config.flushMaxRetries,serverZone:this.config.serverZone,configServerUrl:this.options.configServerUrl,trackServerUrl:this.options.trackServerUrl,sampleRate:this.options.sampleRate,privacyConfig:{blockSelector:null===(r=this.options.privacyConfig)||void 0===r?void 0:r.blockSelector,maskSelector:null===(o=this.options.privacyConfig)||void 0===o?void 0:o.maskSelector,unmaskSelector:null===(s=this.options.privacyConfig)||void 0===s?void 0:s.unmaskSelector,defaultMaskLevel:null===(a=this.options.privacyConfig)||void 0===a?void 0:a.defaultMaskLevel},debugMode:this.options.debugMode,shouldInlineStylesheet:this.options.shouldInlineStylesheet,version:{type:"plugin",version:kn},performanceConfig:this.options.performanceConfig,storeType:this.options.storeType,experimental:this.options.experimental,userProperties:i,omitElementTags:this.options.omitElementTags,applyBackgroundColorToBlockedElements:this.options.applyBackgroundColorToBlockedElements,interactionConfig:this.options.interactionConfig,captureDocumentTitle:this.options.captureDocumentTitle,enableUrlChangePolling:this.options.enableUrlChangePolling,urlChangePollingInterval:this.options.urlChangePollingInterval},yield this.sessionReplay.init(e.apiKey,this.srInitOptions).promise}catch(t){null==e||e.loggerProvider.error(`Session Replay: Failed to initialize due to ${t.message}`)}var t}))}onSessionIdChanged(e){return i(this,void 0,void 0,(function*(){this.config.loggerProvider.debug(`Analytics session id is changed to ${e}, SR session id is ${String(this.sessionReplay.getSessionId())}.`),yield this.sessionReplay.setSessionId(e).promise}))}onOptOutChanged(e){return i(this,void 0,void 0,(function*(){this.config.loggerProvider.debug(`optOut is changed to ${String(e)}, calling ${e?"sessionReplay.shutdown()":"sessionReplay.init()"}.`),e?this.sessionReplay.shutdown():yield this.sessionReplay.init(this.config.apiKey,this.srInitOptions).promise}))}execute(e){var t;return i(this,void 0,void 0,(function*(){try{if(this.options.customSessionId){const t=this.options.customSessionId(e);if(t){t!==this.sessionReplay.getSessionId()&&(yield this.sessionReplay.setSessionId(t).promise);const n=this.sessionReplay.getSessionReplayProperties();e.event_properties=Object.assign(Object.assign({},e.event_properties),n)}}else{const t=this.config.sessionId;if(t&&t!==this.sessionReplay.getSessionId()&&(yield this.sessionReplay.setSessionId(t).promise),t&&t===e.session_id){let t;e.event_type===r.IDENTIFY&&(t=(e=>{if(!e.user_properties)return;let t={};return Object.keys(e.user_properties).forEach((n=>{if(_n.includes(n)){const r=e.user_properties&&e.user_properties[n];t=Object.assign(Object.assign({},t),r)}})),t})(e)),yield this.sessionReplay.evaluateTargetingAndCapture({event:e,userProperties:t});const n=this.sessionReplay.getSessionReplayProperties();e.event_properties=Object.assign(Object.assign({},e.event_properties),n)}}return Promise.resolve(e)}catch(n){return null===(t=this.config)||void 0===t||t.loggerProvider.error(`Session Replay: Failed to enrich event due to ${n.message}`),Promise.resolve(e)}}))}teardown(){var e;return i(this,void 0,void 0,(function*(){try{this.sessionReplay.shutdown(),this.config=null}catch(t){null===(e=this.config)||void 0===e||e.loggerProvider.error(`Session Replay: teardown failed due to ${t.message}`)}}))}getSessionReplayProperties(){return this.sessionReplay.getSessionReplayProperties()}}xn.pluginName="@amplitude/plugin-session-replay-browser";const On=e=>new xn(e);export{xn as S,i as _,s as a,o as b,g,at as o,On as s};
//# sourceMappingURL=index-min.js.map
